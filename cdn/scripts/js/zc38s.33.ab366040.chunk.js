/*! For license information please see zc38s.33.ab366040.chunk.js.LICENSE.txt */

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="49ffa5cd-876e-5ae9-8c4a-06d441e3851a")}catch(e){}}();
(self.fnfr9t56xjj=self.fnfr9t56xjj||[]).push([[33],{16403:(NN,BN,lN)=>{"use strict";var kB=lN(16406),qN=lN(16415),cN=lN(16419);lN.g.__TYPEDARRAY_POOL||(lN.g.__TYPEDARRAY_POOL={UINT8:qN([32,0]),UINT16:qN([32,0]),UINT32:qN([32,0]),INT8:qN([32,0]),INT16:qN([32,0]),INT32:qN([32,0]),FLOAT:qN([32,0]),DOUBLE:qN([32,0]),DATA:qN([32,0]),UINT8C:qN([32,0]),BUFFER:qN([32,0])});var eN="undefined"!==typeof Uint8ClampedArray,vN=lN.g.__TYPEDARRAY_POOL;vN.UINT8C||(vN.UINT8C=qN([32,0])),vN.BUFFER||(vN.BUFFER=qN([32,0]));var HN=vN.DATA,TN=vN.BUFFER;function RN(NN){if(NN){var BN=NN.length||NN.byteLength,lN=kB.log2(BN);HN[lN].push(NN)}}function sN(NN){NN=kB.nextPow2(NN);var BN=kB.log2(NN),lN=HN[BN];return lN.length>0?lN.pop():new ArrayBuffer(NN)}function VN(NN){return new Uint8Array(sN(NN),0,NN)}function fN(NN){return new Uint16Array(sN(2*NN),0,NN)}function ZN(NN){return new Uint32Array(sN(4*NN),0,NN)}function PN(NN){return new Int8Array(sN(NN),0,NN)}function CN(NN){return new Int16Array(sN(2*NN),0,NN)}function FN(NN){return new Int32Array(sN(4*NN),0,NN)}function IN(NN){return new Float32Array(sN(4*NN),0,NN)}function AN(NN){return new Float64Array(sN(8*NN),0,NN)}function MN(NN){return eN?new Uint8ClampedArray(sN(NN),0,NN):VN(NN)}function GN(NN){return new DataView(sN(NN),0,NN)}BN.free=function(NN){if(cN(NN))TN[kB.log2(NN.length)].push(NN);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(NN)&&(NN=NN.buffer),!NN)return;var BN=NN.length||NN.byteLength,lN=0|kB.log2(BN);HN[lN].push(NN)}},BN.freeUint8=BN.freeUint16=BN.freeUint32=BN.freeInt8=BN.freeInt16=BN.freeInt32=BN.freeFloat32=BN.freeFloat=BN.freeFloat64=BN.freeDouble=BN.freeUint8Clamped=BN.freeDataView=function(NN){RN(NN.buffer)},BN.freeArrayBuffer=RN,BN.freeBuffer=function(NN){TN[kB.log2(NN.length)].push(NN)},BN.malloc=function(NN,BN){if(void 0===BN||"arraybuffer"===BN)return sN(NN);switch(BN){case"uint8":return VN(NN);case"uint16":return fN(NN);case"uint32":return ZN(NN);case"int8":return PN(NN);case"int16":return CN(NN);case"int32":return FN(NN);case"float":case"float32":return IN(NN);case"double":case"float64":return AN(NN);case"uint8_clamped":return MN(NN);case"buffer":throw"Buffer not supported";case"data":case"dataview":return GN(NN);default:return null}return null},BN.mallocArrayBuffer=sN,BN.mallocUint8=VN,BN.mallocUint16=fN,BN.mallocUint32=ZN,BN.mallocInt8=PN,BN.mallocInt16=CN,BN.mallocInt32=FN,BN.mallocFloat32=BN.mallocFloat=IN,BN.mallocFloat64=BN.mallocDouble=AN,BN.mallocUint8Clamped=MN,BN.mallocDataView=GN,BN.clearCache=function(){for(var NN=0;NN<32;++NN)vN.UINT8[NN].length=0,vN.UINT16[NN].length=0,vN.UINT32[NN].length=0,vN.INT8[NN].length=0,vN.INT16[NN].length=0,vN.INT32[NN].length=0,vN.FLOAT[NN].length=0,vN.DOUBLE[NN].length=0,vN.UINT8C[NN].length=0,HN[NN].length=0,TN[NN].length=0}},16509:(NN,BN,lN)=>{NN.exports=qN;var kB=lN(155);function qN(NN,BN){if(!(this instanceof qN))return new qN(NN,BN);var lN=kB.create();kB.add(lN,NN,BN),this.base=kB.min(kB.create(),NN,lN),this.Ys=kB.clone(BN),this.max=kB.max(kB.create(),NN,lN),this.mag=kB.length(this.Ys)}var cN=qN.prototype;cN.width=function(){return this.Ys[0]},cN.height=function(){return this.Ys[1]},cN.depth=function(){return this.Ys[2]},cN.x0=function(){return this.base[0]},cN.y0=function(){return this.base[1]},cN.z0=function(){return this.base[2]},cN.x1=function(){return this.max[0]},cN.y1=function(){return this.max[1]},cN.z1=function(){return this.max[2]},cN.translate=function(NN){return kB.add(this.max,this.max,NN),kB.add(this.base,this.base,NN),this},cN.setPosition=function(NN){return kB.add(this.max,NN,this.Ys),kB.zN(this.base,NN),this},cN.expand=function(NN){var BN=kB.create(),lN=kB.create();return kB.max(BN,NN.max,this.max),kB.min(lN,NN.base,this.base),kB.ZB(BN,BN,lN),new qN(lN,BN)},cN.intersects=function(NN){return!(NN.base[0]>this.max[0])&&(!(NN.base[1]>this.max[1])&&(!(NN.base[2]>this.max[2])&&(!(NN.max[0]<this.base[0])&&(!(NN.max[1]<this.base[1])&&!(NN.max[2]<this.base[2])))))},cN.touches=function(NN){var BN=this.union(NN);return null!==BN&&(0==BN.width()||0==BN.height()||0==BN.depth())},cN.union=function(NN){if(!this.intersects(NN))return null;var BN=Math.max(NN.base[0],this.base[0]),lN=Math.max(NN.base[1],this.base[1]),kB=Math.max(NN.base[2],this.base[2]);return new qN([BN,lN,kB],[Math.min(NN.max[0],this.max[0])-BN,Math.min(NN.max[1],this.max[1])-lN,Math.min(NN.max[2],this.max[2])-kB])}},16406:(NN,BN)=>{"use strict";function lN(NN){var BN=32;return(NN&=-NN)&&BN--,65535&NN&&(BN-=16),16711935&NN&&(BN-=8),252645135&NN&&(BN-=4),858993459&NN&&(BN-=2),1431655765&NN&&(BN-=1),BN}BN.INT_BITS=32,BN.INT_MAX=2147483647,BN.INT_MIN=-1<<31,BN.sign=function(NN){return(NN>0)-(NN<0)},BN.abs=function(NN){var BN=NN>>31;return(NN^BN)-BN},BN.min=function(NN,BN){return BN^(NN^BN)&-(NN<BN)},BN.max=function(NN,BN){return NN^(NN^BN)&-(NN<BN)},BN.isPow2=function(NN){return!(NN&NN-1)&&!!NN},BN.log2=function(NN){var BN,lN;return BN=(NN>65535)<<4,BN|=lN=((NN>>>=BN)>255)<<3,BN|=lN=((NN>>>=lN)>15)<<2,(BN|=lN=((NN>>>=lN)>3)<<1)|(NN>>>=lN)>>1},BN.log10=function(NN){return NN>=1e9?9:NN>=1e8?8:NN>=1e7?7:NN>=1e6?6:NN>=1e5?5:NN>=1e4?4:NN>=1e3?3:NN>=100?2:NN>=10?1:0},BN.popCount=function(NN){return 16843009*((NN=(858993459&(NN-=NN>>>1&1431655765))+(NN>>>2&858993459))+(NN>>>4)&252645135)>>>24},BN.countTrailingZeros=lN,BN.nextPow2=function(NN){return NN+=0===NN,--NN,NN|=NN>>>1,NN|=NN>>>2,NN|=NN>>>4,NN|=NN>>>8,(NN|=NN>>>16)+1},BN.prevPow2=function(NN){return NN|=NN>>>1,NN|=NN>>>2,NN|=NN>>>4,NN|=NN>>>8,(NN|=NN>>>16)-(NN>>>1)},BN.parity=function(NN){return NN^=NN>>>16,NN^=NN>>>8,NN^=NN>>>4,27030>>>(NN&=15)&1};var kB=new Array(256);!function(NN){for(var BN=0;BN<256;++BN){var lN=BN,kB=BN,qN=7;for(lN>>>=1;lN;lN>>>=1)kB<<=1,kB|=1&lN,--qN;NN[BN]=kB<<qN&255}}(kB),BN.reverse=function(NN){return kB[255&NN]<<24|kB[NN>>>8&255]<<16|kB[NN>>>16&255]<<8|kB[NN>>>24&255]},BN.interleave2=function(NN,BN){return(NN=1431655765&((NN=858993459&((NN=252645135&((NN=16711935&((NN&=65535)|NN<<8))|NN<<4))|NN<<2))|NN<<1))|(BN=1431655765&((BN=858993459&((BN=252645135&((BN=16711935&((BN&=65535)|BN<<8))|BN<<4))|BN<<2))|BN<<1))<<1},BN.deinterleave2=function(NN,BN){return(NN=65535&((NN=16711935&((NN=252645135&((NN=858993459&((NN=NN>>>BN&1431655765)|NN>>>1))|NN>>>2))|NN>>>4))|NN>>>16))<<16>>16},BN.interleave3=function(NN,BN,lN){return NN=1227133513&((NN=3272356035&((NN=251719695&((NN=4278190335&((NN&=1023)|NN<<16))|NN<<8))|NN<<4))|NN<<2),(NN|=(BN=1227133513&((BN=3272356035&((BN=251719695&((BN=4278190335&((BN&=1023)|BN<<16))|BN<<8))|BN<<4))|BN<<2))<<1)|(lN=1227133513&((lN=3272356035&((lN=251719695&((lN=4278190335&((lN&=1023)|lN<<16))|lN<<8))|lN<<4))|lN<<2))<<2},BN.deinterleave3=function(NN,BN){return(NN=1023&((NN=4278190335&((NN=251719695&((NN=3272356035&((NN=NN>>>BN&1227133513)|NN>>>2))|NN>>>4))|NN>>>8))|NN>>>16))<<22>>22},BN.nextCombination=function(NN){var BN=NN|NN-1;return BN+1|(~BN&-~BN)-1>>>lN(NN)+1}},16400:(NN,BN,lN)=>{"use strict";NN.exports=function(NN,BN,lN){switch(arguments.length){case 1:return kB=[],TN(qN=NN,qN,RN,!0),kB;case 2:return"function"===typeof BN?TN(NN,NN,BN,!0):function(NN,BN){return kB=[],TN(NN,BN,RN,!1),kB}(NN,BN);case 3:return TN(NN,BN,lN,!1);default:throw new Error("box-intersect: Invalid arguments")}var qN};var kB,qN=lN(16403),cN=lN(16428),eN=lN(16439);function vN(NN,BN){for(var lN=0;lN<NN;++lN)if(!(BN[lN]<=BN[lN+NN]))return!0;return!1}function HN(NN,BN,lN,kB){for(var qN=0,cN=0,eN=0,HN=NN.length;eN<HN;++eN){var TN=NN[eN];if(!vN(BN,TN)){for(var RN=0;RN<2*BN;++RN)lN[qN++]=TN[RN];kB[cN++]=eN}}return cN}function TN(NN,BN,lN,kB){var vN=NN.length,TN=BN.length;if(!(vN<=0||TN<=0)){var RN=NN[0].length>>>1;if(!(RN<=0)){var sN,VN=qN.mallocDouble(2*RN*vN),fN=qN.mallocInt32(vN);if((vN=HN(NN,RN,VN,fN))>0){if(1===RN&&kB)cN.init(vN),sN=cN.sweepComplete(RN,lN,0,vN,VN,fN,0,vN,VN,fN);else{var ZN=qN.mallocDouble(2*RN*TN),PN=qN.mallocInt32(TN);(TN=HN(BN,RN,ZN,PN))>0&&(cN.init(vN+TN),sN=1===RN?cN.sweepBipartite(RN,lN,0,vN,VN,fN,0,TN,ZN,PN):eN(RN,lN,kB,vN,VN,fN,TN,ZN,PN),qN.free(ZN),qN.free(PN))}qN.free(VN),qN.free(fN)}return sN}}}function RN(NN,BN){kB.push([NN,BN])}},16447:(NN,BN)=>{"use strict";var lN="d",kB="ax",qN="fp",cN="es",eN="rs",vN="re",HN="rb",TN="bs",RN="be",sN="bb",VN=[lN,kB,"vv",eN,vN,HN,"ri",TN,RN,sN,"bi"];function fN(NN){var BN="bruteForce"+(NN?"Full":"Partial"),kB=[],eN=VN.slice();NN||eN.splice(3,0,qN);var vN=["function "+BN+"("+eN.join()+"){"];function HN(BN,qN){var eN=function(NN,BN,kB){var qN="bruteForce"+(NN?"Red":"Blue")+(BN?"Flip":"")+(kB?"Full":""),eN=["function ",qN,"(",VN.join(),"){","var ",cN,"=2*",lN,";"],vN="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",HN="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(kB?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return NN?eN.push(vN,"Q",":",HN):eN.push(HN,"Q",":",vN),kB?eN.push("if(y1<x0||x1<y0)continue;"):BN?eN.push("if(y0<=x0||x1<y0)continue;"):eN.push("if(y0<x0||x1<y0)continue;"),eN.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),BN?eN.push("yi,xi"):eN.push("xi,yi"),eN.push(");if(rv!==void 0)return rv;}}}"),{name:qN,code:eN.join("")}}(BN,qN,NN);kB.push(eN.code),vN.push("return "+eN.name+"("+VN.join()+");")}vN.push("if(re-rs>be-bs){"),NN?(HN(!0,!1),vN.push("}else{"),HN(!1,!1)):(vN.push("if(fp){"),HN(!0,!0),vN.push("}else{"),HN(!0,!1),vN.push("}}else{if(fp){"),HN(!1,!0),vN.push("}else{"),HN(!1,!1),vN.push("}")),vN.push("}}return "+BN);var TN=kB.join("")+vN.join("");return new Function(TN)()}BN.partial=fN(!1),BN.full=fN(!0)},16439:(NN,BN,lN)=>{"use strict";NN.exports=function(NN,BN,lN,cN,RN,gN,nN,rN,pN){!function(NN,BN){var lN=8*qN.log2(BN+1)*(NN+1)|0,cN=qN.nextPow2(MN*lN);XN.length<cN&&(kB.free(XN),XN=kB.mallocInt32(cN));var eN=qN.nextPow2(GN*lN);uN.length<eN&&(kB.free(uN),uN=kB.mallocDouble(eN))}(NN,cN+nN);var xN,ON=0,wN=2*NN;dN(ON++,0,0,cN,0,nN,lN?16:0,-1/0,1/0),lN||dN(ON++,0,0,nN,0,cN,1,-1/0,1/0);for(;ON>0;){var bN=(ON-=1)*MN,mB=XN[bN],aN=XN[bN+1],DN=XN[bN+2],yN=XN[bN+3],LN=XN[bN+4],hN=XN[bN+5],UN=ON*GN,WN=uN[UN],QN=uN[UN+1],SN=1&hN,iB=!!(16&hN),tN=RN,oN=gN,JN=rN,YN=pN;if(SN&&(tN=rN,oN=pN,JN=RN,YN=gN),!(2&hN&&aN>=(DN=CN(NN,mB,aN,DN,tN,oN,QN)))&&!(4&hN&&(aN=FN(NN,mB,aN,DN,tN,oN,WN))>=DN)){var jB=DN-aN,zN=LN-yN;if(iB){if(NN*jB*(jB+zN)<fN){if(void 0!==(xN=HN.scanComplete(NN,mB,BN,aN,DN,tN,oN,yN,LN,JN,YN)))return xN;continue}}else{if(NN*Math.min(jB,zN)<sN){if(void 0!==(xN=eN(NN,mB,BN,SN,aN,DN,tN,oN,yN,LN,JN,YN)))return xN;continue}if(NN*jB*zN<VN){if(void 0!==(xN=HN.scanBipartite(NN,mB,BN,SN,aN,DN,tN,oN,yN,LN,JN,YN)))return xN;continue}}var NB=ZN(NN,mB,aN,DN,tN,oN,WN,QN);if(aN<NB)if(NN*(NB-aN)<sN){if(void 0!==(xN=vN(NN,mB+1,BN,aN,NB,tN,oN,yN,LN,JN,YN)))return xN}else if(mB===NN-2){if(void 0!==(xN=SN?HN.sweepBipartite(NN,BN,yN,LN,JN,YN,aN,NB,tN,oN):HN.sweepBipartite(NN,BN,aN,NB,tN,oN,yN,LN,JN,YN)))return xN}else dN(ON++,mB+1,aN,NB,yN,LN,SN,-1/0,1/0),dN(ON++,mB+1,yN,LN,aN,NB,1^SN,-1/0,1/0);if(NB<DN){var BB=TN(NN,mB,yN,LN,JN,YN),lB=JN[wN*BB+mB],kl=PN(NN,mB,BB,LN,JN,YN,lB);if(kl<LN&&dN(ON++,mB,NB,DN,kl,LN,(4|SN)+(iB?16:0),lB,QN),yN<BB&&dN(ON++,mB,NB,DN,yN,BB,(2|SN)+(iB?16:0),WN,lB),BB+1===kl){if(void 0!==(xN=iB?KN(NN,mB,BN,NB,DN,tN,oN,BB,JN,YN[BB]):EN(NN,mB,BN,SN,NB,DN,tN,oN,BB,JN,YN[BB])))return xN}else if(BB<kl){var qB;if(iB){if(NB<(qB=IN(NN,mB,NB,DN,tN,oN,lB))){var cB=PN(NN,mB,NB,qB,tN,oN,lB);if(mB===NN-2){if(NB<cB&&void 0!==(xN=HN.sweepComplete(NN,BN,NB,cB,tN,oN,BB,kl,JN,YN)))return xN;if(cB<qB&&void 0!==(xN=HN.sweepBipartite(NN,BN,cB,qB,tN,oN,BB,kl,JN,YN)))return xN}else NB<cB&&dN(ON++,mB+1,NB,cB,BB,kl,16,-1/0,1/0),cB<qB&&(dN(ON++,mB+1,cB,qB,BB,kl,0,-1/0,1/0),dN(ON++,mB+1,BB,kl,cB,qB,1,-1/0,1/0))}}else NB<(qB=SN?AN(NN,mB,NB,DN,tN,oN,lB):IN(NN,mB,NB,DN,tN,oN,lB))&&(mB===NN-2?xN=SN?HN.sweepBipartite(NN,BN,BB,kl,JN,YN,NB,qB,tN,oN):HN.sweepBipartite(NN,BN,NB,qB,tN,oN,BB,kl,JN,YN):(dN(ON++,mB+1,NB,qB,BB,kl,SN,-1/0,1/0),dN(ON++,mB+1,BB,kl,NB,qB,1^SN,-1/0,1/0)))}}}}};var kB=lN(16403),qN=lN(16406),cN=lN(16447),eN=cN.partial,vN=cN.full,HN=lN(16428),TN=lN(16455),RN=lN(16460),sN=128,VN=1<<22,fN=1<<22,ZN=RN("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),PN=RN("lo===p0",["p0"]),CN=RN("lo<p0",["p0"]),FN=RN("hi<=p0",["p0"]),IN=RN("lo<=p0&&p0<=hi",["p0"]),AN=RN("lo<p0&&p0<=hi",["p0"]),MN=6,GN=2,XN=kB.mallocInt32(1024),uN=kB.mallocDouble(1024);function dN(NN,BN,lN,kB,qN,cN,eN,vN,HN){var TN=MN*NN;XN[TN]=BN,XN[TN+1]=lN,XN[TN+2]=kB,XN[TN+3]=qN,XN[TN+4]=cN,XN[TN+5]=eN;var RN=GN*NN;uN[RN]=vN,uN[RN+1]=HN}function EN(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN,RN){var sN=2*NN,VN=HN*sN,fN=TN[VN+BN];NN:for(var ZN=qN,PN=qN*sN;ZN<cN;++ZN,PN+=sN){var CN=eN[PN+BN],FN=eN[PN+BN+NN];if(!(fN<CN||FN<fN)&&(!kB||fN!==CN)){for(var IN,AN=vN[ZN],MN=BN+1;MN<NN;++MN){CN=eN[PN+MN],FN=eN[PN+MN+NN];var GN=TN[VN+MN],XN=TN[VN+MN+NN];if(FN<GN||XN<CN)continue NN}if(void 0!==(IN=kB?lN(RN,AN):lN(AN,RN)))return IN}}}function KN(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN){var RN=2*NN,sN=vN*RN,VN=HN[sN+BN];NN:for(var fN=kB,ZN=kB*RN;fN<qN;++fN,ZN+=RN){var PN=eN[fN];if(PN!==TN){var CN=cN[ZN+BN],FN=cN[ZN+BN+NN];if(!(VN<CN||FN<VN)){for(var IN=BN+1;IN<NN;++IN){CN=cN[ZN+IN],FN=cN[ZN+IN+NN];var AN=HN[sN+IN],MN=HN[sN+IN+NN];if(FN<AN||MN<CN)continue NN}var GN=lN(PN,TN);if(void 0!==GN)return GN}}}}},16455:(NN,BN,lN)=>{"use strict";NN.exports=function(NN,BN,lN,eN,vN,HN){if(eN<=lN+1)return lN;var TN=lN,RN=eN,sN=eN+lN>>>1,VN=2*NN,fN=sN,ZN=vN[VN*sN+BN];for(;TN<RN;){if(RN-TN<qN){cN(NN,BN,TN,RN,vN,HN),ZN=vN[VN*sN+BN];break}var PN=RN-TN,CN=Math.random()*PN+TN|0,FN=vN[VN*CN+BN],IN=Math.random()*PN+TN|0,AN=vN[VN*IN+BN],MN=Math.random()*PN+TN|0,GN=vN[VN*MN+BN];FN<=AN?GN>=AN?(fN=IN,ZN=AN):FN>=GN?(fN=CN,ZN=FN):(fN=MN,ZN=GN):AN>=GN?(fN=IN,ZN=AN):GN>=FN?(fN=CN,ZN=FN):(fN=MN,ZN=GN);for(var XN=VN*(RN-1),uN=VN*fN,dN=0;dN<VN;++dN,++XN,++uN){var EN=vN[XN];vN[XN]=vN[uN],vN[uN]=EN}var KN=HN[RN-1];HN[RN-1]=HN[fN],HN[fN]=KN;for(XN=VN*(RN-1),uN=VN*(fN=kB(NN,BN,TN,RN-1,vN,HN,ZN)),dN=0;dN<VN;++dN,++XN,++uN){EN=vN[XN];vN[XN]=vN[uN],vN[uN]=EN}KN=HN[RN-1];if(HN[RN-1]=HN[fN],HN[fN]=KN,sN<fN){for(RN=fN-1;TN<RN&&vN[VN*(RN-1)+BN]===ZN;)RN-=1;RN+=1}else{if(!(fN<sN))break;for(TN=fN+1;TN<RN&&vN[VN*TN+BN]===ZN;)TN+=1}}return kB(NN,BN,lN,sN,vN,HN,vN[VN*sN+BN])};var kB=lN(16460)("lo<p0",["p0"]),qN=8;function cN(NN,BN,lN,kB,qN,cN){for(var eN=2*NN,vN=eN*(lN+1)+BN,HN=lN+1;HN<kB;++HN,vN+=eN)for(var TN=qN[vN],RN=HN,sN=eN*(HN-1);RN>lN&&qN[sN+BN]>TN;--RN,sN-=eN){for(var VN=sN,fN=sN+eN,ZN=0;ZN<eN;++ZN,++VN,++fN){var PN=qN[VN];qN[VN]=qN[fN],qN[fN]=PN}var CN=cN[RN];cN[RN]=cN[RN-1],cN[RN-1]=CN}}},16460:NN=>{"use strict";NN.exports=function(NN,lN){var kB="abcdef".split("").concat(lN),qN=[];NN.indexOf("lo")>=0&&qN.push("lo=e[k+n]");NN.indexOf("hi")>=0&&qN.push("hi=e[k+o]");return kB.push(BN.replace("_",qN.join()).replace("$",NN)),Function.apply(void 0,kB)};var BN="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},16433:NN=>{"use strict";NN.exports=function(NN,kB){kB<=4*BN?lN(0,kB-1,NN):TN(0,kB-1,NN)};var BN=32;function lN(NN,BN,lN){for(var kB=2*(NN+1),qN=NN+1;qN<=BN;++qN){for(var cN=lN[kB++],eN=lN[kB++],vN=qN,HN=kB-2;vN-- >NN;){var TN=lN[HN-2],RN=lN[HN-1];if(TN<cN)break;if(TN===cN&&RN<eN)break;lN[HN]=TN,lN[HN+1]=RN,HN-=2}lN[HN]=cN,lN[HN+1]=eN}}function kB(NN,BN,lN){BN*=2;var kB=lN[NN*=2],qN=lN[NN+1];lN[NN]=lN[BN],lN[NN+1]=lN[BN+1],lN[BN]=kB,lN[BN+1]=qN}function qN(NN,BN,lN){BN*=2,lN[NN*=2]=lN[BN],lN[NN+1]=lN[BN+1]}function cN(NN,BN,lN,kB){BN*=2,lN*=2;var qN=kB[NN*=2],cN=kB[NN+1];kB[NN]=kB[BN],kB[NN+1]=kB[BN+1],kB[BN]=kB[lN],kB[BN+1]=kB[lN+1],kB[lN]=qN,kB[lN+1]=cN}function eN(NN,BN,lN,kB,qN){BN*=2,qN[NN*=2]=qN[BN],qN[BN]=lN,qN[NN+1]=qN[BN+1],qN[BN+1]=kB}function vN(NN,BN,lN){BN*=2;var kB=lN[NN*=2],qN=lN[BN];return!(kB<qN)&&(kB!==qN||lN[NN+1]>lN[BN+1])}function HN(NN,BN,lN,kB){var qN=kB[NN*=2];return qN<BN||qN===BN&&kB[NN+1]<lN}function TN(NN,RN,sN){var VN=(RN-NN+1)/6|0,fN=NN+VN,ZN=RN-VN,PN=NN+RN>>1,CN=PN-VN,FN=PN+VN,IN=fN,AN=CN,MN=PN,GN=FN,XN=ZN,uN=NN+1,dN=RN-1,EN=0;vN(IN,AN,sN)&&(EN=IN,IN=AN,AN=EN),vN(GN,XN,sN)&&(EN=GN,GN=XN,XN=EN),vN(IN,MN,sN)&&(EN=IN,IN=MN,MN=EN),vN(AN,MN,sN)&&(EN=AN,AN=MN,MN=EN),vN(IN,GN,sN)&&(EN=IN,IN=GN,GN=EN),vN(MN,GN,sN)&&(EN=MN,MN=GN,GN=EN),vN(AN,XN,sN)&&(EN=AN,AN=XN,XN=EN),vN(AN,MN,sN)&&(EN=AN,AN=MN,MN=EN),vN(GN,XN,sN)&&(EN=GN,GN=XN,XN=EN);for(var KN=sN[2*AN],gN=sN[2*AN+1],nN=sN[2*GN],rN=sN[2*GN+1],pN=2*IN,xN=2*MN,ON=2*XN,wN=2*fN,bN=2*PN,mB=2*ZN,aN=0;aN<2;++aN){var DN=sN[pN+aN],yN=sN[xN+aN],LN=sN[ON+aN];sN[wN+aN]=DN,sN[bN+aN]=yN,sN[mB+aN]=LN}qN(CN,NN,sN),qN(FN,RN,sN);for(var hN=uN;hN<=dN;++hN)if(HN(hN,KN,gN,sN))hN!==uN&&kB(hN,uN,sN),++uN;else if(!HN(hN,nN,rN,sN))for(;;){if(HN(dN,nN,rN,sN)){HN(dN,KN,gN,sN)?(cN(hN,uN,dN,sN),++uN,--dN):(kB(hN,dN,sN),--dN);break}if(--dN<hN)break}eN(NN,uN-1,KN,gN,sN),eN(RN,dN+1,nN,rN,sN),uN-2-NN<=BN?lN(NN,uN-2,sN):TN(NN,uN-2,sN),RN-(dN+2)<=BN?lN(dN+2,RN,sN):TN(dN+2,RN,sN),dN-uN<=BN?lN(uN,dN,sN):TN(uN,dN,sN)}},16428:(NN,BN,lN)=>{"use strict";NN.exports={init:function(NN){var BN=qN.nextPow2(NN);HN.length<BN&&(kB.free(HN),HN=kB.mallocInt32(BN));TN.length<BN&&(kB.free(TN),TN=kB.mallocInt32(BN));RN.length<BN&&(kB.free(RN),RN=kB.mallocInt32(BN));sN.length<BN&&(kB.free(sN),sN=kB.mallocInt32(BN));VN.length<BN&&(kB.free(VN),VN=kB.mallocInt32(BN));fN.length<BN&&(kB.free(fN),fN=kB.mallocInt32(BN));var lN=8*BN;ZN.length<lN&&(kB.free(ZN),ZN=kB.mallocDouble(lN))},sweepBipartite:function(NN,BN,lN,kB,qN,vN,VN,fN,FN,IN){for(var AN=0,MN=2*NN,GN=NN-1,XN=MN-1,uN=lN;uN<kB;++uN){var dN=vN[uN],EN=MN*uN;ZN[AN++]=qN[EN+GN],ZN[AN++]=-(dN+1),ZN[AN++]=qN[EN+XN],ZN[AN++]=dN}for(uN=VN;uN<fN;++uN){dN=IN[uN]+eN;var KN=MN*uN;ZN[AN++]=FN[KN+GN],ZN[AN++]=-dN,ZN[AN++]=FN[KN+XN],ZN[AN++]=dN}var gN=AN>>>1;cN(ZN,gN);var nN=0,rN=0;for(uN=0;uN<gN;++uN){var pN=0|ZN[2*uN+1];if(pN>=eN)PN(RN,sN,rN--,pN=pN-eN|0);else if(pN>=0)PN(HN,TN,nN--,pN);else if(pN<=-eN){pN=-pN-eN|0;for(var xN=0;xN<nN;++xN){if(void 0!==(ON=BN(HN[xN],pN)))return ON}CN(RN,sN,rN++,pN)}else{pN=-pN-1|0;for(xN=0;xN<rN;++xN){var ON;if(void 0!==(ON=BN(pN,RN[xN])))return ON}CN(HN,TN,nN++,pN)}}},sweepComplete:function(NN,BN,lN,kB,qN,eN,vN,FN,IN,AN){for(var MN=0,GN=2*NN,XN=NN-1,uN=GN-1,dN=lN;dN<kB;++dN){var EN=eN[dN]+1<<1,KN=GN*dN;ZN[MN++]=qN[KN+XN],ZN[MN++]=-EN,ZN[MN++]=qN[KN+uN],ZN[MN++]=EN}for(dN=vN;dN<FN;++dN){EN=AN[dN]+1<<1;var gN=GN*dN;ZN[MN++]=IN[gN+XN],ZN[MN++]=1|-EN,ZN[MN++]=IN[gN+uN],ZN[MN++]=1|EN}var nN=MN>>>1;cN(ZN,nN);var rN=0,pN=0,xN=0;for(dN=0;dN<nN;++dN){var ON=0|ZN[2*dN+1],wN=1&ON;if(dN<nN-1&&ON>>1===ZN[2*dN+3]>>1&&(wN=2,dN+=1),ON<0){for(var bN=-(ON>>1)-1,mB=0;mB<xN;++mB){if(void 0!==(aN=BN(VN[mB],bN)))return aN}if(0!==wN)for(mB=0;mB<rN;++mB){if(void 0!==(aN=BN(HN[mB],bN)))return aN}if(1!==wN)for(mB=0;mB<pN;++mB){var aN;if(void 0!==(aN=BN(RN[mB],bN)))return aN}0===wN?CN(HN,TN,rN++,bN):1===wN?CN(RN,sN,pN++,bN):2===wN&&CN(VN,fN,xN++,bN)}else{bN=(ON>>1)-1;0===wN?PN(HN,TN,rN--,bN):1===wN?PN(RN,sN,pN--,bN):2===wN&&PN(VN,fN,xN--,bN)}}},scanBipartite:function(NN,BN,lN,kB,qN,vN,RN,sN,VN,fN,FN,IN){var AN=0,MN=2*NN,GN=BN,XN=BN+NN,uN=1,dN=1;kB?dN=eN:uN=eN;for(var EN=qN;EN<vN;++EN){var KN=EN+uN,gN=MN*EN;ZN[AN++]=RN[gN+GN],ZN[AN++]=-KN,ZN[AN++]=RN[gN+XN],ZN[AN++]=KN}for(EN=VN;EN<fN;++EN){KN=EN+dN;var nN=MN*EN;ZN[AN++]=FN[nN+GN],ZN[AN++]=-KN}var rN=AN>>>1;cN(ZN,rN);var pN=0;for(EN=0;EN<rN;++EN){var xN=0|ZN[2*EN+1];if(xN<0){var ON=!1;if((KN=-xN)>=eN?(ON=!kB,KN-=eN):(ON=!!kB,KN-=1),ON)CN(HN,TN,pN++,KN);else{var wN=IN[KN],bN=MN*KN,mB=FN[bN+BN+1],aN=FN[bN+BN+1+NN];NN:for(var DN=0;DN<pN;++DN){var yN=HN[DN],LN=MN*yN;if(!(aN<RN[LN+BN+1]||RN[LN+BN+1+NN]<mB)){for(var hN=BN+2;hN<NN;++hN)if(FN[bN+hN+NN]<RN[LN+hN]||RN[LN+hN+NN]<FN[bN+hN])continue NN;var UN,WN=sN[yN];if(void 0!==(UN=kB?lN(wN,WN):lN(WN,wN)))return UN}}}}else PN(HN,TN,pN--,xN-uN)}},scanComplete:function(NN,BN,lN,kB,qN,vN,TN,RN,sN,VN,fN){for(var PN=0,CN=2*NN,FN=BN,IN=BN+NN,AN=kB;AN<qN;++AN){var MN=AN+eN,GN=CN*AN;ZN[PN++]=vN[GN+FN],ZN[PN++]=-MN,ZN[PN++]=vN[GN+IN],ZN[PN++]=MN}for(AN=RN;AN<sN;++AN){MN=AN+1;var XN=CN*AN;ZN[PN++]=VN[XN+FN],ZN[PN++]=-MN}var uN=PN>>>1;cN(ZN,uN);var dN=0;for(AN=0;AN<uN;++AN){var EN=0|ZN[2*AN+1];if(EN<0){if((MN=-EN)>=eN)HN[dN++]=MN-eN;else{var KN=fN[MN-=1],gN=CN*MN,nN=VN[gN+BN+1],rN=VN[gN+BN+1+NN];NN:for(var pN=0;pN<dN;++pN){var xN=HN[pN],ON=TN[xN];if(ON===KN)break;var wN=CN*xN;if(!(rN<vN[wN+BN+1]||vN[wN+BN+1+NN]<nN)){for(var bN=BN+2;bN<NN;++bN)if(VN[gN+bN+NN]<vN[wN+bN]||vN[wN+bN+NN]<VN[gN+bN])continue NN;var mB=lN(ON,KN);if(void 0!==mB)return mB}}}}else{for(MN=EN-eN,pN=dN-1;pN>=0;--pN)if(HN[pN]===MN){for(bN=pN+1;bN<dN;++bN)HN[bN-1]=HN[bN];break}--dN}}}};var kB=lN(16403),qN=lN(16406),cN=lN(16433),eN=1<<28,vN=1024,HN=kB.mallocInt32(vN),TN=kB.mallocInt32(vN),RN=kB.mallocInt32(vN),sN=kB.mallocInt32(vN),VN=kB.mallocInt32(vN),fN=kB.mallocInt32(vN),ZN=kB.mallocDouble(8192);function PN(NN,BN,lN,kB){var qN=BN[kB],cN=NN[lN-1];NN[qN]=cN,BN[cN]=qN}function CN(NN,BN,lN,kB){NN[lN]=kB,BN[kB]=lN}},16415:NN=>{"use strict";function BN(NN,lN,kB){var qN=0|NN[kB];if(qN<=0)return[];var cN,eN=new Array(qN);if(kB===NN.length-1)for(cN=0;cN<qN;++cN)eN[cN]=lN;else for(cN=0;cN<qN;++cN)eN[cN]=BN(NN,lN,kB+1);return eN}NN.exports=function(NN,lN){switch("undefined"===typeof lN&&(lN=0),typeof NN){case"number":if(NN>0)return function(NN,BN){var lN,kB;for(lN=new Array(NN),kB=0;kB<NN;++kB)lN[kB]=BN;return lN}(0|NN,lN);break;case"object":if("number"===typeof NN.length)return BN(NN,lN,0)}return[]}},16376:(NN,BN,lN)=>{NN.exports=function(){var NN=this;this.components={},this.comps=this.components;var BN=this.components,lN=1,qN={},cN=[],eN=[],vN={timeout:!1,removals:[],multiComps:[]};function HN(NN,lN){var kB=BN[lN],cN=qN[lN],eN=cN.hash[NN];eN&&(cN.remove(NN),kB.GB&&(kB.multi?(eN.forEach((BN=>{BN&&kB.GB(NN,BN)})),eN.length=0):kB.GB(NN,eN)),vN.removals.push(cN),TN())}function TN(){vN.timeout||(vN.timeout=!0,setTimeout(RN,1))}function RN(){vN.timeout=!1,sN()}function sN(){vN.multiComps.length&&function(NN){for(var BN=0;BN<NN.length;BN++){var{entID:lN,data:kB}=NN[BN],qN=kB.hash[lN];if(qN){for(var cN=0;cN<qN.length;cN++)qN[cN]||(qN.splice(cN,1),cN--);0===qN.length&&(kB.remove(lN),vN.removals.push(kB))}}NN.length=0}(vN.multiComps),vN.removals.length&&function(NN){for(var BN=0;BN<NN.length;BN++){NN[BN].flush()}NN.length=0}(vN.removals)}this.Vf=qN,this._systems=cN,this._renderSystems=eN,this.DR=function(BN){var kB=lN++;return Array.isArray(BN)&&BN.forEach((BN=>NN.gR(kB,BN))),kB},this.deleteEntity=function(BN){return Object.keys(qN).forEach((NN=>{qN[NN].hash[BN]&&HN(BN,NN)})),NN},this.fV=function(NN){if(!NN)throw new Error("Missing component definition");var lN=NN.name;if(!lN)throw new Error("Component definition must have a name property.");if("string"!==typeof lN)throw new Error("Component name must be a string.");if(""===lN)throw new Error("Component name must be a non-empty string.");if(qN[lN])throw new Error("Component ".concat(lN," already exists."));var vN={};return vN.name=lN,vN.multi=!!NN.multi,vN.order=isNaN(NN.order)?99:NN.order,vN.stateConstructor=NN.stateConstructor||null,vN.state=NN.state||{},vN.IT=NN.IT||null,vN.GB=NN.GB||null,vN.system=NN.system||null,vN.pT=NN.pT||null,BN[lN]=vN,qN[lN]=new kB,qN[lN]._pendingMultiCleanup=!1,qN[lN]._multiCleanupIDs=vN.multi?[]:null,vN.system&&(cN.push(lN),cN.sort(((NN,lN)=>BN[NN].order-BN[lN].order))),vN.pT&&(eN.push(lN),eN.sort(((NN,lN)=>BN[NN].order-BN[lN].order))),lN},this.overwriteComponent=function(NN,lN){var kB=BN[NN];if(!kB)throw new Error("Unknown component: ".concat(NN));if(!lN)throw new Error("Missing component definition");if(kB.name!==lN.name)throw new Error("Overwriting component must use the same name property.");var vN={};vN.name=NN,vN.multi=!!lN.multi,vN.order=isNaN(lN.order)?99:lN.order,vN.state=lN.state||{},vN.IT=lN.IT||null,vN.GB=lN.GB||null,vN.system=lN.system||null,vN.pT=lN.pT||null,BN[NN]=vN,qN[NN]._pendingMultiCleanup=!1,qN[NN]._multiCleanupIDs=vN.multi?[]:null;var HN=cN.indexOf(NN);vN.system&&HN<0&&cN.push(NN),!vN.system&&HN>=0&&cN.splice(HN,1),cN.sort(((NN,lN)=>BN[NN].order-BN[lN].order));var TN=eN.indexOf(NN);vN.pT&&TN<0&&eN.push(NN),!vN.pT&&TN>=0&&eN.splice(TN,1),eN.sort(((NN,lN)=>BN[NN].order-BN[lN].order));var RN=vN.state;return this.ps(NN).forEach((NN=>{for(var BN in RN)BN in NN||(NN[BN]=RN[BN]);vN.IT&&vN.IT(NN.gT,NN)})),NN},this.deleteComponent=function(lN){var kB=qN[lN];if(!kB)throw new Error("Unknown component: ".concat(lN));kB.flush(),kB.list.forEach((NN=>{NN&&HN(NN.gT||NN[0].gT,lN)}));var vN=cN.indexOf(lN),TN=eN.indexOf(lN);return vN>-1&&cN.splice(vN,1),TN>-1&&eN.splice(TN,1),qN[lN].dispose(),delete qN[lN],delete BN[lN],NN},this.gR=function(NN,lN,kB){var cN,eN=BN[lN],vN=qN[lN];if(!vN)throw new Error("Unknown component: ".concat(lN,"."));if(vN.hash[NN]&&!eN.multi)throw new Error("Entity ".concat(NN," already has component: ").concat(lN,"."));if(eN.stateConstructor){if(!(cN=new eN.stateConstructor).hasOwnProperty("gT"))throw new Error("Component ".concat(eN.name," stateConstructor type does not have property __id"));Object.assign(cN,eN.state,kB)}else cN=Object.assign({},{gT:NN},eN.state,kB);if(cN.gT=NN,eN.multi){var HN=vN.hash[NN];HN||(HN=[],vN.add(NN,HN)),HN.push(cN)}else vN.add(NN,cN);return eN.IT&&eN.IT(NN,cN),this},this.aR=function(NN,BN){var lN=qN[BN];if(!lN)throw new Error("Unknown component: ".concat(BN,"."));return!!lN.hash[NN]},this.pR=function(BN,lN){if(!qN[lN])throw new Error("Unknown component: ".concat(lN,"."));return HN(BN,lN),NN},this.getState=function(NN,BN){var lN=qN[BN];if(!lN)throw new Error("Unknown component: ".concat(BN,"."));return lN.hash[NN]},this.ps=function(NN){var BN=qN[NN];if(!BN)throw new Error("Unknown component: ".concat(NN,"."));return sN(),BN.list},this.rP=function(NN){if(!qN[NN])throw new Error("Unknown component: ".concat(NN,"."));var BN=qN[NN].hash;return NN=>BN[NN]},this.xP=function(NN){if(!qN[NN])throw new Error("Unknown component: ".concat(NN,"."));var BN=qN[NN].hash;return NN=>!!BN[NN]},this.HT=function(lN){sN();for(var kB=0;kB<cN.length;kB++){var eN=cN[kB],vN=BN[eN],HN=qN[eN];vN.system(lN,HN.list),sN()}return NN},this.render=function(lN){sN();for(var kB=0;kB<eN.length;kB++){var cN=eN[kB],vN=BN[cN],HN=qN[cN];vN.pT(lN,HN.list),sN()}return NN},this.removeMultiComponent=function(lN,kB,cN){var eN=BN[kB],HN=qN[kB];if(!HN)throw new Error("Unknown component: ".concat(kB,"."));if(!eN.multi)throw new Error("removeMultiComponent called on non-multi component");return function(NN,BN,lN,kB){var qN=lN.hash[NN];if(qN){var cN=qN[kB];cN&&(qN[kB]=null,BN.GB&&BN.GB(NN,cN),vN.multiComps.push({entID:NN,data:lN}),TN())}}(lN,eN,HN,cN),NN}};var kB=lN(16378)},16378:NN=>{function BN(NN,BN){var lN=NN._map[BN];if(delete NN.hash[BN],delete NN._map[BN],lN===NN.list.length-1)NN.list.pop();else{var kB=NN.list.pop();if(NN.list[lN]=kB,null===kB||null===kB[0]){var qN=NN.list.length;for(var cN in NN._map)if(NN._map[cN]===qN)return void(NN._map[cN]=lN)}else{var eN=kB.gT||kB[0].gT;NN._map[eN]=lN}}}NN.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(NN,BN){if("number"===typeof this._map[NN]){var lN=this._map[NN];this.hash[NN]=BN,this.list[lN]=BN}else this._map[NN]=this.list.length,this.hash[NN]=BN,this.list.push(BN)}remove(NN){var BN=this._map[NN];this.hash[NN]=null,this.list[BN]=null,this._pendingRemovals.push(NN)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var NN=0;NN<this._pendingRemovals.length;NN++){var lN=this._pendingRemovals[NN];null===this.hash[lN]&&BN(this,lN)}this._pendingRemovals.length=0}}},16341:NN=>{"use strict";var BN,lN="object"===typeof Reflect?Reflect:null,kB=function(NN,BN,lN){return Function.prototype.apply.call(NN,BN,lN)};BN=lN&&"function"===typeof lN.ownKeys?lN.ownKeys:Object.getOwnPropertySymbols?function(NN){return Object.getOwnPropertyNames(NN).concat(Object.getOwnPropertySymbols(NN))}:function(NN){return Object.getOwnPropertyNames(NN)};var qN=Number.isNaN||function(NN){return NN!==NN};function cN(){cN.init.call(this)}NN.exports=cN,NN.exports.once=function(NN,BN){return new Promise((function(lN,kB){function qN(lN){NN.removeListener(BN,cN),kB(lN)}function cN(){"function"===typeof NN.removeListener&&NN.removeListener("error",qN),lN([].slice.call(arguments))}PN(NN,BN,cN,{once:!0}),"error"!==BN&&function(NN,BN,lN){"function"===typeof NN.on&&PN(NN,"error",BN,lN)}(NN,qN,{once:!0})}))},cN.EventEmitter=cN,cN.prototype._events=void 0,cN.prototype._eventsCount=0,cN.prototype._maxListeners=void 0;var eN=10;function vN(NN){if("function"!==typeof NN)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof NN)}function HN(NN){return void 0===NN._maxListeners?cN.defaultMaxListeners:NN._maxListeners}function TN(NN,BN,lN,kB){var qN,cN,eN,TN;if(vN(lN),void 0===(cN=NN._events)?(cN=NN._events=Object.create(null),NN._eventsCount=0):(void 0!==cN.newListener&&(NN.emit("newListener",BN,lN.listener?lN.listener:lN),cN=NN._events),eN=cN[BN]),void 0===eN)eN=cN[BN]=lN,++NN._eventsCount;else if("function"===typeof eN?eN=cN[BN]=kB?[lN,eN]:[eN,lN]:kB?eN.unshift(lN):eN.push(lN),(qN=HN(NN))>0&&eN.length>qN&&!eN.warned){eN.warned=!0;var RN=new Error("Possible EventEmitter memory leak detected. "+eN.length+" "+String(BN)+" listeners added. Use emitter.setMaxListeners() to increase limit");RN.name="MaxListenersExceededWarning",RN.NB=NN,RN.type=BN,RN.count=eN.length,TN=RN,console&&console.warn&&console.warn(TN)}return NN}function RN(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sN(NN,BN,lN){var kB={fired:!1,wrapFn:void 0,target:NN,type:BN,listener:lN},qN=RN.bind(kB);return qN.listener=lN,kB.wrapFn=qN,qN}function VN(NN,BN,lN){var kB=NN._events;if(void 0===kB)return[];var qN=kB[BN];return void 0===qN?[]:"function"===typeof qN?lN?[qN.listener||qN]:[qN]:lN?function(NN){for(var BN=new Array(NN.length),lN=0;lN<BN.length;++lN)BN[lN]=NN[lN].listener||NN[lN];return BN}(qN):ZN(qN,qN.length)}function fN(NN){var BN=this._events;if(void 0!==BN){var lN=BN[NN];if("function"===typeof lN)return 1;if(void 0!==lN)return lN.length}return 0}function ZN(NN,BN){for(var lN=new Array(BN),kB=0;kB<BN;++kB)lN[kB]=NN[kB];return lN}function PN(NN,BN,lN,kB){if("function"===typeof NN.on)kB.once?NN.once(BN,lN):NN.on(BN,lN);else{if("function"!==typeof NN.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof NN);NN.addEventListener(BN,(function qN(cN){kB.once&&NN.removeEventListener(BN,qN),lN(cN)}))}}Object.defineProperty(cN,"defaultMaxListeners",{enumerable:!0,get:function(){return eN},set:function(NN){if("number"!==typeof NN||NN<0||qN(NN))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+NN+".");eN=NN}}),cN.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},cN.prototype.setMaxListeners=function(NN){if("number"!==typeof NN||NN<0||qN(NN))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+NN+".");return this._maxListeners=NN,this},cN.prototype.getMaxListeners=function(){return HN(this)},cN.prototype.emit=function(NN){for(var BN=[],lN=1;lN<arguments.length;lN++)BN.push(arguments[lN]);var qN="error"===NN,cN=this._events;if(void 0!==cN)qN=qN&&void 0===cN.error;else if(!qN)return!1;if(qN){var eN;if(BN.length>0&&(eN=BN[0]),eN instanceof Error)throw eN;var vN=new Error("Unhandled error."+(eN?" ("+eN.message+")":""));throw vN.context=eN,vN}var HN=cN[NN];if(void 0===HN)return!1;if("function"===typeof HN)kB(HN,this,BN);else{var TN=HN.length,RN=ZN(HN,TN);for(lN=0;lN<TN;++lN)kB(RN[lN],this,BN)}return!0},cN.prototype.addListener=function(NN,BN){return TN(this,NN,BN,!1)},cN.prototype.on=cN.prototype.addListener,cN.prototype.prependListener=function(NN,BN){return TN(this,NN,BN,!0)},cN.prototype.once=function(NN,BN){return vN(BN),this.on(NN,sN(this,NN,BN)),this},cN.prototype.prependOnceListener=function(NN,BN){return vN(BN),this.prependListener(NN,sN(this,NN,BN)),this},cN.prototype.removeListener=function(NN,BN){var lN,kB,qN,cN,eN;if(vN(BN),void 0===(kB=this._events))return this;if(void 0===(lN=kB[NN]))return this;if(lN===BN||lN.listener===BN)0===--this._eventsCount?this._events=Object.create(null):(delete kB[NN],kB.removeListener&&this.emit("removeListener",NN,lN.listener||BN));else if("function"!==typeof lN){for(qN=-1,cN=lN.length-1;cN>=0;cN--)if(lN[cN]===BN||lN[cN].listener===BN){eN=lN[cN].listener,qN=cN;break}if(qN<0)return this;0===qN?lN.shift():function(NN,BN){for(;BN+1<NN.length;BN++)NN[BN]=NN[BN+1];NN.pop()}(lN,qN),1===lN.length&&(kB[NN]=lN[0]),void 0!==kB.removeListener&&this.emit("removeListener",NN,eN||BN)}return this},cN.prototype.off=cN.prototype.removeListener,cN.prototype.BB=function(NN){var BN,lN,kB;if(void 0===(lN=this._events))return this;if(void 0===lN.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==lN[NN]&&(0===--this._eventsCount?this._events=Object.create(null):delete lN[NN]),this;if(0===arguments.length){var qN,cN=Object.keys(lN);for(kB=0;kB<cN.length;++kB)"removeListener"!==(qN=cN[kB])&&this.BB(qN);return this.BB("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(BN=lN[NN]))this.removeListener(NN,BN);else if(void 0!==BN)for(kB=BN.length-1;kB>=0;kB--)this.removeListener(NN,BN[kB]);return this},cN.prototype.listeners=function(NN){return VN(this,NN,!0)},cN.prototype.rawListeners=function(NN){return VN(this,NN,!1)},cN.listenerCount=function(NN,BN){return"function"===typeof NN.listenerCount?NN.listenerCount(BN):fN.call(NN,BN)},cN.prototype.listenerCount=fN,cN.prototype.eventNames=function(){return this._eventsCount>0?BN(this._events):[]}},16793:NN=>{"use strict";NN.exports=function(NN,BN,lN,kB,qN,cN){var eN=+BN[0],vN=+BN[1],HN=+BN[2],TN=+lN[0],RN=+lN[1],sN=+lN[2],VN=Math.sqrt(TN*TN+RN*RN+sN*sN);if(0===VN)throw new Error("Can't raycast along a zero vector");return function(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN){for(var RN=0,sN=Math.floor,VN=0|sN(BN),fN=0|sN(lN),ZN=0|sN(kB),PN=qN>0?1:-1,CN=cN>0?1:-1,FN=eN>0?1:-1,IN=Math.abs(1/qN),AN=Math.abs(1/cN),MN=Math.abs(1/eN),GN=IN<1/0?IN*(PN>0?VN+1-BN:BN-VN):1/0,XN=AN<1/0?AN*(CN>0?fN+1-lN:lN-fN):1/0,uN=MN<1/0?MN*(FN>0?ZN+1-kB:kB-ZN):1/0,dN=-1;RN<=vN;){var EN=NN(VN,fN,ZN);if(EN)return HN&&(HN[0]=BN+RN*qN,HN[1]=lN+RN*cN,HN[2]=kB+RN*eN),TN&&(TN[0]=TN[1]=TN[2]=0,0===dN&&(TN[0]=-PN),1===dN&&(TN[1]=-CN),2===dN&&(TN[2]=-FN)),EN;GN<XN?GN<uN?(VN+=PN,RN=GN,GN+=IN,dN=0):(ZN+=FN,RN=uN,uN+=MN,dN=2):XN<uN?(fN+=CN,RN=XN,XN+=AN,dN=1):(ZN+=FN,RN=uN,uN+=MN,dN=2)}return HN&&(HN[0]=BN+RN*qN,HN[1]=lN+RN*cN,HN[2]=kB+RN*eN),TN&&(TN[0]=TN[1]=TN[2]=0),0}(NN,eN,vN,HN,TN/=VN,RN/=VN,sN/=VN,kB="undefined"===typeof kB?64:+kB,qN,cN)}},16828:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>cN});var kB=lN(16341);function qN(){this.xZ=!1,this.stopPropagation=!1,this.OZ=!1,this.disabled=!1}class cN{constructor(NN,BN){this.version="0.7.0";var lN=Object.assign({},new qN,BN||{});this.element=NN||document,this.xZ=!!lN.xZ,this.stopPropagation=!!lN.stopPropagation,this.OZ=!!lN.OZ,this.disabled=!!lN.disabled,this.filterEvents=(NN,BN)=>!0,this.down=new kB.EventEmitter,this.up=new kB.EventEmitter,this.state={},this.Es={dx:0,dy:0,GP:0,ds:0,XP:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?vN(this):document.addEventListener("DOMContentLoaded",(NN=>{vN(this)}),{once:!0})}bind(NN){for(var BN=arguments.length,lN=new Array(BN>1?BN-1:0),kB=1;kB<BN;kB++)lN[kB-1]=arguments[kB];lN.forEach((BN=>{var lN=this._keyBindmap[BN]||[];lN.includes(NN)||(lN.push(NN),this._keyBindmap[BN]=lN)})),this.state[NN]=!!this.state[NN],this.pressCount[NN]=this.pressCount[NN]||0,this.releaseCount[NN]=this.releaseCount[NN]||0}unbind(NN){for(var BN in this._keyBindmap){var lN=this._keyBindmap[BN],kB=lN.indexOf(NN);kB>-1&&lN.splice(kB,1)}}getBindings(){var NN={};for(var BN in this._keyBindmap){this._keyBindmap[BN].forEach((lN=>{NN[lN]=NN[lN]||[],NN[lN].push(BN)}))}return NN}HT(){eN(this.Es),eN(this.pressCount),eN(this.releaseCount)}}function eN(NN){for(var BN in NN)NN[BN]=0}function vN(NN){window.addEventListener("keydown",ZN.bind(null,NN,!0),!1),window.addEventListener("keyup",ZN.bind(null,NN,!1),!1);var BN={passive:!0};NN.element.addEventListener("touchstart",sN.bind(void 0,NN),{passive:!1}),NN.element.addEventListener("touchend",fN.bind(void 0,NN),BN),NN.element.addEventListener("mousedown",PN.bind(null,NN,!0),BN),window.document.addEventListener("mouseup",PN.bind(null,NN,!1),BN),NN.element.addEventListener("touchmove",CN.bind(null,NN),BN),NN.element.addEventListener("mousemove",CN.bind(null,NN),BN),window.PointerEvent,NN.element.addEventListener("wheel",FN.bind(null,NN),BN),NN.element.addEventListener("contextmenu",IN.bind(null,NN),!1),window.addEventListener("blur",AN.bind(null,NN),!1)}var HN=0,TN=0,RN=null;function sN(NN,BN){BN.preventDefault(),VN(BN)}function VN(NN){let BN=!1;for(let lN=0;lN<NN.touches.length;++lN)if(NN.touches[lN].identifier===RN){BN=!0;break}if(!BN){const BN=NN.changedTouches[0];HN=BN.clientX,TN=BN.clientY,RN=BN.identifier}}function fN(NN,BN){for(var lN=BN.changedTouches,kB=0;kB<lN.length;++kB)lN[kB].identifier===RN&&(RN=null)}function ZN(NN,BN,lN){MN(lN.code,BN,NN,lN)}function PN(NN,BN,lN){if("pointerId"in lN)if(BN){if(null!==NN._touches.currID)return;NN._touches.currID=lN.pointerId}else{if(NN._touches.currID!==lN.pointerId)return;NN._touches.currID=null}return MN("Mouse"+("button"in lN?lN.button+1:1),BN,NN,lN),!1}function CN(NN,BN){var lN=BN.movementX||BN.mozMovementX||0,kB=BN.movementY||BN.mozMovementY||0;if(BN.touches&&0===(lN|kB)){var qN=function(NN){VN(NN);for(let BN=0;BN<NN.changedTouches.length;++BN)if(NN.changedTouches[BN].identifier==RN){const lN=NN.changedTouches[BN],kB=[lN.clientX-HN,lN.clientY-TN];return HN=lN.clientX,TN=lN.clientY,kB}return console.error("Did not find touch id ".concat(RN)),[0,0]}(BN);lN=qN[0],kB=qN[1]}NN.Es.dx+=lN,NN.Es.dy+=kB}function FN(NN,BN){var lN=1;switch(BN.deltaMode){case 0:lN=1;break;case 1:lN=12;break;case 2:lN=NN.element.clientHeight||window.innerHeight}NN.Es.GP+=(BN.deltaX||0)*lN,NN.Es.ds+=(BN.deltaY||0)*lN,NN.Es.XP+=(BN.deltaZ||0)*lN}function IN(NN,BN){if(!NN.OZ)return BN.preventDefault(),!1}function AN(NN){for(var BN in NN._keyStates)NN._keyStates[BN]&&(/^Mouse\d/.test(BN)||MN(BN,!1,NN,{code:BN,note:"qszrlpgngl8",preventDefault:()=>{},stopPropagation:()=>{}}))}function MN(NN,BN,lN,kB){var qN=lN._keyBindmap[NN];qN&&(GN(lN._keyStates[NN],BN)&&(lN._keyStates[NN]=BN,qN.forEach((NN=>{(!lN.filterEvents||lN.filterEvents(kB,NN))&&function(NN,BN,lN,kB){var qN=BN?lN.pressCount:lN.releaseCount;qN[NN]=(qN[NN]||0)+1;var cN=lN._bindPressCount[NN]||0;(cN+=BN?1:-1)<0&&(cN=0);lN._bindPressCount[NN]=cN;var eN=lN.state[NN];if(GN(eN,cN)){lN.state[NN]=cN>0;var vN=BN?lN.down:lN.up;lN.disabled||vN.emit(NN,kB)}}(NN,BN,lN,kB)}))),"button"in kB||(lN.xZ&&!kB.defaultPrevented&&kB.preventDefault(),lN.stopPropagation&&kB.stopPropagation()))}function GN(NN,BN){return NN?!BN:BN}},16359:NN=>{"use strict";NN.exports=function(NN){for(var BN=new Array(NN),lN=0;lN<NN;++lN)BN[lN]=lN;return BN}},16419:NN=>{NN.exports=function(NN){return null!=NN&&null!=NN.constructor&&"function"===typeof NN.constructor.isBuffer&&NN.constructor.isBuffer(NN)}},16801:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>kB});class kB{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.bV=!1,this.aV=!1,this.OV=30,this.wV=0,this.DV=100,this.SV=!1,this.fullscreen=!1,this.yV=function(NN){},this.LV=function(NN,BN,lN){},this.WV=function(){},this.kc=function(){},this.hV=function(){},this.onFullscreenChanged=function(){},this.onPointerLockError=function(NN){},this._data=new qN(BN),function(NN){if("loading"===document.readyState){var BN=()=>{document.removeEventListener("readystatechange",BN),NN()};document.addEventListener("readystatechange",BN)}else setTimeout(NN,0)}((()=>{!function(NN){var BN=NN._data,lN=BN.nowObject.now();BN.lastTickStarted=lN,BN.lastFrameStarted=lN,BN.lastRenderStarted=lN,BN.frameCB=()=>function(NN){var BN=NN._data;requestAnimationFrame(BN.frameCB),vN(NN);var lN=BN.nowObject.now(),kB=lN-BN.lastFrameStarted;if(BN.lastFrameStarted=lN,NN.wV>0){BN.renderAccum+=kB;var qN=1e3/NN.wV;if(BN.renderAccum<qN)return;BN.renderAccum-=qN,BN.renderAccum>qN&&(BN.renderAccum=qN)}var cN=lN-BN.lastRenderStarted;BN.lastRenderStarted=lN;var eN=1e3/NN.OV,HN=(lN-BN.lastTickStarted)/eN;HN<0&&(HN=0);NN.LV(cN,HN,eN),setTimeout(vN,0,NN,!0)}(NN),BN.intervalCB=()=>vN(NN),requestAnimationFrame(BN.frameCB),BN.pollTime>0&&(BN.intervalID=setInterval(BN.intervalCB,Math.max(BN.pollTime,1e3/NN.OV/2)))}(this),function(NN,BN){if(!BN)return;var lN=!1,kB=!1,qN=NN=>{if(!!NN!==(lN=BN===document.pointerLockElement))if(NN){var kB=BN.requestPointerLock();kB&&kB.catch&&kB.catch((NN=>{}))}else document.exitPointerLock()},cN=NN=>{!!NN!==(kB=BN===document.fullscreenElement)&&(NN?BN.requestFullscreen?BN.requestFullscreen():BN.webkitRequestFullscreen&&BN.webkitRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())};document.addEventListener("pointerlockchange",(kB=>{lN=BN===document.pointerLockElement,NN.hV(lN)})),document.addEventListener("fullscreenchange",(lN=>{kB=BN===document.fullscreenElement,NN.onFullscreenChanged(kB)})),document.addEventListener("pointerlockerror",(kB=>{lN=BN===document.pointerLockElement,NN.onPointerLockError(kB)})),Object.defineProperty(NN,"SV",{get:()=>lN,set:qN}),Object.defineProperty(NN,"fullscreen",{get:()=>kB,set:cN}),BN.addEventListener("click",(BN=>{NN.bV&&qN(!0),NN.aV&&cN(!0)}));var eN=()=>NN.kc();if(window.ResizeObserver){new ResizeObserver(eN).observe(BN)}else window.addEventListener("resize",eN)}(this,NN),this.WV()}))}}function qN(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.nowObject=performance||Date,this.pollTime=NN,this.renderAccum=0,this.lastTickStarted=0,this.lastFrameStarted=0,this.lastRenderStarted=0,this.avgTickTime=2,this.frameCB=null,this.intervalCB=null,this.intervalID=-1}var cN=3,eN=20;function vN(NN){for(var BN=NN._data,lN=1e3/NN.OV,kB=BN.nowObject.now()+eN,qN=0;BN.nowObject.now()>=BN.lastTickStarted+lN&&BN.nowObject.now()<kB&&++qN<=cN;)NN.yV(lN),BN.lastTickStarted+=lN;var vN=5*(lN+5),HN=BN.nowObject.now();if(HN-BN.lastTickStarted>vN)for(;HN>=BN.lastTickStarted+lN;)BN.lastTickStarted+=lN}},16354:(NN,BN,lN)=>{var kB=lN(16359),qN=lN(16366),cN="undefined"!==typeof Float64Array;function eN(NN,BN){return NN[0]-BN[0]}function vN(){var NN,BN=this.stride,lN=new Array(BN.length);for(NN=0;NN<lN.length;++NN)lN[NN]=[Math.abs(BN[NN]),NN];lN.sort(eN);var kB=new Array(lN.length);for(NN=0;NN<kB.length;++NN)kB[NN]=lN[NN][1];return kB}function HN(NN,BN){var lN=["View",BN,"d",NN].join("");BN<0&&(lN="View_Nil"+NN);var qN="generic"===NN;if(-1===BN){var cN="function "+lN+"(a){this.data=a;};var proto="+lN+".prototype;proto.dtype='"+NN+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+lN+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+lN+"(a){return new "+lN+"(a);}";return new Function(cN)()}if(0===BN){cN="function "+lN+"(a,d) {this.data = a;this.offset = d};var proto="+lN+".prototype;proto.dtype='"+NN+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+lN+"_copy() {return new "+lN+"(this.data,this.offset)};proto.pick=function "+lN+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+lN+"_get(){return "+(qN?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+lN+"_set(v){return "+(qN?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+lN+"(a,b,c,d){return new "+lN+"(a,d)}";return new Function("TrivialArray",cN)(TN[NN][0])}cN=["'use strict'"];var eN=kB(BN),HN=eN.map((function(NN){return"i"+NN})),RN="this.offset+"+eN.map((function(NN){return"this.stride["+NN+"]*i"+NN})).join("+"),sN=eN.map((function(NN){return"b"+NN})).join(","),VN=eN.map((function(NN){return"c"+NN})).join(",");cN.push("function "+lN+"(a,"+sN+","+VN+",d){this.data=a","this.shape=["+sN+"]","this.stride=["+VN+"]","this.offset=d|0}","var proto="+lN+".prototype","proto.dtype='"+NN+"'","proto.dimension="+BN),cN.push("Object.defineProperty(proto,'size',{get:function "+lN+"_size(){return "+eN.map((function(NN){return"this.shape["+NN+"]"})).join("*"),"}})"),1===BN?cN.push("proto.order=[0]"):(cN.push("Object.defineProperty(proto,'order',{get:"),BN<4?(cN.push("function "+lN+"_order(){"),2===BN?cN.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===BN&&cN.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):cN.push("ORDER})")),cN.push("proto.set=function "+lN+"_set("+HN.join(",")+",v){"),qN?cN.push("return this.data.set("+RN+",v)}"):cN.push("return this.data["+RN+"]=v}"),cN.push("proto.get=function "+lN+"_get("+HN.join(",")+"){"),qN?cN.push("return this.data.get("+RN+")}"):cN.push("return this.data["+RN+"]}"),cN.push("proto.index=function "+lN+"_index(",HN.join(),"){return "+RN+"}"),cN.push("proto.hi=function "+lN+"_hi("+HN.join(",")+"){return new "+lN+"(this.data,"+eN.map((function(NN){return["(typeof i",NN,"!=='number'||i",NN,"<0)?this.shape[",NN,"]:i",NN,"|0"].join("")})).join(",")+","+eN.map((function(NN){return"this.stride["+NN+"]"})).join(",")+",this.offset)}");var fN=eN.map((function(NN){return"a"+NN+"=this.shape["+NN+"]"})),ZN=eN.map((function(NN){return"c"+NN+"=this.stride["+NN+"]"}));cN.push("proto.lo=function "+lN+"_lo("+HN.join(",")+"){var b=this.offset,d=0,"+fN.join(",")+","+ZN.join(","));for(var PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'&&i"+PN+">=0){d=i"+PN+"|0;b+=c"+PN+"*d;a"+PN+"-=d}");cN.push("return new "+lN+"(this.data,"+eN.map((function(NN){return"a"+NN})).join(",")+","+eN.map((function(NN){return"c"+NN})).join(",")+",b)}"),cN.push("proto.step=function "+lN+"_step("+HN.join(",")+"){var "+eN.map((function(NN){return"a"+NN+"=this.shape["+NN+"]"})).join(",")+","+eN.map((function(NN){return"b"+NN+"=this.stride["+NN+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'){d=i"+PN+"|0;if(d<0){c+=b"+PN+"*(a"+PN+"-1);a"+PN+"=ceil(-a"+PN+"/d)}else{a"+PN+"=ceil(a"+PN+"/d)}b"+PN+"*=d}");cN.push("return new "+lN+"(this.data,"+eN.map((function(NN){return"a"+NN})).join(",")+","+eN.map((function(NN){return"b"+NN})).join(",")+",c)}");var CN=new Array(BN),FN=new Array(BN);for(PN=0;PN<BN;++PN)CN[PN]="a[i"+PN+"]",FN[PN]="b[i"+PN+"]";cN.push("proto.transpose=function "+lN+"_transpose("+HN+"){"+HN.map((function(NN,BN){return NN+"=("+NN+"===undefined?"+BN+":"+NN+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+lN+"(this.data,"+CN.join(",")+","+FN.join(",")+",this.offset)}"),cN.push("proto.pick=function "+lN+"_pick("+HN+"){var a=[],b=[],c=this.offset");for(PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'&&i"+PN+">=0){c=(c+this.stride["+PN+"]*i"+PN+")|0}else{a.push(this.shape["+PN+"]);b.push(this.stride["+PN+"])}");return cN.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),cN.push("return function construct_"+lN+"(data,shape,stride,offset){return new "+lN+"(data,"+eN.map((function(NN){return"shape["+NN+"]"})).join(",")+","+eN.map((function(NN){return"stride["+NN+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",cN.join("\n"))(TN[NN],vN)}var TN={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};NN.exports=function(NN,BN,lN,kB){if(void 0===NN)return(0,TN.array[0])([]);"number"===typeof NN&&(NN=[NN]),void 0===BN&&(BN=[NN.length]);var eN=BN.length;if(void 0===lN){lN=new Array(eN);for(var vN=eN-1,RN=1;vN>=0;--vN)lN[vN]=RN,RN*=BN[vN]}if(void 0===kB){kB=0;for(vN=0;vN<eN;++vN)lN[vN]<0&&(kB-=(BN[vN]-1)*lN[vN])}for(var sN=function(NN){if(qN(NN))return"buffer";if(cN)switch(Object.prototype.toString.call(NN)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(NN)?"array":"generic"}(NN),VN=TN[sN];VN.length<=eN+1;)VN.push(HN(sN,VN.length-1));return(0,VN[eN+1])(NN,BN,lN,kB)}},16366:NN=>{function BN(NN){return!!NN.constructor&&"function"===typeof NN.constructor.isBuffer&&NN.constructor.isBuffer(NN)}NN.exports=function(NN){return null!=NN&&(BN(NN)||function(NN){return"function"===typeof NN.readFloatLE&&"function"===typeof NN.slice&&BN(NN.slice(0,0))}(NN)||!!NN._isBuffer)}},16515:NN=>{"use strict";var BN=[],lN=[],kB=[],qN=[],cN=[],eN=[],vN=[],HN=[],TN=[],RN=[],sN=[],VN=[];NN.exports=function(NN,fN,ZN,PN,CN,FN){for(var IN=vN,AN=TN,MN=RN,GN=VN,XN=0;XN<3;XN++)IN[XN]=+ZN[XN],MN[XN]=+fN.max[XN],AN[XN]=+fN.base[XN];FN||(FN=1e-10);var uN=function(NN,vN,TN,RN,VN,fN){var ZN=BN,PN=lN,CN=kB,FN=qN,IN=cN,AN=eN,MN=HN,GN=Math.floor,XN=0,uN=0,dN=0,EN=0,KN=0;if(gN(),0===dN)return 0;for(EN=pN();uN<=dN;){if(nN(EN)&&rN())return XN;EN=pN()}for(XN+=dN,KN=0;KN<3;KN++)RN[KN]+=TN[KN],VN[KN]+=TN[KN];return XN;function gN(){if(uN=0,0!==(dN=Math.sqrt(TN[0]*TN[0]+TN[1]*TN[1]+TN[2]*TN[2])))for(var NN=0;NN<3;NN++){var BN=TN[NN]>=0;FN[NN]=BN?1:-1;var lN=BN?VN[NN]:RN[NN];ZN[NN]=BN?RN[NN]:VN[NN],PN[NN]=xN(lN,FN[NN]),CN[NN]=ON(ZN[NN],FN[NN]),MN[NN]=TN[NN]/dN,IN[NN]=Math.abs(1/MN[NN]);var kB=BN?PN[NN]+1-lN:lN-PN[NN];AN[NN]=IN[NN]<1/0?IN[NN]*kB:1/0}}function nN(BN){for(var lN=FN[0],kB=0===BN?PN[0]:CN[0],qN=PN[0]+lN,cN=FN[1],eN=1===BN?PN[1]:CN[1],vN=PN[1]+cN,HN=FN[2],TN=2===BN?PN[2]:CN[2],RN=PN[2]+HN,sN=kB;sN!=qN;sN+=lN)for(var VN=eN;VN!=vN;VN+=cN)for(var fN=TN;fN!=RN;fN+=HN)if(NN(sN,VN,fN))return!0;return!1}function rN(){XN+=uN;var NN=FN[EN],BN=uN/dN,lN=sN;for(KN=0;KN<3;KN++){var kB=TN[KN]*BN;RN[KN]+=kB,VN[KN]+=kB,lN[KN]=TN[KN]-kB}if(NN>0?VN[EN]=Math.round(VN[EN]):RN[EN]=Math.round(RN[EN]),vN(XN,EN,NN,lN))return!0;for(KN=0;KN<3;KN++)TN[KN]=lN[KN];return gN(),0===dN}function pN(){var NN=AN[0]<AN[1]?AN[0]<AN[2]?0:2:AN[1]<AN[2]?1:2,BN=AN[NN]-uN;for(uN=AN[NN],PN[NN]+=FN[NN],AN[NN]+=IN[NN],KN=0;KN<3;KN++)ZN[KN]+=BN*MN[KN],CN[KN]=ON(ZN[KN],FN[KN]);return NN}function xN(NN,BN){return GN(NN-BN*fN)}function ON(NN,BN){return GN(NN+BN*fN)}}(NN,PN,IN,AN,MN,FN);if(!CN){for(XN=0;XN<3;XN++)GN[XN]=ZN[XN]>0?MN[XN]-fN.max[XN]:AN[XN]-fN.base[XN];fN.translate(GN)}return uN}},15623:function(NN,BN){!function(NN){"use strict";var BN=function(NN,lN){return BN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(NN,BN){NN.__proto__=BN}||function(NN,BN){for(var lN in BN)Object.prototype.hasOwnProperty.call(BN,lN)&&(NN[lN]=BN[lN])},BN(NN,lN)};function lN(NN,lN){if("function"!==typeof lN&&null!==lN)throw new TypeError("Class extends value "+String(lN)+" is not a constructor or null");function kB(){this.constructor=NN}BN(NN,lN),NN.prototype=null===lN?Object.create(lN):(kB.prototype=lN.prototype,new kB)}function kB(NN,BN,lN,kB){var qN,cN=arguments.length,eN=cN<3?BN:null===kB?kB=Object.getOwnPropertyDescriptor(BN,lN):kB;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)eN=Reflect.decorate(NN,BN,lN,kB);else for(var vN=NN.length-1;vN>=0;vN--)(qN=NN[vN])&&(eN=(cN<3?qN(eN):cN>3?qN(BN,lN,eN):qN(BN,lN))||eN);return cN>3&&eN&&Object.defineProperty(BN,lN,eN),eN}function qN(NN,BN,lN){if(lN||2===arguments.length)for(var kB,qN=0,cN=BN.length;qN<cN;qN++)!kB&&qN in BN||(kB||(kB=Array.prototype.slice.call(BN,0,qN)),kB[qN]=BN[qN]);return NN.concat(kB||Array.prototype.slice.call(BN))}var cN,eN=255,vN=213;NN.OPERATION=void 0,(cN=NN.OPERATION||(NN.OPERATION={}))[cN.ADD=128]="ADD",cN[cN.REPLACE=0]="REPLACE",cN[cN.DELETE=64]="DELETE",cN[cN.DELETE_AND_ADD=192]="DELETE_AND_ADD",cN[cN.TOUCH=1]="TOUCH",cN[cN.CLEAR=10]="CLEAR";var HN=function(){function BN(NN,BN,lN){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=NN,this.setParent(BN,lN)}return BN.prototype.setParent=function(NN,BN,lN){var kB=this;if(this.indexes||(this.indexes=this.ref instanceof xB?this.ref._definition.indexes:{}),this.parent=NN,this.parentIndex=lN,BN)if(this.root=BN,this.ref instanceof xB){var qN=this.ref._definition;for(var cN in qN.schema){var eN=this.ref[cN];if(eN&&eN.$changes){var vN=qN.indexes[cN];eN.$changes.setParent(this.ref,BN,vN)}}}else"object"===typeof this.ref&&this.ref.forEach((function(NN,BN){if(NN instanceof xB){var lN=NN.$changes,qN=kB.ref.$changes.indexes[BN];lN.setParent(kB.ref,kB.root,qN)}}))},BN.prototype.operation=function(NN){this.changes.set(--this.currentCustomOperation,NN)},BN.prototype.change=function(BN,lN){void 0===lN&&(lN=NN.OPERATION.ADD);var kB="number"===typeof BN?BN:this.indexes[BN];this.assertValidIndex(kB,BN);var qN=this.changes.get(kB);qN&&qN.op!==NN.OPERATION.DELETE&&qN.op!==NN.OPERATION.TOUCH||this.changes.set(kB,{op:qN&&qN.op===NN.OPERATION.DELETE?NN.OPERATION.DELETE_AND_ADD:lN,index:kB}),this.allChanges.add(kB),this.changed=!0,this.touchParents()},BN.prototype.touch=function(BN){var lN="number"===typeof BN?BN:this.indexes[BN];this.assertValidIndex(lN,BN),this.changes.has(lN)||this.changes.set(lN,{op:NN.OPERATION.TOUCH,index:lN}),this.allChanges.add(lN),this.touchParents()},BN.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},BN.prototype.getType=function(NN){if(this.ref._definition)return(BN=this.ref._definition).schema[BN.fieldsByIndex[NN]];var BN,lN=(BN=this.parent._definition).schema[BN.fieldsByIndex[this.parentIndex]];return Object.values(lN)[0]},BN.prototype.getChildrenFilter=function(){var NN=this.parent._definition.childFilters;return NN&&NN[this.parentIndex]},BN.prototype.getValue=function(NN){return this.ref.getByIndex(NN)},BN.prototype.delete=function(BN){var lN="number"===typeof BN?BN:this.indexes[BN];if(void 0!==lN){var kB=this.getValue(lN);this.changes.set(lN,{op:NN.OPERATION.DELETE,index:lN}),this.allChanges.delete(lN),delete this.caches[lN],kB&&kB.$changes&&(kB.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(BN," (").concat(lN,")"))},BN.prototype.discard=function(BN,lN){var kB=this;void 0===BN&&(BN=!1),void 0===lN&&(lN=!1),this.ref instanceof xB||this.changes.forEach((function(BN){if(BN.op===NN.OPERATION.DELETE){var lN=kB.ref.getIndex(BN.index);delete kB.indexes[lN]}})),this.changes.clear(),this.changed=BN,lN&&this.allChanges.clear(),this.currentCustomOperation=0},BN.prototype.discardAll=function(){var NN=this;this.changes.forEach((function(BN){var lN=NN.getValue(BN.index);lN&&lN.$changes&&lN.$changes.discardAll()})),this.discard()},BN.prototype.cache=function(NN,BN){this.caches[NN]=BN},BN.prototype.clone=function(){return new BN(this.ref,this.parent,this.root)},BN.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},BN.prototype.assertValidIndex=function(NN,BN){if(void 0===NN)throw new Error('ChangeTree: missing index for field "'.concat(BN,'"'))},BN}();function TN(NN,BN,lN,kB){return NN[BN]||(NN[BN]=[]),NN[BN].push(lN),null===kB||void 0===kB||kB.forEach((function(NN,BN){return lN(NN,BN)})),function(){return sN(NN[BN],NN[BN].indexOf(lN))}}function RN(BN){var lN=this,kB="string"!==typeof this.$changes.getType();this.$items.forEach((function(qN,cN){BN.push({refId:lN.$changes.refId,op:NN.OPERATION.DELETE,field:cN,value:void 0,previousValue:qN}),kB&&lN.$changes.root.removeRef(qN.$changes.refId)}))}function sN(NN,BN){if(-1===BN||BN>=NN.length)return!1;for(var lN=NN.length-1,kB=BN;kB<lN;kB++)NN[kB]=NN[kB+1];return NN.length=lN,!0}var VN=function(NN,BN){var lN=NN.toString(),kB=BN.toString();return lN<kB?-1:lN>kB?1:0};function fN(NN){return NN.$proxy=!0,NN=new Proxy(NN,{get:function(NN,BN){return"symbol"===typeof BN||isNaN(BN)?NN[BN]:NN.at(BN)},set:function(NN,BN,lN){if("symbol"===typeof BN||isNaN(BN))NN[BN]=lN;else{var kB=Array.from(NN.$items.keys()),qN=parseInt(kB[BN]||BN);void 0===lN||null===lN?NN.deleteAt(qN):NN.setAt(qN,lN)}return!0},deleteProperty:function(NN,BN){return"number"===typeof BN?NN.deleteAt(BN):delete NN[BN],!0}})}var ZN=function(){function BN(){for(var NN=[],BN=0;BN<arguments.length;BN++)NN[BN]=arguments[BN];this.$changes=new HN(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,NN)}return BN.prototype.IT=function(BN,lN){return void 0===lN&&(lN=!0),TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.ADD,BN,lN?this.$items:void 0)},BN.prototype.GB=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.DELETE,BN)},BN.prototype.onChange=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.REPLACE,BN)},BN.is=function(NN){return Array.isArray(NN)||void 0!==NN.array},Object.defineProperty(BN.prototype,"length",{get:function(){return this.$items.size},set:function(NN){0===NN?this.clear():this.splice(NN,this.length-NN)},enumerable:!1,configurable:!0}),BN.prototype.push=function(){for(var NN,BN=this,lN=[],kB=0;kB<arguments.length;kB++)lN[kB]=arguments[kB];return lN.forEach((function(lN){NN=BN.$refId++,BN.setAt(NN,lN)})),NN},BN.prototype.pop=function(){var NN=Array.from(this.$indexes.values()).pop();if(void 0!==NN){this.$changes.delete(NN),this.$indexes.delete(NN);var BN=this.$items.get(NN);return this.$items.delete(NN),BN}},BN.prototype.at=function(NN){var BN=Array.from(this.$items.keys())[NN];return this.$items.get(BN)},BN.prototype.setAt=function(BN,lN){var kB,qN;if(void 0!==lN&&null!==lN){if(this.$items.get(BN)!==lN){void 0!==lN.$changes&&lN.$changes.setParent(this,this.$changes.root,BN);var cN=null!==(qN=null===(kB=this.$changes.indexes[BN])||void 0===kB?void 0:kB.op)&&void 0!==qN?qN:NN.OPERATION.ADD;this.$changes.indexes[BN]=BN,this.$indexes.set(BN,BN),this.$items.set(BN,lN),this.$changes.change(BN,cN)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},BN.prototype.deleteAt=function(NN){var BN=Array.from(this.$items.keys())[NN];return void 0!==BN&&this.$deleteAt(BN)},BN.prototype.$deleteAt=function(NN){return this.$changes.delete(NN),this.$indexes.delete(NN),this.$items.delete(NN)},BN.prototype.clear=function(BN){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),BN&&RN.call(this,BN),this.$items.clear(),this.$changes.operation({index:0,op:NN.OPERATION.CLEAR}),this.$changes.touchParents()},BN.prototype.concat=function(){for(var NN,lN=[],kB=0;kB<arguments.length;kB++)lN[kB]=arguments[kB];return new(BN.bind.apply(BN,qN([void 0],(NN=Array.from(this.$items.values())).concat.apply(NN,lN),!1)))},BN.prototype.join=function(NN){return Array.from(this.$items.values()).join(NN)},BN.prototype.reverse=function(){var NN=this,BN=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(lN,kB){NN.setAt(BN[kB],lN)})),this},BN.prototype.shift=function(){var NN=Array.from(this.$items.keys()).shift();if(void 0!==NN){var BN=this.$items.get(NN);return this.$deleteAt(NN),BN}},BN.prototype.slice=function(NN,lN){var kB=new BN;return kB.push.apply(kB,Array.from(this.$items.values()).slice(NN,lN)),kB},BN.prototype.sort=function(NN){var BN=this;void 0===NN&&(NN=VN);var lN=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(NN).forEach((function(NN,kB){BN.setAt(lN[kB],NN)})),this},BN.prototype.splice=function(NN,BN){void 0===BN&&(BN=this.length-NN);for(var lN=Array.from(this.$items.keys()),kB=[],qN=NN;qN<NN+BN;qN++)kB.push(this.$items.get(lN[qN])),this.$deleteAt(lN[qN]);return kB},BN.prototype.unshift=function(){for(var NN=this,BN=[],lN=0;lN<arguments.length;lN++)BN[lN]=arguments[lN];var kB=this.length,qN=BN.length,cN=Array.from(this.$items.values());return BN.forEach((function(BN,lN){NN.setAt(lN,BN)})),cN.forEach((function(BN,lN){NN.setAt(qN+lN,BN)})),kB+qN},BN.prototype.indexOf=function(NN,BN){return Array.from(this.$items.values()).indexOf(NN,BN)},BN.prototype.lastIndexOf=function(NN,BN){return void 0===BN&&(BN=this.length-1),Array.from(this.$items.values()).lastIndexOf(NN,BN)},BN.prototype.every=function(NN,BN){return Array.from(this.$items.values()).every(NN,BN)},BN.prototype.some=function(NN,BN){return Array.from(this.$items.values()).some(NN,BN)},BN.prototype.forEach=function(NN,BN){Array.from(this.$items.values()).forEach(NN,BN)},BN.prototype.map=function(NN,BN){return Array.from(this.$items.values()).map(NN,BN)},BN.prototype.filter=function(NN,BN){return Array.from(this.$items.values()).filter(NN,BN)},BN.prototype.reduce=function(NN,BN){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},BN.prototype.reduceRight=function(NN,BN){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},BN.prototype.find=function(NN,BN){return Array.from(this.$items.values()).find(NN,BN)},BN.prototype.findIndex=function(NN,BN){return Array.from(this.$items.values()).findIndex(NN,BN)},BN.prototype.fill=function(NN,BN,lN){throw new Error("ArraySchema#fill() not implemented")},BN.prototype.copyWithin=function(NN,BN,lN){throw new Error("ArraySchema#copyWithin() not implemented")},BN.prototype.toString=function(){return this.$items.toString()},BN.prototype.toLocaleString=function(){return this.$items.toLocaleString()},BN.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(BN,Symbol.species,{get:function(){return BN},enumerable:!1,configurable:!0}),BN.prototype.entries=function(){return this.$items.entries()},BN.prototype.keys=function(){return this.$items.keys()},BN.prototype.values=function(){return this.$items.values()},BN.prototype.includes=function(NN,BN){return Array.from(this.$items.values()).includes(NN,BN)},BN.prototype.flatMap=function(NN,BN){throw new Error("ArraySchema#flatMap() is not supported.")},BN.prototype.flat=function(NN){throw new Error("ArraySchema#flat() is not supported.")},BN.prototype.findLast=function(){var NN=Array.from(this.$items.values());return NN.findLast.apply(NN,arguments)},BN.prototype.findLastIndex=function(){var NN=Array.from(this.$items.values());return NN.findLastIndex.apply(NN,arguments)},BN.prototype.setIndex=function(NN,BN){this.$indexes.set(NN,BN)},BN.prototype.getIndex=function(NN){return this.$indexes.get(NN)},BN.prototype.getByIndex=function(NN){return this.$items.get(this.$indexes.get(NN))},BN.prototype.deleteByIndex=function(NN){var BN=this.$indexes.get(NN);this.$items.delete(BN),this.$indexes.delete(NN)},BN.prototype.toArray=function(){return Array.from(this.$items.values())},BN.prototype.toJSON=function(){return this.toArray().map((function(NN){return"function"===typeof NN.toJSON?NN.toJSON():NN}))},BN.prototype.clone=function(NN){return NN?new(BN.bind.apply(BN,qN([void 0],Array.from(this.$items.values()),!1))):new(BN.bind.apply(BN,qN([void 0],this.map((function(NN){return NN.$changes?NN.clone():NN})),!1)))},BN}();function PN(NN){return NN.$proxy=!0,NN=new Proxy(NN,{get:function(NN,BN){return"symbol"!==typeof BN&&"undefined"===typeof NN[BN]?NN.get(BN):NN[BN]},set:function(NN,BN,lN){return"symbol"!==typeof BN&&-1===BN.indexOf("$")&&"IT"!==BN&&"GB"!==BN&&"onChange"!==BN?NN.set(BN,lN):NN[BN]=lN,!0},deleteProperty:function(NN,BN){return NN.delete(BN),!0}})}var CN=function(){function BN(NN){var lN=this;if(this.$changes=new HN(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,NN)if(NN instanceof Map||NN instanceof BN)NN.forEach((function(NN,BN){return lN.set(BN,NN)}));else for(var kB in NN)this.set(kB,NN[kB])}return BN.prototype.IT=function(BN,lN){return void 0===lN&&(lN=!0),TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.ADD,BN,lN?this.$items:void 0)},BN.prototype.GB=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.DELETE,BN)},BN.prototype.onChange=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.REPLACE,BN)},BN.is=function(NN){return void 0!==NN.map},BN.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(BN.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(BN,Symbol.species,{get:function(){return BN},enumerable:!1,configurable:!0}),BN.prototype.set=function(BN,lN){if(void 0===lN||null===lN)throw new Error("MapSchema#set('".concat(BN,"', ").concat(lN,"): trying to set ").concat(lN," value on '").concat(BN,"'."));BN=BN.toString();var kB="undefined"!==typeof this.$changes.indexes[BN],qN=kB?this.$changes.indexes[BN]:this.$refId++,cN=kB?NN.OPERATION.REPLACE:NN.OPERATION.ADD,eN=void 0!==lN.$changes;if(eN&&lN.$changes.setParent(this,this.$changes.root,qN),kB){if(!eN&&this.$items.get(BN)===lN)return;eN&&this.$items.get(BN)!==lN&&(cN=NN.OPERATION.ADD)}else this.$changes.indexes[BN]=qN,this.$indexes.set(qN,BN);return this.$items.set(BN,lN),this.$changes.change(BN,cN),this},BN.prototype.get=function(NN){return this.$items.get(NN)},BN.prototype.delete=function(NN){return this.$changes.delete(NN),this.$items.delete(NN)},BN.prototype.clear=function(BN){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),BN&&RN.call(this,BN),this.$items.clear(),this.$changes.operation({index:0,op:NN.OPERATION.CLEAR}),this.$changes.touchParents()},BN.prototype.has=function(NN){return this.$items.has(NN)},BN.prototype.forEach=function(NN){this.$items.forEach(NN)},BN.prototype.entries=function(){return this.$items.entries()},BN.prototype.keys=function(){return this.$items.keys()},BN.prototype.values=function(){return this.$items.values()},Object.defineProperty(BN.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),BN.prototype.setIndex=function(NN,BN){this.$indexes.set(NN,BN)},BN.prototype.getIndex=function(NN){return this.$indexes.get(NN)},BN.prototype.getByIndex=function(NN){return this.$items.get(this.$indexes.get(NN))},BN.prototype.deleteByIndex=function(NN){var BN=this.$indexes.get(NN);this.$items.delete(BN),this.$indexes.delete(NN)},BN.prototype.toJSON=function(){var NN={};return this.forEach((function(BN,lN){NN[lN]="function"===typeof BN.toJSON?BN.toJSON():BN})),NN},BN.prototype.clone=function(NN){var lN;return NN?lN=Object.assign(new BN,this):(lN=new BN,this.forEach((function(NN,BN){NN.$changes?lN.set(BN,NN.clone()):lN.set(BN,NN)}))),lN},BN}(),FN={};function IN(NN,BN){FN[NN]=BN}function AN(NN){return FN[NN]}var MN=function(){function NN(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return NN.create=function(BN){var lN=new NN;return lN.schema=Object.assign({},BN&&BN.schema||{}),lN.indexes=Object.assign({},BN&&BN.indexes||{}),lN.fieldsByIndex=Object.assign({},BN&&BN.fieldsByIndex||{}),lN.descriptors=Object.assign({},BN&&BN.descriptors||{}),lN.deprecated=Object.assign({},BN&&BN.deprecated||{}),lN},NN.prototype.addField=function(NN,BN){var lN=this.getNextFieldIndex();this.fieldsByIndex[lN]=NN,this.indexes[NN]=lN,this.schema[NN]=Array.isArray(BN)?{array:BN[0]}:BN},NN.prototype.hasField=function(NN){return void 0!==this.indexes[NN]},NN.prototype.addFilter=function(NN,BN){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[NN]]=BN,this.indexesWithFilters.push(this.indexes[NN]),!0},NN.prototype.addChildrenFilter=function(NN,BN){var lN=this.indexes[NN],kB=this.schema[NN];if(AN(Object.keys(kB)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[lN]=BN,!0;console.warn("@filterChildren: field '".concat(NN,"' can't have children. Ignoring filter."))},NN.prototype.getChildrenFilter=function(NN){return this.childFilters&&this.childFilters[this.indexes[NN]]},NN.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},NN}();function GN(NN){return NN._context&&NN._context.useFilters}var XN=function(){function NN(){this.types={},this.schemas=new Map,this.useFilters=!1}return NN.prototype.has=function(NN){return this.schemas.has(NN)},NN.prototype.get=function(NN){return this.types[NN]},NN.prototype.add=function(NN,BN){void 0===BN&&(BN=this.schemas.size),NN._definition=MN.create(NN._definition),NN._typeid=BN,this.types[BN]=NN,this.schemas.set(NN,BN)},NN.create=function(BN){return void 0===BN&&(BN={}),function(lN){return BN.context||(BN.context=new NN),dN(lN,BN)}},NN}(),uN=new XN;function dN(NN,BN){return void 0===BN&&(BN={}),function(lN,kB){var cN=BN.context||uN,eN=lN.constructor;if(eN._context=cN,!NN)throw new Error("".concat(eN.name,': @type() reference provided for "').concat(kB,"\" is undefined. Make sure you don't have any circular dependencies."));cN.has(eN)||cN.add(eN);var vN=eN._definition;if(vN.addField(kB,NN),vN.descriptors[kB]){if(vN.deprecated[kB])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(kB,"' definition on '").concat(eN.name,"'.\nCheck @type() annotation"))}catch(FN){var HN=FN.stack.split("\n")[4].trim();throw new Error("".concat(FN.message," ").concat(HN))}}var TN=ZN.is(NN),RN=!TN&&CN.is(NN);if("string"!==typeof NN&&!xB.is(NN)){var sN=Object.values(NN)[0];"string"===typeof sN||cN.has(sN)||cN.add(sN)}if(BN.manual)vN.descriptors[kB]={enumerable:!0,configurable:!0,writable:!0};else{var VN="_".concat(kB);vN.descriptors[VN]={enumerable:!1,configurable:!1,writable:!0},vN.descriptors[kB]={get:function(){return this[VN]},set:function(NN){NN!==this[VN]&&(void 0!==NN&&null!==NN?(!TN||NN instanceof ZN||(NN=new(ZN.bind.apply(ZN,qN([void 0],NN,!1)))),!RN||NN instanceof CN||(NN=new CN(NN)),void 0===NN.$proxy&&(RN?NN=PN(NN):TN&&(NN=fN(NN))),this.$changes.change(kB),NN.$changes&&NN.$changes.setParent(this,this.$changes.root,this._definition.indexes[kB])):this[VN]&&this.$changes.delete(kB),this[VN]=NN)},enumerable:!0,configurable:!0}}}}function EN(NN){return function(BN,lN){var kB=BN.constructor;kB._definition.addFilter(lN,NN)&&(kB._context.useFilters=!0)}}function KN(NN){return function(BN,lN){var kB=BN.constructor;kB._definition.addChildrenFilter(lN,NN)&&(kB._context.useFilters=!0)}}function gN(NN){return void 0===NN&&(NN=!0),function(BN,lN){var kB=BN.constructor._definition;kB.deprecated[lN]=!0,NN&&(kB.descriptors[lN]={get:function(){throw new Error("".concat(lN," is deprecated."))},set:function(NN){},enumerable:!1,configurable:!0})}}function nN(NN,BN,lN){for(var kB in void 0===lN&&(lN={}),lN.context||(lN.context=NN._context||lN.context||uN),BN)dN(BN[kB],lN)(NN.prototype,kB);return NN}function rN(NN){for(var BN=0,lN=0,kB=0,qN=NN.length;kB<qN;kB++)(BN=NN.charCodeAt(kB))<128?lN+=1:BN<2048?lN+=2:BN<55296||BN>=57344?lN+=3:(kB++,lN+=4);return lN}function pN(NN,BN,lN){for(var kB=0,qN=0,cN=lN.length;qN<cN;qN++)(kB=lN.charCodeAt(qN))<128?NN[BN++]=kB:kB<2048?(NN[BN++]=192|kB>>6,NN[BN++]=128|63&kB):kB<55296||kB>=57344?(NN[BN++]=224|kB>>12,NN[BN++]=128|kB>>6&63,NN[BN++]=128|63&kB):(qN++,kB=65536+((1023&kB)<<10|1023&lN.charCodeAt(qN)),NN[BN++]=240|kB>>18,NN[BN++]=128|kB>>12&63,NN[BN++]=128|kB>>6&63,NN[BN++]=128|63&kB)}function xN(NN,BN){NN.push(255&BN)}function ON(NN,BN){NN.push(255&BN)}function wN(NN,BN){NN.push(255&BN),NN.push(BN>>8&255)}function bN(NN,BN){NN.push(255&BN),NN.push(BN>>8&255)}function mB(NN,BN){NN.push(255&BN),NN.push(BN>>8&255),NN.push(BN>>16&255),NN.push(BN>>24&255)}function aN(NN,BN){var lN=BN>>24,kB=BN>>16,qN=BN>>8,cN=BN;NN.push(255&cN),NN.push(255&qN),NN.push(255&kB),NN.push(255&lN)}function DN(NN,BN){var lN=Math.floor(BN/Math.pow(2,32));aN(NN,BN>>>0),aN(NN,lN)}function yN(NN,BN){var lN=BN/Math.pow(2,32)|0;aN(NN,BN>>>0),aN(NN,lN)}function LN(NN,BN){SN(NN,BN)}function hN(NN,BN){iB(NN,BN)}var UN=new Int32Array(2),WN=new Float32Array(UN.buffer),QN=new Float64Array(UN.buffer);function SN(NN,BN){WN[0]=BN,mB(NN,UN[0])}function iB(NN,BN){QN[0]=BN,mB(NN,UN[0]),mB(NN,UN[1])}function tN(NN,BN){return ON(NN,BN?1:0)}function oN(NN,BN){BN||(BN="");var lN=rN(BN),kB=0;if(lN<32)NN.push(160|lN),kB=1;else if(lN<256)NN.push(217),ON(NN,lN),kB=2;else if(lN<65536)NN.push(218),bN(NN,lN),kB=3;else{if(!(lN<4294967296))throw new Error("String too long");NN.push(219),aN(NN,lN),kB=5}return pN(NN,NN.length,BN),kB+lN}function JN(NN,BN){return isNaN(BN)?JN(NN,0):isFinite(BN)?BN!==(0|BN)?(NN.push(203),iB(NN,BN),9):BN>=0?BN<128?(ON(NN,BN),1):BN<256?(NN.push(204),ON(NN,BN),2):BN<65536?(NN.push(205),bN(NN,BN),3):BN<4294967296?(NN.push(206),aN(NN,BN),5):(NN.push(207),yN(NN,BN),9):BN>=-32?(NN.push(224|BN+32),1):BN>=-128?(NN.push(208),xN(NN,BN),2):BN>=-32768?(NN.push(209),wN(NN,BN),3):BN>=-2147483648?(NN.push(210),mB(NN,BN),5):(NN.push(211),DN(NN,BN),9):JN(NN,BN>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var YN=Object.freeze({__proto__:null,utf8Write:pN,int8:xN,uint8:ON,int16:wN,uint16:bN,int32:mB,uint32:aN,int64:DN,uint64:yN,float32:LN,float64:hN,writeFloat32:SN,writeFloat64:iB,boolean:tN,string:oN,number:JN});function jB(NN,BN,lN){for(var kB="",qN=0,cN=BN,eN=BN+lN;cN<eN;cN++){var vN=NN[cN];0!==(128&vN)?192!==(224&vN)?224!==(240&vN)?240!==(248&vN)?console.error("Invalid byte "+vN.toString(16)):(qN=(7&vN)<<18|(63&NN[++cN])<<12|(63&NN[++cN])<<6|63&NN[++cN])>=65536?(qN-=65536,kB+=String.fromCharCode(55296+(qN>>>10),56320+(1023&qN))):kB+=String.fromCharCode(qN):kB+=String.fromCharCode((15&vN)<<12|(63&NN[++cN])<<6|63&NN[++cN]):kB+=String.fromCharCode((31&vN)<<6|63&NN[++cN]):kB+=String.fromCharCode(vN)}return kB}function zN(NN,BN){return NB(NN,BN)<<24>>24}function NB(NN,BN){return NN[BN.offset++]}function BB(NN,BN){return lB(NN,BN)<<16>>16}function lB(NN,BN){return NN[BN.offset++]|NN[BN.offset++]<<8}function kl(NN,BN){return NN[BN.offset++]|NN[BN.offset++]<<8|NN[BN.offset++]<<16|NN[BN.offset++]<<24}function qB(NN,BN){return kl(NN,BN)>>>0}function cB(NN,BN){return VB(NN,BN)}function eB(NN,BN){return fB(NN,BN)}function vB(NN,BN){var lN=qB(NN,BN);return kl(NN,BN)*Math.pow(2,32)+lN}function HB(NN,BN){var lN=qB(NN,BN);return qB(NN,BN)*Math.pow(2,32)+lN}var TB=new Int32Array(2),RB=new Float32Array(TB.buffer),sB=new Float64Array(TB.buffer);function VB(NN,BN){return TB[0]=kl(NN,BN),RB[0]}function fB(NN,BN){return TB[0]=kl(NN,BN),TB[1]=kl(NN,BN),sB[0]}function ZB(NN,BN){return NB(NN,BN)>0}function PB(NN,BN){var lN,kB=NN[BN.offset++];kB<192?lN=31&kB:217===kB?lN=NB(NN,BN):218===kB?lN=lB(NN,BN):219===kB&&(lN=qB(NN,BN));var qN=jB(NN,BN.offset,lN);return BN.offset+=lN,qN}function CB(NN,BN){var lN=NN[BN.offset];return lN<192&&lN>160||217===lN||218===lN||219===lN}function FB(NN,BN){var lN=NN[BN.offset++];return lN<128?lN:202===lN?VB(NN,BN):203===lN?fB(NN,BN):204===lN?NB(NN,BN):205===lN?lB(NN,BN):206===lN?qB(NN,BN):207===lN?HB(NN,BN):208===lN?zN(NN,BN):209===lN?BB(NN,BN):210===lN?kl(NN,BN):211===lN?vB(NN,BN):lN>223?-1*(255-lN+1):void 0}function IB(NN,BN){var lN=NN[BN.offset];return lN<128||lN>=202&&lN<=211}function AB(NN,BN){return NN[BN.offset]<160}function MB(NN,BN){return NN[BN.offset-1]===eN&&(NN[BN.offset]<128||NN[BN.offset]>=202&&NN[BN.offset]<=211)}var GB=Object.freeze({__proto__:null,int8:zN,uint8:NB,int16:BB,uint16:lB,int32:kl,uint32:qB,float32:cB,float64:eB,int64:vB,uint64:HB,readFloat32:VB,readFloat64:fB,boolean:ZB,string:PB,stringCheck:CB,number:FB,numberCheck:IB,arrayCheck:AB,switchStructureCheck:MB}),XB=function(){function BN(NN){var BN=this;this.$changes=new HN(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,NN&&NN.forEach((function(NN){return BN.add(NN)}))}return BN.prototype.IT=function(BN,lN){return void 0===lN&&(lN=!0),TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.ADD,BN,lN?this.$items:void 0)},BN.prototype.GB=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.DELETE,BN)},BN.prototype.onChange=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.REPLACE,BN)},BN.is=function(NN){return void 0!==NN.collection},BN.prototype.add=function(NN){var BN=this.$refId++;return void 0!==NN.$changes&&NN.$changes.setParent(this,this.$changes.root,BN),this.$changes.indexes[BN]=BN,this.$indexes.set(BN,BN),this.$items.set(BN,NN),this.$changes.change(BN),BN},BN.prototype.at=function(NN){var BN=Array.from(this.$items.keys())[NN];return this.$items.get(BN)},BN.prototype.entries=function(){return this.$items.entries()},BN.prototype.delete=function(NN){for(var BN,lN,kB=this.$items.entries();(lN=kB.next())&&!lN.done;)if(NN===lN.value[1]){BN=lN.value[0];break}return void 0!==BN&&(this.$changes.delete(BN),this.$indexes.delete(BN),this.$items.delete(BN))},BN.prototype.clear=function(BN){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),BN&&RN.call(this,BN),this.$items.clear(),this.$changes.operation({index:0,op:NN.OPERATION.CLEAR}),this.$changes.touchParents()},BN.prototype.has=function(NN){return Array.from(this.$items.values()).some((function(BN){return BN===NN}))},BN.prototype.forEach=function(NN){var BN=this;this.$items.forEach((function(lN,kB,qN){return NN(lN,kB,BN)}))},BN.prototype.values=function(){return this.$items.values()},Object.defineProperty(BN.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),BN.prototype.setIndex=function(NN,BN){this.$indexes.set(NN,BN)},BN.prototype.getIndex=function(NN){return this.$indexes.get(NN)},BN.prototype.getByIndex=function(NN){return this.$items.get(this.$indexes.get(NN))},BN.prototype.deleteByIndex=function(NN){var BN=this.$indexes.get(NN);this.$items.delete(BN),this.$indexes.delete(NN)},BN.prototype.toArray=function(){return Array.from(this.$items.values())},BN.prototype.toJSON=function(){var NN=[];return this.forEach((function(BN,lN){NN.push("function"===typeof BN.toJSON?BN.toJSON():BN)})),NN},BN.prototype.clone=function(NN){var lN;return NN?lN=Object.assign(new BN,this):(lN=new BN,this.forEach((function(NN){NN.$changes?lN.add(NN.clone()):lN.add(NN)}))),lN},BN}(),uB=function(){function BN(NN){var BN=this;this.$changes=new HN(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,NN&&NN.forEach((function(NN){return BN.add(NN)}))}return BN.prototype.IT=function(BN,lN){return void 0===lN&&(lN=!0),TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.ADD,BN,lN?this.$items:void 0)},BN.prototype.GB=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.DELETE,BN)},BN.prototype.onChange=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.REPLACE,BN)},BN.is=function(NN){return void 0!==NN.set},BN.prototype.add=function(BN){var lN,kB;if(this.has(BN))return!1;var qN=this.$refId++;void 0!==BN.$changes&&BN.$changes.setParent(this,this.$changes.root,qN);var cN=null!==(kB=null===(lN=this.$changes.indexes[qN])||void 0===lN?void 0:lN.op)&&void 0!==kB?kB:NN.OPERATION.ADD;return this.$changes.indexes[qN]=qN,this.$indexes.set(qN,qN),this.$items.set(qN,BN),this.$changes.change(qN,cN),qN},BN.prototype.entries=function(){return this.$items.entries()},BN.prototype.delete=function(NN){for(var BN,lN,kB=this.$items.entries();(lN=kB.next())&&!lN.done;)if(NN===lN.value[1]){BN=lN.value[0];break}return void 0!==BN&&(this.$changes.delete(BN),this.$indexes.delete(BN),this.$items.delete(BN))},BN.prototype.clear=function(BN){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),BN&&RN.call(this,BN),this.$items.clear(),this.$changes.operation({index:0,op:NN.OPERATION.CLEAR}),this.$changes.touchParents()},BN.prototype.has=function(NN){for(var BN,lN=this.$items.values(),kB=!1;(BN=lN.next())&&!BN.done;)if(NN===BN.value){kB=!0;break}return kB},BN.prototype.forEach=function(NN){var BN=this;this.$items.forEach((function(lN,kB,qN){return NN(lN,kB,BN)}))},BN.prototype.values=function(){return this.$items.values()},Object.defineProperty(BN.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),BN.prototype.setIndex=function(NN,BN){this.$indexes.set(NN,BN)},BN.prototype.getIndex=function(NN){return this.$indexes.get(NN)},BN.prototype.getByIndex=function(NN){return this.$items.get(this.$indexes.get(NN))},BN.prototype.deleteByIndex=function(NN){var BN=this.$indexes.get(NN);this.$items.delete(BN),this.$indexes.delete(NN)},BN.prototype.toArray=function(){return Array.from(this.$items.values())},BN.prototype.toJSON=function(){var NN=[];return this.forEach((function(BN,lN){NN.push("function"===typeof BN.toJSON?BN.toJSON():BN)})),NN},BN.prototype.clone=function(NN){var lN;return NN?lN=Object.assign(new BN,this):(lN=new BN,this.forEach((function(NN){NN.$changes?lN.add(NN.clone()):lN.add(NN)}))),lN},BN}(),dB=function(){function NN(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return NN.prototype.addRefId=function(NN){this.refIds.has(NN)||(this.refIds.add(NN),this.containerIndexes.set(NN,new Set))},NN.get=function(BN){return void 0===BN.$filterState&&(BN.$filterState=new NN),BN.$filterState},NN}(),EB=function(){function NN(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return NN.prototype.getNextUniqueId=function(){return this.nextUniqueId++},NN.prototype.addRef=function(NN,BN,lN){void 0===lN&&(lN=!0),this.refs.set(NN,BN),lN&&(this.refCounts[NN]=(this.refCounts[NN]||0)+1)},NN.prototype.removeRef=function(NN){this.refCounts[NN]=this.refCounts[NN]-1,this.deletedRefs.add(NN)},NN.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},NN.prototype.garbageCollectDeletedRefs=function(){var NN=this;this.deletedRefs.forEach((function(BN){if(!(NN.refCounts[BN]>0)){var lN=NN.refs.get(BN);if(lN instanceof xB)for(var kB in lN._definition.schema)"string"!==typeof lN._definition.schema[kB]&&lN[kB]&&lN[kB].$changes&&NN.removeRef(lN[kB].$changes.refId);else{var qN=lN.$changes.parent._definition,cN=qN.schema[qN.fieldsByIndex[lN.$changes.parentIndex]];"function"===typeof Object.values(cN)[0]&&Array.from(lN.values()).forEach((function(BN){return NN.removeRef(BN.$changes.refId)}))}NN.refs.delete(BN),delete NN.refCounts[BN]}})),this.deletedRefs.clear()},NN}(),KB=function(NN){function BN(){return null!==NN&&NN.apply(this,arguments)||this}return lN(BN,NN),BN}(Error);function gB(NN,BN,lN,kB){var qN,cN=!1;switch(BN){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":qN="number",isNaN(NN)&&console.log('trying to encode "NaN" in '.concat(lN.constructor.name,"#").concat(kB));break;case"string":qN="string",cN=!0;break;case"boolean":return}if(typeof NN!==qN&&(!cN||cN&&null!==NN)){var eN="'".concat(JSON.stringify(NN),"'").concat(NN&&NN.constructor&&" (".concat(NN.constructor.name,")")||"");throw new KB("a '".concat(qN,"' was expected, but ").concat(eN," was provided in ").concat(lN.constructor.name,"#").concat(kB))}}function nB(NN,BN,lN,kB){if(!(NN instanceof BN))throw new KB("a '".concat(BN.name,"' was expected, but '").concat(NN.constructor.name,"' was provided in ").concat(lN.constructor.name,"#").concat(kB))}function rB(NN,BN,lN,kB,qN){gB(lN,NN,kB,qN);var cN=YN[NN];if(!cN)throw new KB("a '".concat(NN,"' was expected, but ").concat(lN," was provided in ").concat(kB.constructor.name,"#").concat(qN));cN(BN,lN)}function pB(NN,BN,lN){return GB[NN](BN,lN)}var xB=function(){function BN(){for(var NN=[],BN=0;BN<arguments.length;BN++)NN[BN]=arguments[BN];Object.defineProperties(this,{$changes:{value:new HN(this,void 0,new EB),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var lN=this._definition.descriptors;lN&&Object.defineProperties(this,lN),NN[0]&&this.assign(NN[0])}return BN.onError=function(NN){console.error(NN)},BN.is=function(NN){return NN._definition&&void 0!==NN._definition.schema},BN.prototype.onChange=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.REPLACE,BN)},BN.prototype.GB=function(BN){return TN(this.$callbacks||(this.$callbacks=[]),NN.OPERATION.DELETE,BN)},BN.prototype.assign=function(NN){return Object.assign(this,NN),this},Object.defineProperty(BN.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),BN.prototype.setDirty=function(NN,BN){this.$changes.change(NN,BN)},BN.prototype.listen=function(NN,BN,lN){var kB=this;return void 0===lN&&(lN=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[NN]||(this.$callbacks[NN]=[]),this.$callbacks[NN].push(BN),lN&&void 0!==this[NN]&&BN(this[NN],void 0),function(){return sN(kB.$callbacks[NN],kB.$callbacks[NN].indexOf(BN))}},BN.prototype.decode=function(lN,kB,qN){var cN;void 0===kB&&(kB={offset:0}),void 0===qN&&(qN=this);var vN=[],HN=this.$changes.root,TN=lN.length,RN=0;for(HN.refs.set(RN,this);kB.offset<TN;){var sN=lN[kB.offset++];if(sN!=eN){var VN=qN.$changes,fN=void 0!==qN._definition,PN=fN?sN>>6<<6:sN;if(PN!==NN.OPERATION.CLEAR){var FN=fN?sN%(PN||255):FB(lN,kB),IN=fN?qN._definition.fieldsByIndex[FN]:"",MN=VN.getType(FN),GN=void 0,XN=void 0,uN=void 0;if(fN?XN=qN["_".concat(IN)]:(XN=qN.getByIndex(FN),(PN&NN.OPERATION.ADD)===NN.OPERATION.ADD?(uN=qN instanceof CN?PB(lN,kB):FN,qN.setIndex(FN,uN)):uN=qN.getIndex(FN)),(PN&NN.OPERATION.DELETE)===NN.OPERATION.DELETE&&(PN!==NN.OPERATION.DELETE_AND_ADD&&qN.deleteByIndex(FN),XN&&XN.$changes&&HN.removeRef(XN.$changes.refId),GN=null),void 0!==IN){if(PN===NN.OPERATION.DELETE);else if(BN.is(MN)){var dN=FB(lN,kB);if(GN=HN.refs.get(dN),PN!==NN.OPERATION.REPLACE){var EN=this.getSchemaType(lN,kB,MN);GN||((GN=this.createTypeInstance(EN)).$changes.refId=dN,XN&&(GN.$callbacks=XN.$callbacks,XN.$changes.refId&&dN!==XN.$changes.refId&&HN.removeRef(XN.$changes.refId))),HN.addRef(dN,GN,GN!==XN)}}else if("string"===typeof MN)GN=pB(MN,lN,kB);else{var KN=AN(Object.keys(MN)[0]),gN=FB(lN,kB),nN=HN.refs.has(gN)?XN||HN.refs.get(gN):new KN.constructor;if((GN=nN.clone(!0)).$changes.refId=gN,XN&&(GN.$callbacks=XN.$callbacks,XN.$changes.refId&&gN!==XN.$changes.refId)){HN.removeRef(XN.$changes.refId);for(var rN=XN.entries(),pN=void 0;(pN=rN.next())&&!pN.done;){var xN=(cN=pN.value)[0],ON=cN[1];vN.push({refId:gN,op:NN.OPERATION.DELETE,field:xN,value:void 0,previousValue:ON})}}HN.addRef(gN,GN,nN!==XN)}if(null!==GN&&void 0!==GN)if(GN.$changes&&GN.$changes.setParent(VN.ref,VN.root,FN),qN instanceof BN)qN[IN]=GN;else if(qN instanceof CN)xN=uN,qN.$items.set(xN,GN),qN.$changes.allChanges.add(FN);else if(qN instanceof ZN)qN.setAt(FN,GN);else if(qN instanceof XB){var wN=qN.add(GN);qN.setIndex(FN,wN)}else qN instanceof uB&&!1!==(wN=qN.add(GN))&&qN.setIndex(FN,wN);XN!==GN&&vN.push({refId:RN,op:PN,field:IN,dynamicIndex:uN,value:GN,previousValue:XN})}else{console.warn("@colyseus/schema: definition mismatch");for(var bN={offset:kB.offset};kB.offset<TN&&(!MB(lN,kB)||(bN.offset=kB.offset+1,!HN.refs.has(FB(lN,bN))));)kB.offset++}}else qN.clear(vN)}else{RN=FB(lN,kB);var mB=HN.refs.get(RN);if(!mB)throw new Error('"refId" not found: '.concat(RN));qN=mB}}return this._triggerChanges(vN),HN.garbageCollectDeletedRefs(),vN},BN.prototype.encode=function(lN,kB,qN){void 0===lN&&(lN=!1),void 0===kB&&(kB=[]),void 0===qN&&(qN=!1);for(var cN=this.$changes,vN=new WeakSet,HN=[cN],TN=1,RN=0;RN<TN;RN++){var sN=HN[RN],VN=sN.ref,fN=VN instanceof BN;sN.ensureRefId(),vN.add(sN),sN!==cN&&(sN.changed||lN)&&(ON(kB,eN),JN(kB,sN.refId));for(var ZN=lN?Array.from(sN.allChanges):Array.from(sN.changes.values()),PN=0,FN=ZN.length;PN<FN;PN++){var IN=lN?{op:NN.OPERATION.ADD,index:ZN[PN]}:ZN[PN],MN=IN.index,GN=fN?VN._definition.fieldsByIndex&&VN._definition.fieldsByIndex[MN]:MN,XN=kB.length;if(IN.op!==NN.OPERATION.TOUCH)if(fN)ON(kB,MN|IN.op);else{if(ON(kB,IN.op),IN.op===NN.OPERATION.CLEAR)continue;JN(kB,MN)}if(fN||(IN.op&NN.OPERATION.ADD)!=NN.OPERATION.ADD||VN instanceof CN&&oN(kB,sN.ref.$indexes.get(MN)),IN.op!==NN.OPERATION.DELETE){var uN=sN.getType(MN),dN=sN.getValue(MN);if(dN&&dN.$changes&&!vN.has(dN.$changes)&&(HN.push(dN.$changes),dN.$changes.ensureRefId(),TN++),IN.op!==NN.OPERATION.TOUCH){if(BN.is(uN))nB(dN,uN,VN,GN),JN(kB,dN.$changes.refId),(IN.op&NN.OPERATION.ADD)===NN.OPERATION.ADD&&this.tryEncodeTypeId(kB,uN,dN.constructor);else if("string"===typeof uN)rB(uN,kB,dN,VN,GN);else{var EN=AN(Object.keys(uN)[0]);nB(VN["_".concat(GN)],EN.constructor,VN,GN),JN(kB,dN.$changes.refId)}qN&&sN.cache(MN,kB.slice(XN))}}}lN||qN||sN.discard()}return kB},BN.prototype.encodeAll=function(NN){return this.encode(!0,[],NN)},BN.prototype.applyFilters=function(lN,kB){var qN,cN;void 0===kB&&(kB=!1);for(var vN=this,HN=new Set,TN=dB.get(lN),RN=[this.$changes],sN=1,VN=[],fN=function(fN){var ZN=RN[fN];if(HN.has(ZN.refId))return"continue";var PN=ZN.ref,FN=PN instanceof BN;ON(VN,eN),JN(VN,ZN.refId);var IN=TN.refIds.has(ZN),AN=kB||!IN;TN.addRefId(ZN);var MN=TN.containerIndexes.get(ZN),GN=AN?Array.from(ZN.allChanges):Array.from(ZN.changes.values());!kB&&FN&&PN._definition.indexesWithFilters&&PN._definition.indexesWithFilters.forEach((function(BN){!MN.has(BN)&&ZN.allChanges.has(BN)&&(AN?GN.push(BN):GN.push({op:NN.OPERATION.ADD,index:BN}))}));for(var XN=0,uN=GN.length;XN<uN;XN++){var dN=AN?{op:NN.OPERATION.ADD,index:GN[XN]}:GN[XN];if(dN.op!==NN.OPERATION.CLEAR){var EN=dN.index;if(dN.op!==NN.OPERATION.DELETE){var KN=ZN.getValue(EN),gN=ZN.getType(EN);if(FN){if((nN=PN._definition.filters&&PN._definition.filters[EN])&&!nN.call(PN,lN,KN,vN)){KN&&KN.$changes&&HN.add(KN.$changes.refId);continue}}else{var nN,rN=ZN.parent;if((nN=ZN.getChildrenFilter())&&!nN.call(rN,lN,PN.$indexes.get(EN),KN,vN)){KN&&KN.$changes&&HN.add(KN.$changes.refId);continue}}if(KN.$changes&&(RN.push(KN.$changes),sN++),dN.op!==NN.OPERATION.TOUCH)if(dN.op===NN.OPERATION.ADD||FN)VN.push.apply(VN,null!==(qN=ZN.caches[EN])&&void 0!==qN?qN:[]),MN.add(EN);else if(MN.has(EN))VN.push.apply(VN,null!==(cN=ZN.caches[EN])&&void 0!==cN?cN:[]);else{if(MN.add(EN),ON(VN,NN.OPERATION.ADD),JN(VN,EN),PN instanceof CN){var pN=ZN.ref.$indexes.get(EN);oN(VN,pN)}KN.$changes?JN(VN,KN.$changes.refId):YN[gN](VN,KN)}else KN.$changes&&!FN&&(ON(VN,NN.OPERATION.ADD),JN(VN,EN),PN instanceof CN&&(pN=ZN.ref.$indexes.get(EN),oN(VN,pN)),JN(VN,KN.$changes.refId))}else FN?ON(VN,dN.op|EN):(ON(VN,dN.op),JN(VN,EN))}else ON(VN,dN.op)}},ZN=0;ZN<sN;ZN++)fN(ZN);return VN},BN.prototype.clone=function(){var NN,BN=new this.constructor,lN=this._definition.schema;for(var kB in lN)"object"===typeof this[kB]&&"function"===typeof(null===(NN=this[kB])||void 0===NN?void 0:NN.clone)?BN[kB]=this[kB].clone():BN[kB]=this[kB];return BN},BN.prototype.toJSON=function(){var NN=this._definition.schema,BN=this._definition.deprecated,lN={};for(var kB in NN)BN[kB]||null===this[kB]||"undefined"===typeof this[kB]||(lN[kB]="function"===typeof this[kB].toJSON?this[kB].toJSON():this["_".concat(kB)]);return lN},BN.prototype.discardAllChanges=function(){this.$changes.discardAll()},BN.prototype.getByIndex=function(NN){return this[this._definition.fieldsByIndex[NN]]},BN.prototype.deleteByIndex=function(NN){this[this._definition.fieldsByIndex[NN]]=void 0},BN.prototype.tryEncodeTypeId=function(NN,BN,lN){BN._typeid!==lN._typeid&&(ON(NN,vN),JN(NN,lN._typeid))},BN.prototype.getSchemaType=function(NN,BN,lN){var kB;return NN[BN.offset]===vN&&(BN.offset++,kB=this.constructor._context.get(FB(NN,BN))),kB||lN},BN.prototype.createTypeInstance=function(NN){var BN=new NN;return BN.$changes.root=this.$changes.root,BN},BN.prototype._triggerChanges=function(lN){for(var kB,qN,cN,eN,vN,HN,TN,RN,sN,VN=new Set,fN=this.$changes.root.refs,ZN=function(ZN){var PN=lN[ZN],CN=PN.refId,FN=fN.get(CN),IN=FN.$callbacks;if((PN.op&NN.OPERATION.DELETE)===NN.OPERATION.DELETE&&PN.previousValue instanceof BN&&(null===(qN=null===(kB=PN.previousValue.$callbacks)||void 0===kB?void 0:kB[NN.OPERATION.DELETE])||void 0===qN||qN.forEach((function(NN){return NN()}))),!IN)return"continue";if(FN instanceof BN){if(!VN.has(CN))try{null===(cN=null===IN||void 0===IN?void 0:IN[NN.OPERATION.REPLACE])||void 0===cN||cN.forEach((function(NN){return NN()}))}catch(AN){BN.onError(AN)}try{IN.hasOwnProperty(PN.field)&&(null===(eN=IN[PN.field])||void 0===eN||eN.forEach((function(NN){return NN(PN.value,PN.previousValue)})))}catch(AN){BN.onError(AN)}}else PN.op===NN.OPERATION.ADD&&void 0===PN.previousValue?null===(vN=IN[NN.OPERATION.ADD])||void 0===vN||vN.forEach((function(NN){var BN;return NN(PN.value,null!==(BN=PN.dynamicIndex)&&void 0!==BN?BN:PN.field)})):PN.op===NN.OPERATION.DELETE?void 0!==PN.previousValue&&(null===(HN=IN[NN.OPERATION.DELETE])||void 0===HN||HN.forEach((function(NN){var BN;return NN(PN.previousValue,null!==(BN=PN.dynamicIndex)&&void 0!==BN?BN:PN.field)}))):PN.op===NN.OPERATION.DELETE_AND_ADD&&(void 0!==PN.previousValue&&(null===(TN=IN[NN.OPERATION.DELETE])||void 0===TN||TN.forEach((function(NN){var BN;return NN(PN.previousValue,null!==(BN=PN.dynamicIndex)&&void 0!==BN?BN:PN.field)}))),null===(RN=IN[NN.OPERATION.ADD])||void 0===RN||RN.forEach((function(NN){var BN;return NN(PN.value,null!==(BN=PN.dynamicIndex)&&void 0!==BN?BN:PN.field)}))),PN.value!==PN.previousValue&&(null===(sN=IN[NN.OPERATION.REPLACE])||void 0===sN||sN.forEach((function(NN){var BN;return NN(PN.value,null!==(BN=PN.dynamicIndex)&&void 0!==BN?BN:PN.field)})));VN.add(CN)},PN=0;PN<lN.length;PN++)ZN(PN)},BN._definition=MN.create(),BN}();function OB(NN){for(var BN=[NN.$changes],lN=1,kB={},qN=kB,cN=function(NN){var lN=BN[NN];lN.changes.forEach((function(NN){var BN=lN.ref,kB=NN.index,cN=BN._definition?BN._definition.fieldsByIndex[kB]:BN.$indexes.get(kB);qN[cN]=lN.getValue(kB)}))},eN=0;eN<lN;eN++)cN(eN);return kB}var wB={context:new XN},bB=function(NN){function BN(){return null!==NN&&NN.apply(this,arguments)||this}return lN(BN,NN),kB([dN("string",wB)],BN.prototype,"name",void 0),kB([dN("string",wB)],BN.prototype,"type",void 0),kB([dN("number",wB)],BN.prototype,"referencedType",void 0),BN}(xB),ml=function(NN){function BN(){var BN=null!==NN&&NN.apply(this,arguments)||this;return BN.fields=new ZN,BN}return lN(BN,NN),kB([dN("number",wB)],BN.prototype,"id",void 0),kB([dN([bB],wB)],BN.prototype,"fields",void 0),BN}(xB),aB=function(NN){function BN(){var BN=null!==NN&&NN.apply(this,arguments)||this;return BN.types=new ZN,BN}return lN(BN,NN),BN.encode=function(NN){var lN=NN.constructor,kB=new BN;kB.rootType=lN._typeid;var qN=function(NN,BN){for(var lN in BN){var qN=new bB;qN.name=lN;var cN=void 0;if("string"===typeof BN[lN])cN=BN[lN];else{var eN=BN[lN],vN=void 0;xB.is(eN)?(cN="ref",vN=BN[lN]):"string"===typeof eN[cN=Object.keys(eN)[0]]?cN+=":"+eN[cN]:vN=eN[cN],qN.referencedType=vN?vN._typeid:-1}qN.type=cN,NN.fields.push(qN)}kB.types.push(NN)},cN=lN._context.types;for(var eN in cN){var vN=new ml;vN.id=Number(eN),qN(vN,cN[eN]._definition.schema)}return kB.encodeAll()},BN.decode=function(NN,kB){var qN=new XN,cN=new BN;cN.decode(NN,kB);var eN=cN.types.reduce((function(NN,BN){var kB=function(NN){function BN(){return null!==NN&&NN.apply(this,arguments)||this}return lN(BN,NN),BN}(xB),cN=BN.id;return NN[cN]=kB,qN.add(kB,cN),NN}),{});cN.types.forEach((function(NN){var BN=eN[NN.id];NN.fields.forEach((function(NN){var lN;if(void 0!==NN.referencedType){var kB=NN.type,cN=eN[NN.referencedType];if(!cN){var vN=NN.type.split(":");kB=vN[0],cN=vN[1]}"ref"===kB?dN(cN,{context:qN})(BN.prototype,NN.name):dN(((lN={})[kB]=cN,lN),{context:qN})(BN.prototype,NN.name)}else dN(NN.type,{context:qN})(BN.prototype,NN.name)}))}));var vN=eN[cN.rootType],HN=new vN;for(var TN in vN._definition.schema){var RN=vN._definition.schema[TN];"string"!==typeof RN&&(HN[TN]="function"===typeof RN?new RN:new(AN(Object.keys(RN)[0]).constructor))}return HN},kB([dN([ml],wB)],BN.prototype,"types",void 0),kB([dN("number",wB)],BN.prototype,"rootType",void 0),BN}(xB);IN("map",{constructor:CN}),IN("array",{constructor:ZN}),IN("set",{constructor:uB}),IN("collection",{constructor:XB}),NN.ArraySchema=ZN,NN.CollectionSchema=XB,NN.Context=XN,NN.MapSchema=CN,NN.Reflection=aB,NN.ReflectionField=bB,NN.ReflectionType=ml,NN.Schema=xB,NN.SchemaDefinition=MN,NN.SetSchema=uB,NN.decode=GB,NN.defineTypes=nN,NN.deprecated=gN,NN.dumpChanges=OB,NN.encode=YN,NN.filter=EN,NN.filterChildren=KN,NN.hasFilter=GN,NN.registerType=IN,NN.type=dN,Object.defineProperty(NN,"__esModule",{value:!0})}(BN)},16841:(NN,BN,lN)=>{NN.exports=qN;var kB=lN(155);function qN(NN,BN){if(!(this instanceof qN))return new qN(NN,BN);var lN=kB.create();kB.add(lN,NN,BN),this.base=kB.min(kB.create(),NN,lN),this.Ys=kB.clone(BN),this.max=kB.max(kB.create(),NN,lN),this.mag=kB.length(this.Ys)}var cN=qN.prototype;cN.width=function(){return this.Ys[0]},cN.height=function(){return this.Ys[1]},cN.depth=function(){return this.Ys[2]},cN.x0=function(){return this.base[0]},cN.y0=function(){return this.base[1]},cN.z0=function(){return this.base[2]},cN.x1=function(){return this.max[0]},cN.y1=function(){return this.max[1]},cN.z1=function(){return this.max[2]},cN.translate=function(NN){return kB.add(this.max,this.max,NN),kB.add(this.base,this.base,NN),this},cN.setPosition=function(NN){return kB.add(this.max,NN,this.Ys),kB.zN(this.base,NN),this},cN.expand=function(NN){var BN=kB.create(),lN=kB.create();return kB.max(BN,NN.max,this.max),kB.min(lN,NN.base,this.base),kB.ZB(BN,BN,lN),new qN(lN,BN)},cN.intersects=function(NN){return!(NN.base[0]>this.max[0])&&(!(NN.base[1]>this.max[1])&&(!(NN.base[2]>this.max[2])&&(!(NN.max[0]<this.base[0])&&(!(NN.max[1]<this.base[1])&&!(NN.max[2]<this.base[2])))))},cN.touches=function(NN){var BN=this.union(NN);return null!==BN&&(0==BN.width()||0==BN.height()||0==BN.depth())},cN.union=function(NN){if(!this.intersects(NN))return null;var BN=Math.max(NN.base[0],this.base[0]),lN=Math.max(NN.base[1],this.base[1]),kB=Math.max(NN.base[2],this.base[2]);return new qN([BN,lN,kB],[Math.min(NN.max[0],this.max[0])-BN,Math.min(NN.max[1],this.max[1])-lN,Math.min(NN.max[2],this.max[2])-kB])}},16706:NN=>{"use strict";NN.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},16701:(NN,BN,lN)=>{var kB=lN(16706),qN=lN(16708),cN=Object.hasOwnProperty,eN=Object.create(null);for(var vN in kB)cN.call(kB,vN)&&(eN[kB[vN]]=vN);var HN=NN.exports={to:{},get:{}};function TN(NN,BN,lN){return Math.min(Math.max(BN,NN),lN)}function RN(NN){var BN=Math.round(NN).toString(16).toUpperCase();return BN.length<2?"0"+BN:BN}HN.get=function(NN){var BN,lN;switch(NN.substring(0,3).toLowerCase()){case"hsl":BN=HN.get.hsl(NN),lN="hsl";break;case"hwb":BN=HN.get.hwb(NN),lN="hwb";break;default:BN=HN.get.rgb(NN),lN="rgb"}return BN?{model:lN,value:BN}:null},HN.get.rgb=function(NN){if(!NN)return null;var BN,lN,qN,eN=[0,0,0,1];if(BN=NN.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(qN=BN[2],BN=BN[1],lN=0;lN<3;lN++){var vN=2*lN;eN[lN]=parseInt(BN.slice(vN,vN+2),16)}qN&&(eN[3]=parseInt(qN,16)/255)}else if(BN=NN.match(/^#([a-f0-9]{3,4})$/i)){for(qN=(BN=BN[1])[3],lN=0;lN<3;lN++)eN[lN]=parseInt(BN[lN]+BN[lN],16);qN&&(eN[3]=parseInt(qN+qN,16)/255)}else if(BN=NN.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(lN=0;lN<3;lN++)eN[lN]=parseInt(BN[lN+1],0);BN[4]&&(BN[5]?eN[3]=.01*parseFloat(BN[4]):eN[3]=parseFloat(BN[4]))}else{if(!(BN=NN.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(BN=NN.match(/^(\w+)$/))?"transparent"===BN[1]?[0,0,0,0]:cN.call(kB,BN[1])?((eN=kB[BN[1]])[3]=1,eN):null:null;for(lN=0;lN<3;lN++)eN[lN]=Math.round(2.55*parseFloat(BN[lN+1]));BN[4]&&(BN[5]?eN[3]=.01*parseFloat(BN[4]):eN[3]=parseFloat(BN[4]))}for(lN=0;lN<3;lN++)eN[lN]=TN(eN[lN],0,255);return eN[3]=TN(eN[3],0,1),eN},HN.get.hsl=function(NN){if(!NN)return null;var BN=NN.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(BN){var lN=parseFloat(BN[4]);return[(parseFloat(BN[1])%360+360)%360,TN(parseFloat(BN[2]),0,100),TN(parseFloat(BN[3]),0,100),TN(isNaN(lN)?1:lN,0,1)]}return null},HN.get.hwb=function(NN){if(!NN)return null;var BN=NN.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(BN){var lN=parseFloat(BN[4]);return[(parseFloat(BN[1])%360+360)%360,TN(parseFloat(BN[2]),0,100),TN(parseFloat(BN[3]),0,100),TN(isNaN(lN)?1:lN,0,1)]}return null},HN.to.hex=function(){var NN=qN(arguments);return"#"+RN(NN[0])+RN(NN[1])+RN(NN[2])+(NN[3]<1?RN(Math.round(255*NN[3])):"")},HN.to.rgb=function(){var NN=qN(arguments);return NN.length<4||1===NN[3]?"rgb("+Math.round(NN[0])+", "+Math.round(NN[1])+", "+Math.round(NN[2])+")":"rgba("+Math.round(NN[0])+", "+Math.round(NN[1])+", "+Math.round(NN[2])+", "+NN[3]+")"},HN.to.rgb.percent=function(){var NN=qN(arguments),BN=Math.round(NN[0]/255*100),lN=Math.round(NN[1]/255*100),kB=Math.round(NN[2]/255*100);return NN.length<4||1===NN[3]?"rgb("+BN+"%, "+lN+"%, "+kB+"%)":"rgba("+BN+"%, "+lN+"%, "+kB+"%, "+NN[3]+")"},HN.to.hsl=function(){var NN=qN(arguments);return NN.length<4||1===NN[3]?"hsl("+NN[0]+", "+NN[1]+"%, "+NN[2]+"%)":"hsla("+NN[0]+", "+NN[1]+"%, "+NN[2]+"%, "+NN[3]+")"},HN.to.hwb=function(){var NN=qN(arguments),BN="";return NN.length>=4&&1!==NN[3]&&(BN=", "+NN[3]),"hwb("+NN[0]+", "+NN[1]+"%, "+NN[2]+"%"+BN+")"},HN.to.keyword=function(NN){return eN[NN.slice(0,3)]}},16696:(NN,BN,lN)=>{const kB=lN(16701),qN=lN(16724),cN=["keyword","gray","hex"],eN={};for(const fN of Object.keys(qN))eN[[...qN[fN].labels].sort().join("")]=fN;const vN={};function HN(NN,BN){if(!(this instanceof HN))return new HN(NN,BN);if(BN&&BN in cN&&(BN=null),BN&&!(BN in qN))throw new Error("Unknown model: "+BN);let lN,TN;if(null==NN)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(NN instanceof HN)this.model=NN.model,this.color=[...NN.color],this.valpha=NN.valpha;else if("string"===typeof NN){const BN=kB.get(NN);if(null===BN)throw new Error("Unable to parse color from string: "+NN);this.model=BN.model,TN=qN[this.model].channels,this.color=BN.value.slice(0,TN),this.valpha="number"===typeof BN.value[TN]?BN.value[TN]:1}else if(NN.length>0){this.model=BN||"rgb",TN=qN[this.model].channels;const lN=Array.prototype.slice.call(NN,0,TN);this.color=VN(lN,TN),this.valpha="number"===typeof NN[TN]?NN[TN]:1}else if("number"===typeof NN)this.model="rgb",this.color=[NN>>16&255,NN>>8&255,255&NN],this.valpha=1;else{this.valpha=1;const BN=Object.keys(NN);"alpha"in NN&&(BN.splice(BN.indexOf("alpha"),1),this.valpha="number"===typeof NN.alpha?NN.alpha:0);const kB=BN.sort().join("");if(!(kB in eN))throw new Error("Unable to parse color from object: "+JSON.stringify(NN));this.model=eN[kB];const{labels:cN}=qN[this.model],vN=[];for(lN=0;lN<cN.length;lN++)vN.push(NN[cN[lN]]);this.color=VN(vN)}if(vN[this.model])for(TN=qN[this.model].channels,lN=0;lN<TN;lN++){const NN=vN[this.model][lN];NN&&(this.color[lN]=NN(this.color[lN]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}HN.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(NN){let BN=this.model in kB.to?this:this.rgb();BN=BN.round("number"===typeof NN?NN:1);const lN=1===BN.valpha?BN.color:[...BN.color,this.valpha];return kB.to[BN.model](lN)},percentString(NN){const BN=this.rgb().round("number"===typeof NN?NN:1),lN=1===BN.valpha?BN.color:[...BN.color,this.valpha];return kB.to.rgb.percent(lN)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const NN={},{channels:BN}=qN[this.model],{labels:lN}=qN[this.model];for(let kB=0;kB<BN;kB++)NN[lN[kB]]=this.color[kB];return 1!==this.valpha&&(NN.alpha=this.valpha),NN},unitArray(){const NN=this.rgb().color;return NN[0]/=255,NN[1]/=255,NN[2]/=255,1!==this.valpha&&NN.push(this.valpha),NN},unitObject(){const NN=this.rgb().object();return NN.r/=255,NN.g/=255,NN.b/=255,1!==this.valpha&&(NN.alpha=this.valpha),NN},round(NN){return NN=Math.max(NN||0,0),new HN([...this.color.map(TN(NN)),this.valpha],this.model)},alpha(NN){return void 0!==NN?new HN([...this.color,Math.max(0,Math.min(1,NN))],this.model):this.valpha},red:RN("rgb",0,sN(255)),green:RN("rgb",1,sN(255)),blue:RN("rgb",2,sN(255)),hue:RN(["hsl","hsv","hsl","hwb","hcg"],0,(NN=>(NN%360+360)%360)),saturationl:RN("hsl",1,sN(100)),lightness:RN("hsl",2,sN(100)),saturationv:RN("hsv",1,sN(100)),value:RN("hsv",2,sN(100)),chroma:RN("hcg",1,sN(100)),gray:RN("hcg",2,sN(100)),white:RN("hwb",1,sN(100)),wblack:RN("hwb",2,sN(100)),cyan:RN("cmyk",0,sN(100)),magenta:RN("cmyk",1,sN(100)),yellow:RN("cmyk",2,sN(100)),black:RN("cmyk",3,sN(100)),x:RN("xyz",0,sN(95.047)),y:RN("xyz",1,sN(100)),z:RN("xyz",2,sN(108.833)),l:RN("lab",0,sN(100)),a:RN("lab",1),b:RN("lab",2),keyword(NN){return void 0!==NN?new HN(NN):qN[this.model].keyword(this.color)},hex(NN){return void 0!==NN?new HN(NN):kB.to.hex(this.rgb().round().color)},hexa(NN){if(void 0!==NN)return new HN(NN);const BN=this.rgb().round().color;let lN=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===lN.length&&(lN="0"+lN),kB.to.hex(BN)+lN},rgbNumber(){const NN=this.rgb().color;return(255&NN[0])<<16|(255&NN[1])<<8|255&NN[2]},luminosity(){const NN=this.rgb().color,BN=[];for(const[lN,kB]of NN.entries()){const NN=kB/255;BN[lN]=NN<=.04045?NN/12.92:((NN+.055)/1.055)**2.4}return.2126*BN[0]+.7152*BN[1]+.0722*BN[2]},contrast(NN){const BN=this.luminosity(),lN=NN.luminosity();return BN>lN?(BN+.05)/(lN+.05):(lN+.05)/(BN+.05)},level(NN){const BN=this.contrast(NN);return BN>=7?"AAA":BN>=4.5?"AA":""},isDark(){const NN=this.rgb().color;return(2126*NN[0]+7152*NN[1]+722*NN[2])/1e4<128},isLight(){return!this.isDark()},negate(){const NN=this.rgb();for(let BN=0;BN<3;BN++)NN.color[BN]=255-NN.color[BN];return NN},lighten(NN){const BN=this.hsl();return BN.color[2]+=BN.color[2]*NN,BN},darken(NN){const BN=this.hsl();return BN.color[2]-=BN.color[2]*NN,BN},saturate(NN){const BN=this.hsl();return BN.color[1]+=BN.color[1]*NN,BN},desaturate(NN){const BN=this.hsl();return BN.color[1]-=BN.color[1]*NN,BN},whiten(NN){const BN=this.hwb();return BN.color[1]+=BN.color[1]*NN,BN},blacken(NN){const BN=this.hwb();return BN.color[2]+=BN.color[2]*NN,BN},grayscale(){const NN=this.rgb().color,BN=.3*NN[0]+.59*NN[1]+.11*NN[2];return HN.rgb(BN,BN,BN)},fade(NN){return this.alpha(this.valpha-this.valpha*NN)},opaquer(NN){return this.alpha(this.valpha+this.valpha*NN)},rotate(NN){const BN=this.hsl();let lN=BN.color[0];return lN=(lN+NN)%360,lN=lN<0?360+lN:lN,BN.color[0]=lN,BN},mix(NN,BN){if(!NN||!NN.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof NN);const lN=NN.rgb(),kB=this.rgb(),qN=void 0===BN?.5:BN,cN=2*qN-1,eN=lN.alpha()-kB.alpha(),vN=((cN*eN===-1?cN:(cN+eN)/(1+cN*eN))+1)/2,TN=1-vN;return HN.rgb(vN*lN.red()+TN*kB.red(),vN*lN.green()+TN*kB.green(),vN*lN.blue()+TN*kB.blue(),lN.alpha()*qN+kB.alpha()*(1-qN))}};for(const fN of Object.keys(qN)){if(cN.includes(fN))continue;const{channels:NN}=qN[fN];HN.prototype[fN]=function(){if(this.model===fN)return new HN(this);for(var NN=arguments.length,BN=new Array(NN),lN=0;lN<NN;lN++)BN[lN]=arguments[lN];return BN.length>0?new HN(BN,fN):new HN([...(kB=qN[this.model][fN].raw(this.color),Array.isArray(kB)?kB:[kB]),this.valpha],fN);var kB},HN[fN]=function(){for(var BN=arguments.length,lN=new Array(BN),kB=0;kB<BN;kB++)lN[kB]=arguments[kB];let qN=lN[0];return"number"===typeof qN&&(qN=VN(lN,NN)),new HN(qN,fN)}}function TN(NN){return function(BN){return function(NN,BN){return Number(NN.toFixed(BN))}(BN,NN)}}function RN(NN,BN,lN){NN=Array.isArray(NN)?NN:[NN];for(const kB of NN)(vN[kB]||(vN[kB]=[]))[BN]=lN;return NN=NN[0],function(kB){let qN;return void 0!==kB?(lN&&(kB=lN(kB)),qN=this[NN](),qN.color[BN]=kB,qN):(qN=this[NN]().color[BN],lN&&(qN=lN(qN)),qN)}}function sN(NN){return function(BN){return Math.max(0,Math.min(NN,BN))}}function VN(NN,BN){for(let lN=0;lN<BN;lN++)"number"!==typeof NN[lN]&&(NN[lN]=0);return NN}NN.exports=HN},16730:(NN,BN,lN)=>{const kB=lN(16732),qN={};for(const eN of Object.keys(kB))qN[kB[eN]]=eN;const cN={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};NN.exports=cN;for(const eN of Object.keys(cN)){if(!("channels"in cN[eN]))throw new Error("missing channels property: "+eN);if(!("labels"in cN[eN]))throw new Error("missing channel labels property: "+eN);if(cN[eN].labels.length!==cN[eN].channels)throw new Error("channel and label counts mismatch: "+eN);const{channels:NN,labels:BN}=cN[eN];delete cN[eN].channels,delete cN[eN].labels,Object.defineProperty(cN[eN],"channels",{value:NN}),Object.defineProperty(cN[eN],"labels",{value:BN})}cN.rgb.hsl=function(NN){const BN=NN[0]/255,lN=NN[1]/255,kB=NN[2]/255,qN=Math.min(BN,lN,kB),cN=Math.max(BN,lN,kB),eN=cN-qN;let vN,HN;cN===qN?vN=0:BN===cN?vN=(lN-kB)/eN:lN===cN?vN=2+(kB-BN)/eN:kB===cN&&(vN=4+(BN-lN)/eN),vN=Math.min(60*vN,360),vN<0&&(vN+=360);const TN=(qN+cN)/2;return HN=cN===qN?0:TN<=.5?eN/(cN+qN):eN/(2-cN-qN),[vN,100*HN,100*TN]},cN.rgb.hsv=function(NN){let BN,lN,kB,qN,cN;const eN=NN[0]/255,vN=NN[1]/255,HN=NN[2]/255,TN=Math.max(eN,vN,HN),RN=TN-Math.min(eN,vN,HN),sN=function(NN){return(TN-NN)/6/RN+.5};return 0===RN?(qN=0,cN=0):(cN=RN/TN,BN=sN(eN),lN=sN(vN),kB=sN(HN),eN===TN?qN=kB-lN:vN===TN?qN=1/3+BN-kB:HN===TN&&(qN=2/3+lN-BN),qN<0?qN+=1:qN>1&&(qN-=1)),[360*qN,100*cN,100*TN]},cN.rgb.hwb=function(NN){const BN=NN[0],lN=NN[1];let kB=NN[2];const qN=cN.rgb.hsl(NN)[0],eN=1/255*Math.min(BN,Math.min(lN,kB));return kB=1-1/255*Math.max(BN,Math.max(lN,kB)),[qN,100*eN,100*kB]},cN.rgb.cmyk=function(NN){const BN=NN[0]/255,lN=NN[1]/255,kB=NN[2]/255,qN=Math.min(1-BN,1-lN,1-kB);return[100*((1-BN-qN)/(1-qN)||0),100*((1-lN-qN)/(1-qN)||0),100*((1-kB-qN)/(1-qN)||0),100*qN]},cN.rgb.keyword=function(NN){const BN=qN[NN];if(BN)return BN;let lN,cN=1/0;for(const qN of Object.keys(kB)){const BN=kB[qN],HN=(vN=BN,((eN=NN)[0]-vN[0])**2+(eN[1]-vN[1])**2+(eN[2]-vN[2])**2);HN<cN&&(cN=HN,lN=qN)}var eN,vN;return lN},cN.keyword.rgb=function(NN){return kB[NN]},cN.rgb.xyz=function(NN){let BN=NN[0]/255,lN=NN[1]/255,kB=NN[2]/255;BN=BN>.04045?((BN+.055)/1.055)**2.4:BN/12.92,lN=lN>.04045?((lN+.055)/1.055)**2.4:lN/12.92,kB=kB>.04045?((kB+.055)/1.055)**2.4:kB/12.92;return[100*(.4124*BN+.3576*lN+.1805*kB),100*(.2126*BN+.7152*lN+.0722*kB),100*(.0193*BN+.1192*lN+.9505*kB)]},cN.rgb.lab=function(NN){const BN=cN.rgb.xyz(NN);let lN=BN[0],kB=BN[1],qN=BN[2];lN/=95.047,kB/=100,qN/=108.883,lN=lN>.008856?lN**(1/3):7.787*lN+16/116,kB=kB>.008856?kB**(1/3):7.787*kB+16/116,qN=qN>.008856?qN**(1/3):7.787*qN+16/116;return[116*kB-16,500*(lN-kB),200*(kB-qN)]},cN.hsl.rgb=function(NN){const BN=NN[0]/360,lN=NN[1]/100,kB=NN[2]/100;let qN,cN,eN;if(0===lN)return eN=255*kB,[eN,eN,eN];qN=kB<.5?kB*(1+lN):kB+lN-kB*lN;const vN=2*kB-qN,HN=[0,0,0];for(let TN=0;TN<3;TN++)cN=BN+1/3*-(TN-1),cN<0&&cN++,cN>1&&cN--,eN=6*cN<1?vN+6*(qN-vN)*cN:2*cN<1?qN:3*cN<2?vN+(qN-vN)*(2/3-cN)*6:vN,HN[TN]=255*eN;return HN},cN.hsl.hsv=function(NN){const BN=NN[0];let lN=NN[1]/100,kB=NN[2]/100,qN=lN;const cN=Math.max(kB,.01);kB*=2,lN*=kB<=1?kB:2-kB,qN*=cN<=1?cN:2-cN;return[BN,100*(0===kB?2*qN/(cN+qN):2*lN/(kB+lN)),100*((kB+lN)/2)]},cN.hsv.rgb=function(NN){const BN=NN[0]/60,lN=NN[1]/100;let kB=NN[2]/100;const qN=Math.floor(BN)%6,cN=BN-Math.floor(BN),eN=255*kB*(1-lN),vN=255*kB*(1-lN*cN),HN=255*kB*(1-lN*(1-cN));switch(kB*=255,qN){case 0:return[kB,HN,eN];case 1:return[vN,kB,eN];case 2:return[eN,kB,HN];case 3:return[eN,vN,kB];case 4:return[HN,eN,kB];case 5:return[kB,eN,vN]}},cN.hsv.hsl=function(NN){const BN=NN[0],lN=NN[1]/100,kB=NN[2]/100,qN=Math.max(kB,.01);let cN,eN;eN=(2-lN)*kB;const vN=(2-lN)*qN;return cN=lN*qN,cN/=vN<=1?vN:2-vN,cN=cN||0,eN/=2,[BN,100*cN,100*eN]},cN.hwb.rgb=function(NN){const BN=NN[0]/360;let lN=NN[1]/100,kB=NN[2]/100;const qN=lN+kB;let cN;qN>1&&(lN/=qN,kB/=qN);const eN=Math.floor(6*BN),vN=1-kB;cN=6*BN-eN,0!==(1&eN)&&(cN=1-cN);const HN=lN+cN*(vN-lN);let TN,RN,sN;switch(eN){default:case 6:case 0:TN=vN,RN=HN,sN=lN;break;case 1:TN=HN,RN=vN,sN=lN;break;case 2:TN=lN,RN=vN,sN=HN;break;case 3:TN=lN,RN=HN,sN=vN;break;case 4:TN=HN,RN=lN,sN=vN;break;case 5:TN=vN,RN=lN,sN=HN}return[255*TN,255*RN,255*sN]},cN.cmyk.rgb=function(NN){const BN=NN[0]/100,lN=NN[1]/100,kB=NN[2]/100,qN=NN[3]/100;return[255*(1-Math.min(1,BN*(1-qN)+qN)),255*(1-Math.min(1,lN*(1-qN)+qN)),255*(1-Math.min(1,kB*(1-qN)+qN))]},cN.xyz.rgb=function(NN){const BN=NN[0]/100,lN=NN[1]/100,kB=NN[2]/100;let qN,cN,eN;return qN=3.2406*BN+-1.5372*lN+-.4986*kB,cN=-.9689*BN+1.8758*lN+.0415*kB,eN=.0557*BN+-.204*lN+1.057*kB,qN=qN>.0031308?1.055*qN**(1/2.4)-.055:12.92*qN,cN=cN>.0031308?1.055*cN**(1/2.4)-.055:12.92*cN,eN=eN>.0031308?1.055*eN**(1/2.4)-.055:12.92*eN,qN=Math.min(Math.max(0,qN),1),cN=Math.min(Math.max(0,cN),1),eN=Math.min(Math.max(0,eN),1),[255*qN,255*cN,255*eN]},cN.xyz.lab=function(NN){let BN=NN[0],lN=NN[1],kB=NN[2];BN/=95.047,lN/=100,kB/=108.883,BN=BN>.008856?BN**(1/3):7.787*BN+16/116,lN=lN>.008856?lN**(1/3):7.787*lN+16/116,kB=kB>.008856?kB**(1/3):7.787*kB+16/116;return[116*lN-16,500*(BN-lN),200*(lN-kB)]},cN.lab.xyz=function(NN){let BN,lN,kB;lN=(NN[0]+16)/116,BN=NN[1]/500+lN,kB=lN-NN[2]/200;const qN=lN**3,cN=BN**3,eN=kB**3;return lN=qN>.008856?qN:(lN-16/116)/7.787,BN=cN>.008856?cN:(BN-16/116)/7.787,kB=eN>.008856?eN:(kB-16/116)/7.787,BN*=95.047,lN*=100,kB*=108.883,[BN,lN,kB]},cN.lab.lch=function(NN){const BN=NN[0],lN=NN[1],kB=NN[2];let qN;qN=360*Math.atan2(kB,lN)/2/Math.PI,qN<0&&(qN+=360);return[BN,Math.sqrt(lN*lN+kB*kB),qN]},cN.lch.lab=function(NN){const BN=NN[0],lN=NN[1],kB=NN[2]/360*2*Math.PI;return[BN,lN*Math.cos(kB),lN*Math.sin(kB)]},cN.rgb.ansi16=function(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[lN,kB,qN]=NN;let eN=null===BN?cN.rgb.hsv(NN)[2]:BN;if(eN=Math.round(eN/50),0===eN)return 30;let vN=30+(Math.round(qN/255)<<2|Math.round(kB/255)<<1|Math.round(lN/255));return 2===eN&&(vN+=60),vN},cN.hsv.ansi16=function(NN){return cN.rgb.ansi16(cN.hsv.rgb(NN),NN[2])},cN.rgb.ansi256=function(NN){const BN=NN[0],lN=NN[1],kB=NN[2];if(BN===lN&&lN===kB)return BN<8?16:BN>248?231:Math.round((BN-8)/247*24)+232;return 16+36*Math.round(BN/255*5)+6*Math.round(lN/255*5)+Math.round(kB/255*5)},cN.ansi16.rgb=function(NN){let BN=NN%10;if(0===BN||7===BN)return NN>50&&(BN+=3.5),BN=BN/10.5*255,[BN,BN,BN];const lN=.5*(1+~~(NN>50));return[(1&BN)*lN*255,(BN>>1&1)*lN*255,(BN>>2&1)*lN*255]},cN.ansi256.rgb=function(NN){if(NN>=232){const BN=10*(NN-232)+8;return[BN,BN,BN]}let BN;NN-=16;return[Math.floor(NN/36)/5*255,Math.floor((BN=NN%36)/6)/5*255,BN%6/5*255]},cN.rgb.hex=function(NN){const BN=(((255&Math.round(NN[0]))<<16)+((255&Math.round(NN[1]))<<8)+(255&Math.round(NN[2]))).toString(16).toUpperCase();return"000000".substring(BN.length)+BN},cN.hex.rgb=function(NN){const BN=NN.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!BN)return[0,0,0];let lN=BN[0];3===BN[0].length&&(lN=lN.split("").map((NN=>NN+NN)).join(""));const kB=parseInt(lN,16);return[kB>>16&255,kB>>8&255,255&kB]},cN.rgb.hcg=function(NN){const BN=NN[0]/255,lN=NN[1]/255,kB=NN[2]/255,qN=Math.max(Math.max(BN,lN),kB),cN=Math.min(Math.min(BN,lN),kB),eN=qN-cN;let vN,HN;return vN=eN<1?cN/(1-eN):0,HN=eN<=0?0:qN===BN?(lN-kB)/eN%6:qN===lN?2+(kB-BN)/eN:4+(BN-lN)/eN,HN/=6,HN%=1,[360*HN,100*eN,100*vN]},cN.hsl.hcg=function(NN){const BN=NN[1]/100,lN=NN[2]/100,kB=lN<.5?2*BN*lN:2*BN*(1-lN);let qN=0;return kB<1&&(qN=(lN-.5*kB)/(1-kB)),[NN[0],100*kB,100*qN]},cN.hsv.hcg=function(NN){const BN=NN[1]/100,lN=NN[2]/100,kB=BN*lN;let qN=0;return kB<1&&(qN=(lN-kB)/(1-kB)),[NN[0],100*kB,100*qN]},cN.hcg.rgb=function(NN){const BN=NN[0]/360,lN=NN[1]/100,kB=NN[2]/100;if(0===lN)return[255*kB,255*kB,255*kB];const qN=[0,0,0],cN=BN%1*6,eN=cN%1,vN=1-eN;let HN=0;switch(Math.floor(cN)){case 0:qN[0]=1,qN[1]=eN,qN[2]=0;break;case 1:qN[0]=vN,qN[1]=1,qN[2]=0;break;case 2:qN[0]=0,qN[1]=1,qN[2]=eN;break;case 3:qN[0]=0,qN[1]=vN,qN[2]=1;break;case 4:qN[0]=eN,qN[1]=0,qN[2]=1;break;default:qN[0]=1,qN[1]=0,qN[2]=vN}return HN=(1-lN)*kB,[255*(lN*qN[0]+HN),255*(lN*qN[1]+HN),255*(lN*qN[2]+HN)]},cN.hcg.hsv=function(NN){const BN=NN[1]/100,lN=BN+NN[2]/100*(1-BN);let kB=0;return lN>0&&(kB=BN/lN),[NN[0],100*kB,100*lN]},cN.hcg.hsl=function(NN){const BN=NN[1]/100,lN=NN[2]/100*(1-BN)+.5*BN;let kB=0;return lN>0&&lN<.5?kB=BN/(2*lN):lN>=.5&&lN<1&&(kB=BN/(2*(1-lN))),[NN[0],100*kB,100*lN]},cN.hcg.hwb=function(NN){const BN=NN[1]/100,lN=BN+NN[2]/100*(1-BN);return[NN[0],100*(lN-BN),100*(1-lN)]},cN.hwb.hcg=function(NN){const BN=NN[1]/100,lN=1-NN[2]/100,kB=lN-BN;let qN=0;return kB<1&&(qN=(lN-kB)/(1-kB)),[NN[0],100*kB,100*qN]},cN.apple.rgb=function(NN){return[NN[0]/65535*255,NN[1]/65535*255,NN[2]/65535*255]},cN.rgb.apple=function(NN){return[NN[0]/255*65535,NN[1]/255*65535,NN[2]/255*65535]},cN.gray.rgb=function(NN){return[NN[0]/100*255,NN[0]/100*255,NN[0]/100*255]},cN.gray.hsl=function(NN){return[0,0,NN[0]]},cN.gray.hsv=cN.gray.hsl,cN.gray.hwb=function(NN){return[0,100,NN[0]]},cN.gray.cmyk=function(NN){return[0,0,0,NN[0]]},cN.gray.lab=function(NN){return[NN[0],0,0]},cN.gray.hex=function(NN){const BN=255&Math.round(NN[0]/100*255),lN=((BN<<16)+(BN<<8)+BN).toString(16).toUpperCase();return"000000".substring(lN.length)+lN},cN.rgb.gray=function(NN){return[(NN[0]+NN[1]+NN[2])/3/255*100]}},16724:(NN,BN,lN)=>{const kB=lN(16730),qN=lN(16735),cN={};Object.keys(kB).forEach((NN=>{cN[NN]={},Object.defineProperty(cN[NN],"channels",{value:kB[NN].channels}),Object.defineProperty(cN[NN],"labels",{value:kB[NN].labels});const BN=qN(NN);Object.keys(BN).forEach((lN=>{const kB=BN[lN];cN[NN][lN]=function(NN){const BN=function(){for(var BN=arguments.length,lN=new Array(BN),kB=0;kB<BN;kB++)lN[kB]=arguments[kB];const qN=lN[0];if(void 0===qN||null===qN)return qN;qN.length>1&&(lN=qN);const cN=NN(lN);if("object"===typeof cN)for(let NN=cN.length,eN=0;eN<NN;eN++)cN[eN]=Math.round(cN[eN]);return cN};return"conversion"in NN&&(BN.conversion=NN.conversion),BN}(kB),cN[NN][lN].raw=function(NN){const BN=function(){for(var BN=arguments.length,lN=new Array(BN),kB=0;kB<BN;kB++)lN[kB]=arguments[kB];const qN=lN[0];return void 0===qN||null===qN?qN:(qN.length>1&&(lN=qN),NN(lN))};return"conversion"in NN&&(BN.conversion=NN.conversion),BN}(kB)}))})),NN.exports=cN},16735:(NN,BN,lN)=>{const kB=lN(16730);function qN(NN){const BN=function(){const NN={},BN=Object.keys(kB);for(let lN=BN.length,kB=0;kB<lN;kB++)NN[BN[kB]]={distance:-1,parent:null};return NN}(),lN=[NN];for(BN[NN].distance=0;lN.length;){const NN=lN.pop(),qN=Object.keys(kB[NN]);for(let kB=qN.length,cN=0;cN<kB;cN++){const kB=qN[cN],eN=BN[kB];-1===eN.distance&&(eN.distance=BN[NN].distance+1,eN.parent=NN,lN.unshift(kB))}}return BN}function cN(NN,BN){return function(lN){return BN(NN(lN))}}function eN(NN,BN){const lN=[BN[NN].parent,NN];let qN=kB[BN[NN].parent][NN],eN=BN[NN].parent;for(;BN[eN].parent;)lN.unshift(BN[eN].parent),qN=cN(kB[BN[eN].parent][eN],qN),eN=BN[eN].parent;return qN.conversion=lN,qN}NN.exports=function(NN){const BN=qN(NN),lN={},kB=Object.keys(BN);for(let qN=kB.length,cN=0;cN<qN;cN++){const NN=kB[cN];null!==BN[NN].parent&&(lN[NN]=eN(NN,BN))}return lN}},16732:NN=>{"use strict";NN.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15658:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.discordURLBuilder=void 0,BN.discordURLBuilder=function(NN){var BN;const lN=(null===(BN=null===window||void 0===window?void 0:window.location)||void 0===BN?void 0:BN.hostname)||"localhost",kB=NN.hostname.split("."),qN=!NN.hostname.includes("trycloudflare.com")&&!NN.hostname.includes("discordsays.com")&&kB.length>2?"/".concat(kB[0]):"";return NN.pathname.startsWith("/.proxy")?"".concat(NN.protocol,"//").concat(lN).concat(qN).concat(NN.pathname).concat(NN.search):"".concat(NN.protocol,"//").concat(lN,"/.proxy/colyseus").concat(qN).concat(NN.pathname).concat(NN.search)}},15645:function(NN,BN,lN){"use strict";var kB,qN,cN,eN,vN=this&&this.__awaiter||function(NN,BN,lN,kB){return new(lN||(lN=Promise))((function(qN,cN){function eN(NN){try{HN(kB.next(NN))}catch(BN){cN(BN)}}function vN(NN){try{HN(kB.throw(NN))}catch(BN){cN(BN)}}function HN(NN){var BN;NN.done?qN(NN.value):(BN=NN.value,BN instanceof lN?BN:new lN((function(NN){NN(BN)}))).then(eN,vN)}HN((kB=kB.apply(NN,BN||[])).next())}))},HN=this&&this.__classPrivateFieldGet||function(NN,BN,lN,kB){if("a"===lN&&!kB)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof BN?NN!==BN||!kB:!BN.has(NN))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===lN?kB:"a"===lN?kB.call(NN):kB?kB.value:BN.get(NN)},TN=this&&this.__classPrivateFieldSet||function(NN,BN,lN,kB,qN){if("m"===kB)throw new TypeError("Private method is not writable");if("a"===kB&&!qN)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof BN?NN!==BN||!qN:!BN.has(NN))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kB?qN.call(NN,lN):qN?qN.value=lN:BN.set(NN,lN),lN};Object.defineProperty(BN,"__esModule",{value:!0}),BN.Auth=void 0;const RN=lN(15653),sN=lN(15607);BN.Auth=class{constructor(NN){this.http=NN,this.settings={path:"/auth",key:"colyseus-auth-token"},kB.set(this,!1),qN.set(this,void 0),cN.set(this,void 0),eN.set(this,(0,sN.createNanoEvents)()),(0,RN.getItem)(this.settings.key,(NN=>this.token=NN))}set token(NN){this.http.authToken=NN}get token(){return this.http.authToken}onChange(NN){const BN=HN(this,eN,"f").on("change",NN);return HN(this,kB,"f")||TN(this,qN,new Promise(((NN,BN)=>{this.getUserData().then((NN=>{this.emitChange(Object.assign(Object.assign({},NN),{token:this.token}))})).catch((NN=>{this.emitChange({user:null,token:void 0})})).finally((()=>{NN()}))})),"f"),TN(this,kB,!0,"f"),BN}getUserData(){return vN(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get("".concat(this.settings.path,"/userdata"))).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(NN,BN,lN){return vN(this,void 0,void 0,(function*(){const kB=(yield this.http.post("".concat(this.settings.path,"/register"),{body:{email:NN,password:BN,options:lN}})).data;return this.emitChange(kB),kB}))}signInWithEmailAndPassword(NN,BN){return vN(this,void 0,void 0,(function*(){const lN=(yield this.http.post("".concat(this.settings.path,"/login"),{body:{email:NN,password:BN}})).data;return this.emitChange(lN),lN}))}signInAnonymously(NN){return vN(this,void 0,void 0,(function*(){const BN=(yield this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:NN}})).data;return this.emitChange(BN),BN}))}sendPasswordResetEmail(NN){return vN(this,void 0,void 0,(function*(){return(yield this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:NN}})).data}))}signInWithProvider(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vN(this,void 0,void 0,(function*(){return new Promise(((lN,kB)=>{const qN=BN.width||480,eN=BN.height||768,vN=this.token?"?token=".concat(this.token):"",RN="Login with ".concat(NN[0].toUpperCase()+NN.substring(1)),sN=this.http.client.getHttpEndpoint("".concat(BN.prefix||"".concat(this.settings.path,"/provider"),"/").concat(NN).concat(vN)),VN=screen.width/2-qN/2,fN=screen.height/2-eN/2;TN(this,cN,window.open(sN,RN,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+qN+", height="+eN+", top="+fN+", left="+VN),"f");const ZN=NN=>{void 0===NN.data.user&&void 0===NN.data.token||(clearInterval(PN),HN(this,cN,"f").close(),TN(this,cN,void 0,"f"),window.removeEventListener("message",ZN),void 0!==NN.data.error?kB(NN.data.error):(lN(NN.data),this.emitChange(NN.data)))},PN=setInterval((()=>{HN(this,cN,"f")&&!HN(this,cN,"f").closed||(TN(this,cN,void 0,"f"),kB("oe"),window.removeEventListener("message",ZN))}),200);window.addEventListener("message",ZN)}))}))}signOut(){return vN(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(NN){void 0!==NN.token&&(this.token=NN.token,null===NN.token?(0,RN.removeItem)(this.settings.key):(0,RN.setItem)(this.settings.key,NN.token)),HN(this,eN,"f").emit("change",NN)}},kB=new WeakMap,qN=new WeakMap,cN=new WeakMap,eN=new WeakMap},15557:function(NN,BN,lN){"use strict";var kB,qN=this&&this.__awaiter||function(NN,BN,lN,kB){return new(lN||(lN=Promise))((function(qN,cN){function eN(NN){try{HN(kB.next(NN))}catch(BN){cN(BN)}}function vN(NN){try{HN(kB.throw(NN))}catch(BN){cN(BN)}}function HN(NN){var BN;NN.done?qN(NN.value):(BN=NN.value,BN instanceof lN?BN:new lN((function(NN){NN(BN)}))).then(eN,vN)}HN((kB=kB.apply(NN,BN||[])).next())}))};Object.defineProperty(BN,"__esModule",{value:!0}),BN.Client=BN.MatchMakeError=void 0;const cN=lN(15566),eN=lN(15568),vN=lN(15628),HN=lN(15645),TN=lN(15658);class RN extends Error{constructor(NN,BN){super(NN),this.code=BN,Object.setPrototypeOf(this,RN.prototype)}}BN.MatchMakeError=RN;const sN="undefined"!==typeof window&&"undefined"!==typeof(null===(kB=null===window||void 0===window?void 0:window.location)||void 0===kB?void 0:kB.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567";BN.Client=class{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sN,BN=arguments.length>1?arguments[1]:void 0;var lN,kB;if("string"===typeof NN){const BN=NN.startsWith("/")?new URL(NN,sN):new URL(NN),lN="https:"===BN.protocol||"wss:"===BN.protocol,kB=Number(BN.port||(lN?443:80));this.settings={hostname:BN.hostname,pathname:BN.pathname,port:kB,secure:lN}}else void 0===NN.port&&(NN.port=NN.secure?443:80),void 0===NN.pathname&&(NN.pathname=""),this.settings=NN;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new vN.HTTP(this,(null===BN||void 0===BN?void 0:BN.headers)||{}),this.auth=new HN.Auth(this.http),this.urlBuilder=null===BN||void 0===BN?void 0:BN.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(kB=null===(lN=null===window||void 0===window?void 0:window.location)||void 0===lN?void 0:lN.hostname)||void 0===kB?void 0:kB.includes("discordsays.com"))&&(this.urlBuilder=TN.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;return qN(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",NN,BN,lN)}))}create(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;return qN(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",NN,BN,lN)}))}join(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;return qN(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",NN,BN,lN)}))}joinById(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;return qN(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",NN,BN,lN)}))}reconnect(NN,BN){return qN(this,void 0,void 0,(function*(){if("string"===typeof NN&&"string"===typeof BN)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[lN,kB]=NN.split(":");if(!lN||!kB)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",lN,{reconnectionToken:kB},BN)}))}getAvailableRooms(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return qN(this,void 0,void 0,(function*(){return(yield this.http.get("matchmake/".concat(NN),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(NN,BN,lN){return qN(this,void 0,void 0,(function*(){const kB=this.createRoom(NN.room.name,BN);kB.roomId=NN.room.roomId,kB.sessionId=NN.sessionId;const eN={sessionId:kB.sessionId};NN.reconnectionToken&&(eN.reconnectionToken=NN.reconnectionToken);const vN=lN||kB;return kB.connect(this.buildEndpoint(NN.room,eN),NN.devMode&&(()=>qN(this,void 0,void 0,(function*(){console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(kB.roomId,"'..."));let lN=0;const cN=()=>qN(this,void 0,void 0,(function*(){lN++;try{yield this.consumeSeatReservation(NN,BN,vN),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(kB.roomId,"'"))}catch(qN){lN<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(lN," out of ").concat(8,")")),setTimeout(cN,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."))}}));setTimeout(cN,2e3)}))),vN,this.http.headers),new Promise(((NN,BN)=>{const lN=(NN,lN)=>BN(new cN.ServerError(NN,lN));vN.onError.once(lN),vN.onJoin.once((()=>{vN.onError.remove(lN),setTimeout((()=>{try{vN.dR(128,new Uint8Array([33,55,19,24,172,186,205,204,88,93,2,6,214,218,60,99,133,24,193,198]))}catch(NN){}}),3e3),NN(vN)}))}))}))}createMatchMakeRequest(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},kB=arguments.length>3?arguments[3]:void 0,cN=arguments.length>4?arguments[4]:void 0;return qN(this,void 0,void 0,(function*(){const qN=(yield this.http.post("matchmake/".concat(NN,"/").concat(BN),{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(lN)})).data;if(qN.error)throw new RN(qN.error,qN.code);return"reconnect"===NN&&(qN.reconnectionToken=lN.reconnectionToken),yield this.consumeSeatReservation(qN,kB,cN)}))}createRoom(NN,BN){return new eN.Room(NN,BN)}buildEndpoint(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const lN=[];for(const cN in BN)BN.hasOwnProperty(cN)&&lN.push("".concat(cN,"=").concat(BN[cN]));let kB=this.settings.secure?"wss://":"ws://";NN.publicAddress?kB+="".concat(NN.publicAddress):kB+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname);const qN="".concat(kB,"/").concat(NN.processId,"/").concat(NN.roomId,"?").concat(lN.join("&"));return this.urlBuilder?this.urlBuilder(new URL(qN)):qN}getHttpEndpoint(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const BN=NN.startsWith("/")?NN:"/".concat(NN),lN="".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(BN);return this.urlBuilder?this.urlBuilder(new URL(lN)):lN}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}},15583:(NN,BN,lN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.Connection=void 0;const kB=lN(15587);BN.Connection=class{constructor(){this.events={},this.transport=new kB.WebSocketTransport(this.events)}send(NN){this.transport.send(NN)}connect(NN,BN){this.transport.connect(NN,BN)}close(NN,BN){this.transport.close(NN,BN)}get isOpen(){return this.transport.isOpen}}},15628:function(NN,BN,lN){"use strict";var kB=this&&this.__createBinding||(Object.create?function(NN,BN,lN,kB){void 0===kB&&(kB=lN);var qN=Object.getOwnPropertyDescriptor(BN,lN);qN&&!("get"in qN?!BN.__esModule:qN.writable||qN.configurable)||(qN={enumerable:!0,get:function(){return BN[lN]}}),Object.defineProperty(NN,kB,qN)}:function(NN,BN,lN,kB){void 0===kB&&(kB=lN),NN[kB]=BN[lN]}),qN=this&&this.__setModuleDefault||(Object.create?function(NN,BN){Object.defineProperty(NN,"default",{enumerable:!0,value:BN})}:function(NN,BN){NN.default=BN}),cN=this&&this.__importStar||function(NN){if(NN&&NN.__esModule)return NN;var BN={};if(null!=NN)for(var lN in NN)"default"!==lN&&Object.prototype.hasOwnProperty.call(NN,lN)&&kB(BN,NN,lN);return qN(BN,NN),BN};Object.defineProperty(BN,"__esModule",{value:!0}),BN.HTTP=void 0;const eN=lN(15566),vN=cN(lN(15636));BN.HTTP=class{constructor(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=NN,this.headers=BN}get(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",NN,BN)}post(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",NN,BN)}del(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",NN,BN)}put(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",NN,BN)}request(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return vN[NN](this.client.getHttpEndpoint(BN),this.getOptions(lN)).catch((NN=>{var BN;const lN=NN.statusCode,kB=(null===(BN=NN.data)||void 0===BN?void 0:BN.error)||NN.statusMessage||NN.message;if(!lN&&!kB)throw NN;throw new eN.ServerError(lN,kB)}))}getOptions(NN){return NN.headers=Object.assign({},this.headers,NN.headers),this.authToken&&(NN.headers.Authorization="Bearer ".concat(this.authToken)),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(NN.withCredentials=!0),NN}}},15600:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.utf8Length=BN.utf8Read=BN.ErrorCode=BN.Protocol=void 0,function(NN){NN[NN.HANDSHAKE=9]="HANDSHAKE",NN[NN.JOIN_ROOM=10]="JOIN_ROOM",NN[NN.ERROR=11]="ERROR",NN[NN.LEAVE_ROOM=12]="LEAVE_ROOM",NN[NN.ROOM_DATA=13]="ROOM_DATA",NN[NN.ROOM_STATE=14]="ROOM_STATE",NN[NN.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",NN[NN.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",NN[NN.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(BN.Protocol||(BN.Protocol={})),function(NN){NN[NN.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",NN[NN.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",NN[NN.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",NN[NN.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",NN[NN.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",NN[NN.AUTH_FAILED=4215]="AUTH_FAILED",NN[NN.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(BN.ErrorCode||(BN.ErrorCode={})),BN.utf8Read=function(NN,BN){const lN=NN[BN++];for(var kB="",qN=0,cN=BN,eN=BN+lN;cN<eN;cN++){var vN=NN[cN];if(0!==(128&vN))if(192!==(224&vN))if(224!==(240&vN)){if(240!==(248&vN))throw new Error("Invalid byte "+vN.toString(16));(qN=(7&vN)<<18|(63&NN[++cN])<<12|(63&NN[++cN])<<6|63&NN[++cN])>=65536?(qN-=65536,kB+=String.fromCharCode(55296+(qN>>>10),56320+(1023&qN))):kB+=String.fromCharCode(qN)}else kB+=String.fromCharCode((15&vN)<<12|(63&NN[++cN])<<6|63&NN[++cN]);else kB+=String.fromCharCode((31&vN)<<6|63&NN[++cN]);else kB+=String.fromCharCode(vN)}return kB},BN.utf8Length=function(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",BN=0,lN=0;for(let kB=0,qN=NN.length;kB<qN;kB++)BN=NN.charCodeAt(kB),BN<128?lN+=1:BN<2048?lN+=2:BN<55296||BN>=57344?lN+=3:(kB++,lN+=4);return lN+1}},15568:function(NN,BN,lN){"use strict";var kB=this&&this.__createBinding||(Object.create?function(NN,BN,lN,kB){void 0===kB&&(kB=lN);var qN=Object.getOwnPropertyDescriptor(BN,lN);qN&&!("get"in qN?!BN.__esModule:qN.writable||qN.configurable)||(qN={enumerable:!0,get:function(){return BN[lN]}}),Object.defineProperty(NN,kB,qN)}:function(NN,BN,lN,kB){void 0===kB&&(kB=lN),NN[kB]=BN[lN]}),qN=this&&this.__setModuleDefault||(Object.create?function(NN,BN){Object.defineProperty(NN,"default",{enumerable:!0,value:BN})}:function(NN,BN){NN.default=BN}),cN=this&&this.__importStar||function(NN){if(NN&&NN.__esModule)return NN;var BN={};if(null!=NN)for(var lN in NN)"default"!==lN&&Object.prototype.hasOwnProperty.call(NN,lN)&&kB(BN,NN,lN);return qN(BN,NN),BN};Object.defineProperty(BN,"__esModule",{value:!0}),BN.Room=void 0;const eN=cN(lN(15576)),vN=lN(15583),HN=lN(15600),TN=lN(15605),RN=lN(15607),sN=lN(15615),VN=lN(15623),fN=lN(15566);class ZN{constructor(NN,BN){this.onStateChange=(0,sN.createSignal)(),this.onError=(0,sN.createSignal)(),this.onLeave=(0,sN.createSignal)(),this.onJoin=(0,sN.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,RN.createNanoEvents)(),this.roomId=null,this.name=NN,BN&&(this.serializer=new((0,TN.getSerializer)("schema")),this.rootSchema=BN,this.serializer.state=new BN),this.onError(((NN,BN)=>{var lN;return null===(lN=console.warn)||void 0===lN?void 0:lN.call(console,"colyseus.js - onError => (".concat(NN,") ").concat(BN))})),this.onLeave((()=>this.BB()))}get id(){return this.roomId}connect(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,kB=arguments.length>3?arguments[3]:void 0;const qN=new vN.Connection;lN.connection=qN,qN.events.onmessage=ZN.prototype.onMessageCallback.bind(lN),qN.events.onclose=function(NN){var kB;if(!lN.hasJoined)return null===(kB=console.warn)||void 0===kB||kB.call(console,"Room connection was closed unexpectedly (".concat(NN.code,"): ").concat(NN.reason)),void lN.onError.invoke(NN.code,NN.reason);NN.code===fN.CloseCode.DEVMODE_RESTART&&BN?BN():(lN.onLeave.invoke(NN.code,NN.reason),lN.destroy())},qN.events.onerror=function(NN){var BN;null===(BN=console.warn)||void 0===BN||BN.call(console,"Room, onError (".concat(NN.code,"): ").concat(NN.reason)),lN.onError.invoke(NN.code,NN.reason)},qN.connect(NN,kB)}uT(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((BN=>{this.onLeave((NN=>BN(NN))),this.connection?NN?this.connection.send([HN.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(fN.CloseCode.CONSENTED)}))}bB(NN,BN){return this.onMessageHandlers.on(this.getMessageHandlerKey(NN),BN)}send(NN,BN){const lN=[HN.Protocol.ROOM_DATA];let kB;if("string"===typeof NN?VN.encode.string(lN,NN):VN.encode.number(lN,NN),void 0!==BN){const NN=eN.encode(BN);kB=new Uint8Array(lN.length+NN.byteLength),kB.set(new Uint8Array(lN),0),kB.set(new Uint8Array(NN),lN.length)}else kB=new Uint8Array(lN);this.connection.send(kB.buffer)}dR(NN,BN){const lN=[HN.Protocol.ROOM_DATA_BYTES];let kB;"string"===typeof NN?VN.encode.string(lN,NN):VN.encode.number(lN,NN),kB=new Uint8Array(lN.length+(BN.byteLength||BN.length)),kB.set(new Uint8Array(lN),0),kB.set(new Uint8Array(BN),lN.length),this.connection.send(kB.buffer)}get state(){return this.serializer.getState()}BB(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(NN){const BN=Array.from(new Uint8Array(NN.data)),lN=BN[0];if(lN===HN.Protocol.JOIN_ROOM){let NN=1;const lN=(0,HN.utf8Read)(BN,NN);if(NN+=(0,HN.utf8Length)(lN),this.serializerId=(0,HN.utf8Read)(BN,NN),NN+=(0,HN.utf8Length)(this.serializerId),!this.serializer){const NN=(0,TN.getSerializer)(this.serializerId);this.serializer=new NN}BN.length>NN&&this.serializer.handshake&&this.serializer.handshake(BN,{offset:NN}),this.reconnectionToken="".concat(this.roomId,":").concat(lN),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([HN.Protocol.JOIN_ROOM])}else if(lN===HN.Protocol.ERROR){const NN={offset:1},lN=VN.decode.number(BN,NN),kB=VN.decode.string(BN,NN);this.onError.invoke(lN,kB)}else if(lN===HN.Protocol.LEAVE_ROOM)this.uT();else if(lN===HN.Protocol.ROOM_DATA_SCHEMA){const NN={offset:1},lN=this.serializer.getState().constructor._context.get(VN.decode.number(BN,NN)),kB=new lN;kB.decode(BN,NN),this.dispatchMessage(lN,kB)}else if(lN===HN.Protocol.ROOM_STATE)BN.shift(),this.setState(BN);else if(lN===HN.Protocol.ROOM_STATE_PATCH)BN.shift(),this.patch(BN);else if(lN===HN.Protocol.ROOM_DATA){const lN={offset:1},kB=VN.decode.stringCheck(BN,lN)?VN.decode.string(BN,lN):VN.decode.number(BN,lN),qN=BN.length>lN.offset?eN.decode(NN.data,lN.offset):void 0;this.dispatchMessage(kB,qN)}else if(lN===HN.Protocol.ROOM_DATA_BYTES){const NN={offset:1},lN=VN.decode.stringCheck(BN,NN)?VN.decode.string(BN,NN):VN.decode.number(BN,NN);this.dispatchMessage(lN,new Uint8Array(BN.slice(NN.offset)))}}setState(NN){this.serializer.setState(NN),this.onStateChange.invoke(this.serializer.getState())}patch(NN){this.serializer.patch(NN),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(NN,BN){var lN;const kB=this.getMessageHandlerKey(NN);this.onMessageHandlers.events[kB]?this.onMessageHandlers.emit(kB,BN):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",NN,BN):null===(lN=console.warn)||void 0===lN||lN.call(console,"colyseus.js: onMessage() not registered for type '".concat(NN,"'."))}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(NN){switch(typeof NN){case"function":return"$".concat(NN._typeid);case"string":return NN;case"number":return"i".concat(NN);default:throw new Error("invalid message type.")}}}BN.Room=ZN},15653:(NN,BN)=>{"use strict";let lN;function kB(){if(!lN)try{lN="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(NN){}return lN||(lN={cache:{},setItem:function(NN,BN){this.cache[NN]=BN},getItem:function(NN){this.cache[NN]},removeItem:function(NN){delete this.cache[NN]}}),lN}Object.defineProperty(BN,"__esModule",{value:!0}),BN.getItem=BN.removeItem=BN.setItem=void 0,BN.setItem=function(NN,BN){kB().setItem(NN,BN)},BN.removeItem=function(NN){kB().removeItem(NN)},BN.getItem=function(NN,BN){const lN=kB().getItem(NN);"undefined"!==typeof Promise&&lN instanceof Promise?lN.then((NN=>BN(NN))):BN(lN)}},15607:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.createNanoEvents=void 0;BN.createNanoEvents=()=>({emit(NN){let BN=this.events[NN]||[];for(var lN=arguments.length,kB=new Array(lN>1?lN-1:0),qN=1;qN<lN;qN++)kB[qN-1]=arguments[qN];for(let cN=0,eN=BN.length;cN<eN;cN++)BN[cN](...kB)},events:{},on(NN,BN){var lN;return(null===(lN=this.events[NN])||void 0===lN?void 0:lN.push(BN))||(this.events[NN]=[BN]),()=>{var lN;this.events[NN]=null===(lN=this.events[NN])||void 0===lN?void 0:lN.filter((NN=>BN!==NN))}}})},15615:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.createSignal=BN.EventEmitter=void 0;class lN{constructor(){this.handlers=[]}register(NN){return this.handlers.push(NN),this}invoke(){for(var NN=arguments.length,BN=new Array(NN),lN=0;lN<NN;lN++)BN[lN]=arguments[lN];this.handlers.forEach((NN=>NN.apply(this,BN)))}invokeAsync(){for(var NN=arguments.length,BN=new Array(NN),lN=0;lN<NN;lN++)BN[lN]=arguments[lN];return Promise.all(this.handlers.map((NN=>NN.apply(this,BN))))}remove(NN){const BN=this.handlers.indexOf(NN);this.handlers[BN]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}BN.EventEmitter=lN,BN.createSignal=function(){const NN=new lN;function BN(BN){return NN.register(BN,null===this)}return BN.once=BN=>{const lN=function(){for(var kB=arguments.length,qN=new Array(kB),cN=0;cN<kB;cN++)qN[cN]=arguments[cN];BN.apply(this,qN),NN.remove(lN)};NN.register(lN)},BN.remove=BN=>NN.remove(BN),BN.invoke=function(){return NN.invoke(...arguments)},BN.invokeAsync=function(){return NN.invokeAsync(...arguments)},BN.clear=()=>NN.clear(),BN}},15566:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.ServerError=BN.CloseCode=void 0,function(NN){NN[NN.CONSENTED=4e3]="CONSENTED",NN[NN.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(BN.CloseCode||(BN.CloseCode={}));class lN extends Error{constructor(NN,BN){super(BN),this.name="ServerError",this.code=NN}}BN.ServerError=lN},15548:(NN,BN,lN)=>{"use strict";BN.c=void 0,lN(15550);var kB=lN(15557);Object.defineProperty(BN,"c",{enumerable:!0,get:function(){return kB.Client}});var qN=lN(15600);var cN=lN(15568);var eN=lN(15645);const vN=lN(15662);const HN=lN(15668),TN=lN(15605);(0,TN.registerSerializer)("schema",vN.SchemaSerializer),(0,TN.registerSerializer)("none",HN.NoneSerializer)},15550:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=NN=>null!==NN&&"object"===typeof NN&&NN.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},15576:(NN,BN)=>{"use strict";function lN(NN,BN){if(this._offset=BN,NN instanceof ArrayBuffer)this._buffer=NN,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(NN))throw new Error("Invalid argument");this._buffer=NN.buffer,this._view=new DataView(this._buffer,NN.byteOffset,NN.byteLength)}}Object.defineProperty(BN,"__esModule",{value:!0}),BN.decode=BN.encode=void 0,lN.prototype._array=function(NN){for(var BN=new Array(NN),lN=0;lN<NN;lN++)BN[lN]=this._parse();return BN},lN.prototype._map=function(NN){for(var BN={},lN=0;lN<NN;lN++)BN[this._parse()]=this._parse();return BN},lN.prototype._str=function(NN){var BN=function(NN,BN,lN){for(var kB="",qN=0,cN=BN,eN=BN+lN;cN<eN;cN++){var vN=NN.getUint8(cN);if(0!==(128&vN))if(192!==(224&vN))if(224!==(240&vN)){if(240!==(248&vN))throw new Error("Invalid byte "+vN.toString(16));(qN=(7&vN)<<18|(63&NN.getUint8(++cN))<<12|(63&NN.getUint8(++cN))<<6|63&NN.getUint8(++cN))>=65536?(qN-=65536,kB+=String.fromCharCode(55296+(qN>>>10),56320+(1023&qN))):kB+=String.fromCharCode(qN)}else kB+=String.fromCharCode((15&vN)<<12|(63&NN.getUint8(++cN))<<6|63&NN.getUint8(++cN));else kB+=String.fromCharCode((31&vN)<<6|63&NN.getUint8(++cN));else kB+=String.fromCharCode(vN)}return kB}(this._view,this._offset,NN);return this._offset+=NN,BN},lN.prototype._bin=function(NN){var BN=this._buffer.slice(this._offset,this._offset+NN);return this._offset+=NN,BN},lN.prototype._parse=function(){var NN,BN=this._view.getUint8(this._offset++),lN=0,kB=0,qN=0,cN=0;if(BN<192)return BN<128?BN:BN<144?this._map(15&BN):BN<160?this._array(15&BN):this._str(31&BN);if(BN>223)return-1*(255-BN+1);switch(BN){case 192:return null;case 194:return!1;case 195:return!0;case 196:return lN=this._view.getUint8(this._offset),this._offset+=1,this._bin(lN);case 197:return lN=this._view.getUint16(this._offset),this._offset+=2,this._bin(lN);case 198:return lN=this._view.getUint32(this._offset),this._offset+=4,this._bin(lN);case 199:if(lN=this._view.getUint8(this._offset),kB=this._view.getInt8(this._offset+1),this._offset+=2,-1===kB){var eN=this._view.getUint32(this._offset);return qN=this._view.getInt32(this._offset+4),cN=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*qN+cN)+eN/1e6)}return[kB,this._bin(lN)];case 200:return lN=this._view.getUint16(this._offset),kB=this._view.getInt8(this._offset+2),this._offset+=3,[kB,this._bin(lN)];case 201:return lN=this._view.getUint32(this._offset),kB=this._view.getInt8(this._offset+4),this._offset+=5,[kB,this._bin(lN)];case 202:return NN=this._view.getFloat32(this._offset),this._offset+=4,NN;case 203:return NN=this._view.getFloat64(this._offset),this._offset+=8,NN;case 204:return NN=this._view.getUint8(this._offset),this._offset+=1,NN;case 205:return NN=this._view.getUint16(this._offset),this._offset+=2,NN;case 206:return NN=this._view.getUint32(this._offset),this._offset+=4,NN;case 207:return qN=this._view.getUint32(this._offset)*Math.pow(2,32),cN=this._view.getUint32(this._offset+4),this._offset+=8,qN+cN;case 208:return NN=this._view.getInt8(this._offset),this._offset+=1,NN;case 209:return NN=this._view.getInt16(this._offset),this._offset+=2,NN;case 210:return NN=this._view.getInt32(this._offset),this._offset+=4,NN;case 211:return qN=this._view.getInt32(this._offset)*Math.pow(2,32),cN=this._view.getUint32(this._offset+4),this._offset+=8,qN+cN;case 212:return kB=this._view.getInt8(this._offset),this._offset+=1,0===kB?void(this._offset+=1):[kB,this._bin(1)];case 213:return kB=this._view.getInt8(this._offset),this._offset+=1,[kB,this._bin(2)];case 214:return kB=this._view.getInt8(this._offset),this._offset+=1,-1===kB?(NN=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*NN)):[kB,this._bin(4)];case 215:return kB=this._view.getInt8(this._offset),this._offset+=1,0===kB?(qN=this._view.getInt32(this._offset)*Math.pow(2,32),cN=this._view.getUint32(this._offset+4),this._offset+=8,new Date(qN+cN)):-1===kB?(qN=this._view.getUint32(this._offset),cN=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&qN)+cN)+(qN>>>2)/1e6)):[kB,this._bin(8)];case 216:return kB=this._view.getInt8(this._offset),this._offset+=1,[kB,this._bin(16)];case 217:return lN=this._view.getUint8(this._offset),this._offset+=1,this._str(lN);case 218:return lN=this._view.getUint16(this._offset),this._offset+=2,this._str(lN);case 219:return lN=this._view.getUint32(this._offset),this._offset+=4,this._str(lN);case 220:return lN=this._view.getUint16(this._offset),this._offset+=2,this._array(lN);case 221:return lN=this._view.getUint32(this._offset),this._offset+=4,this._array(lN);case 222:return lN=this._view.getUint16(this._offset),this._offset+=2,this._map(lN);case 223:return lN=this._view.getUint32(this._offset),this._offset+=4,this._map(lN)}throw new Error("Could not parse")},BN.decode=function(NN){var BN=new lN(NN,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),kB=BN._parse();if(BN._offset!==NN.byteLength)throw new Error(NN.byteLength-BN._offset+" trailing bytes");return kB};function kB(NN,BN,lN){for(var kB=0,qN=0,cN=lN.length;qN<cN;qN++)(kB=lN.charCodeAt(qN))<128?NN.setUint8(BN++,kB):kB<2048?(NN.setUint8(BN++,192|kB>>6),NN.setUint8(BN++,128|63&kB)):kB<55296||kB>=57344?(NN.setUint8(BN++,224|kB>>12),NN.setUint8(BN++,128|kB>>6&63),NN.setUint8(BN++,128|63&kB)):(qN++,kB=65536+((1023&kB)<<10|1023&lN.charCodeAt(qN)),NN.setUint8(BN++,240|kB>>18),NN.setUint8(BN++,128|kB>>12&63),NN.setUint8(BN++,128|kB>>6&63),NN.setUint8(BN++,128|63&kB))}function qN(NN,BN,lN){var kB=typeof lN,cN=0,eN=0,vN=0,HN=0,TN=0,RN=0;if("string"===kB){if(TN=function(NN){for(var BN=0,lN=0,kB=0,qN=NN.length;kB<qN;kB++)(BN=NN.charCodeAt(kB))<128?lN+=1:BN<2048?lN+=2:BN<55296||BN>=57344?lN+=3:(kB++,lN+=4);return lN}(lN),TN<32)NN.push(160|TN),RN=1;else if(TN<256)NN.push(217,TN),RN=2;else if(TN<65536)NN.push(218,TN>>8,TN),RN=3;else{if(!(TN<4294967296))throw new Error("String too long");NN.push(219,TN>>24,TN>>16,TN>>8,TN),RN=5}return BN.push({_str:lN,_length:TN,_offset:NN.length}),RN+TN}if("number"===kB)return Math.floor(lN)===lN&&isFinite(lN)?lN>=0?lN<128?(NN.push(lN),1):lN<256?(NN.push(204,lN),2):lN<65536?(NN.push(205,lN>>8,lN),3):lN<4294967296?(NN.push(206,lN>>24,lN>>16,lN>>8,lN),5):(vN=lN/Math.pow(2,32)|0,HN=lN>>>0,NN.push(207,vN>>24,vN>>16,vN>>8,vN,HN>>24,HN>>16,HN>>8,HN),9):lN>=-32?(NN.push(lN),1):lN>=-128?(NN.push(208,lN),2):lN>=-32768?(NN.push(209,lN>>8,lN),3):lN>=-2147483648?(NN.push(210,lN>>24,lN>>16,lN>>8,lN),5):(vN=Math.floor(lN/Math.pow(2,32)),HN=lN>>>0,NN.push(211,vN>>24,vN>>16,vN>>8,vN,HN>>24,HN>>16,HN>>8,HN),9):(NN.push(203),BN.push({_float:lN,_length:8,_offset:NN.length}),9);if("object"===kB){if(null===lN)return NN.push(192),1;if(Array.isArray(lN)){if((TN=lN.length)<16)NN.push(144|TN),RN=1;else if(TN<65536)NN.push(220,TN>>8,TN),RN=3;else{if(!(TN<4294967296))throw new Error("Array too large");NN.push(221,TN>>24,TN>>16,TN>>8,TN),RN=5}for(cN=0;cN<TN;cN++)RN+=qN(NN,BN,lN[cN]);return RN}if(lN instanceof Date){var sN=lN.getTime(),VN=Math.floor(sN/1e3),fN=1e6*(sN-1e3*VN);return VN>=0&&fN>=0&&VN<=17179869183?0===fN&&VN<=4294967295?(NN.push(214,255,VN>>24,VN>>16,VN>>8,VN),6):(vN=VN/4294967296,HN=4294967295&VN,NN.push(215,255,fN>>22,fN>>14,fN>>6,vN,HN>>24,HN>>16,HN>>8,HN),10):(vN=Math.floor(VN/4294967296),HN=VN>>>0,NN.push(199,12,255,fN>>24,fN>>16,fN>>8,fN,vN>>24,vN>>16,vN>>8,vN,HN>>24,HN>>16,HN>>8,HN),15)}if(lN instanceof ArrayBuffer){if((TN=lN.byteLength)<256)NN.push(196,TN),RN=2;else if(TN<65536)NN.push(197,TN>>8,TN),RN=3;else{if(!(TN<4294967296))throw new Error("Buffer too large");NN.push(198,TN>>24,TN>>16,TN>>8,TN),RN=5}return BN.push({_bin:lN,_length:TN,_offset:NN.length}),RN+TN}if("function"===typeof lN.toJSON)return qN(NN,BN,lN.toJSON());var ZN=[],PN="",CN=Object.keys(lN);for(cN=0,eN=CN.length;cN<eN;cN++)void 0!==lN[PN=CN[cN]]&&"function"!==typeof lN[PN]&&ZN.push(PN);if((TN=ZN.length)<16)NN.push(128|TN),RN=1;else if(TN<65536)NN.push(222,TN>>8,TN),RN=3;else{if(!(TN<4294967296))throw new Error("Object too large");NN.push(223,TN>>24,TN>>16,TN>>8,TN),RN=5}for(cN=0;cN<TN;cN++)RN+=qN(NN,BN,PN=ZN[cN]),RN+=qN(NN,BN,lN[PN]);return RN}if("boolean"===kB)return NN.push(lN?195:194),1;if("undefined"===kB)return NN.push(192),1;if("function"===typeof lN.toJSON)return qN(NN,BN,lN.toJSON());throw new Error("Could not encode")}BN.encode=function(NN){var BN=[],lN=[],cN=qN(BN,lN,NN),eN=new ArrayBuffer(cN),vN=new DataView(eN),HN=0,TN=0,RN=-1;lN.length>0&&(RN=lN[0]._offset);for(var sN,VN=0,fN=0,ZN=0,PN=BN.length;ZN<PN;ZN++)if(vN.setUint8(TN+ZN,BN[ZN]),ZN+1===RN){if(VN=(sN=lN[HN])._length,fN=TN+RN,sN._bin)for(var CN=new Uint8Array(sN._bin),FN=0;FN<VN;FN++)vN.setUint8(fN+FN,CN[FN]);else sN._str?kB(vN,fN,sN._str):void 0!==sN._float&&vN.setFloat64(fN,sN._float);TN+=VN,lN[++HN]&&(RN=lN[HN]._offset)}return eN}},15668:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.NoneSerializer=void 0;BN.NoneSerializer=class{setState(NN){}getState(){return null}patch(NN){}teardown(){}handshake(NN){}}},15662:(NN,BN,lN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.SchemaSerializer=void 0;const kB=lN(15623);BN.SchemaSerializer=class{setState(NN){return this.state.decode(NN)}getState(){return this.state}patch(NN){return this.state.decode(NN)}teardown(){var NN,BN;null===(BN=null===(NN=this.state)||void 0===NN?void 0:NN.$changes)||void 0===BN||BN.root.clearRefs()}handshake(NN,BN){if(this.state){(new kB.Reflection).decode(NN,BN)}else this.state=kB.Reflection.decode(NN,BN)}}},15605:(NN,BN)=>{"use strict";Object.defineProperty(BN,"__esModule",{value:!0}),BN.getSerializer=BN.registerSerializer=void 0;const lN={};BN.registerSerializer=function(NN,BN){lN[NN]=BN},BN.getSerializer=function(NN){const BN=lN[NN];if(!BN)throw new Error("missing serializer: "+NN);return BN}},15587:function(NN,BN,lN){"use strict";var kB=this&&this.__importDefault||function(NN){return NN&&NN.__esModule?NN:{default:NN}};Object.defineProperty(BN,"__esModule",{value:!0}),BN.WebSocketTransport=void 0;const qN=kB(lN(15591)),cN=globalThis.WebSocket||qN.default;BN.WebSocketTransport=class{constructor(NN){this.events=NN}send(NN){NN instanceof ArrayBuffer?this.ws.send(NN):Array.isArray(NN)&&this.ws.send(new Uint8Array(NN).buffer)}connect(NN,BN){try{this.ws=new cN(NN,{headers:BN,protocols:this.protocols})}catch(lN){this.ws=new cN(NN,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(NN,BN){this.ws.close(NN,BN)}get isOpen(){return this.ws.readyState===cN.OPEN}}},15591:NN=>{"use strict";NN.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},16565:NN=>{"use strict";NN.exports=function(NN){for(var BN=new Array(NN),lN=0;lN<NN;++lN)BN[lN]=lN;return BN}},16570:NN=>{function BN(NN){return!!NN.constructor&&"function"===typeof NN.constructor.isBuffer&&NN.constructor.isBuffer(NN)}NN.exports=function(NN){return null!=NN&&(BN(NN)||function(NN){return"function"===typeof NN.readFloatLE&&"function"===typeof NN.slice&&BN(NN.slice(0,0))}(NN)||!!NN._isBuffer)}},16556:(NN,BN,lN)=>{var kB=lN(16565),qN=lN(16570),cN="undefined"!==typeof Float64Array;function eN(NN,BN){return NN[0]-BN[0]}function vN(){var NN,BN=this.stride,lN=new Array(BN.length);for(NN=0;NN<lN.length;++NN)lN[NN]=[Math.abs(BN[NN]),NN];lN.sort(eN);var kB=new Array(lN.length);for(NN=0;NN<kB.length;++NN)kB[NN]=lN[NN][1];return kB}function HN(NN,BN){var lN=["View",BN,"d",NN].join("");BN<0&&(lN="View_Nil"+NN);var qN="generic"===NN;if(-1===BN){var cN="function "+lN+"(a){this.data=a;};var proto="+lN+".prototype;proto.dtype='"+NN+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+lN+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+lN+"(a){return new "+lN+"(a);}";return new Function(cN)()}if(0===BN){cN="function "+lN+"(a,d) {this.data = a;this.offset = d};var proto="+lN+".prototype;proto.dtype='"+NN+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+lN+"_copy() {return new "+lN+"(this.data,this.offset)};proto.pick=function "+lN+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+lN+"_get(){return "+(qN?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+lN+"_set(v){return "+(qN?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+lN+"(a,b,c,d){return new "+lN+"(a,d)}";return new Function("TrivialArray",cN)(TN[NN][0])}cN=["'use strict'"];var eN=kB(BN),HN=eN.map((function(NN){return"i"+NN})),RN="this.offset+"+eN.map((function(NN){return"this.stride["+NN+"]*i"+NN})).join("+"),sN=eN.map((function(NN){return"b"+NN})).join(","),VN=eN.map((function(NN){return"c"+NN})).join(",");cN.push("function "+lN+"(a,"+sN+","+VN+",d){this.data=a","this.shape=["+sN+"]","this.stride=["+VN+"]","this.offset=d|0}","var proto="+lN+".prototype","proto.dtype='"+NN+"'","proto.dimension="+BN),cN.push("Object.defineProperty(proto,'size',{get:function "+lN+"_size(){return "+eN.map((function(NN){return"this.shape["+NN+"]"})).join("*"),"}})"),1===BN?cN.push("proto.order=[0]"):(cN.push("Object.defineProperty(proto,'order',{get:"),BN<4?(cN.push("function "+lN+"_order(){"),2===BN?cN.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===BN&&cN.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):cN.push("ORDER})")),cN.push("proto.set=function "+lN+"_set("+HN.join(",")+",v){"),qN?cN.push("return this.data.set("+RN+",v)}"):cN.push("return this.data["+RN+"]=v}"),cN.push("proto.get=function "+lN+"_get("+HN.join(",")+"){"),qN?cN.push("return this.data.get("+RN+")}"):cN.push("return this.data["+RN+"]}"),cN.push("proto.index=function "+lN+"_index(",HN.join(),"){return "+RN+"}"),cN.push("proto.hi=function "+lN+"_hi("+HN.join(",")+"){return new "+lN+"(this.data,"+eN.map((function(NN){return["(typeof i",NN,"!=='number'||i",NN,"<0)?this.shape[",NN,"]:i",NN,"|0"].join("")})).join(",")+","+eN.map((function(NN){return"this.stride["+NN+"]"})).join(",")+",this.offset)}");var fN=eN.map((function(NN){return"a"+NN+"=this.shape["+NN+"]"})),ZN=eN.map((function(NN){return"c"+NN+"=this.stride["+NN+"]"}));cN.push("proto.lo=function "+lN+"_lo("+HN.join(",")+"){var b=this.offset,d=0,"+fN.join(",")+","+ZN.join(","));for(var PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'&&i"+PN+">=0){d=i"+PN+"|0;b+=c"+PN+"*d;a"+PN+"-=d}");cN.push("return new "+lN+"(this.data,"+eN.map((function(NN){return"a"+NN})).join(",")+","+eN.map((function(NN){return"c"+NN})).join(",")+",b)}"),cN.push("proto.step=function "+lN+"_step("+HN.join(",")+"){var "+eN.map((function(NN){return"a"+NN+"=this.shape["+NN+"]"})).join(",")+","+eN.map((function(NN){return"b"+NN+"=this.stride["+NN+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'){d=i"+PN+"|0;if(d<0){c+=b"+PN+"*(a"+PN+"-1);a"+PN+"=ceil(-a"+PN+"/d)}else{a"+PN+"=ceil(a"+PN+"/d)}b"+PN+"*=d}");cN.push("return new "+lN+"(this.data,"+eN.map((function(NN){return"a"+NN})).join(",")+","+eN.map((function(NN){return"b"+NN})).join(",")+",c)}");var CN=new Array(BN),FN=new Array(BN);for(PN=0;PN<BN;++PN)CN[PN]="a[i"+PN+"]",FN[PN]="b[i"+PN+"]";cN.push("proto.transpose=function "+lN+"_transpose("+HN+"){"+HN.map((function(NN,BN){return NN+"=("+NN+"===undefined?"+BN+":"+NN+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+lN+"(this.data,"+CN.join(",")+","+FN.join(",")+",this.offset)}"),cN.push("proto.pick=function "+lN+"_pick("+HN+"){var a=[],b=[],c=this.offset");for(PN=0;PN<BN;++PN)cN.push("if(typeof i"+PN+"==='number'&&i"+PN+">=0){c=(c+this.stride["+PN+"]*i"+PN+")|0}else{a.push(this.shape["+PN+"]);b.push(this.stride["+PN+"])}");return cN.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),cN.push("return function construct_"+lN+"(data,shape,stride,offset){return new "+lN+"(data,"+eN.map((function(NN){return"shape["+NN+"]"})).join(",")+","+eN.map((function(NN){return"stride["+NN+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",cN.join("\n"))(TN[NN],vN)}var TN={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};NN.exports=function(NN,BN,lN,kB){if(void 0===NN)return(0,TN.array[0])([]);"number"===typeof NN&&(NN=[NN]),void 0===BN&&(BN=[NN.length]);var eN=BN.length;if(void 0===lN){lN=new Array(eN);for(var vN=eN-1,RN=1;vN>=0;--vN)lN[vN]=RN,RN*=BN[vN]}if(void 0===kB){kB=0;for(vN=0;vN<eN;++vN)lN[vN]<0&&(kB-=(BN[vN]-1)*lN[vN])}for(var sN=function(NN){if(qN(NN))return"buffer";if(cN)switch(Object.prototype.toString.call(NN)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(NN)?"array":"generic"}(NN),VN=TN[sN];VN.length<=eN+1;)VN.push(HN(sN,VN.length-1));return(0,VN[eN+1])(NN,BN,lN,kB)}},16527:NN=>{var BN;self,BN=()=>(()=>{"use strict";var NN={d:(BN,lN)=>{for(var kB in lN)NN.o(lN,kB)&&!NN.o(BN,kB)&&Object.defineProperty(BN,kB,{enumerable:!0,get:lN[kB]})},o:(NN,BN)=>Object.prototype.hasOwnProperty.call(NN,BN)},BN={};NN.d(BN,{default:()=>ON});var lN,kB=function(NN,BN){var lN=BN.x-NN.x,kB=BN.y-NN.y;return Math.sqrt(lN*lN+kB*kB)},qN=function(NN){return NN*(Math.PI/180)},cN=new Map,eN=function(NN){cN.has(NN)&&clearTimeout(cN.get(NN)),cN.set(NN,setTimeout(NN,100))},vN=function(NN,BN,lN){for(var kB,qN=BN.split(/[ ,]+/g),cN=0;cN<qN.length;cN+=1)kB=qN[cN],NN.addEventListener?NN.addEventListener(kB,lN,!1):NN.attachEvent&&NN.attachEvent(kB,lN)},HN=function(NN,BN,lN){for(var kB,qN=BN.split(/[ ,]+/g),cN=0;cN<qN.length;cN+=1)kB=qN[cN],NN.removeEventListener?NN.removeEventListener(kB,lN):NN.detachEvent&&NN.detachEvent(kB,lN)},TN=function(NN){return NN.preventDefault(),NN.type.match(/^touch/)?NN.changedTouches:NN},RN=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},sN=function(NN,BN){BN.top||BN.right||BN.bottom||BN.left?(NN.style.top=BN.top,NN.style.right=BN.right,NN.style.bottom=BN.bottom,NN.style.left=BN.left):(NN.style.left=BN.x+"px",NN.style.top=BN.y+"px")},VN=function(NN,BN,lN){var kB=fN(NN);for(var qN in kB)if(kB.hasOwnProperty(qN))if("string"==typeof BN)kB[qN]=BN+" "+lN;else{for(var cN="",eN=0,vN=BN.length;eN<vN;eN+=1)cN+=BN[eN]+" "+lN+", ";kB[qN]=cN.slice(0,-2)}return kB},fN=function(NN){var BN={};return BN[NN]="",["webkit","Moz","o"].forEach((function(lN){BN[lN+NN.charAt(0).toUpperCase()+NN.slice(1)]=""})),BN},ZN=function(NN,BN){for(var lN in BN)BN.hasOwnProperty(lN)&&(NN[lN]=BN[lN]);return NN},PN=function(NN,BN){if(NN.length)for(var lN=0,kB=NN.length;lN<kB;lN+=1)BN(NN[lN]);else BN(NN)},CN="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,FN=window.matchMedia("(any-hover: none)").matches,IN=!!("ontouchstart"in window),AN=!!window.PointerEvent,MN=!!window.MSPointerEvent,GN={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},XN={start:"mousedown",move:"mousemove",end:"mouseup"},uN={};function dN(){}CN&&!FN?lN=GN:AN?lN={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:MN?lN={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:IN?(lN=GN,uN=XN):lN=XN,dN.prototype.on=function(NN,BN){var lN,kB=this,qN=NN.split(/[ ,]+/g);kB._handlers_=kB._handlers_||{};for(var cN=0;cN<qN.length;cN+=1)lN=qN[cN],kB._handlers_[lN]=kB._handlers_[lN]||[],kB._handlers_[lN].push(BN);return kB},dN.prototype.off=function(NN,BN){var lN=this;return lN._handlers_=lN._handlers_||{},void 0===NN?lN._handlers_={}:void 0===BN?lN._handlers_[NN]=null:lN._handlers_[NN]&&lN._handlers_[NN].indexOf(BN)>=0&&lN._handlers_[NN].splice(lN._handlers_[NN].indexOf(BN),1),lN},dN.prototype.trigger=function(NN,BN){var lN,kB=this,qN=NN.split(/[ ,]+/g);kB._handlers_=kB._handlers_||{};for(var cN=0;cN<qN.length;cN+=1)lN=qN[cN],kB._handlers_[lN]&&kB._handlers_[lN].length&&kB._handlers_[lN].forEach((function(NN){NN.call(kB,{type:lN,target:kB},BN)}))},dN.prototype.config=function(NN){var BN=this;BN.options=BN.defaults||{},NN&&(BN.options=function(NN,BN){var lN={};for(var kB in NN)NN.hasOwnProperty(kB)&&BN.hasOwnProperty(kB)?lN[kB]=BN[kB]:NN.hasOwnProperty(kB)&&(lN[kB]=NN[kB]);return lN}(BN.options,NN))},dN.prototype.bindEvt=function(NN,BN){var kB=this;return kB._domHandlers_=kB._domHandlers_||{},kB._domHandlers_[BN]=function(){"function"==typeof kB["on"+BN]?kB["on"+BN].apply(kB,arguments):console.warn('[WARNING] : Missing "on'+BN+'" handler.')},vN(NN,lN[BN],kB._domHandlers_[BN]),uN[BN]&&vN(NN,uN[BN],kB._domHandlers_[BN]),kB},dN.prototype.unbindEvt=function(NN,BN){var kB=this;return kB._domHandlers_=kB._domHandlers_||{},HN(NN,lN[BN],kB._domHandlers_[BN]),uN[BN]&&HN(NN,uN[BN],kB._domHandlers_[BN]),delete kB._domHandlers_[BN],this};const EN=dN;function KN(NN,BN){return this.identifier=BN.identifier,this.position=BN.position,this.frontPosition=BN.frontPosition,this.collection=NN,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(BN),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=KN.id,KN.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}KN.prototype=new EN,KN.constructor=KN,KN.id=0,KN.prototype.buildEl=function(NN){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},KN.prototype.stylize=function(){if(this.options.dataOnly)return this;var NN=this.options.fadeTime+"ms",BN=function(){var NN=fN("borderRadius");for(var BN in NN)NN.hasOwnProperty(BN)&&(NN[BN]="50%");return NN}(),lN=VN("transition","opacity",NN),kB={};return kB.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},kB.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},kB.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},ZN(kB.el,lN),"circle"===this.options.shape&&ZN(kB.back,BN),ZN(kB.front,BN),this.applyStyles(kB),this},KN.prototype.applyStyles=function(NN){for(var BN in this.ui)if(this.ui.hasOwnProperty(BN))for(var lN in NN[BN])this.ui[BN].style[lN]=NN[BN][lN];return this},KN.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},KN.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},KN.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},KN.prototype.show=function(NN){var BN=this;return BN.options.dataOnly||(clearTimeout(BN.removeTimeout),clearTimeout(BN.showTimeout),clearTimeout(BN.restTimeout),BN.addToDom(),BN.restCallback(),setTimeout((function(){BN.ui.el.style.opacity=1}),0),BN.showTimeout=setTimeout((function(){BN.trigger("shown",BN.instance),"function"==typeof NN&&NN.call(this)}),BN.options.fadeTime)),BN},KN.prototype.hide=function(NN){var BN=this;if(BN.options.dataOnly)return BN;if(BN.ui.el.style.opacity=BN.options.restOpacity,clearTimeout(BN.removeTimeout),clearTimeout(BN.showTimeout),clearTimeout(BN.restTimeout),BN.removeTimeout=setTimeout((function(){var lN="dynamic"===BN.options.mode?"none":"block";BN.ui.el.style.display=lN,"function"==typeof NN&&NN.call(BN),BN.trigger("hidden",BN.instance)}),BN.options.fadeTime),BN.options.restJoystick){var lN=BN.options.restJoystick,kB={};kB.x=!0===lN||!1!==lN.x?0:BN.instance.frontPosition.x,kB.y=!0===lN||!1!==lN.y?0:BN.instance.frontPosition.y,BN.setPosition(NN,kB)}return BN},KN.prototype.setPosition=function(NN,BN){var lN=this;lN.frontPosition={x:BN.x,y:BN.y};var kB=lN.options.fadeTime+"ms",qN={};qN.front=VN("transition",["transform"],kB);var cN={front:{}};cN.front={transform:"translate("+lN.frontPosition.x+"px,"+lN.frontPosition.y+"px)"},lN.applyStyles(qN),lN.applyStyles(cN),lN.restTimeout=setTimeout((function(){"function"==typeof NN&&NN.call(lN),lN.restCallback()}),lN.options.fadeTime)},KN.prototype.restCallback=function(){var NN=this,BN={};BN.front=VN("transition","none",""),NN.applyStyles(BN),NN.trigger("rested",NN.instance)},KN.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},KN.prototype.computeDirection=function(NN){var BN,lN,kB,qN=NN.angle.radian,cN=Math.PI/4,eN=Math.PI/2;if(qN>cN&&qN<3*cN&&!NN.lockX?BN="up":qN>-cN&&qN<=cN&&!NN.lockY?BN="left":qN>3*-cN&&qN<=-cN&&!NN.lockX?BN="down":NN.lockY||(BN="right"),NN.lockY||(lN=qN>-eN&&qN<eN?"left":"right"),NN.lockX||(kB=qN>0?"up":"down"),NN.force>this.options.threshold){var vN,HN={};for(vN in this.direction)this.direction.hasOwnProperty(vN)&&(HN[vN]=this.direction[vN]);var TN={};for(vN in this.direction={x:lN,y:kB,angle:BN},NN.direction=this.direction,HN)HN[vN]===this.direction[vN]&&(TN[vN]=!0);if(TN.x&&TN.y&&TN.angle)return NN;TN.x&&TN.y||this.trigger("plain",NN),TN.x||this.trigger("plain:"+lN,NN),TN.y||this.trigger("plain:"+kB,NN),TN.angle||this.trigger("dir dir:"+BN,NN)}else this.resetDirection();return NN};const gN=KN;function nN(NN,BN){var lN=this;lN.nipples=[],lN.idles=[],lN.actives=[],lN.ids=[],lN.pressureIntervals={},lN.manager=NN,lN.id=nN.id,nN.id+=1,lN.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},lN.config(BN),"static"!==lN.options.mode&&"semi"!==lN.options.mode||(lN.options.multitouch=!1),lN.options.multitouch||(lN.options.maxNumberOfNipples=1);var kB=getComputedStyle(lN.options.zone.parentElement);return kB&&"flex"===kB.display&&(lN.parentIsFlex=!0),lN.updateBox(),lN.prepareNipples(),lN.wZ(),lN.begin(),lN.nipples}nN.prototype=new EN,nN.constructor=nN,nN.id=0,nN.prototype.prepareNipples=function(){var NN=this,BN=NN.nipples;BN.on=NN.on.bind(NN),BN.off=NN.off.bind(NN),BN.options=NN.options,BN.destroy=NN.destroy.bind(NN),BN.ids=NN.ids,BN.id=NN.id,BN.processOnMove=NN.processOnMove.bind(NN),BN.processOnEnd=NN.processOnEnd.bind(NN),BN.get=function(NN){if(void 0===NN)return BN[0];for(var lN=0,kB=BN.length;lN<kB;lN+=1)if(BN[lN].identifier===NN)return BN[lN];return!1}},nN.prototype.wZ=function(){var NN=this;NN.bindEvt(NN.options.zone,"start"),NN.options.zone.style.touchAction="none",NN.options.zone.style.msTouchAction="none"},nN.prototype.begin=function(){var NN=this,BN=NN.options;if("static"===BN.mode){var lN=NN.createNipple(BN.position,NN.manager.getIdentifier());lN.add(),NN.idles.push(lN)}},nN.prototype.createNipple=function(NN,BN){var lN=this,kB=lN.manager.scroll,qN={},cN=lN.options,eN=lN.parentIsFlex?kB.x:kB.x+lN.box.left,vN=lN.parentIsFlex?kB.y:kB.y+lN.box.top;if(NN.x&&NN.y)qN={x:NN.x-eN,y:NN.y-vN};else if(NN.top||NN.right||NN.bottom||NN.left){var HN=document.createElement("DIV");HN.style.display="hidden",HN.style.top=NN.top,HN.style.right=NN.right,HN.style.bottom=NN.bottom,HN.style.left=NN.left,HN.style.position="absolute",cN.zone.appendChild(HN);var TN=HN.getBoundingClientRect();cN.zone.removeChild(HN),qN=NN,NN={x:TN.left+kB.x,y:TN.top+kB.y}}var RN=new gN(lN,{color:cN.color,size:cN.size,threshold:cN.threshold,fadeTime:cN.fadeTime,dataOnly:cN.dataOnly,restJoystick:cN.restJoystick,restOpacity:cN.restOpacity,mode:cN.mode,identifier:BN,position:NN,zone:cN.zone,frontPosition:{x:0,y:0},shape:cN.shape});return cN.dataOnly||(sN(RN.ui.el,qN),sN(RN.ui.front,RN.frontPosition)),lN.nipples.push(RN),lN.trigger("added "+RN.identifier+":added",RN),lN.manager.trigger("added "+RN.identifier+":added",RN),lN.bindNipple(RN),RN},nN.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},nN.prototype.bindNipple=function(NN){var BN,lN=this,kB=function(NN,kB){BN=NN.type+" "+kB.id+":"+NN.type,lN.trigger(BN,kB)};NN.on("destroyed",lN.onDestroyed.bind(lN)),NN.on("shown hidden rested dir plain",kB),NN.on("dir:up dir:right dir:down dir:left",kB),NN.on("plain:up plain:right plain:down plain:left",kB)},nN.prototype.pressureFn=function(NN,BN,lN){var kB=this,qN=0;clearInterval(kB.pressureIntervals[lN]),kB.pressureIntervals[lN]=setInterval(function(){var lN=NN.force||NN.pressure||NN.webkitForce||0;lN!==qN&&(BN.trigger("pressure",lN),kB.trigger("pressure "+BN.identifier+":pressure",lN),qN=lN)}.bind(kB),100)},nN.prototype.onstart=function(NN){var BN=this,lN=BN.options,kB=NN;return NN=TN(NN),BN.updateBox(),PN(NN,(function(qN){BN.actives.length<lN.maxNumberOfNipples?BN.processOnStart(qN):kB.type.match(/^touch/)&&(Object.keys(BN.manager.ids).forEach((function(lN){if(Object.values(kB.touches).findIndex((function(NN){return NN.identifier===lN}))<0){var qN=[NN[0]];qN.identifier=lN,BN.processOnEnd(qN)}})),BN.actives.length<lN.maxNumberOfNipples&&BN.processOnStart(qN))})),BN.manager.bindDocument(),!1},nN.prototype.processOnStart=function(NN){var BN,lN=this,qN=lN.options,cN=lN.manager.getIdentifier(NN),eN=NN.force||NN.pressure||NN.webkitForce||0,vN={x:NN.pageX,y:NN.pageY},HN=lN.getOrCreate(cN,vN);HN.identifier!==cN&&lN.manager.removeIdentifier(HN.identifier),HN.identifier=cN;var TN=function(BN){BN.trigger("start",BN),lN.trigger("start "+BN.id+":start",BN),BN.show(),eN>0&&lN.pressureFn(NN,BN,BN.identifier),lN.processOnMove(NN)};if((BN=lN.idles.indexOf(HN))>=0&&lN.idles.splice(BN,1),lN.actives.push(HN),lN.ids.push(HN.identifier),"semi"!==qN.mode)TN(HN);else{if(!(kB(vN,HN.position)<=qN.catchDistance))return HN.destroy(),void lN.processOnStart(NN);TN(HN)}return HN},nN.prototype.getOrCreate=function(NN,BN){var lN,kB=this,qN=kB.options;return/(semi|static)/.test(qN.mode)?(lN=kB.idles[0])?(kB.idles.splice(0,1),lN):"semi"===qN.mode?kB.createNipple(BN,NN):(console.warn("Coudln't find the needed nipple."),!1):lN=kB.createNipple(BN,NN)},nN.prototype.processOnMove=function(NN){var BN=this,lN=BN.options,cN=BN.manager.getIdentifier(NN),eN=BN.nipples.get(cN),vN=BN.manager.scroll;if(function(NN){return isNaN(NN.buttons)?0!==NN.pressure:0!==NN.buttons}(NN)){if(!eN)return console.error("Found zombie joystick with ID "+cN),void BN.manager.removeIdentifier(cN);if(lN.dynamicPage){var HN=eN.el.getBoundingClientRect();eN.position={x:vN.x+HN.left,y:vN.y+HN.top}}eN.identifier=cN;var TN=eN.options.size/2,RN={x:NN.pageX,y:NN.pageY};lN.lockX&&(RN.y=eN.position.y),lN.lockY&&(RN.x=eN.position.x);var sN,VN,fN,ZN,PN,CN,FN,IN,AN,MN,GN=kB(RN,eN.position),XN=(sN=RN,fN=(VN=eN.position).x-sN.x,ZN=VN.y-sN.y,function(NN){return NN*(180/Math.PI)}(Math.atan2(ZN,fN))),uN=qN(XN),dN=GN/TN,EN={distance:GN,position:RN};if("circle"===eN.options.shape?(PN=Math.min(GN,TN),FN=eN.position,IN=PN,MN={x:0,y:0},AN=qN(AN=XN),MN.x=FN.x-IN*Math.cos(AN),MN.y=FN.y-IN*Math.sin(AN),CN=MN):(CN=function(NN,BN,lN){return{x:Math.min(Math.max(NN.x,BN.x-lN),BN.x+lN),y:Math.min(Math.max(NN.y,BN.y-lN),BN.y+lN)}}(RN,eN.position,TN),PN=kB(CN,eN.position)),lN.follow){if(GN>TN){var KN=RN.x-CN.x,gN=RN.y-CN.y;eN.position.x+=KN,eN.position.y+=gN,eN.el.style.top=eN.position.y-(BN.box.top+vN.y)+"px",eN.el.style.left=eN.position.x-(BN.box.left+vN.x)+"px",GN=kB(RN,eN.position)}}else RN=CN,GN=PN;var nN=RN.x-eN.position.x,rN=RN.y-eN.position.y;eN.frontPosition={x:nN,y:rN},lN.dataOnly||(eN.ui.front.style.transform="translate("+nN+"px,"+rN+"px)");var pN={identifier:eN.identifier,position:RN,force:dN,pressure:NN.force||NN.pressure||NN.webkitForce||0,distance:GN,angle:{radian:uN,degree:XN},vector:{x:nN/TN,y:-rN/TN},raw:EN,instance:eN,lockX:lN.lockX,lockY:lN.lockY};(pN=eN.computeDirection(pN)).angle={radian:qN(180-XN),degree:180-XN},eN.trigger("move",pN),BN.trigger("move "+eN.id+":move",pN)}else this.processOnEnd(NN)},nN.prototype.processOnEnd=function(NN){var BN=this,lN=BN.options,kB=BN.manager.getIdentifier(NN),qN=BN.nipples.get(kB),cN=BN.manager.removeIdentifier(qN.identifier);qN&&(lN.dataOnly||qN.hide((function(){"dynamic"===lN.mode&&(qN.trigger("removed",qN),BN.trigger("removed "+qN.id+":removed",qN),BN.manager.trigger("removed "+qN.id+":removed",qN),qN.destroy())})),clearInterval(BN.pressureIntervals[qN.identifier]),qN.resetDirection(),qN.trigger("end",qN),BN.trigger("end "+qN.id+":end",qN),BN.ids.indexOf(qN.identifier)>=0&&BN.ids.splice(BN.ids.indexOf(qN.identifier),1),BN.actives.indexOf(qN)>=0&&BN.actives.splice(BN.actives.indexOf(qN),1),/(semi|static)/.test(lN.mode)?BN.idles.push(qN):BN.nipples.indexOf(qN)>=0&&BN.nipples.splice(BN.nipples.indexOf(qN),1),BN.manager.unbindDocument(),/(semi|static)/.test(lN.mode)&&(BN.manager.ids[cN.id]=cN.identifier))},nN.prototype.onDestroyed=function(NN,BN){var lN=this;lN.nipples.indexOf(BN)>=0&&lN.nipples.splice(lN.nipples.indexOf(BN),1),lN.actives.indexOf(BN)>=0&&lN.actives.splice(lN.actives.indexOf(BN),1),lN.idles.indexOf(BN)>=0&&lN.idles.splice(lN.idles.indexOf(BN),1),lN.ids.indexOf(BN.identifier)>=0&&lN.ids.splice(lN.ids.indexOf(BN.identifier),1),lN.manager.removeIdentifier(BN.identifier),lN.manager.unbindDocument()},nN.prototype.destroy=function(){var NN=this;for(var BN in NN.unbindEvt(NN.options.zone,"start"),NN.nipples.forEach((function(NN){NN.destroy()})),NN.pressureIntervals)NN.pressureIntervals.hasOwnProperty(BN)&&clearInterval(NN.pressureIntervals[BN]);NN.trigger("destroyed",NN.nipples),NN.manager.unbindDocument(),NN.off()};const rN=nN;function pN(NN){var BN=this;BN.ids={},BN.index=0,BN.collections=[],BN.scroll=RN(),BN.config(NN),BN.prepareCollections();var lN=function(){var NN;BN.collections.forEach((function(lN){lN.forEach((function(lN){NN=lN.el.getBoundingClientRect(),lN.position={x:BN.scroll.x+NN.left,y:BN.scroll.y+NN.top}}))}))};vN(window,"resize",(function(){eN(lN)}));var kB=function(){BN.scroll=RN()};return vN(window,"scroll",(function(){eN(kB)})),BN.collections}pN.prototype=new EN,pN.constructor=pN,pN.prototype.prepareCollections=function(){var NN=this;NN.collections.create=NN.create.bind(NN),NN.collections.on=NN.on.bind(NN),NN.collections.off=NN.off.bind(NN),NN.collections.destroy=NN.destroy.bind(NN),NN.collections.get=function(BN){var lN;return NN.collections.every((function(NN){return!(lN=NN.get(BN))})),lN}},pN.prototype.create=function(NN){return this.createCollection(NN)},pN.prototype.createCollection=function(NN){var BN=this,lN=new rN(BN,NN);return BN.bindCollection(lN),BN.collections.push(lN),lN},pN.prototype.bindCollection=function(NN){var BN,lN=this,kB=function(NN,kB){BN=NN.type+" "+kB.id+":"+NN.type,lN.trigger(BN,kB)};NN.on("destroyed",lN.onDestroyed.bind(lN)),NN.on("shown hidden rested dir plain",kB),NN.on("dir:up dir:right dir:down dir:left",kB),NN.on("plain:up plain:right plain:down plain:left",kB)},pN.prototype.bindDocument=function(){var NN=this;NN.binded||(NN.bindEvt(document,"move").bindEvt(document,"end"),NN.binded=!0)},pN.prototype.unbindDocument=function(NN){var BN=this;Object.keys(BN.ids).length&&!0!==NN||(BN.unbindEvt(document,"move").unbindEvt(document,"end"),BN.binded=!1)},pN.prototype.getIdentifier=function(NN){var BN;return NN?void 0===(BN=void 0===NN.identifier?NN.pointerId:NN.identifier)&&(BN=this.latest||0):BN=this.index,void 0===this.ids[BN]&&(this.ids[BN]=this.index,this.index+=1),this.latest=BN,this.ids[BN]},pN.prototype.removeIdentifier=function(NN){var BN={};for(var lN in this.ids)if(this.ids[lN]===NN){BN.id=lN,BN.identifier=this.ids[lN],delete this.ids[lN];break}return BN},pN.prototype.onmove=function(NN){return this.onAny("move",NN),!1},pN.prototype.onend=function(NN){return this.onAny("end",NN),!1},pN.prototype.oncancel=function(NN){return this.onAny("end",NN),!1},pN.prototype.onAny=function(NN,BN){var lN,kB=this,qN="processOn"+NN.charAt(0).toUpperCase()+NN.slice(1);BN=TN(BN);var cN=function(NN,BN,lN){lN.ids.indexOf(BN)>=0&&(lN[qN](NN),NN._found_=!0)};return PN(BN,(function(NN){lN=kB.getIdentifier(NN),PN(kB.collections,cN.bind(null,NN,lN)),NN._found_||kB.removeIdentifier(lN)})),!1},pN.prototype.destroy=function(){var NN=this;NN.unbindDocument(!0),NN.ids={},NN.index=0,NN.collections.forEach((function(NN){NN.destroy()})),NN.off()},pN.prototype.onDestroyed=function(NN,BN){var lN=this;if(lN.collections.indexOf(BN)<0)return!1;lN.collections.splice(lN.collections.indexOf(BN),1)};var xN=new pN;const ON={create:function(NN){return xN.create(NN)},factory:xN};return BN.default})(),NN.exports=BN()},16581:(NN,BN,lN)=>{"use strict";const{Deflate:kB,deflate:qN,deflateRaw:cN,gzip:eN}=lN(16586),{Inflate:vN,inflate:HN,inflateRaw:TN,ungzip:RN}=lN(16644),sN=lN(16621);NN.exports.Deflate=kB,NN.exports.deflate=qN,NN.exports.deflateRaw=cN,NN.exports.gzip=eN,NN.exports.Inflate=vN,NN.exports.inflate=HN,NN.exports.inflateRaw=TN,NN.exports.ungzip=RN,NN.exports.constants=sN},16586:(NN,BN,lN)=>{"use strict";const kB=lN(16593),qN=lN(16628),cN=lN(16632),eN=lN(16614),vN=lN(16639),HN=Object.prototype.toString,{Z_NO_FLUSH:TN,Z_SYNC_FLUSH:RN,Z_FULL_FLUSH:sN,Z_FINISH:VN,Z_OK:fN,Z_STREAM_END:ZN,Z_DEFAULT_COMPRESSION:PN,Z_DEFAULT_STRATEGY:CN,Z_DEFLATED:FN}=lN(16621);function IN(NN){this.options=qN.assign({level:PN,method:FN,JN:16384,windowBits:15,memLevel:8,strategy:CN},NN||{});let BN=this.options;BN.raw&&BN.windowBits>0?BN.windowBits=-BN.windowBits:BN.gzip&&BN.windowBits>0&&BN.windowBits<16&&(BN.windowBits+=16),this.err=0,this.vB="",this.ended=!1,this.chunks=[],this.strm=new vN,this.strm.avail_out=0;let lN=kB.deflateInit2(this.strm,BN.level,BN.method,BN.windowBits,BN.memLevel,BN.strategy);if(lN!==fN)throw new Error(eN[lN]);if(BN.header&&kB.deflateSetHeader(this.strm,BN.header),BN.dictionary){let NN;if(NN="string"===typeof BN.dictionary?cN.string2buf(BN.dictionary):"[object ArrayBuffer]"===HN.call(BN.dictionary)?new Uint8Array(BN.dictionary):BN.dictionary,lN=kB.deflateSetDictionary(this.strm,NN),lN!==fN)throw new Error(eN[lN]);this._dict_set=!0}}function AN(NN,BN){const lN=new IN(BN);if(lN.push(NN,!0),lN.err)throw lN.vB||eN[lN.err];return lN.result}IN.prototype.push=function(NN,BN){const lN=this.strm,qN=this.options.JN;let eN,vN;if(this.ended)return!1;for(vN=BN===~~BN?BN:!0===BN?VN:TN,"string"===typeof NN?lN.input=cN.string2buf(NN):"[object ArrayBuffer]"===HN.call(NN)?lN.input=new Uint8Array(NN):lN.input=NN,lN.next_in=0,lN.avail_in=lN.input.length;;)if(0===lN.avail_out&&(lN.output=new Uint8Array(qN),lN.next_out=0,lN.avail_out=qN),(vN===RN||vN===sN)&&lN.avail_out<=6)this.onData(lN.output.subarray(0,lN.next_out)),lN.avail_out=0;else{if(eN=kB.deflate(lN,vN),eN===ZN)return lN.next_out>0&&this.onData(lN.output.subarray(0,lN.next_out)),eN=kB.deflateEnd(this.strm),this.onEnd(eN),this.ended=!0,eN===fN;if(0!==lN.avail_out){if(vN>0&&lN.next_out>0)this.onData(lN.output.subarray(0,lN.next_out)),lN.avail_out=0;else if(0===lN.avail_in)break}else this.onData(lN.output)}return!0},IN.prototype.onData=function(NN){this.chunks.push(NN)},IN.prototype.onEnd=function(NN){NN===fN&&(this.result=qN.flattenChunks(this.chunks)),this.chunks=[],this.err=NN,this.vB=this.strm.vB},NN.exports.Deflate=IN,NN.exports.deflate=AN,NN.exports.deflateRaw=function(NN,BN){return(BN=BN||{}).raw=!0,AN(NN,BN)},NN.exports.gzip=function(NN,BN){return(BN=BN||{}).gzip=!0,AN(NN,BN)},NN.exports.constants=lN(16621)},16644:(NN,BN,lN)=>{"use strict";const kB=lN(16653),qN=lN(16628),cN=lN(16632),eN=lN(16614),vN=lN(16639),HN=lN(16673),TN=Object.prototype.toString,{Z_NO_FLUSH:RN,Z_FINISH:sN,Z_OK:VN,Z_STREAM_END:fN,Z_NEED_DICT:ZN,Z_STREAM_ERROR:PN,Z_DATA_ERROR:CN,Z_MEM_ERROR:FN}=lN(16621);function IN(NN){this.options=qN.assign({JN:65536,windowBits:15,to:""},NN||{});const BN=this.options;BN.raw&&BN.windowBits>=0&&BN.windowBits<16&&(BN.windowBits=-BN.windowBits,0===BN.windowBits&&(BN.windowBits=-15)),!(BN.windowBits>=0&&BN.windowBits<16)||NN&&NN.windowBits||(BN.windowBits+=32),BN.windowBits>15&&BN.windowBits<48&&0===(15&BN.windowBits)&&(BN.windowBits|=15),this.err=0,this.vB="",this.ended=!1,this.chunks=[],this.strm=new vN,this.strm.avail_out=0;let lN=kB.inflateInit2(this.strm,BN.windowBits);if(lN!==VN)throw new Error(eN[lN]);if(this.header=new HN,kB.inflateGetHeader(this.strm,this.header),BN.dictionary&&("string"===typeof BN.dictionary?BN.dictionary=cN.string2buf(BN.dictionary):"[object ArrayBuffer]"===TN.call(BN.dictionary)&&(BN.dictionary=new Uint8Array(BN.dictionary)),BN.raw&&(lN=kB.inflateSetDictionary(this.strm,BN.dictionary),lN!==VN)))throw new Error(eN[lN])}function AN(NN,BN){const lN=new IN(BN);if(lN.push(NN),lN.err)throw lN.vB||eN[lN.err];return lN.result}IN.prototype.push=function(NN,BN){const lN=this.strm,qN=this.options.JN,eN=this.options.dictionary;let vN,HN,IN;if(this.ended)return!1;for(HN=BN===~~BN?BN:!0===BN?sN:RN,"[object ArrayBuffer]"===TN.call(NN)?lN.input=new Uint8Array(NN):lN.input=NN,lN.next_in=0,lN.avail_in=lN.input.length;;){for(0===lN.avail_out&&(lN.output=new Uint8Array(qN),lN.next_out=0,lN.avail_out=qN),vN=kB.inflate(lN,HN),vN===ZN&&eN&&(vN=kB.inflateSetDictionary(lN,eN),vN===VN?vN=kB.inflate(lN,HN):vN===CN&&(vN=ZN));lN.avail_in>0&&vN===fN&&lN.state.wrap>0&&0!==NN[lN.next_in];)kB.inflateReset(lN),vN=kB.inflate(lN,HN);switch(vN){case PN:case CN:case ZN:case FN:return this.onEnd(vN),this.ended=!0,!1}if(IN=lN.avail_out,lN.next_out&&(0===lN.avail_out||vN===fN))if("string"===this.options.to){let NN=cN.utf8border(lN.output,lN.next_out),BN=lN.next_out-NN,kB=cN.buf2string(lN.output,NN);lN.next_out=BN,lN.avail_out=qN-BN,BN&&lN.output.set(lN.output.subarray(NN,NN+BN),0),this.onData(kB)}else this.onData(lN.output.length===lN.next_out?lN.output:lN.output.subarray(0,lN.next_out));if(vN!==VN||0!==IN){if(vN===fN)return vN=kB.inflateEnd(this.strm),this.onEnd(vN),this.ended=!0,!0;if(0===lN.avail_in)break}}return!0},IN.prototype.onData=function(NN){this.chunks.push(NN)},IN.prototype.onEnd=function(NN){NN===VN&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=qN.flattenChunks(this.chunks)),this.chunks=[],this.err=NN,this.vB=this.strm.vB},NN.exports.Inflate=IN,NN.exports.inflate=AN,NN.exports.inflateRaw=function(NN,BN){return(BN=BN||{}).raw=!0,AN(NN,BN)},NN.exports.ungzip=AN,NN.exports.constants=lN(16621)},16628:NN=>{"use strict";const BN=(NN,BN)=>Object.prototype.hasOwnProperty.call(NN,BN);NN.exports.assign=function(NN){const lN=Array.prototype.slice.call(arguments,1);for(;lN.length;){const kB=lN.shift();if(kB){if("object"!==typeof kB)throw new TypeError(kB+"must be non-object");for(const lN in kB)BN(kB,lN)&&(NN[lN]=kB[lN])}}return NN},NN.exports.flattenChunks=NN=>{let BN=0;for(let kB=0,qN=NN.length;kB<qN;kB++)BN+=NN[kB].length;const lN=new Uint8Array(BN);for(let kB=0,qN=0,cN=NN.length;kB<cN;kB++){let BN=NN[kB];lN.set(BN,qN),qN+=BN.length}return lN}},16632:NN=>{"use strict";let BN=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(kB){BN=!1}const lN=new Uint8Array(256);for(let qN=0;qN<256;qN++)lN[qN]=qN>=252?6:qN>=248?5:qN>=240?4:qN>=224?3:qN>=192?2:1;lN[254]=lN[254]=1,NN.exports.string2buf=NN=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(NN);let BN,lN,kB,qN,cN,eN=NN.length,vN=0;for(qN=0;qN<eN;qN++)lN=NN.charCodeAt(qN),55296===(64512&lN)&&qN+1<eN&&(kB=NN.charCodeAt(qN+1),56320===(64512&kB)&&(lN=65536+(lN-55296<<10)+(kB-56320),qN++)),vN+=lN<128?1:lN<2048?2:lN<65536?3:4;for(BN=new Uint8Array(vN),cN=0,qN=0;cN<vN;qN++)lN=NN.charCodeAt(qN),55296===(64512&lN)&&qN+1<eN&&(kB=NN.charCodeAt(qN+1),56320===(64512&kB)&&(lN=65536+(lN-55296<<10)+(kB-56320),qN++)),lN<128?BN[cN++]=lN:lN<2048?(BN[cN++]=192|lN>>>6,BN[cN++]=128|63&lN):lN<65536?(BN[cN++]=224|lN>>>12,BN[cN++]=128|lN>>>6&63,BN[cN++]=128|63&lN):(BN[cN++]=240|lN>>>18,BN[cN++]=128|lN>>>12&63,BN[cN++]=128|lN>>>6&63,BN[cN++]=128|63&lN);return BN};NN.exports.buf2string=(NN,kB)=>{const qN=kB||NN.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(NN.subarray(0,kB));let cN,eN;const vN=new Array(2*qN);for(eN=0,cN=0;cN<qN;){let BN=NN[cN++];if(BN<128){vN[eN++]=BN;continue}let kB=lN[BN];if(kB>4)vN[eN++]=65533,cN+=kB-1;else{for(BN&=2===kB?31:3===kB?15:7;kB>1&&cN<qN;)BN=BN<<6|63&NN[cN++],kB--;kB>1?vN[eN++]=65533:BN<65536?vN[eN++]=BN:(BN-=65536,vN[eN++]=55296|BN>>10&1023,vN[eN++]=56320|1023&BN)}}return((NN,lN)=>{if(lN<65534&&NN.subarray&&BN)return String.fromCharCode.apply(null,NN.length===lN?NN:NN.subarray(0,lN));let kB="";for(let BN=0;BN<lN;BN++)kB+=String.fromCharCode(NN[BN]);return kB})(vN,eN)},NN.exports.utf8border=(NN,BN)=>{(BN=BN||NN.length)>NN.length&&(BN=NN.length);let kB=BN-1;for(;kB>=0&&128===(192&NN[kB]);)kB--;return kB<0||0===kB?BN:kB+lN[NN[kB]]>BN?kB:BN}},16600:NN=>{"use strict";NN.exports=(NN,BN,lN,kB)=>{let qN=65535&NN,cN=NN>>>16&65535,eN=0;for(;0!==lN;){eN=lN>2e3?2e3:lN,lN-=eN;do{qN=qN+BN[kB++]|0,cN=cN+qN|0}while(--eN);qN%=65521,cN%=65521}return qN|cN<<16}},16621:NN=>{"use strict";NN.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},16608:NN=>{"use strict";const BN=new Uint32Array((()=>{let NN,BN=[];for(var lN=0;lN<256;lN++){NN=lN;for(var kB=0;kB<8;kB++)NN=1&NN?3988292384^NN>>>1:NN>>>1;BN[lN]=NN}return BN})());NN.exports=(NN,lN,kB,qN)=>{const cN=BN,eN=qN+kB;NN^=-1;for(let BN=qN;BN<eN;BN++)NN=NN>>>8^cN[255&(NN^lN[BN])];return~NN}},16593:(NN,BN,lN)=>{"use strict";const{_tr_init:kB,_tr_stored_block:qN,_tr_flush_block:cN,_tr_tally:eN,_tr_align:vN}=lN(16595),HN=lN(16600),TN=lN(16608),RN=lN(16614),{Z_NO_FLUSH:sN,Z_PARTIAL_FLUSH:VN,Z_FULL_FLUSH:fN,Z_FINISH:ZN,Z_BLOCK:PN,Z_OK:CN,Z_STREAM_END:FN,Z_STREAM_ERROR:IN,Z_DATA_ERROR:AN,Z_BUF_ERROR:MN,Z_DEFAULT_COMPRESSION:GN,Z_FILTERED:XN,Z_HUFFMAN_ONLY:uN,Z_RLE:dN,Z_FIXED:EN,Z_DEFAULT_STRATEGY:KN,Z_UNKNOWN:gN,Z_DEFLATED:nN}=lN(16621),rN=258,pN=262,xN=103,ON=113,wN=666,bN=(NN,BN)=>(NN.vB=RN[BN],BN),mB=NN=>(NN<<1)-(NN>4?9:0),aN=NN=>{let BN=NN.length;for(;--BN>=0;)NN[BN]=0};let DN=(NN,BN,lN)=>(BN<<NN.hash_shift^lN)&NN.hash_mask;const yN=NN=>{const BN=NN.state;let lN=BN.pending;lN>NN.avail_out&&(lN=NN.avail_out),0!==lN&&(NN.output.set(BN.pending_buf.subarray(BN.pending_out,BN.pending_out+lN),NN.next_out),NN.next_out+=lN,BN.pending_out+=lN,NN.total_out+=lN,NN.avail_out-=lN,BN.pending-=lN,0===BN.pending&&(BN.pending_out=0))},LN=(NN,BN)=>{cN(NN,NN.block_start>=0?NN.block_start:-1,NN.strstart-NN.block_start,BN),NN.block_start=NN.strstart,yN(NN.strm)},hN=(NN,BN)=>{NN.pending_buf[NN.pending++]=BN},UN=(NN,BN)=>{NN.pending_buf[NN.pending++]=BN>>>8&255,NN.pending_buf[NN.pending++]=255&BN},WN=(NN,BN,lN,kB)=>{let qN=NN.avail_in;return qN>kB&&(qN=kB),0===qN?0:(NN.avail_in-=qN,BN.set(NN.input.subarray(NN.next_in,NN.next_in+qN),lN),1===NN.state.wrap?NN.adler=HN(NN.adler,BN,qN,lN):2===NN.state.wrap&&(NN.adler=TN(NN.adler,BN,qN,lN)),NN.next_in+=qN,NN.total_in+=qN,qN)},QN=(NN,BN)=>{let lN,kB,qN=NN.max_chain_length,cN=NN.strstart,eN=NN.prev_length,vN=NN.nice_match;const HN=NN.strstart>NN.w_size-pN?NN.strstart-(NN.w_size-pN):0,TN=NN.window,RN=NN.w_mask,sN=NN.prev,VN=NN.strstart+rN;let fN=TN[cN+eN-1],ZN=TN[cN+eN];NN.prev_length>=NN.good_match&&(qN>>=2),vN>NN.lookahead&&(vN=NN.lookahead);do{if(lN=BN,TN[lN+eN]===ZN&&TN[lN+eN-1]===fN&&TN[lN]===TN[cN]&&TN[++lN]===TN[cN+1]){cN+=2,lN++;do{}while(TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&TN[++cN]===TN[++lN]&&cN<VN);if(kB=rN-(VN-cN),cN=VN-rN,kB>eN){if(NN.match_start=BN,eN=kB,kB>=vN)break;fN=TN[cN+eN-1],ZN=TN[cN+eN]}}}while((BN=sN[BN&RN])>HN&&0!==--qN);return eN<=NN.lookahead?eN:NN.lookahead},SN=NN=>{const BN=NN.w_size;let lN,kB,qN,cN,eN;do{if(cN=NN.window_size-NN.lookahead-NN.strstart,NN.strstart>=BN+(BN-pN)){NN.window.set(NN.window.subarray(BN,BN+BN),0),NN.match_start-=BN,NN.strstart-=BN,NN.block_start-=BN,kB=NN.hash_size,lN=kB;do{qN=NN.head[--lN],NN.head[lN]=qN>=BN?qN-BN:0}while(--kB);kB=BN,lN=kB;do{qN=NN.prev[--lN],NN.prev[lN]=qN>=BN?qN-BN:0}while(--kB);cN+=BN}if(0===NN.strm.avail_in)break;if(kB=WN(NN.strm,NN.window,NN.strstart+NN.lookahead,cN),NN.lookahead+=kB,NN.lookahead+NN.insert>=3)for(eN=NN.strstart-NN.insert,NN.ins_h=NN.window[eN],NN.ins_h=DN(NN,NN.ins_h,NN.window[eN+1]);NN.insert&&(NN.ins_h=DN(NN,NN.ins_h,NN.window[eN+3-1]),NN.prev[eN&NN.w_mask]=NN.head[NN.ins_h],NN.head[NN.ins_h]=eN,eN++,NN.insert--,!(NN.lookahead+NN.insert<3)););}while(NN.lookahead<pN&&0!==NN.strm.avail_in)},iB=(NN,BN)=>{let lN,kB;for(;;){if(NN.lookahead<pN){if(SN(NN),NN.lookahead<pN&&BN===sN)return 1;if(0===NN.lookahead)break}if(lN=0,NN.lookahead>=3&&(NN.ins_h=DN(NN,NN.ins_h,NN.window[NN.strstart+3-1]),lN=NN.prev[NN.strstart&NN.w_mask]=NN.head[NN.ins_h],NN.head[NN.ins_h]=NN.strstart),0!==lN&&NN.strstart-lN<=NN.w_size-pN&&(NN.match_length=QN(NN,lN)),NN.match_length>=3)if(kB=eN(NN,NN.strstart-NN.match_start,NN.match_length-3),NN.lookahead-=NN.match_length,NN.match_length<=NN.max_lazy_match&&NN.lookahead>=3){NN.match_length--;do{NN.strstart++,NN.ins_h=DN(NN,NN.ins_h,NN.window[NN.strstart+3-1]),lN=NN.prev[NN.strstart&NN.w_mask]=NN.head[NN.ins_h],NN.head[NN.ins_h]=NN.strstart}while(0!==--NN.match_length);NN.strstart++}else NN.strstart+=NN.match_length,NN.match_length=0,NN.ins_h=NN.window[NN.strstart],NN.ins_h=DN(NN,NN.ins_h,NN.window[NN.strstart+1]);else kB=eN(NN,0,NN.window[NN.strstart]),NN.lookahead--,NN.strstart++;if(kB&&(LN(NN,!1),0===NN.strm.avail_out))return 1}return NN.insert=NN.strstart<2?NN.strstart:2,BN===ZN?(LN(NN,!0),0===NN.strm.avail_out?3:4):NN.last_lit&&(LN(NN,!1),0===NN.strm.avail_out)?1:2},tN=(NN,BN)=>{let lN,kB,qN;for(;;){if(NN.lookahead<pN){if(SN(NN),NN.lookahead<pN&&BN===sN)return 1;if(0===NN.lookahead)break}if(lN=0,NN.lookahead>=3&&(NN.ins_h=DN(NN,NN.ins_h,NN.window[NN.strstart+3-1]),lN=NN.prev[NN.strstart&NN.w_mask]=NN.head[NN.ins_h],NN.head[NN.ins_h]=NN.strstart),NN.prev_length=NN.match_length,NN.prev_match=NN.match_start,NN.match_length=2,0!==lN&&NN.prev_length<NN.max_lazy_match&&NN.strstart-lN<=NN.w_size-pN&&(NN.match_length=QN(NN,lN),NN.match_length<=5&&(NN.strategy===XN||3===NN.match_length&&NN.strstart-NN.match_start>4096)&&(NN.match_length=2)),NN.prev_length>=3&&NN.match_length<=NN.prev_length){qN=NN.strstart+NN.lookahead-3,kB=eN(NN,NN.strstart-1-NN.prev_match,NN.prev_length-3),NN.lookahead-=NN.prev_length-1,NN.prev_length-=2;do{++NN.strstart<=qN&&(NN.ins_h=DN(NN,NN.ins_h,NN.window[NN.strstart+3-1]),lN=NN.prev[NN.strstart&NN.w_mask]=NN.head[NN.ins_h],NN.head[NN.ins_h]=NN.strstart)}while(0!==--NN.prev_length);if(NN.match_available=0,NN.match_length=2,NN.strstart++,kB&&(LN(NN,!1),0===NN.strm.avail_out))return 1}else if(NN.match_available){if(kB=eN(NN,0,NN.window[NN.strstart-1]),kB&&LN(NN,!1),NN.strstart++,NN.lookahead--,0===NN.strm.avail_out)return 1}else NN.match_available=1,NN.strstart++,NN.lookahead--}return NN.match_available&&(kB=eN(NN,0,NN.window[NN.strstart-1]),NN.match_available=0),NN.insert=NN.strstart<2?NN.strstart:2,BN===ZN?(LN(NN,!0),0===NN.strm.avail_out?3:4):NN.last_lit&&(LN(NN,!1),0===NN.strm.avail_out)?1:2};function oN(NN,BN,lN,kB,qN){this.good_length=NN,this.max_lazy=BN,this.nice_length=lN,this.max_chain=kB,this.func=qN}const JN=[new oN(0,0,0,0,((NN,BN)=>{let lN=65535;for(lN>NN.pending_buf_size-5&&(lN=NN.pending_buf_size-5);;){if(NN.lookahead<=1){if(SN(NN),0===NN.lookahead&&BN===sN)return 1;if(0===NN.lookahead)break}NN.strstart+=NN.lookahead,NN.lookahead=0;const kB=NN.block_start+lN;if((0===NN.strstart||NN.strstart>=kB)&&(NN.lookahead=NN.strstart-kB,NN.strstart=kB,LN(NN,!1),0===NN.strm.avail_out))return 1;if(NN.strstart-NN.block_start>=NN.w_size-pN&&(LN(NN,!1),0===NN.strm.avail_out))return 1}return NN.insert=0,BN===ZN?(LN(NN,!0),0===NN.strm.avail_out?3:4):(NN.strstart>NN.block_start&&(LN(NN,!1),NN.strm.avail_out),1)})),new oN(4,4,8,4,iB),new oN(4,5,16,8,iB),new oN(4,6,32,32,iB),new oN(4,4,16,16,tN),new oN(8,16,32,32,tN),new oN(8,16,128,128,tN),new oN(8,32,128,256,tN),new oN(32,128,258,1024,tN),new oN(32,258,258,4096,tN)];function YN(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=nN,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),aN(this.dyn_ltree),aN(this.dyn_dtree),aN(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),aN(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),aN(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const jB=NN=>{if(!NN||!NN.state)return bN(NN,IN);NN.total_in=NN.total_out=0,NN.data_type=gN;const BN=NN.state;return BN.pending=0,BN.pending_out=0,BN.wrap<0&&(BN.wrap=-BN.wrap),BN.status=BN.wrap?42:ON,NN.adler=2===BN.wrap?0:1,BN.last_flush=sN,kB(BN),CN},zN=NN=>{const BN=jB(NN);var lN;return BN===CN&&((lN=NN.state).window_size=2*lN.w_size,aN(lN.head),lN.max_lazy_match=JN[lN.level].max_lazy,lN.good_match=JN[lN.level].good_length,lN.nice_match=JN[lN.level].nice_length,lN.max_chain_length=JN[lN.level].max_chain,lN.strstart=0,lN.block_start=0,lN.lookahead=0,lN.insert=0,lN.match_length=lN.prev_length=2,lN.match_available=0,lN.ins_h=0),BN},NB=(NN,BN,lN,kB,qN,cN)=>{if(!NN)return IN;let eN=1;if(BN===GN&&(BN=6),kB<0?(eN=0,kB=-kB):kB>15&&(eN=2,kB-=16),qN<1||qN>9||lN!==nN||kB<8||kB>15||BN<0||BN>9||cN<0||cN>EN)return bN(NN,IN);8===kB&&(kB=9);const vN=new YN;return NN.state=vN,vN.strm=NN,vN.wrap=eN,vN.gzhead=null,vN.w_bits=kB,vN.w_size=1<<vN.w_bits,vN.w_mask=vN.w_size-1,vN.hash_bits=qN+7,vN.hash_size=1<<vN.hash_bits,vN.hash_mask=vN.hash_size-1,vN.hash_shift=~~((vN.hash_bits+3-1)/3),vN.window=new Uint8Array(2*vN.w_size),vN.head=new Uint16Array(vN.hash_size),vN.prev=new Uint16Array(vN.w_size),vN.lit_bufsize=1<<qN+6,vN.pending_buf_size=4*vN.lit_bufsize,vN.pending_buf=new Uint8Array(vN.pending_buf_size),vN.d_buf=1*vN.lit_bufsize,vN.l_buf=3*vN.lit_bufsize,vN.level=BN,vN.strategy=cN,vN.method=lN,zN(NN)};NN.exports.deflateInit=(NN,BN)=>NB(NN,BN,nN,15,8,KN),NN.exports.deflateInit2=NB,NN.exports.deflateReset=zN,NN.exports.deflateResetKeep=jB,NN.exports.deflateSetHeader=(NN,BN)=>NN&&NN.state?2!==NN.state.wrap?IN:(NN.state.gzhead=BN,CN):IN,NN.exports.deflate=(NN,BN)=>{let lN,kB;if(!NN||!NN.state||BN>PN||BN<0)return NN?bN(NN,IN):IN;const cN=NN.state;if(!NN.output||!NN.input&&0!==NN.avail_in||cN.status===wN&&BN!==ZN)return bN(NN,0===NN.avail_out?MN:IN);cN.strm=NN;const HN=cN.last_flush;if(cN.last_flush=BN,42===cN.status)if(2===cN.wrap)NN.adler=0,hN(cN,31),hN(cN,139),hN(cN,8),cN.gzhead?(hN(cN,(cN.gzhead.text?1:0)+(cN.gzhead.hcrc?2:0)+(cN.gzhead.extra?4:0)+(cN.gzhead.name?8:0)+(cN.gzhead.comment?16:0)),hN(cN,255&cN.gzhead.time),hN(cN,cN.gzhead.time>>8&255),hN(cN,cN.gzhead.time>>16&255),hN(cN,cN.gzhead.time>>24&255),hN(cN,9===cN.level?2:cN.strategy>=uN||cN.level<2?4:0),hN(cN,255&cN.gzhead.os),cN.gzhead.extra&&cN.gzhead.extra.length&&(hN(cN,255&cN.gzhead.extra.length),hN(cN,cN.gzhead.extra.length>>8&255)),cN.gzhead.hcrc&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending,0)),cN.gzindex=0,cN.status=69):(hN(cN,0),hN(cN,0),hN(cN,0),hN(cN,0),hN(cN,0),hN(cN,9===cN.level?2:cN.strategy>=uN||cN.level<2?4:0),hN(cN,3),cN.status=ON);else{let BN=nN+(cN.w_bits-8<<4)<<8,lN=-1;lN=cN.strategy>=uN||cN.level<2?0:cN.level<6?1:6===cN.level?2:3,BN|=lN<<6,0!==cN.strstart&&(BN|=32),BN+=31-BN%31,cN.status=ON,UN(cN,BN),0!==cN.strstart&&(UN(cN,NN.adler>>>16),UN(cN,65535&NN.adler)),NN.adler=1}if(69===cN.status)if(cN.gzhead.extra){for(lN=cN.pending;cN.gzindex<(65535&cN.gzhead.extra.length)&&(cN.pending!==cN.pending_buf_size||(cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),yN(NN),lN=cN.pending,cN.pending!==cN.pending_buf_size));)hN(cN,255&cN.gzhead.extra[cN.gzindex]),cN.gzindex++;cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),cN.gzindex===cN.gzhead.extra.length&&(cN.gzindex=0,cN.status=73)}else cN.status=73;if(73===cN.status)if(cN.gzhead.name){lN=cN.pending;do{if(cN.pending===cN.pending_buf_size&&(cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),yN(NN),lN=cN.pending,cN.pending===cN.pending_buf_size)){kB=1;break}kB=cN.gzindex<cN.gzhead.name.length?255&cN.gzhead.name.charCodeAt(cN.gzindex++):0,hN(cN,kB)}while(0!==kB);cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),0===kB&&(cN.gzindex=0,cN.status=91)}else cN.status=91;if(91===cN.status)if(cN.gzhead.comment){lN=cN.pending;do{if(cN.pending===cN.pending_buf_size&&(cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),yN(NN),lN=cN.pending,cN.pending===cN.pending_buf_size)){kB=1;break}kB=cN.gzindex<cN.gzhead.comment.length?255&cN.gzhead.comment.charCodeAt(cN.gzindex++):0,hN(cN,kB)}while(0!==kB);cN.gzhead.hcrc&&cN.pending>lN&&(NN.adler=TN(NN.adler,cN.pending_buf,cN.pending-lN,lN)),0===kB&&(cN.status=xN)}else cN.status=xN;if(cN.status===xN&&(cN.gzhead.hcrc?(cN.pending+2>cN.pending_buf_size&&yN(NN),cN.pending+2<=cN.pending_buf_size&&(hN(cN,255&NN.adler),hN(cN,NN.adler>>8&255),NN.adler=0,cN.status=ON)):cN.status=ON),0!==cN.pending){if(yN(NN),0===NN.avail_out)return cN.last_flush=-1,CN}else if(0===NN.avail_in&&mB(BN)<=mB(HN)&&BN!==ZN)return bN(NN,MN);if(cN.status===wN&&0!==NN.avail_in)return bN(NN,MN);if(0!==NN.avail_in||0!==cN.lookahead||BN!==sN&&cN.status!==wN){let lN=cN.strategy===uN?((NN,BN)=>{let lN;for(;;){if(0===NN.lookahead&&(SN(NN),0===NN.lookahead)){if(BN===sN)return 1;break}if(NN.match_length=0,lN=eN(NN,0,NN.window[NN.strstart]),NN.lookahead--,NN.strstart++,lN&&(LN(NN,!1),0===NN.strm.avail_out))return 1}return NN.insert=0,BN===ZN?(LN(NN,!0),0===NN.strm.avail_out?3:4):NN.last_lit&&(LN(NN,!1),0===NN.strm.avail_out)?1:2})(cN,BN):cN.strategy===dN?((NN,BN)=>{let lN,kB,qN,cN;const vN=NN.window;for(;;){if(NN.lookahead<=rN){if(SN(NN),NN.lookahead<=rN&&BN===sN)return 1;if(0===NN.lookahead)break}if(NN.match_length=0,NN.lookahead>=3&&NN.strstart>0&&(qN=NN.strstart-1,kB=vN[qN],kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN])){cN=NN.strstart+rN;do{}while(kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&kB===vN[++qN]&&qN<cN);NN.match_length=rN-(cN-qN),NN.match_length>NN.lookahead&&(NN.match_length=NN.lookahead)}if(NN.match_length>=3?(lN=eN(NN,1,NN.match_length-3),NN.lookahead-=NN.match_length,NN.strstart+=NN.match_length,NN.match_length=0):(lN=eN(NN,0,NN.window[NN.strstart]),NN.lookahead--,NN.strstart++),lN&&(LN(NN,!1),0===NN.strm.avail_out))return 1}return NN.insert=0,BN===ZN?(LN(NN,!0),0===NN.strm.avail_out?3:4):NN.last_lit&&(LN(NN,!1),0===NN.strm.avail_out)?1:2})(cN,BN):JN[cN.level].func(cN,BN);if(3!==lN&&4!==lN||(cN.status=wN),1===lN||3===lN)return 0===NN.avail_out&&(cN.last_flush=-1),CN;if(2===lN&&(BN===VN?vN(cN):BN!==PN&&(qN(cN,0,0,!1),BN===fN&&(aN(cN.head),0===cN.lookahead&&(cN.strstart=0,cN.block_start=0,cN.insert=0))),yN(NN),0===NN.avail_out))return cN.last_flush=-1,CN}return BN!==ZN?CN:cN.wrap<=0?FN:(2===cN.wrap?(hN(cN,255&NN.adler),hN(cN,NN.adler>>8&255),hN(cN,NN.adler>>16&255),hN(cN,NN.adler>>24&255),hN(cN,255&NN.total_in),hN(cN,NN.total_in>>8&255),hN(cN,NN.total_in>>16&255),hN(cN,NN.total_in>>24&255)):(UN(cN,NN.adler>>>16),UN(cN,65535&NN.adler)),yN(NN),cN.wrap>0&&(cN.wrap=-cN.wrap),0!==cN.pending?CN:FN)},NN.exports.deflateEnd=NN=>{if(!NN||!NN.state)return IN;const BN=NN.state.status;return 42!==BN&&69!==BN&&73!==BN&&91!==BN&&BN!==xN&&BN!==ON&&BN!==wN?bN(NN,IN):(NN.state=null,BN===ON?bN(NN,AN):CN)},NN.exports.deflateSetDictionary=(NN,BN)=>{let lN=BN.length;if(!NN||!NN.state)return IN;const kB=NN.state,qN=kB.wrap;if(2===qN||1===qN&&42!==kB.status||kB.lookahead)return IN;if(1===qN&&(NN.adler=HN(NN.adler,BN,lN,0)),kB.wrap=0,lN>=kB.w_size){0===qN&&(aN(kB.head),kB.strstart=0,kB.block_start=0,kB.insert=0);let NN=new Uint8Array(kB.w_size);NN.set(BN.subarray(lN-kB.w_size,lN),0),BN=NN,lN=kB.w_size}const cN=NN.avail_in,eN=NN.next_in,vN=NN.input;for(NN.avail_in=lN,NN.next_in=0,NN.input=BN,SN(kB);kB.lookahead>=3;){let NN=kB.strstart,BN=kB.lookahead-2;do{kB.ins_h=DN(kB,kB.ins_h,kB.window[NN+3-1]),kB.prev[NN&kB.w_mask]=kB.head[kB.ins_h],kB.head[kB.ins_h]=NN,NN++}while(--BN);kB.strstart=NN,kB.lookahead=2,SN(kB)}return kB.strstart+=kB.lookahead,kB.block_start=kB.strstart,kB.insert=kB.lookahead,kB.lookahead=0,kB.match_length=kB.prev_length=2,kB.match_available=0,NN.next_in=eN,NN.input=vN,NN.avail_in=cN,kB.wrap=qN,CN},NN.exports.deflateInfo="pako deflate (from Nodeca project)"},16673:NN=>{"use strict";NN.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},16661:NN=>{"use strict";NN.exports=function(NN,BN){let lN,kB,qN,cN,eN,vN,HN,TN,RN,sN,VN,fN,ZN,PN,CN,FN,IN,AN,MN,GN,XN,uN,dN,EN;const KN=NN.state;lN=NN.next_in,dN=NN.input,kB=lN+(NN.avail_in-5),qN=NN.next_out,EN=NN.output,cN=qN-(BN-NN.avail_out),eN=qN+(NN.avail_out-257),vN=KN.dmax,HN=KN.wsize,TN=KN.whave,RN=KN.wnext,sN=KN.window,VN=KN.hold,fN=KN.bits,ZN=KN.lencode,PN=KN.distcode,CN=(1<<KN.lenbits)-1,FN=(1<<KN.distbits)-1;NN:do{fN<15&&(VN+=dN[lN++]<<fN,fN+=8,VN+=dN[lN++]<<fN,fN+=8),IN=ZN[VN&CN];BN:for(;;){if(AN=IN>>>24,VN>>>=AN,fN-=AN,AN=IN>>>16&255,0===AN)EN[qN++]=65535&IN;else{if(!(16&AN)){if(0===(64&AN)){IN=ZN[(65535&IN)+(VN&(1<<AN)-1)];continue BN}if(32&AN){KN.mode=12;break NN}NN.vB="invalid literal/length code",KN.mode=30;break NN}MN=65535&IN,AN&=15,AN&&(fN<AN&&(VN+=dN[lN++]<<fN,fN+=8),MN+=VN&(1<<AN)-1,VN>>>=AN,fN-=AN),fN<15&&(VN+=dN[lN++]<<fN,fN+=8,VN+=dN[lN++]<<fN,fN+=8),IN=PN[VN&FN];lN:for(;;){if(AN=IN>>>24,VN>>>=AN,fN-=AN,AN=IN>>>16&255,!(16&AN)){if(0===(64&AN)){IN=PN[(65535&IN)+(VN&(1<<AN)-1)];continue lN}NN.vB="invalid distance code",KN.mode=30;break NN}if(GN=65535&IN,AN&=15,fN<AN&&(VN+=dN[lN++]<<fN,fN+=8,fN<AN&&(VN+=dN[lN++]<<fN,fN+=8)),GN+=VN&(1<<AN)-1,GN>vN){NN.vB="invalid distance too far back",KN.mode=30;break NN}if(VN>>>=AN,fN-=AN,AN=qN-cN,GN>AN){if(AN=GN-AN,AN>TN&&KN.sane){NN.vB="invalid distance too far back",KN.mode=30;break NN}if(XN=0,uN=sN,0===RN){if(XN+=HN-AN,AN<MN){MN-=AN;do{EN[qN++]=sN[XN++]}while(--AN);XN=qN-GN,uN=EN}}else if(RN<AN){if(XN+=HN+RN-AN,AN-=RN,AN<MN){MN-=AN;do{EN[qN++]=sN[XN++]}while(--AN);if(XN=0,RN<MN){AN=RN,MN-=AN;do{EN[qN++]=sN[XN++]}while(--AN);XN=qN-GN,uN=EN}}}else if(XN+=RN-AN,AN<MN){MN-=AN;do{EN[qN++]=sN[XN++]}while(--AN);XN=qN-GN,uN=EN}for(;MN>2;)EN[qN++]=uN[XN++],EN[qN++]=uN[XN++],EN[qN++]=uN[XN++],MN-=3;MN&&(EN[qN++]=uN[XN++],MN>1&&(EN[qN++]=uN[XN++]))}else{XN=qN-GN;do{EN[qN++]=EN[XN++],EN[qN++]=EN[XN++],EN[qN++]=EN[XN++],MN-=3}while(MN>2);MN&&(EN[qN++]=EN[XN++],MN>1&&(EN[qN++]=EN[XN++]))}break}}break}}while(lN<kB&&qN<eN);MN=fN>>3,lN-=MN,fN-=MN<<3,VN&=(1<<fN)-1,NN.next_in=lN,NN.next_out=qN,NN.avail_in=lN<kB?kB-lN+5:5-(lN-kB),NN.avail_out=qN<eN?eN-qN+257:257-(qN-eN),KN.hold=VN,KN.bits=fN}},16653:(NN,BN,lN)=>{"use strict";const kB=lN(16600),qN=lN(16608),cN=lN(16661),eN=lN(16664),{Z_FINISH:vN,Z_BLOCK:HN,Z_TREES:TN,Z_OK:RN,Z_STREAM_END:sN,Z_NEED_DICT:VN,Z_STREAM_ERROR:fN,Z_DATA_ERROR:ZN,Z_MEM_ERROR:PN,Z_BUF_ERROR:CN,Z_DEFLATED:FN}=lN(16621),IN=12,AN=30,MN=NN=>(NN>>>24&255)+(NN>>>8&65280)+((65280&NN)<<8)+((255&NN)<<24);function GN(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const XN=NN=>{if(!NN||!NN.state)return fN;const BN=NN.state;return NN.total_in=NN.total_out=BN.total=0,NN.vB="",BN.wrap&&(NN.adler=1&BN.wrap),BN.mode=1,BN.last=0,BN.havedict=0,BN.dmax=32768,BN.head=null,BN.hold=0,BN.bits=0,BN.lencode=BN.lendyn=new Int32Array(852),BN.distcode=BN.distdyn=new Int32Array(592),BN.sane=1,BN.back=-1,RN},uN=NN=>{if(!NN||!NN.state)return fN;const BN=NN.state;return BN.wsize=0,BN.whave=0,BN.wnext=0,XN(NN)},dN=(NN,BN)=>{let lN;if(!NN||!NN.state)return fN;const kB=NN.state;return BN<0?(lN=0,BN=-BN):(lN=1+(BN>>4),BN<48&&(BN&=15)),BN&&(BN<8||BN>15)?fN:(null!==kB.window&&kB.wbits!==BN&&(kB.window=null),kB.wrap=lN,kB.wbits=BN,uN(NN))},EN=(NN,BN)=>{if(!NN)return fN;const lN=new GN;NN.state=lN,lN.window=null;const kB=dN(NN,BN);return kB!==RN&&(NN.state=null),kB};let KN,gN,nN=!0;const rN=NN=>{if(nN){KN=new Int32Array(512),gN=new Int32Array(32);let BN=0;for(;BN<144;)NN.lens[BN++]=8;for(;BN<256;)NN.lens[BN++]=9;for(;BN<280;)NN.lens[BN++]=7;for(;BN<288;)NN.lens[BN++]=8;for(eN(1,NN.lens,0,288,KN,0,NN.work,{bits:9}),BN=0;BN<32;)NN.lens[BN++]=5;eN(2,NN.lens,0,32,gN,0,NN.work,{bits:5}),nN=!1}NN.lencode=KN,NN.lenbits=9,NN.distcode=gN,NN.distbits=5},pN=(NN,BN,lN,kB)=>{let qN;const cN=NN.state;return null===cN.window&&(cN.wsize=1<<cN.wbits,cN.wnext=0,cN.whave=0,cN.window=new Uint8Array(cN.wsize)),kB>=cN.wsize?(cN.window.set(BN.subarray(lN-cN.wsize,lN),0),cN.wnext=0,cN.whave=cN.wsize):(qN=cN.wsize-cN.wnext,qN>kB&&(qN=kB),cN.window.set(BN.subarray(lN-kB,lN-kB+qN),cN.wnext),(kB-=qN)?(cN.window.set(BN.subarray(lN-kB,lN),0),cN.wnext=kB,cN.whave=cN.wsize):(cN.wnext+=qN,cN.wnext===cN.wsize&&(cN.wnext=0),cN.whave<cN.wsize&&(cN.whave+=qN))),0};NN.exports.inflateReset=uN,NN.exports.inflateReset2=dN,NN.exports.inflateResetKeep=XN,NN.exports.inflateInit=NN=>EN(NN,15),NN.exports.inflateInit2=EN,NN.exports.inflate=(NN,BN)=>{let lN,GN,XN,uN,dN,EN,KN,gN,nN,xN,ON,wN,bN,mB,aN,DN,yN,LN,hN,UN,WN,QN,SN=0;const iB=new Uint8Array(4);let tN,oN;const JN=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!NN||!NN.state||!NN.output||!NN.input&&0!==NN.avail_in)return fN;lN=NN.state,lN.mode===IN&&(lN.mode=13),dN=NN.next_out,XN=NN.output,KN=NN.avail_out,uN=NN.next_in,GN=NN.input,EN=NN.avail_in,gN=lN.hold,nN=lN.bits,xN=EN,ON=KN,QN=RN;NN:for(;;)switch(lN.mode){case 1:if(0===lN.wrap){lN.mode=13;break}for(;nN<16;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(2&lN.wrap&&35615===gN){lN.check=0,iB[0]=255&gN,iB[1]=gN>>>8&255,lN.check=qN(lN.check,iB,2,0),gN=0,nN=0,lN.mode=2;break}if(lN.flags=0,lN.head&&(lN.head.done=!1),!(1&lN.wrap)||(((255&gN)<<8)+(gN>>8))%31){NN.vB="incorrect header check",lN.mode=AN;break}if((15&gN)!==FN){NN.vB="unknown compression method",lN.mode=AN;break}if(gN>>>=4,nN-=4,WN=8+(15&gN),0===lN.wbits)lN.wbits=WN;else if(WN>lN.wbits){NN.vB="invalid window size",lN.mode=AN;break}lN.dmax=1<<lN.wbits,NN.adler=lN.check=1,lN.mode=512&gN?10:IN,gN=0,nN=0;break;case 2:for(;nN<16;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(lN.flags=gN,(255&lN.flags)!==FN){NN.vB="unknown compression method",lN.mode=AN;break}if(57344&lN.flags){NN.vB="unknown header flags set",lN.mode=AN;break}lN.head&&(lN.head.text=gN>>8&1),512&lN.flags&&(iB[0]=255&gN,iB[1]=gN>>>8&255,lN.check=qN(lN.check,iB,2,0)),gN=0,nN=0,lN.mode=3;case 3:for(;nN<32;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.head&&(lN.head.time=gN),512&lN.flags&&(iB[0]=255&gN,iB[1]=gN>>>8&255,iB[2]=gN>>>16&255,iB[3]=gN>>>24&255,lN.check=qN(lN.check,iB,4,0)),gN=0,nN=0,lN.mode=4;case 4:for(;nN<16;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.head&&(lN.head.xflags=255&gN,lN.head.os=gN>>8),512&lN.flags&&(iB[0]=255&gN,iB[1]=gN>>>8&255,lN.check=qN(lN.check,iB,2,0)),gN=0,nN=0,lN.mode=5;case 5:if(1024&lN.flags){for(;nN<16;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.length=gN,lN.head&&(lN.head.extra_len=gN),512&lN.flags&&(iB[0]=255&gN,iB[1]=gN>>>8&255,lN.check=qN(lN.check,iB,2,0)),gN=0,nN=0}else lN.head&&(lN.head.extra=null);lN.mode=6;case 6:if(1024&lN.flags&&(wN=lN.length,wN>EN&&(wN=EN),wN&&(lN.head&&(WN=lN.head.extra_len-lN.length,lN.head.extra||(lN.head.extra=new Uint8Array(lN.head.extra_len)),lN.head.extra.set(GN.subarray(uN,uN+wN),WN)),512&lN.flags&&(lN.check=qN(lN.check,GN,wN,uN)),EN-=wN,uN+=wN,lN.length-=wN),lN.length))break NN;lN.length=0,lN.mode=7;case 7:if(2048&lN.flags){if(0===EN)break NN;wN=0;do{WN=GN[uN+wN++],lN.head&&WN&&lN.length<65536&&(lN.head.name+=String.fromCharCode(WN))}while(WN&&wN<EN);if(512&lN.flags&&(lN.check=qN(lN.check,GN,wN,uN)),EN-=wN,uN+=wN,WN)break NN}else lN.head&&(lN.head.name=null);lN.length=0,lN.mode=8;case 8:if(4096&lN.flags){if(0===EN)break NN;wN=0;do{WN=GN[uN+wN++],lN.head&&WN&&lN.length<65536&&(lN.head.comment+=String.fromCharCode(WN))}while(WN&&wN<EN);if(512&lN.flags&&(lN.check=qN(lN.check,GN,wN,uN)),EN-=wN,uN+=wN,WN)break NN}else lN.head&&(lN.head.comment=null);lN.mode=9;case 9:if(512&lN.flags){for(;nN<16;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(gN!==(65535&lN.check)){NN.vB="header crc mismatch",lN.mode=AN;break}gN=0,nN=0}lN.head&&(lN.head.hcrc=lN.flags>>9&1,lN.head.done=!0),NN.adler=lN.check=0,lN.mode=IN;break;case 10:for(;nN<32;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}NN.adler=lN.check=MN(gN),gN=0,nN=0,lN.mode=11;case 11:if(0===lN.havedict)return NN.next_out=dN,NN.avail_out=KN,NN.next_in=uN,NN.avail_in=EN,lN.hold=gN,lN.bits=nN,VN;NN.adler=lN.check=1,lN.mode=IN;case IN:if(BN===HN||BN===TN)break NN;case 13:if(lN.last){gN>>>=7&nN,nN-=7&nN,lN.mode=27;break}for(;nN<3;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}switch(lN.last=1&gN,gN>>>=1,nN-=1,3&gN){case 0:lN.mode=14;break;case 1:if(rN(lN),lN.mode=20,BN===TN){gN>>>=2,nN-=2;break NN}break;case 2:lN.mode=17;break;case 3:NN.vB="invalid block type",lN.mode=AN}gN>>>=2,nN-=2;break;case 14:for(gN>>>=7&nN,nN-=7&nN;nN<32;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if((65535&gN)!==(gN>>>16^65535)){NN.vB="invalid stored block lengths",lN.mode=AN;break}if(lN.length=65535&gN,gN=0,nN=0,lN.mode=15,BN===TN)break NN;case 15:lN.mode=16;case 16:if(wN=lN.length,wN){if(wN>EN&&(wN=EN),wN>KN&&(wN=KN),0===wN)break NN;XN.set(GN.subarray(uN,uN+wN),dN),EN-=wN,uN+=wN,KN-=wN,dN+=wN,lN.length-=wN;break}lN.mode=IN;break;case 17:for(;nN<14;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(lN.nlen=257+(31&gN),gN>>>=5,nN-=5,lN.ndist=1+(31&gN),gN>>>=5,nN-=5,lN.ncode=4+(15&gN),gN>>>=4,nN-=4,lN.nlen>286||lN.ndist>30){NN.vB="too many length or distance symbols",lN.mode=AN;break}lN.have=0,lN.mode=18;case 18:for(;lN.have<lN.ncode;){for(;nN<3;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.lens[JN[lN.have++]]=7&gN,gN>>>=3,nN-=3}for(;lN.have<19;)lN.lens[JN[lN.have++]]=0;if(lN.lencode=lN.lendyn,lN.lenbits=7,tN={bits:lN.lenbits},QN=eN(0,lN.lens,0,19,lN.lencode,0,lN.work,tN),lN.lenbits=tN.bits,QN){NN.vB="invalid code lengths set",lN.mode=AN;break}lN.have=0,lN.mode=19;case 19:for(;lN.have<lN.nlen+lN.ndist;){for(;SN=lN.lencode[gN&(1<<lN.lenbits)-1],aN=SN>>>24,DN=SN>>>16&255,yN=65535&SN,!(aN<=nN);){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(yN<16)gN>>>=aN,nN-=aN,lN.lens[lN.have++]=yN;else{if(16===yN){for(oN=aN+2;nN<oN;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(gN>>>=aN,nN-=aN,0===lN.have){NN.vB="invalid bit length repeat",lN.mode=AN;break}WN=lN.lens[lN.have-1],wN=3+(3&gN),gN>>>=2,nN-=2}else if(17===yN){for(oN=aN+3;nN<oN;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}gN>>>=aN,nN-=aN,WN=0,wN=3+(7&gN),gN>>>=3,nN-=3}else{for(oN=aN+7;nN<oN;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}gN>>>=aN,nN-=aN,WN=0,wN=11+(127&gN),gN>>>=7,nN-=7}if(lN.have+wN>lN.nlen+lN.ndist){NN.vB="invalid bit length repeat",lN.mode=AN;break}for(;wN--;)lN.lens[lN.have++]=WN}}if(lN.mode===AN)break;if(0===lN.lens[256]){NN.vB="invalid code -- missing end-of-block",lN.mode=AN;break}if(lN.lenbits=9,tN={bits:lN.lenbits},QN=eN(1,lN.lens,0,lN.nlen,lN.lencode,0,lN.work,tN),lN.lenbits=tN.bits,QN){NN.vB="invalid literal/lengths set",lN.mode=AN;break}if(lN.distbits=6,lN.distcode=lN.distdyn,tN={bits:lN.distbits},QN=eN(2,lN.lens,lN.nlen,lN.ndist,lN.distcode,0,lN.work,tN),lN.distbits=tN.bits,QN){NN.vB="invalid distances set",lN.mode=AN;break}if(lN.mode=20,BN===TN)break NN;case 20:lN.mode=21;case 21:if(EN>=6&&KN>=258){NN.next_out=dN,NN.avail_out=KN,NN.next_in=uN,NN.avail_in=EN,lN.hold=gN,lN.bits=nN,cN(NN,ON),dN=NN.next_out,XN=NN.output,KN=NN.avail_out,uN=NN.next_in,GN=NN.input,EN=NN.avail_in,gN=lN.hold,nN=lN.bits,lN.mode===IN&&(lN.back=-1);break}for(lN.back=0;SN=lN.lencode[gN&(1<<lN.lenbits)-1],aN=SN>>>24,DN=SN>>>16&255,yN=65535&SN,!(aN<=nN);){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(DN&&0===(240&DN)){for(LN=aN,hN=DN,UN=yN;SN=lN.lencode[UN+((gN&(1<<LN+hN)-1)>>LN)],aN=SN>>>24,DN=SN>>>16&255,yN=65535&SN,!(LN+aN<=nN);){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}gN>>>=LN,nN-=LN,lN.back+=LN}if(gN>>>=aN,nN-=aN,lN.back+=aN,lN.length=yN,0===DN){lN.mode=26;break}if(32&DN){lN.back=-1,lN.mode=IN;break}if(64&DN){NN.vB="invalid literal/length code",lN.mode=AN;break}lN.extra=15&DN,lN.mode=22;case 22:if(lN.extra){for(oN=lN.extra;nN<oN;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.length+=gN&(1<<lN.extra)-1,gN>>>=lN.extra,nN-=lN.extra,lN.back+=lN.extra}lN.was=lN.length,lN.mode=23;case 23:for(;SN=lN.distcode[gN&(1<<lN.distbits)-1],aN=SN>>>24,DN=SN>>>16&255,yN=65535&SN,!(aN<=nN);){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(0===(240&DN)){for(LN=aN,hN=DN,UN=yN;SN=lN.distcode[UN+((gN&(1<<LN+hN)-1)>>LN)],aN=SN>>>24,DN=SN>>>16&255,yN=65535&SN,!(LN+aN<=nN);){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}gN>>>=LN,nN-=LN,lN.back+=LN}if(gN>>>=aN,nN-=aN,lN.back+=aN,64&DN){NN.vB="invalid distance code",lN.mode=AN;break}lN.offset=yN,lN.extra=15&DN,lN.mode=24;case 24:if(lN.extra){for(oN=lN.extra;nN<oN;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}lN.offset+=gN&(1<<lN.extra)-1,gN>>>=lN.extra,nN-=lN.extra,lN.back+=lN.extra}if(lN.offset>lN.dmax){NN.vB="invalid distance too far back",lN.mode=AN;break}lN.mode=25;case 25:if(0===KN)break NN;if(wN=ON-KN,lN.offset>wN){if(wN=lN.offset-wN,wN>lN.whave&&lN.sane){NN.vB="invalid distance too far back",lN.mode=AN;break}wN>lN.wnext?(wN-=lN.wnext,bN=lN.wsize-wN):bN=lN.wnext-wN,wN>lN.length&&(wN=lN.length),mB=lN.window}else mB=XN,bN=dN-lN.offset,wN=lN.length;wN>KN&&(wN=KN),KN-=wN,lN.length-=wN;do{XN[dN++]=mB[bN++]}while(--wN);0===lN.length&&(lN.mode=21);break;case 26:if(0===KN)break NN;XN[dN++]=lN.length,KN--,lN.mode=21;break;case 27:if(lN.wrap){for(;nN<32;){if(0===EN)break NN;EN--,gN|=GN[uN++]<<nN,nN+=8}if(ON-=KN,NN.total_out+=ON,lN.total+=ON,ON&&(NN.adler=lN.check=lN.flags?qN(lN.check,XN,ON,dN-ON):kB(lN.check,XN,ON,dN-ON)),ON=KN,(lN.flags?gN:MN(gN))!==lN.check){NN.vB="incorrect data check",lN.mode=AN;break}gN=0,nN=0}lN.mode=28;case 28:if(lN.wrap&&lN.flags){for(;nN<32;){if(0===EN)break NN;EN--,gN+=GN[uN++]<<nN,nN+=8}if(gN!==(4294967295&lN.total)){NN.vB="incorrect length check",lN.mode=AN;break}gN=0,nN=0}lN.mode=29;case 29:QN=sN;break NN;case AN:QN=ZN;break NN;case 31:return PN;default:return fN}return NN.next_out=dN,NN.avail_out=KN,NN.next_in=uN,NN.avail_in=EN,lN.hold=gN,lN.bits=nN,(lN.wsize||ON!==NN.avail_out&&lN.mode<AN&&(lN.mode<27||BN!==vN))&&pN(NN,NN.output,NN.next_out,ON-NN.avail_out)?(lN.mode=31,PN):(xN-=NN.avail_in,ON-=NN.avail_out,NN.total_in+=xN,NN.total_out+=ON,lN.total+=ON,lN.wrap&&ON&&(NN.adler=lN.check=lN.flags?qN(lN.check,XN,ON,NN.next_out-ON):kB(lN.check,XN,ON,NN.next_out-ON)),NN.data_type=lN.bits+(lN.last?64:0)+(lN.mode===IN?128:0)+(20===lN.mode||15===lN.mode?256:0),(0===xN&&0===ON||BN===vN)&&QN===RN&&(QN=CN),QN)},NN.exports.inflateEnd=NN=>{if(!NN||!NN.state)return fN;let BN=NN.state;return BN.window&&(BN.window=null),NN.state=null,RN},NN.exports.inflateGetHeader=(NN,BN)=>{if(!NN||!NN.state)return fN;const lN=NN.state;return 0===(2&lN.wrap)?fN:(lN.head=BN,BN.done=!1,RN)},NN.exports.inflateSetDictionary=(NN,BN)=>{const lN=BN.length;let qN,cN,eN;return NN&&NN.state?(qN=NN.state,0!==qN.wrap&&11!==qN.mode?fN:11===qN.mode&&(cN=1,cN=kB(cN,BN,lN,0),cN!==qN.check)?ZN:(eN=pN(NN,BN,lN,lN),eN?(qN.mode=31,PN):(qN.havedict=1,RN))):fN},NN.exports.inflateInfo="pako inflate (from Nodeca project)"},16664:NN=>{"use strict";const BN=15,lN=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),kB=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),qN=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cN=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);NN.exports=(NN,eN,vN,HN,TN,RN,sN,VN)=>{const fN=VN.bits;let ZN,PN,CN,FN,IN,AN,MN=0,GN=0,XN=0,uN=0,dN=0,EN=0,KN=0,gN=0,nN=0,rN=0,pN=null,xN=0;const ON=new Uint16Array(16),wN=new Uint16Array(16);let bN,mB,aN,DN=null,yN=0;for(MN=0;MN<=BN;MN++)ON[MN]=0;for(GN=0;GN<HN;GN++)ON[eN[vN+GN]]++;for(dN=fN,uN=BN;uN>=1&&0===ON[uN];uN--);if(dN>uN&&(dN=uN),0===uN)return TN[RN++]=20971520,TN[RN++]=20971520,VN.bits=1,0;for(XN=1;XN<uN&&0===ON[XN];XN++);for(dN<XN&&(dN=XN),gN=1,MN=1;MN<=BN;MN++)if(gN<<=1,gN-=ON[MN],gN<0)return-1;if(gN>0&&(0===NN||1!==uN))return-1;for(wN[1]=0,MN=1;MN<BN;MN++)wN[MN+1]=wN[MN]+ON[MN];for(GN=0;GN<HN;GN++)0!==eN[vN+GN]&&(sN[wN[eN[vN+GN]]++]=GN);if(0===NN?(pN=DN=sN,AN=19):1===NN?(pN=lN,xN-=257,DN=kB,yN-=257,AN=256):(pN=qN,DN=cN,AN=-1),rN=0,GN=0,MN=XN,IN=RN,EN=dN,KN=0,CN=-1,nN=1<<dN,FN=nN-1,1===NN&&nN>852||2===NN&&nN>592)return 1;for(;;){bN=MN-KN,sN[GN]<AN?(mB=0,aN=sN[GN]):sN[GN]>AN?(mB=DN[yN+sN[GN]],aN=pN[xN+sN[GN]]):(mB=96,aN=0),ZN=1<<MN-KN,PN=1<<EN,XN=PN;do{PN-=ZN,TN[IN+(rN>>KN)+PN]=bN<<24|mB<<16|aN}while(0!==PN);for(ZN=1<<MN-1;rN&ZN;)ZN>>=1;if(0!==ZN?(rN&=ZN-1,rN+=ZN):rN=0,GN++,0===--ON[MN]){if(MN===uN)break;MN=eN[vN+sN[GN]]}if(MN>dN&&(rN&FN)!==CN){for(0===KN&&(KN=dN),IN+=XN,EN=MN-KN,gN=1<<EN;EN+KN<uN&&(gN-=ON[EN+KN],!(gN<=0));)EN++,gN<<=1;if(nN+=1<<EN,1===NN&&nN>852||2===NN&&nN>592)return 1;CN=rN&FN,TN[CN]=dN<<24|EN<<16|IN-RN}}return 0!==rN&&(TN[IN+rN]=MN-KN<<24|64<<16),VN.bits=dN,0}},16614:NN=>{"use strict";NN.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},16595:NN=>{"use strict";function BN(NN){let BN=NN.length;for(;--BN>=0;)NN[BN]=0}const lN=256,kB=286,qN=30,cN=15,eN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vN=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),HN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),TN=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),RN=new Array(576);BN(RN);const sN=new Array(60);BN(sN);const VN=new Array(512);BN(VN);const fN=new Array(256);BN(fN);const ZN=new Array(29);BN(ZN);const PN=new Array(qN);function CN(NN,BN,lN,kB,qN){this.static_tree=NN,this.extra_bits=BN,this.extra_base=lN,this.elems=kB,this.max_length=qN,this.has_stree=NN&&NN.length}let FN,IN,AN;function MN(NN,BN){this.dyn_tree=NN,this.max_code=0,this.stat_desc=BN}BN(PN);const GN=NN=>NN<256?VN[NN]:VN[256+(NN>>>7)],XN=(NN,BN)=>{NN.pending_buf[NN.pending++]=255&BN,NN.pending_buf[NN.pending++]=BN>>>8&255},uN=(NN,BN,lN)=>{NN.bi_valid>16-lN?(NN.bi_buf|=BN<<NN.bi_valid&65535,XN(NN,NN.bi_buf),NN.bi_buf=BN>>16-NN.bi_valid,NN.bi_valid+=lN-16):(NN.bi_buf|=BN<<NN.bi_valid&65535,NN.bi_valid+=lN)},dN=(NN,BN,lN)=>{uN(NN,lN[2*BN],lN[2*BN+1])},EN=(NN,BN)=>{let lN=0;do{lN|=1&NN,NN>>>=1,lN<<=1}while(--BN>0);return lN>>>1},KN=(NN,BN,lN)=>{const kB=new Array(16);let qN,eN,vN=0;for(qN=1;qN<=cN;qN++)kB[qN]=vN=vN+lN[qN-1]<<1;for(eN=0;eN<=BN;eN++){let BN=NN[2*eN+1];0!==BN&&(NN[2*eN]=EN(kB[BN]++,BN))}},gN=NN=>{let BN;for(BN=0;BN<kB;BN++)NN.dyn_ltree[2*BN]=0;for(BN=0;BN<qN;BN++)NN.dyn_dtree[2*BN]=0;for(BN=0;BN<19;BN++)NN.bl_tree[2*BN]=0;NN.dyn_ltree[512]=1,NN.opt_len=NN.static_len=0,NN.last_lit=NN.matches=0},nN=NN=>{NN.bi_valid>8?XN(NN,NN.bi_buf):NN.bi_valid>0&&(NN.pending_buf[NN.pending++]=NN.bi_buf),NN.bi_buf=0,NN.bi_valid=0},rN=(NN,BN,lN,kB)=>{const qN=2*BN,cN=2*lN;return NN[qN]<NN[cN]||NN[qN]===NN[cN]&&kB[BN]<=kB[lN]},pN=(NN,BN,lN)=>{const kB=NN.heap[lN];let qN=lN<<1;for(;qN<=NN.heap_len&&(qN<NN.heap_len&&rN(BN,NN.heap[qN+1],NN.heap[qN],NN.depth)&&qN++,!rN(BN,kB,NN.heap[qN],NN.depth));)NN.heap[lN]=NN.heap[qN],lN=qN,qN<<=1;NN.heap[lN]=kB},xN=(NN,BN,kB)=>{let qN,cN,HN,TN,RN=0;if(0!==NN.last_lit)do{qN=NN.pending_buf[NN.d_buf+2*RN]<<8|NN.pending_buf[NN.d_buf+2*RN+1],cN=NN.pending_buf[NN.l_buf+RN],RN++,0===qN?dN(NN,cN,BN):(HN=fN[cN],dN(NN,HN+lN+1,BN),TN=eN[HN],0!==TN&&(cN-=ZN[HN],uN(NN,cN,TN)),qN--,HN=GN(qN),dN(NN,HN,kB),TN=vN[HN],0!==TN&&(qN-=PN[HN],uN(NN,qN,TN)))}while(RN<NN.last_lit);dN(NN,256,BN)},ON=(NN,BN)=>{const lN=BN.dyn_tree,kB=BN.stat_desc.static_tree,qN=BN.stat_desc.has_stree,eN=BN.stat_desc.elems;let vN,HN,TN,RN=-1;for(NN.heap_len=0,NN.heap_max=573,vN=0;vN<eN;vN++)0!==lN[2*vN]?(NN.heap[++NN.heap_len]=RN=vN,NN.depth[vN]=0):lN[2*vN+1]=0;for(;NN.heap_len<2;)TN=NN.heap[++NN.heap_len]=RN<2?++RN:0,lN[2*TN]=1,NN.depth[TN]=0,NN.opt_len--,qN&&(NN.static_len-=kB[2*TN+1]);for(BN.max_code=RN,vN=NN.heap_len>>1;vN>=1;vN--)pN(NN,lN,vN);TN=eN;do{vN=NN.heap[1],NN.heap[1]=NN.heap[NN.heap_len--],pN(NN,lN,1),HN=NN.heap[1],NN.heap[--NN.heap_max]=vN,NN.heap[--NN.heap_max]=HN,lN[2*TN]=lN[2*vN]+lN[2*HN],NN.depth[TN]=(NN.depth[vN]>=NN.depth[HN]?NN.depth[vN]:NN.depth[HN])+1,lN[2*vN+1]=lN[2*HN+1]=TN,NN.heap[1]=TN++,pN(NN,lN,1)}while(NN.heap_len>=2);NN.heap[--NN.heap_max]=NN.heap[1],((NN,BN)=>{const lN=BN.dyn_tree,kB=BN.max_code,qN=BN.stat_desc.static_tree,eN=BN.stat_desc.has_stree,vN=BN.stat_desc.extra_bits,HN=BN.stat_desc.extra_base,TN=BN.stat_desc.max_length;let RN,sN,VN,fN,ZN,PN,CN=0;for(fN=0;fN<=cN;fN++)NN.bl_count[fN]=0;for(lN[2*NN.heap[NN.heap_max]+1]=0,RN=NN.heap_max+1;RN<573;RN++)sN=NN.heap[RN],fN=lN[2*lN[2*sN+1]+1]+1,fN>TN&&(fN=TN,CN++),lN[2*sN+1]=fN,sN>kB||(NN.bl_count[fN]++,ZN=0,sN>=HN&&(ZN=vN[sN-HN]),PN=lN[2*sN],NN.opt_len+=PN*(fN+ZN),eN&&(NN.static_len+=PN*(qN[2*sN+1]+ZN)));if(0!==CN){do{for(fN=TN-1;0===NN.bl_count[fN];)fN--;NN.bl_count[fN]--,NN.bl_count[fN+1]+=2,NN.bl_count[TN]--,CN-=2}while(CN>0);for(fN=TN;0!==fN;fN--)for(sN=NN.bl_count[fN];0!==sN;)VN=NN.heap[--RN],VN>kB||(lN[2*VN+1]!==fN&&(NN.opt_len+=(fN-lN[2*VN+1])*lN[2*VN],lN[2*VN+1]=fN),sN--)}})(NN,BN),KN(lN,RN,NN.bl_count)},wN=(NN,BN,lN)=>{let kB,qN,cN=-1,eN=BN[1],vN=0,HN=7,TN=4;for(0===eN&&(HN=138,TN=3),BN[2*(lN+1)+1]=65535,kB=0;kB<=lN;kB++)qN=eN,eN=BN[2*(kB+1)+1],++vN<HN&&qN===eN||(vN<TN?NN.bl_tree[2*qN]+=vN:0!==qN?(qN!==cN&&NN.bl_tree[2*qN]++,NN.bl_tree[32]++):vN<=10?NN.bl_tree[34]++:NN.bl_tree[36]++,vN=0,cN=qN,0===eN?(HN=138,TN=3):qN===eN?(HN=6,TN=3):(HN=7,TN=4))},bN=(NN,BN,lN)=>{let kB,qN,cN=-1,eN=BN[1],vN=0,HN=7,TN=4;for(0===eN&&(HN=138,TN=3),kB=0;kB<=lN;kB++)if(qN=eN,eN=BN[2*(kB+1)+1],!(++vN<HN&&qN===eN)){if(vN<TN)do{dN(NN,qN,NN.bl_tree)}while(0!==--vN);else 0!==qN?(qN!==cN&&(dN(NN,qN,NN.bl_tree),vN--),dN(NN,16,NN.bl_tree),uN(NN,vN-3,2)):vN<=10?(dN(NN,17,NN.bl_tree),uN(NN,vN-3,3)):(dN(NN,18,NN.bl_tree),uN(NN,vN-11,7));vN=0,cN=qN,0===eN?(HN=138,TN=3):qN===eN?(HN=6,TN=3):(HN=7,TN=4)}};let mB=!1;const aN=(NN,BN,lN,kB)=>{uN(NN,0+(kB?1:0),3),((NN,BN,lN,kB)=>{nN(NN),kB&&(XN(NN,lN),XN(NN,~lN)),NN.pending_buf.set(NN.window.subarray(BN,BN+lN),NN.pending),NN.pending+=lN})(NN,BN,lN,!0)};NN.exports._tr_init=NN=>{mB||((()=>{let NN,BN,lN,TN,MN;const GN=new Array(16);for(lN=0,TN=0;TN<28;TN++)for(ZN[TN]=lN,NN=0;NN<1<<eN[TN];NN++)fN[lN++]=TN;for(fN[lN-1]=TN,MN=0,TN=0;TN<16;TN++)for(PN[TN]=MN,NN=0;NN<1<<vN[TN];NN++)VN[MN++]=TN;for(MN>>=7;TN<qN;TN++)for(PN[TN]=MN<<7,NN=0;NN<1<<vN[TN]-7;NN++)VN[256+MN++]=TN;for(BN=0;BN<=cN;BN++)GN[BN]=0;for(NN=0;NN<=143;)RN[2*NN+1]=8,NN++,GN[8]++;for(;NN<=255;)RN[2*NN+1]=9,NN++,GN[9]++;for(;NN<=279;)RN[2*NN+1]=7,NN++,GN[7]++;for(;NN<=287;)RN[2*NN+1]=8,NN++,GN[8]++;for(KN(RN,287,GN),NN=0;NN<qN;NN++)sN[2*NN+1]=5,sN[2*NN]=EN(NN,5);FN=new CN(RN,eN,257,kB,cN),IN=new CN(sN,vN,0,qN,cN),AN=new CN(new Array(0),HN,0,19,7)})(),mB=!0),NN.l_desc=new MN(NN.dyn_ltree,FN),NN.d_desc=new MN(NN.dyn_dtree,IN),NN.bl_desc=new MN(NN.bl_tree,AN),NN.bi_buf=0,NN.bi_valid=0,gN(NN)},NN.exports._tr_stored_block=aN,NN.exports._tr_flush_block=(NN,BN,kB,qN)=>{let cN,eN,vN=0;NN.level>0?(2===NN.strm.data_type&&(NN.strm.data_type=(NN=>{let BN,kB=4093624447;for(BN=0;BN<=31;BN++,kB>>>=1)if(1&kB&&0!==NN.dyn_ltree[2*BN])return 0;if(0!==NN.dyn_ltree[18]||0!==NN.dyn_ltree[20]||0!==NN.dyn_ltree[26])return 1;for(BN=32;BN<lN;BN++)if(0!==NN.dyn_ltree[2*BN])return 1;return 0})(NN)),ON(NN,NN.l_desc),ON(NN,NN.d_desc),vN=(NN=>{let BN;for(wN(NN,NN.dyn_ltree,NN.l_desc.max_code),wN(NN,NN.dyn_dtree,NN.d_desc.max_code),ON(NN,NN.bl_desc),BN=18;BN>=3&&0===NN.bl_tree[2*TN[BN]+1];BN--);return NN.opt_len+=3*(BN+1)+5+5+4,BN})(NN),cN=NN.opt_len+3+7>>>3,eN=NN.static_len+3+7>>>3,eN<=cN&&(cN=eN)):cN=eN=kB+5,kB+4<=cN&&-1!==BN?aN(NN,BN,kB,qN):4===NN.strategy||eN===cN?(uN(NN,2+(qN?1:0),3),xN(NN,RN,sN)):(uN(NN,4+(qN?1:0),3),((NN,BN,lN,kB)=>{let qN;for(uN(NN,BN-257,5),uN(NN,lN-1,5),uN(NN,kB-4,4),qN=0;qN<kB;qN++)uN(NN,NN.bl_tree[2*TN[qN]+1],3);bN(NN,NN.dyn_ltree,BN-1),bN(NN,NN.dyn_dtree,lN-1)})(NN,NN.l_desc.max_code+1,NN.d_desc.max_code+1,vN+1),xN(NN,NN.dyn_ltree,NN.dyn_dtree)),gN(NN),qN&&nN(NN)},NN.exports._tr_tally=(NN,BN,kB)=>(NN.pending_buf[NN.d_buf+2*NN.last_lit]=BN>>>8&255,NN.pending_buf[NN.d_buf+2*NN.last_lit+1]=255&BN,NN.pending_buf[NN.l_buf+NN.last_lit]=255&kB,NN.last_lit++,0===BN?NN.dyn_ltree[2*kB]++:(NN.matches++,BN--,NN.dyn_ltree[2*(fN[kB]+lN+1)]++,NN.dyn_dtree[2*GN(BN)]++),NN.last_lit===NN.lit_bufsize-1),NN.exports._tr_align=NN=>{uN(NN,2,3),dN(NN,256,RN),(NN=>{16===NN.bi_valid?(XN(NN,NN.bi_buf),NN.bi_buf=0,NN.bi_valid=0):NN.bi_valid>=8&&(NN.pending_buf[NN.pending++]=255&NN.bi_buf,NN.bi_buf>>=8,NN.bi_valid-=8)})(NN)}},16639:NN=>{"use strict";NN.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.vB="",this.state=null,this.data_type=2,this.adler=0}},15768:NN=>{function BN(NN,BN,lN){for(var kB=NN.length,qN=-1/0,cN=1/0,eN=0;eN<kB;eN++){var vN=(lN[0][eN]-NN[eN])/BN[eN],HN=(lN[1][eN]-NN[eN])/BN[eN];if(vN>HN){var TN=vN;vN=HN,HN=TN}if(HN<qN||vN>cN)return 1/0;vN>qN&&(qN=vN),HN<cN&&(cN=HN)}return qN>cN?1/0:qN}NN.exports=function(NN,lN,kB,qN){var cN=BN(lN,kB,qN);if(cN===1/0)NN=null;else{NN=NN||[];for(var eN=0;eN<lN.length;eN++)NN[eN]=lN[eN]+kB[eN]*cN}return NN},NN.exports.distance=BN},16737:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>eN});var kB=lN(51);const qN=kB.useLayoutEffect;const cN=function(NN){var BN=(0,kB.useRef)(NN);return qN((function(){BN.current=NN})),BN};var eN=function(NN){var BN=cN(NN);(0,kB.kl)((function(){var NN=function(NN){var lN;if(null!=BN.current&&(lN=BN.current(NN)),NN.defaultPrevented&&(NN.returnValue=""),"string"===typeof lN)return NN.returnValue=lN,lN};return window.addEventListener("beforeunload",NN),function(){window.removeEventListener("beforeunload",NN)}}),[])}},16708:(NN,BN,lN)=>{"use strict";var kB=lN(16715),qN=Array.prototype.concat,cN=Array.prototype.slice,eN=NN.exports=function(NN){for(var BN=[],lN=0,eN=NN.length;lN<eN;lN++){var vN=NN[lN];kB(vN)?BN=qN.call(BN,cN.call(vN)):BN.push(vN)}return BN};eN.wrap=function(NN){return function(){return NN(eN(arguments))}}},16715:NN=>{NN.exports=function(NN){return!(!NN||"string"===typeof NN)&&(NN instanceof Array||Array.isArray(NN)||NN.length>=0&&(NN.splice instanceof Function||Object.getOwnPropertyDescriptor(NN,NN.length-1)&&"String"!==NN.constructor.name))}},16849:NN=>{"use strict";var BN=[],lN=[],kB=[],qN=[],cN=[],eN=[],vN=[],HN=[],TN=[],RN=[],sN=[],VN=[];NN.exports=function(NN,fN,ZN,PN,CN,FN){for(var IN=vN,AN=TN,MN=RN,GN=VN,XN=0;XN<3;XN++)IN[XN]=+ZN[XN],MN[XN]=+fN.max[XN],AN[XN]=+fN.base[XN];FN||(FN=1e-10);var uN=function(NN,vN,TN,RN,VN,fN){var ZN=BN,PN=lN,CN=kB,FN=qN,IN=cN,AN=eN,MN=HN,GN=Math.floor,XN=0,uN=0,dN=0,EN=0,KN=0;if(gN(),0===dN)return 0;for(EN=pN();uN<=dN;){if(nN(EN)&&rN())return XN;EN=pN()}for(XN+=dN,KN=0;KN<3;KN++)RN[KN]+=TN[KN],VN[KN]+=TN[KN];return XN;function gN(){if(uN=0,0!==(dN=Math.sqrt(TN[0]*TN[0]+TN[1]*TN[1]+TN[2]*TN[2])))for(var NN=0;NN<3;NN++){var BN=TN[NN]>=0;FN[NN]=BN?1:-1;var lN=BN?VN[NN]:RN[NN];ZN[NN]=BN?RN[NN]:VN[NN],PN[NN]=xN(lN,FN[NN]),CN[NN]=ON(ZN[NN],FN[NN]),MN[NN]=TN[NN]/dN,IN[NN]=Math.abs(1/MN[NN]);var kB=BN?PN[NN]+1-lN:lN-PN[NN];AN[NN]=IN[NN]<1/0?IN[NN]*kB:1/0}}function nN(BN){for(var lN=FN[0],kB=0===BN?PN[0]:CN[0],qN=PN[0]+lN,cN=FN[1],eN=1===BN?PN[1]:CN[1],vN=PN[1]+cN,HN=FN[2],TN=2===BN?PN[2]:CN[2],RN=PN[2]+HN,sN=kB;sN!=qN;sN+=lN)for(var VN=eN;VN!=vN;VN+=cN)for(var fN=TN;fN!=RN;fN+=HN)if(NN(sN,VN,fN))return!0;return!1}function rN(){XN+=uN;var NN=FN[EN],BN=uN/dN,lN=sN;for(KN=0;KN<3;KN++){var kB=TN[KN]*BN;RN[KN]+=kB,VN[KN]+=kB,lN[KN]=TN[KN]-kB}if(NN>0?VN[EN]=Math.round(VN[EN]):RN[EN]=Math.round(RN[EN]),vN(XN,EN,NN,lN))return!0;for(KN=0;KN<3;KN++)TN[KN]=lN[KN];return gN(),0===dN}function pN(){var NN=AN[0]<AN[1]?AN[0]<AN[2]?0:2:AN[1]<AN[2]?1:2,BN=AN[NN]-uN;for(uN=AN[NN],PN[NN]+=FN[NN],AN[NN]+=IN[NN],KN=0;KN<3;KN++)ZN[KN]+=BN*MN[KN],CN[KN]=ON(ZN[KN],FN[KN]);return NN}function xN(NN,BN){return GN(NN-BN*fN)}function ON(NN,BN){return GN(NN+BN*fN)}}(NN,PN,IN,AN,MN,FN);if(!CN){for(XN=0;XN<3;XN++)GN[XN]=ZN[XN]>0?MN[XN]-fN.max[XN]:AN[XN]-fN.base[XN];fN.translate(GN)}return uN}},16547:(NN,BN,lN)=>{var kB=lN(16553);function qN(NN){for(var BN,lN,qN=0,cN=NN.length,eN=0;eN<NN.length;){for(BN=NN[eN],lN=0;eN<cN&&NN[eN]===BN;)++eN,++lN;qN+=kB.log2(lN)/7|0,qN+=kB.log2(BN>>>0)/7|0,qN+=2}return qN}BN.size=qN,BN.encode=function(NN,BN){BN||(BN=new Uint8Array(qN(NN)));for(var lN,kB,cN=0,eN=BN.length,vN=0;vN<NN.length;){for(lN=NN[vN],kB=0;vN<NN.length&&NN[vN]===lN;)++vN,++kB;for(;cN<eN&&kB>=128;)BN[cN++]=128+(127&kB),kB>>>=7;if(cN>=eN)throw new Error("RLE buffer overflow");for(BN[cN++]=kB,lN>>>=0;cN<eN&&lN>=128;)BN[cN++]=128+(127&lN),lN>>>=7;if(cN>=eN)throw new Error("RLE buffer overflow");BN[cN++]=lN}return BN},BN.decode=function(NN,BN){for(var lN,kB,qN,cN,eN=BN.length,vN=NN.length,HN=0,TN=0;TN<vN;){for(lN=0,kB=0;TN<vN&&NN[TN]>=128;)lN+=(127&NN[TN++])<<kB,kB+=7;if(lN+=NN[TN++]<<kB,TN>=vN)throw new Error("RLE buffer underrun");if(HN+lN>eN)throw new Error("Chunk buffer overflow");for(qN=0,kB=0;TN<vN&&NN[TN]>=128;)qN+=(127&NN[TN++])<<kB,kB+=7;if(TN>=vN)throw new Error("RLE buffer underrun");for(qN+=NN[TN++]<<kB,cN=0;cN<lN;++cN)BN[HN++]=qN}return BN}},16553:(NN,BN)=>{"use strict";function lN(NN){var BN=32;return(NN&=-NN)&&BN--,65535&NN&&(BN-=16),16711935&NN&&(BN-=8),252645135&NN&&(BN-=4),858993459&NN&&(BN-=2),1431655765&NN&&(BN-=1),BN}BN.INT_BITS=32,BN.INT_MAX=2147483647,BN.INT_MIN=-1<<31,BN.sign=function(NN){return(NN>0)-(NN<0)},BN.abs=function(NN){var BN=NN>>31;return(NN^BN)-BN},BN.min=function(NN,BN){return BN^(NN^BN)&-(NN<BN)},BN.max=function(NN,BN){return NN^(NN^BN)&-(NN<BN)},BN.isPow2=function(NN){return!(NN&NN-1)&&!!NN},BN.log2=function(NN){var BN,lN;return BN=(NN>65535)<<4,BN|=lN=((NN>>>=BN)>255)<<3,BN|=lN=((NN>>>=lN)>15)<<2,(BN|=lN=((NN>>>=lN)>3)<<1)|(NN>>>=lN)>>1},BN.log10=function(NN){return NN>=1e9?9:NN>=1e8?8:NN>=1e7?7:NN>=1e6?6:NN>=1e5?5:NN>=1e4?4:NN>=1e3?3:NN>=100?2:NN>=10?1:0},BN.popCount=function(NN){return 16843009*((NN=(858993459&(NN-=NN>>>1&1431655765))+(NN>>>2&858993459))+(NN>>>4)&252645135)>>>24},BN.countTrailingZeros=lN,BN.nextPow2=function(NN){return NN+=0===NN,--NN,NN|=NN>>>1,NN|=NN>>>2,NN|=NN>>>4,NN|=NN>>>8,(NN|=NN>>>16)+1},BN.prevPow2=function(NN){return NN|=NN>>>1,NN|=NN>>>2,NN|=NN>>>4,NN|=NN>>>8,(NN|=NN>>>16)-(NN>>>1)},BN.parity=function(NN){return NN^=NN>>>16,NN^=NN>>>8,NN^=NN>>>4,27030>>>(NN&=15)&1};var kB=new Array(256);!function(NN){for(var BN=0;BN<256;++BN){var lN=BN,kB=BN,qN=7;for(lN>>>=1;lN;lN>>>=1)kB<<=1,kB|=1&lN,--qN;NN[BN]=kB<<qN&255}}(kB),BN.reverse=function(NN){return kB[255&NN]<<24|kB[NN>>>8&255]<<16|kB[NN>>>16&255]<<8|kB[NN>>>24&255]},BN.interleave2=function(NN,BN){return(NN=1431655765&((NN=858993459&((NN=252645135&((NN=16711935&((NN&=65535)|NN<<8))|NN<<4))|NN<<2))|NN<<1))|(BN=1431655765&((BN=858993459&((BN=252645135&((BN=16711935&((BN&=65535)|BN<<8))|BN<<4))|BN<<2))|BN<<1))<<1},BN.deinterleave2=function(NN,BN){return(NN=65535&((NN=16711935&((NN=252645135&((NN=858993459&((NN=NN>>>BN&1431655765)|NN>>>1))|NN>>>2))|NN>>>4))|NN>>>16))<<16>>16},BN.interleave3=function(NN,BN,lN){return NN=1227133513&((NN=3272356035&((NN=251719695&((NN=4278190335&((NN&=1023)|NN<<16))|NN<<8))|NN<<4))|NN<<2),(NN|=(BN=1227133513&((BN=3272356035&((BN=251719695&((BN=4278190335&((BN&=1023)|BN<<16))|BN<<8))|BN<<4))|BN<<2))<<1)|(lN=1227133513&((lN=3272356035&((lN=251719695&((lN=4278190335&((lN&=1023)|lN<<16))|lN<<8))|lN<<4))|lN<<2))<<2},BN.deinterleave3=function(NN,BN){return(NN=1023&((NN=4278190335&((NN=251719695&((NN=3272356035&((NN=NN>>>BN&1227133513)|NN>>>2))|NN>>>4))|NN>>>8))|NN>>>16))<<22>>22},BN.nextCombination=function(NN){var BN=NN|NN-1;return BN+1|(~BN&-~BN)-1>>>lN(NN)+1}},16832:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>sN});var kB=lN(16841),qN=lN(155);class cN{constructor(NN,BN,lN,cN,eN,vN,HN){this.rs=new kB(NN.base,NN.Ys),this.tq=BN,this.friction=lN,this.restitution=cN,this.LH=eN,this.UP=vN,this.hH=!!HN,this.Js=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.gC=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.zP=null,this.tR=qN.create(),this.resting=[0,0,0],this.inFluid=!1,this.testSolid=null,this._ratioInFluid=0,this._forces=qN.create(),this._impulses=qN.create(),this._sleepFrameCount=10}loadFromCopy(NN){qN.zN(this.rs.base,NN.rs.base),qN.zN(this.rs.Ys,NN.rs.Ys),qN.zN(this.rs.max,NN.rs.max),this.rs.mag=NN.rs.mag,this.tq=NN.tq,this.friction=NN.friction,this.restitution=NN.restitution,this.LH=NN.LH,this.UP=NN.UP,this.hH=NN.hH,this.Js=NN.Js,this.fluidDrag=NN.fluidDrag,this.gC=NN.gC,this.preventFallOffEdge=NN.preventFallOffEdge,this.rolledBackLastTick=NN.rolledBackLastTick,this.zP=NN.zP,qN.zN(this.tR,NN.tR),qN.zN(this.resting,NN.resting),this.inFluid=NN.inFluid,this._ratioInFluid=NN._ratioInFluid,qN.zN(this._forces,NN._forces),qN.zN(this._impulses,NN._impulses),this._sleepFrameCount=NN._sleepFrameCount}setPosition(NN){eN(NN),qN.ZB(NN,NN,this.rs.base),this.rs.translate(NN),this.oR()}qq(){return qN.clone(this.rs.base)}applyForce(NN){eN(NN),qN.add(this._forces,this._forces,NN),this.oR()}applyImpulse(NN){eN(NN),qN.add(this._impulses,this._impulses,NN),this.oR()}oR(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var eN=NN=>{};var vN=lN(16841),HN=lN(155),TN=lN(16849);function RN(){this.Js=.1,this.fluidDrag=.4,this.iT=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function sN(NN,BN,lN){NN=Object.assign(new RN,NN),this.gravity=NN.gravity||[0,-10,0],this.Js=NN.Js||.1,this.iT=NN.iT||2,this.fluidDrag=NN.fluidDrag||.4,this.minBounceImpulse=NN.minBounceImpulse,this.bodies=[],this.sP=NN.sP,this.testSolid=BN,this.testFluid=lN}sN.prototype.JP=function(NN,BN,lN,kB,qN,eN){NN=NN||new vN([0,0,0],[1,1,1]),"undefined"==typeof BN&&(BN=1),"undefined"==typeof lN&&(lN=1),"undefined"==typeof kB&&(kB=0),"undefined"==typeof qN&&(qN=1);var HN=new cN(NN,BN,lN,kB,qN,eN);return this.bodies.push(HN),HN},sN.prototype.YP=function(NN){var BN=this.bodies.indexOf(NN);BN<0||(this.bodies.splice(BN,1),NN.rs=NN.UP=null)};var VN=HN.create(),fN=HN.create(),ZN=HN.create(),PN=HN.create(),CN=HN.create(),FN=HN.create(),IN=HN.create(),AN=new vN([0,0,0],[1,1,1]),MN=new cN(AN,1,1,0,1,(()=>{}),!1);function GN(NN,BN,lN){return BN=lN,BN*=1-(1-NN.ratioInFluid)**2}sN.prototype.HT=function(NN){NN/=1e3;var BN=yN(0,HN.squaredLength(this.gravity));this.bodies.forEach((lN=>function(NN,BN,lN,kB){HN.zN(CN,BN.resting),NN.sP&&MN.loadFromCopy(BN);if(BN.tq<=0)return HN.set(BN.tR,0,0,0),HN.set(BN._forces,0,0,0),void HN.set(BN._impulses,0,0,0);var qN=kB||0===BN.LH;if(function(NN,BN,lN,kB){if(BN._sleepFrameCount>0)return!1;if(kB)return!0;var qN=!1,cN=.5*lN*lN*BN.LH;HN.scale(DN,NN.gravity,cN);var eN=mB(NN,BN);return TN(eN,BN.rs,DN,(function(){return qN=!0,!0}),!0),qN}(NN,BN,lN,qN))return;BN._sleepFrameCount--,function(NN,BN){var lN=BN.rs,kB=Math.floor(lN.base[0]),qN=Math.floor(lN.base[2]),cN=Math.floor(lN.base[1]),eN=Math.floor(lN.max[1]);if(!NN.testFluid(kB,cN,qN))return BN.inFluid=!1,void(BN.ratioInFluid=0);var vN=1,TN=cN+1;for(;TN<=eN&&NN.testFluid(kB,TN,qN);)vN++,TN++;var RN=(cN+vN-lN.base[1])/lN.Ys[1];RN>1&&(RN=1);var sN=lN.Ys[0]*lN.Ys[1]*lN.Ys[2]*RN,VN=uN;HN.scale(VN,NN.gravity,-NN.iT*sN*BN.LH),BN.applyForce(VN),BN.inFluid=!0,BN.ratioInFluid=RN}(NN,BN),hN(BN._forces),hN(BN._impulses),hN(BN.tR),hN(BN.resting),HN.scale(VN,BN._forces,1/BN.tq),HN.fT(VN,VN,NN.gravity,BN.LH),HN.scale(fN,BN._impulses,1/BN.tq),HN.fT(fN,fN,VN,lN),HN.add(BN.tR,BN.tR,fN),BN.friction&&(dN(NN,0,BN,fN,lN),dN(NN,1,BN,fN,lN),dN(NN,2,BN,fN,lN));var cN=BN.fluidDrag>=0?BN.fluidDrag:NN.fluidDrag,eN=BN.Js>=0?BN.Js:NN.Js,vN=eN,RN=eN;BN.inFluid&&(vN=GN(BN,vN,BN.fluidDragHoriz>=0?BN.fluidDragHoriz:cN),RN=GN(BN,RN,BN.fluidDragVert>=0?BN.fluidDragVert:cN));vN=Math.max(1-vN*lN/BN.tq,0),RN=Math.max(1-RN*lN/BN.tq,0),HN.set(XN,vN,RN,vN),HN.multiply(BN.tR,BN.tR,XN),HN.scale(ZN,BN.tR,lN),HN.set(BN._forces,0,0,0),HN.set(BN._impulses,0,0,0),BN.hH&&LN(gN,BN.rs);HN.zN(FN,ZN),HN.set(IN,0,0,0),BN.preventFallOffEdge&&function(NN,BN,lN,kB){if(!BN.resting[1]||lN[1]>0)return;var qN=wN;LN(qN,BN.rs);for(var cN=0;cN<3;cN+=2){HN.set(ON,0,0,0),ON[cN]=lN[cN];var eN=!0;(eN=(eN=(eN=(eN=eN&&!aN(NN,BN,qN.base[0]+ON[0]+1e-5,qN.base[1],qN.base[2]+ON[2]+1e-5))&&!aN(NN,BN,qN.max[0]+ON[0]-1e-5,qN.base[1],qN.base[2]+ON[2]+1e-5))&&!aN(NN,BN,qN.base[0]+ON[0]+1e-5,qN.base[1],qN.max[2]+ON[2]-1e-5))&&!aN(NN,BN,qN.max[0]+ON[0]-1e-5,qN.base[1],qN.max[2]+ON[2]-1e-5))?(kB[cN]=lN[cN]>0?1:-1,lN[cN]=0):0===cN&&(HN.set(bN,lN[0],0,0),KN(NN,BN,qN,bN,kB,BN.slideOnCollision))}}(NN,BN,ZN,IN);KN(NN,BN,BN.rs,ZN,BN.resting,BN.slideOnCollision),BN.hH&&function(NN,BN,lN,kB){if(BN.resting[1]>=0&&!BN.inFluid)return;var qN=0!==BN.resting[0],cN=0!==BN.resting[2];if(!qN&&!cN)return;var eN=Math.abs(kB[0]/kB[2]),vN=4;if(!qN&&eN>vN)return;if(!cN&&eN<1/vN)return;HN.add(rN,lN.base,kB);var RN=mB(NN,BN);TN(RN,lN,kB,(function(NN,BN,lN,kB){if(1!==BN)return!0;kB[BN]=0}));var sN=lN.base[1],VN=BN.inFluid?1.951:1.001,fN=Math.floor(sN+VN)-sN;HN.set(pN,0,fN,0);var ZN=!1;if(TN(RN,lN,pN,(function(NN,BN,lN,kB){return ZN=!0,!0})),ZN)return;HN.ZB(xN,rN,lN.base),xN[1]=0,KN(NN,BN,lN,xN,nN,!0);var PN=yN(lN.base[0],rN[0]),CN=yN(lN.base[2],rN[2]);if(qN&&!PN&&(!CN||!cN))return;if(cN&&(!PN||!qN)&&!CN)return;var FN=!0;if(FN=FN&&!aN(NN,BN,lN.base[0]+1e-5,lN.base[1],lN.base[2]+1e-5),FN=FN&&!aN(NN,BN,lN.max[0]-1e-5,lN.base[1],lN.base[2]+1e-5),FN=FN&&!aN(NN,BN,lN.base[0]+1e-5,lN.base[1],lN.max[2]-1e-5),FN=FN&&!aN(NN,BN,lN.max[0]-1e-5,lN.base[1],lN.max[2]-1e-5),FN)return;LN(BN.rs,lN),BN.resting[0]=nN[0],BN.resting[2]=nN[2],BN.gC&&BN.gC()}(NN,BN,gN,FN);for(var sN=0;sN<3;++sN)BN.resting[sN]=BN.resting[sN]||IN[sN],PN[sN]=0,BN.resting[sN]&&(CN[sN]||(PN[sN]=-BN.tR[sN]),BN.tR[sN]=0);var AN=HN.length(PN);AN>.001&&(HN.scale(PN,PN,BN.tq),BN.UP&&BN.UP(PN),BN.restitution>0&&AN>NN.minBounceImpulse&&(HN.scale(PN,PN,BN.restitution),BN.applyImpulse(PN)));var EN=HN.squaredLength(BN.tR);EN>1e-5&&BN.oR();NN.sP&&NN.sP(BN)?(BN.loadFromCopy(MN),BN.rolledBackLastTick=!0):BN.rolledBackLastTick=!1}(this,lN,NN,BN)))};var XN=HN.create([0,0,0]);var uN=HN.create();function dN(NN,BN,lN,kB,qN){var cN=lN.resting[BN],eN=kB[BN];if(!lN.alwaysApplyHorizFriction||1!==BN){if(0===cN)return;if(cN*eN<=0)return}HN.zN(EN,lN.tR),EN[BN]=0;var vN=HN.length(EN);if(!yN(vN,0)){var TN=Math.abs(lN.friction*NN.gravity[BN]*qN),RN=vN>TN?(vN-TN)/vN:0;lN.tR[(BN+1)%3]*=RN,lN.tR[(BN+2)%3]*=RN}}var EN=HN.create();function KN(NN,BN,lN,kB,qN,cN){HN.set(qN,0,0,0);var eN=mB(NN,BN);return TN(eN,lN,kB,(function(NN,BN,lN,kB){qN[BN]=lN,kB[BN]=0,cN||(kB[0]=0,kB[1]=0,kB[2]=0)}))}var gN=new vN([],[]),nN=HN.create(),rN=HN.create(),pN=HN.create(),xN=HN.create();var ON=HN.create(),wN=new vN([],[]),bN=HN.create();function mB(NN,BN){return BN.testSolid||(BN.testSolid=(lN,kB,qN)=>null!==BN.zP&&kB<=BN.zP||NN.testSolid(lN,kB,qN)),BN.testSolid}function aN(NN,BN,lN,kB,qN){return mB(NN,BN)(Math.floor(lN),Math.floor(kB-1),Math.floor(qN))}var DN=HN.create();function yN(NN,BN){return Math.abs(NN-BN)<1e-5}function LN(NN,BN){for(var lN=0;lN<3;lN++)NN.base[lN]=BN.base[lN],NN.max[lN]=BN.max[lN],NN.Ys[lN]=BN.Ys[lN]}var hN=function(NN){}},16578:NN=>{"use strict";NN.exports=function(NN,BN,lN,kB){var qN=self||window;try{try{var cN;try{cN=new qN.Blob([NN])}catch(TN){(cN=new(qN.BlobBuilder||qN.WebKitBlobBuilder||qN.MozBlobBuilder||qN.MSBlobBuilder)).append(NN),cN=cN.getBlob()}var eN=qN.URL||qN.webkitURL,vN=eN.createObjectURL(cN),HN=new qN[BN](vN,lN);return eN.revokeObjectURL(vN),HN}catch(TN){return new qN[BN]("data:application/javascript,".concat(encodeURIComponent(NN)),lN)}}catch(TN){if(!kB)throw Error("Inline worker is not supported");return new qN[BN](kB,lN)}}},15740:(NN,BN,lN)=>{"use strict";function kB(NN,BN,lN,kB,qN){var cN={};return Object.keys(kB).forEach((function(NN){cN[NN]=kB[NN]})),cN.enumerable=!!cN.enumerable,cN.configurable=!!cN.configurable,("value"in cN||cN.initializer)&&(cN.writable=!0),cN=lN.slice().reverse().reduce((function(lN,kB){return kB(NN,BN,lN)||lN}),cN),qN&&void 0!==cN.initializer&&(cN.value=cN.initializer?cN.initializer.call(qN):void 0,cN.initializer=void 0),void 0===cN.initializer&&(Object.defineProperty(NN,BN,cN),cN=null),cN}lN.d(BN,{d:()=>kB})},15738:(NN,BN,lN)=>{"use strict";function kB(NN,BN,lN,kB){lN&&Object.defineProperty(NN,BN,{enumerable:lN.enumerable,configurable:lN.configurable,writable:lN.writable,value:lN.initializer?lN.initializer.call(kB):void 0})}lN.d(BN,{b:()=>kB})},16743:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>eN,d:()=>sN,e:()=>vN,f:()=>cN,i:()=>HN,j:()=>qN,n:()=>TN,q:()=>RN});var kB=lN(15136);class qN{constructor(){this._easingMode=qN.EASINGMODE_EASEIN}setEasingMode(NN){const BN=Math.min(Math.max(NN,0),2);this._easingMode=BN}getEasingMode(){return this._easingMode}easeInCore(NN){throw new Error("You must implement this method")}ease(NN){switch(this._easingMode){case qN.EASINGMODE_EASEIN:return this.easeInCore(NN);case qN.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-NN)}return NN>=.5?.5*(1-this.easeInCore(2*(1-NN)))+.5:.5*this.easeInCore(2*NN)}}qN.EASINGMODE_EASEIN=0,qN.EASINGMODE_EASEOUT=1,qN.EASINGMODE_EASEINOUT=2;class cN extends qN{easeInCore(NN){return NN=Math.max(0,Math.min(1,NN)),1-Math.sqrt(1-NN*NN)}}class eN extends qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=NN}easeInCore(NN){const BN=Math.max(0,this.amplitude);return Math.pow(NN,3)-NN*BN*Math.sin(3.141592653589793*NN)}}class vN extends qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=NN,this.bounciness=BN}easeInCore(NN){const BN=Math.max(0,this.bounces);let lN=this.bounciness;lN<=1&&(lN=1.001);const kB=Math.pow(lN,BN),qN=1-lN,cN=(1-kB)/qN+.5*kB,eN=NN*cN,vN=Math.log(-eN*(1-lN)+1)/Math.log(lN),HN=Math.floor(vN),TN=HN+1,RN=(1-Math.pow(lN,HN))/(qN*cN),sN=.5*(RN+(1-Math.pow(lN,TN))/(qN*cN)),VN=NN-sN,fN=sN-RN;return-Math.pow(1/lN,BN-HN)/(fN*fN)*(VN-fN)*(VN+fN)}}class HN extends qN{easeInCore(NN){return NN*NN*NN}}class TN extends qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=NN,this.springiness=BN}easeInCore(NN){let BN;const lN=Math.max(0,this.oscillations),kB=Math.max(0,this.springiness);return BN=0==kB?NN:(Math.exp(kB*NN)-1)/(Math.exp(kB)-1),BN*Math.sin((6.283185307179586*lN+1.5707963267948966)*NN)}}class RN extends qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=NN}easeInCore(NN){return this.exponent<=0?NN:(Math.exp(this.exponent*NN)-1)/(Math.exp(this.exponent)-1)}}class sN extends qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=NN,this.y1=BN,this.x2=lN,this.y2=kB}easeInCore(NN){return kB.e.Interpolate(NN,this.x1,this.y1,this.x2,this.y2)}}},15794:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>eN});var kB=lN(14925),qN=lN(14936),cN=lN(15370);class eN extends cN.c{get _matrix(){return this._compose(),this.JZ}set _matrix(NN){(NN.updateFlag!==this.JZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.JZ.kB(NN),this._markAsDirtyAndDecompose())}constructor(NN,BN){var lN;let qN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,cN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,eN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,vN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,HN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(NN,BN.VB(),!1),this.name=NN,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=BN,this.JZ=null!==(lN=null===cN||void 0===cN?void 0:cN.clone())&&void 0!==lN?lN:kB.Matrix.Identity(),this._restMatrix=null!==eN&&void 0!==eN?eN:this.JZ.clone(),this._bindMatrix=null!==vN&&void 0!==vN?vN:this.JZ.clone(),this._index=HN,this._absoluteMatrix=new kB.Matrix,this._absoluteBindMatrix=new kB.Matrix,this._absoluteInverseBindMatrix=new kB.Matrix,this._finalMatrix=new kB.Matrix,BN.bones.push(this),this.setParent(qN,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(NN){this.setParent(NN)}setParent(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==NN){if(this.parent){const NN=this.parent.children.indexOf(this);-1!==NN&&this.parent.children.splice(NN,1)}this._parentNode=NN,this.parent&&this.parent.children.push(this),BN&&this._updateAbsoluteBindMatrices(),this.Us()}}getLocalMatrix(){return this._compose(),this.JZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(NN){this._restMatrix.kB(NN)}setRestPose(NN){this.setRestMatrix(NN)}getBindPose(){return this.getBindMatrix()}setBindMatrix(NN){this.Xc(NN)}setBindPose(NN){this.setBindMatrix(NN)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){var NN;const BN=kB.TmpVectors.fB[0],lN=kB.TmpVectors.Quaternion[0],qN=kB.TmpVectors.fB[1];this.getRestMatrix().decompose(BN,lN,qN),this._linkedTransformNode.position.kB(qN),this._linkedTransformNode.rotationQuaternion=null!==(NN=this._linkedTransformNode.rotationQuaternion)&&void 0!==NN?NN:kB.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.kB(lN),this._linkedTransformNode.gc.kB(BN)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(NN){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=NN,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.aT}set position(NN){this._decompose(),this.aT.kB(NN),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(NN){this.setRotation(NN)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(NN){this.setRotationQuaternion(NN)}get gc(){return this.getScale()}set gc(NN){this.setScale(NN)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=kB.fB.Zero(),this._localRotation=kB.Quaternion.Zero(),this.aT=kB.fB.Zero()),this.JZ.decompose(this._localScaling,this._localRotation,this.aT))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,kB.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.aT,this.JZ)):this._needToCompose=!1)}Xc(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],lN=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.kB(NN),BN&&this._updateAbsoluteBindMatrices(),lN?this._matrix=NN:this.Us()}_updateAbsoluteBindMatrices(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(NN||(NN=this._bindMatrix),this.parent?NN.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.kB(NN),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),BN)for(let lN=0;lN<this.children.length;lN++)this.children[lN]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Us(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Us(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Us(),this._needToDecompose=!0}_updatePosition(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0,qN=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const cN=this.getLocalMatrix();if(0==BN)qN?(cN.addAtIndex(12,NN.x),cN.addAtIndex(13,NN.y),cN.addAtIndex(14,NN.z)):cN.setTranslationFromFloats(NN.x,NN.y,NN.z);else{let BN=null;lN&&(BN=lN.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const vN=eN._TmpMats[0],HN=eN._TmpVecs[0];this.parent?lN&&BN?(vN.kB(this.parent.getAbsoluteMatrix()),vN.multiplyToRef(BN,vN)):vN.kB(this.parent.getAbsoluteMatrix()):kB.Matrix.IdentityToRef(vN),qN&&vN.setTranslationFromFloats(0,0,0),vN.invert(),kB.fB.TransformCoordinatesToRef(NN,vN,HN),qN?(cN.addAtIndex(12,HN.x),cN.addAtIndex(13,HN.y),cN.addAtIndex(14,HN.z)):cN.setTranslationFromFloats(HN.x,HN.y,HN.z)}this._markAsDirtyAndDecompose()}translate(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;this._updatePosition(NN,BN,lN,!0)}setPosition(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;this._updatePosition(NN,BN,lN,!1)}setAbsolutePosition(NN,BN){this.setPosition(NN,1,BN)}scale(NN,BN,lN){let qN=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const cN=this.getLocalMatrix(),vN=eN._TmpMats[0];kB.Matrix.ScalingToRef(NN,BN,lN,vN),vN.multiplyToRef(cN,cN),vN.invert();for(const kB of this.children){const qN=kB.getLocalMatrix();qN.multiplyToRef(vN,qN),qN.multiplyAtIndex(12,NN),qN.multiplyAtIndex(13,BN),qN.multiplyAtIndex(14,lN),kB._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),qN)for(const kB of this.children)kB.scale(NN,BN,lN,qN)}setScale(NN){this._decompose(),this._localScaling.kB(NN),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(NN){this._decompose(),NN.kB(this._localScaling)}setYawPitchRoll(NN,BN,lN){let qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,cN=arguments.length>4?arguments[4]:void 0;if(0===qN){const vN=eN._TmpQuat;return kB.Quaternion.RotationYawPitchRollToRef(NN,BN,lN,vN),void this.setRotationQuaternion(vN,qN,cN)}const vN=eN._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(vN,cN))return;const HN=eN._TmpMats[1];kB.Matrix.RotationYawPitchRollToRef(NN,BN,lN,HN),vN.multiplyToRef(HN,HN),this._rotateWithMatrix(HN,qN,cN)}rotate(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,qN=arguments.length>3?arguments[3]:void 0;const cN=eN._TmpMats[0];cN.setTranslationFromFloats(0,0,0),kB.Matrix.RotationAxisToRef(NN,BN,cN),this._rotateWithMatrix(cN,lN,qN)}setAxisAngle(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,qN=arguments.length>3?arguments[3]:void 0;if(0===lN){const cN=eN._TmpQuat;return kB.Quaternion.RotationAxisToRef(NN,BN,cN),void this.setRotationQuaternion(cN,lN,qN)}const cN=eN._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(cN,qN))return;const vN=eN._TmpMats[1];kB.Matrix.RotationAxisToRef(NN,BN,vN),cN.multiplyToRef(vN,vN),this._rotateWithMatrix(vN,lN,qN)}setRotation(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(NN.y,NN.x,NN.z,BN,lN)}setRotationQuaternion(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;if(0===BN)return this._decompose(),this._localRotation.kB(NN),void this._markAsDirtyAndCompose();const qN=eN._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(qN,lN))return;const cN=eN._TmpMats[1];kB.Matrix.FromQuaternionToRef(NN,cN),qN.multiplyToRef(cN,cN),this._rotateWithMatrix(cN,BN,lN)}setRotationMatrix(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;if(0===BN){const qN=eN._TmpQuat;return kB.Quaternion.FromRotationMatrixToRef(NN,qN),void this.setRotationQuaternion(qN,BN,lN)}const qN=eN._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(qN,lN))return;const cN=eN._TmpMats[1];cN.kB(NN),qN.multiplyToRef(NN,cN),this._rotateWithMatrix(cN,BN,lN)}_rotateWithMatrix(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;const kB=this.getLocalMatrix(),qN=kB.m[12],cN=kB.m[13],vN=kB.m[14],HN=this.getParent(),TN=eN._TmpMats[3],RN=eN._TmpMats[4];HN&&1==BN?(lN?(TN.kB(lN.getWorldMatrix()),HN.getAbsoluteMatrix().multiplyToRef(TN,TN)):TN.kB(HN.getAbsoluteMatrix()),RN.kB(TN),RN.invert(),kB.multiplyToRef(TN,kB),kB.multiplyToRef(NN,kB),kB.multiplyToRef(RN,kB)):1==BN&&lN?(TN.kB(lN.getWorldMatrix()),RN.kB(TN),RN.invert(),kB.multiplyToRef(TN,kB),kB.multiplyToRef(NN,kB),kB.multiplyToRef(RN,kB)):kB.multiplyToRef(NN,kB),kB.setTranslationFromFloats(qN,cN,vN),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(NN,BN){const lN=eN._TmpMats[2];return NN.kB(this.getAbsoluteMatrix()),BN?(NN.multiplyToRef(BN.getWorldMatrix(),NN),kB.Matrix.ScalingToRef(BN.gc.x,BN.gc.y,BN.gc.z,lN)):kB.Matrix.IdentityToRef(lN),NN.invert(),!isNaN(NN.m[0])&&(lN.multiplyAtIndex(0,this._scalingDeterminant),NN.multiplyToRef(lN,NN),!0)}qq(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.fB.Zero();return this.getPositionToRef(NN,BN,lN),lN}getPositionToRef(){let NN=arguments.length>1?arguments[1]:void 0,BN=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const NN=this.getLocalMatrix();BN.x=NN.m[12],BN.y=NN.m[13],BN.z=NN.m[14]}else{let lN=null;NN&&(lN=NN.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let kB=eN._TmpMats[0];NN&&lN?(kB.kB(this.getAbsoluteMatrix()),kB.multiplyToRef(lN,kB)):kB=this.getAbsoluteMatrix(),BN.x=kB.m[12],BN.y=kB.m[13],BN.z=kB.m[14]}}getAbsolutePosition(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const BN=kB.fB.Zero();return this.getPositionToRef(1,NN,BN),BN}getAbsolutePositionToRef(NN,BN){this.getPositionToRef(1,NN,BN)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.JZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.kB(this.JZ);const NN=this._skeleton.getPoseMatrix();NN&&this._absoluteMatrix.multiplyToRef(NN,this._absoluteMatrix)}const NN=this.children,BN=NN.length;for(let lN=0;lN<BN;lN++)NN[lN].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}RR(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.fB.Zero();return this.getDirectionToRef(NN,BN,lN),lN}getDirectionToRef(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2?arguments[2]:void 0,qN=null;BN&&(qN=BN.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const cN=eN._TmpMats[0];cN.kB(this.getAbsoluteMatrix()),BN&&qN&&cN.multiplyToRef(qN,cN),kB.fB.TransformNormalToRef(NN,cN,lN),lN.normalize()}getRotation(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.fB.Zero();return this.getRotationToRef(NN,BN,lN),lN}getRotationToRef(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2?arguments[2]:void 0;const kB=eN._TmpQuat;this.getRotationQuaternionToRef(NN,BN,kB),kB.toEulerAnglesToRef(lN)}getRotationQuaternion(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.Quaternion.Identity();return this.getRotationQuaternionToRef(NN,BN,lN),lN}getRotationQuaternionToRef(){let NN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,BN=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),BN.kB(this._localRotation);else{const lN=eN._TmpMats[0],kB=this.getAbsoluteMatrix();NN?kB.multiplyToRef(NN.getWorldMatrix(),lN):lN.kB(kB),lN.multiplyAtIndex(0,this._scalingDeterminant),lN.multiplyAtIndex(1,this._scalingDeterminant),lN.multiplyAtIndex(2,this._scalingDeterminant),lN.decompose(void 0,BN,void 0)}}getRotationMatrix(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1?arguments[1]:void 0;const lN=kB.Matrix.Identity();return this.getRotationMatrixToRef(NN,BN,lN),lN}getRotationMatrixToRef(){let NN=arguments.length>1?arguments[1]:void 0,BN=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(BN);else{const lN=eN._TmpMats[0],kB=this.getAbsoluteMatrix();NN?kB.multiplyToRef(NN.getWorldMatrix(),lN):lN.kB(kB),lN.multiplyAtIndex(0,this._scalingDeterminant),lN.multiplyAtIndex(1,this._scalingDeterminant),lN.multiplyAtIndex(2,this._scalingDeterminant),lN.getRotationMatrixToRef(BN)}}getAbsolutePositionFromLocal(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.fB.Zero();return this.getAbsolutePositionFromLocalToRef(NN,BN,lN),lN}getAbsolutePositionFromLocalToRef(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2?arguments[2]:void 0,qN=null;BN&&(qN=BN.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const cN=eN._TmpMats[0];cN.kB(this.getAbsoluteMatrix()),BN&&qN&&cN.multiplyToRef(qN,cN),kB.fB.TransformCoordinatesToRef(NN,cN,lN)}getLocalPositionFromAbsolute(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=kB.fB.Zero();return this.getLocalPositionFromAbsoluteToRef(NN,BN,lN),lN}getLocalPositionFromAbsoluteToRef(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2?arguments[2]:void 0,qN=null;BN&&(qN=BN.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const cN=eN._TmpMats[0];cN.kB(this.getAbsoluteMatrix()),BN&&qN&&cN.multiplyToRef(qN,cN),cN.invert(),kB.fB.TransformCoordinatesToRef(NN,cN,lN)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const NN=this._skeleton.bones.indexOf(this);if(-1!==NN&&this._skeleton.bones.splice(NN,1),this._parentNode&&this._parentNode.children){const NN=this._parentNode.children,BN=NN.indexOf(this);-1!==BN&&NN.splice(BN,1)}super.dispose()}}eN._TmpVecs=(0,qN.d)(2,kB.fB.Zero),eN._TmpQuat=kB.Quaternion.Identity(),eN._TmpMats=(0,qN.d)(5,kB.Matrix.Identity)},16740:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>ON});var kB=lN(14905),qN=lN(14910),cN=lN(14731),eN=lN(14925),vN=lN(14945),HN=lN(15370),TN=lN(15391),RN=lN(15208),sN=lN(14756),VN=lN(14934);class fN{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(NN){this._zoomStopsAnimation=NN}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(NN){this._idleRotationSpeed=NN}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(NN){this._idleRotationWaitTime=NN}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(NN){this._idleRotationSpinupTime=NN}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(NN){this._attachedCamera=NN;const BN=this._attachedCamera.VB();this._onPrePointerObservableObserver=BN.onPrePointerObservable.add((NN=>{NN.type!==RN.b.POINTERDOWN?NN.type===RN.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=NN.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const NN=sN.b.Now;let BN=0;null!=this._lastFrameTime&&(BN=NN-this._lastFrameTime),this._lastFrameTime=NN,this._applyUserInteraction();const lN=NN-this._lastInteractionTime-this._idleRotationWaitTime,kB=Math.max(Math.min(lN/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*kB,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(BN/1e3))}))}detach(){if(!this._attachedCamera)return;const NN=this._attachedCamera.VB();this._onPrePointerObservableObserver&&NN.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(NN){this._lastInteractionTime=null!==NN&&void 0!==NN?NN:sN.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<VN.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let NN=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(NN=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?NN:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=sN.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var ZN=lN(16743),PN=lN(15471);class CN{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(NN){if(this._autoTransitionRange===NN)return;this._autoTransitionRange=NN;const BN=this._attachedCamera;BN&&(NN?this._onMeshTargetChangedObserver=BN.onMeshTargetChangedObservable.add((NN=>{if(NN&&(NN.uc(!0),NN.getBoundingInfo)){const BN=NN.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*BN,this.upperRadiusTransitionRange=.05*BN}})):this._onMeshTargetChangedObserver&&BN.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(NN){this._attachedCamera=NN,this._onAfterCheckInputsObserver=NN.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(NN){return!!this._attachedCamera&&(this._attachedCamera.radius===NN&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(NN){if(!this._attachedCamera)return;this._radiusBounceTransition||(CN.EasingFunction.setEasingMode(CN.EasingMode),this._radiusBounceTransition=PN.c.CreateAnimation("radius",PN.c.ANIMATIONTYPE_FLOAT,60,CN.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const BN=PN.c.TransitionTo("radius",this._attachedCamera.radius+NN,this._attachedCamera,this._attachedCamera.VB(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));BN&&this._animatables.push(BN)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}CN.EasingFunction=new ZN.c(.3),CN.EasingMode=ZN.j.EASINGMODE_EASEOUT;class FN{constructor(){this.onTargetFramingAnimationEndObservable=new cN.b,this._mode=FN.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(NN){this._mode=NN}get mode(){return this._mode}set radiusScale(NN){this._radiusScale=NN}get radiusScale(){return this._radiusScale}set positionScale(NN){this._positionScale=NN}get positionScale(){return this._positionScale}set defaultElevation(NN){this._defaultElevation=NN}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(NN){this._elevationReturnTime=NN}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(NN){this._elevationReturnWaitTime=NN}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(NN){this._zoomStopsAnimation=NN}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(NN){this._framingTime=NN}get framingTime(){return this._framingTime}init(){}attach(NN){this._attachedCamera=NN;const BN=this._attachedCamera.VB();FN.EasingFunction.setEasingMode(FN.EasingMode),this._onPrePointerObservableObserver=BN.onPrePointerObservable.add((NN=>{NN.type!==RN.b.POINTERDOWN?NN.type===RN.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=NN.onMeshTargetChangedObservable.add((NN=>{NN&&NN.getBoundingInfo&&this.zoomOnMesh(NN,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=NN.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const NN=this._attachedCamera.VB();this._onPrePointerObservableObserver&&NN.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;NN.uc(!0);const kB=NN.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(kB.minimumWorld,kB.maximumWorld,BN,lN)}zoomOnMeshHierarchy(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;NN.uc(!0);const kB=NN.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(kB.min,kB.max,BN,lN)}zoomOnMeshesHierarchy(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new eN.fB(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),qN=new eN.fB(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let cN=0;cN<NN.length;cN++){const BN=NN[cN].getHierarchyBoundingVectors(!0);eN.fB.CheckExtends(BN.min,kB,qN),eN.fB.CheckExtends(BN.max,kB,qN)}this.zoomOnBoundingInfo(kB,qN,BN,lN)}zoomOnBoundingInfo(NN,BN){let lN,kB=arguments.length>2&&void 0!==arguments[2]&&arguments[2],qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const cN=NN.y,vN=cN+(BN.y-cN)*this._positionScale,HN=BN.ZB(NN).scale(.5);if(!isFinite(vN))return!1;if(kB)lN=new eN.fB(0,vN,0);else{const BN=NN.add(HN);lN=new eN.fB(BN.x,vN,BN.z)}this._vectorTransition||(this._vectorTransition=PN.c.CreateAnimation("target",PN.c.ANIMATIONTYPE_VECTOR3,60,FN.EasingFunction)),this._betaIsAnimating=!0;let TN=PN.c.TransitionTo("target",lN,this._attachedCamera,this._attachedCamera.VB(),60,this._vectorTransition,this._framingTime);TN&&this._animatables.push(TN);let RN=0;if(this._mode===FN.FitFrustumSidesMode){const lN=this._calculateLowerRadiusFromModelBoundingSphere(NN,BN);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=HN.length()+this._attachedCamera.Mc),RN=lN}else this._mode===FN.IgnoreBoundsSizeMode&&(RN=this._calculateLowerRadiusFromModelBoundingSphere(NN,BN),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Mc));if(this.autoCorrectCameraLimitsAndSensibility){const lN=BN.ZB(NN).length();this._attachedCamera.panningSensibility=5e3/lN,this._attachedCamera.wheelPrecision=100/RN}return this._radiusTransition||(this._radiusTransition=PN.c.CreateAnimation("radius",PN.c.ANIMATIONTYPE_FLOAT,60,FN.EasingFunction)),TN=PN.c.TransitionTo("radius",RN,this._attachedCamera,this._attachedCamera.VB(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),qN&&qN(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),TN&&this._animatables.push(TN),!0}_calculateLowerRadiusFromModelBoundingSphere(NN,BN){const lN=this._attachedCamera;if(!lN)return 0;let kB=lN._calculateLowerRadiusFromModelBoundingSphere(NN,BN,this._radiusScale);return lN.lowerRadiusLimit&&this._mode===FN.IgnoreBoundsSizeMode&&(kB=kB<lN.lowerRadiusLimit?lN.lowerRadiusLimit:kB),lN.upperRadiusLimit&&(kB=kB>lN.upperRadiusLimit?lN.upperRadiusLimit:kB),kB}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const NN=sN.b.Now-this._lastInteractionTime,BN=.5*Math.PI-this._defaultElevation,lN=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>lN&&NN>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=PN.c.CreateAnimation("beta",PN.c.ANIMATIONTYPE_FLOAT,60,FN.EasingFunction));const NN=PN.c.TransitionTo("beta",BN,this._attachedCamera,this._attachedCamera.VB(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));NN&&this._animatables.push(NN)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=sN.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}FN.EasingFunction=new ZN.q,FN.EasingMode=ZN.j.EASINGMODE_EASEINOUT,FN.IgnoreBoundsSizeMode=0,FN.FitFrustumSidesMode=1;var IN=lN(15400),AN=lN(15438),MN=lN(15790),GN=lN(14727);class XN{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(NN){NN=GN.Tools.BackCompatCameraNoPreventDefault(arguments);const BN=this.camera.getEngine(),lN=BN.getInputElement();let kB=0,qN=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=cN=>{var eN,vN;const HN=cN.event,TN="touch"===HN.pointerType;if(cN.type!==RN.b.POINTERMOVE&&-1===this.buttons.indexOf(HN.button))return;const sN=HN.target;if(this._altKey=HN.altKey,this._ctrlKey=HN.ctrlKey,this._metaKey=HN.metaKey,this._shiftKey=HN.shiftKey,this._buttonsPressed=HN.buttons,BN.isPointerLock){const NN=HN.movementX,BN=HN.movementY;this.onTouch(null,NN,BN),this._pointA=null,this._pointB=null}else{if(cN.type!==RN.b.POINTERDOWN&&cN.type!==RN.b.POINTERDOUBLETAP&&TN&&(null===(eN=this._pointA)||void 0===eN?void 0:eN.pointerId)!==HN.pointerId&&(null===(vN=this._pointB)||void 0===vN?void 0:vN.pointerId)!==HN.pointerId)return;if(cN.type!==RN.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!TN)if(cN.type===RN.b.POINTERDOUBLETAP)this.onDoubleTap(HN.pointerType);else if(cN.type!==RN.b.POINTERUP||this._currentMousePointerIdDown!==HN.pointerId&&!TN){if(cN.type===RN.b.POINTERMOVE)if(NN||HN.preventDefault(),this._pointA&&null===this._pointB){const NN=HN.clientX-this._pointA.x,BN=HN.clientY-this._pointA.y;this._pointA.x=HN.clientX,this._pointA.y=HN.clientY,this.onTouch(this._pointA,NN,BN)}else if(this._pointA&&this._pointB){const NN=this._pointA.pointerId===HN.pointerId?this._pointA:this._pointB;NN.x=HN.clientX,NN.y=HN.clientY;const BN=this._pointA.x-this._pointB.x,lN=this._pointA.y-this._pointB.y,eN=BN*BN+lN*lN,vN={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:HN.pointerId,type:cN.type};this.onMultiTouch(this._pointA,this._pointB,kB,eN,qN,vN),qN=vN,kB=eN}}else{try{null===sN||void 0===sN||sN.releasePointerCapture(HN.pointerId)}catch(VN){}TN||(this._pointB=null),BN._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==HN.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==HN.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==kB||qN)&&(this.onMultiTouch(this._pointA,this._pointB,kB,0,qN,null),kB=0,qN=null),this._currentMousePointerIdDown=-1,this.onButtonUp(HN),NN||HN.preventDefault()}else{try{null===sN||void 0===sN||sN.setPointerCapture(HN.pointerId)}catch(VN){}if(null===this._pointA)this._pointA={x:HN.clientX,y:HN.clientY,pointerId:HN.pointerId,type:HN.pointerType};else{if(null!==this._pointB)return;this._pointB={x:HN.clientX,y:HN.clientY,pointerId:HN.pointerId,type:HN.pointerType}}-1!==this._currentMousePointerIdDown||TN||(this._currentMousePointerIdDown=HN.pointerId),this.onButtonDown(HN),NN||(HN.preventDefault(),lN&&lN.focus())}}},this._observer=this.camera.VB()._inputManager._addCameraPointerObserver(this._pointerInput,RN.b.POINTERDOWN|RN.b.POINTERUP|RN.b.POINTERMOVE|RN.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,kB=0,qN=null,this.onLostFocus()},this._contextMenuBind=NN=>this.onContextMenu(NN),lN&&lN.addEventListener("contextmenu",this._contextMenuBind,!1);const cN=this.camera.VB().getEngine().getHostWindow();cN&&GN.Tools.RegisterTopRootEvents(cN,[{name:"blur",handler:this._onLostFocus}])}qZ(){if(this._onLostFocus){const NN=this.camera.VB().getEngine().getHostWindow();NN&&GN.Tools.UnregisterTopRootEvents(NN,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.VB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const NN=this.camera.VB().getEngine().getInputElement();NN&&NN.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(NN){}onTouch(NN,BN,lN){}onMultiTouch(NN,BN,lN,kB,qN,cN){}onContextMenu(NN){NN.preventDefault()}onButtonDown(NN){}onButtonUp(NN){}onLostFocus(){}}(0,kB.c)([(0,qN.G)()],XN.prototype,"buttons",void 0);class uN extends XN{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(NN,BN){if(0!==this.panningSensibility&&NN&&BN){const lN=BN.x-NN.x,kB=BN.y-NN.y;this.camera.inertialPanningX+=-lN/this.panningSensibility,this.camera.inertialPanningY+=kB/this.panningSensibility}}_computePinchZoom(NN,BN){const lN=this.camera.radius||uN.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=lN*Math.sqrt(NN)/Math.sqrt(BN):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(BN-NN)*lN*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(BN-NN)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(NN,BN,lN){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-BN/this.panningSensibility,this.camera.inertialPanningY+=lN/this.panningSensibility):(this.camera.inertialAlphaOffset-=BN/this.angularSensibilityX,this.camera.inertialBetaOffset-=lN/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(NN,BN,lN,kB,qN,cN){0===lN&&null===qN||0===kB&&null===cN||(this.multiTouchPanAndZoom?(this._computePinchZoom(lN,kB),this._computeMultiTouchPanning(qN,cN)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(kB)-Math.sqrt(lN))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(lN,kB),this._isPinching=!0):this._computeMultiTouchPanning(qN,cN)):this.multiTouchPanning?this._computeMultiTouchPanning(qN,cN):this.pinchZoom&&this._computePinchZoom(lN,kB))}onButtonDown(NN){this._isPanClick=NN.button===this.camera._panningMouseButton}onButtonUp(NN){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}uN.MinimumRadiusForPinch=.001,(0,kB.c)([(0,qN.G)()],uN.prototype,"buttons",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"angularSensibilityX",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"angularSensibilityY",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"pinchPrecision",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"pinchDeltaPercentage",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"useNaturalPinchZoom",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"pinchZoom",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"panningSensibility",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"multiTouchPanning",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"multiTouchPanAndZoom",void 0),MN.b.ArcRotateCameraPointersInput=uN;var dN=lN(15213);class EN{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(NN){NN=GN.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.VB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((BN=>{const lN=BN.event;if(!lN.metaKey)if(BN.type===dN.b.KEYDOWN){if(this._ctrlPressed=lN.ctrlKey,this._altPressed=lN.altKey,-1!==this.keysUp.indexOf(lN.keyCode)||-1!==this.keysDown.indexOf(lN.keyCode)||-1!==this.keysLeft.indexOf(lN.keyCode)||-1!==this.keysRight.indexOf(lN.keyCode)||-1!==this.keysReset.indexOf(lN.keyCode)){-1===this._keys.indexOf(lN.keyCode)&&this._keys.push(lN.keyCode),lN.preventDefault&&(NN||lN.preventDefault())}}else if(-1!==this.keysUp.indexOf(lN.keyCode)||-1!==this.keysDown.indexOf(lN.keyCode)||-1!==this.keysLeft.indexOf(lN.keyCode)||-1!==this.keysRight.indexOf(lN.keyCode)||-1!==this.keysReset.indexOf(lN.keyCode)){const BN=this._keys.indexOf(lN.keyCode);BN>=0&&this._keys.splice(BN,1),lN.preventDefault&&(NN||lN.preventDefault())}})))}qZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const NN=this.camera;for(let BN=0;BN<this._keys.length;BN++){const lN=this._keys[BN];-1!==this.keysLeft.indexOf(lN)?this._ctrlPressed&&this.camera._useCtrlForPanning?NN.inertialPanningX-=1/this.panningSensibility:NN.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(lN)?this._ctrlPressed&&this.camera._useCtrlForPanning?NN.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?NN.inertialRadiusOffset+=1/this.zoomingSensibility:NN.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(lN)?this._ctrlPressed&&this.camera._useCtrlForPanning?NN.inertialPanningX+=1/this.panningSensibility:NN.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(lN)?this._ctrlPressed&&this.camera._useCtrlForPanning?NN.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?NN.inertialRadiusOffset-=1/this.zoomingSensibility:NN.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(lN)&&NN.useInputToRestoreState&&NN.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,kB.c)([(0,qN.G)()],EN.prototype,"keysUp",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"keysDown",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"keysLeft",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"keysRight",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"keysReset",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"panningSensibility",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"zoomingSensibility",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"useAltToZoom",void 0),(0,kB.c)([(0,qN.G)()],EN.prototype,"angularSpeed",void 0),MN.b.ArcRotateCameraKeyboardMoveInput=EN;var KN=lN(14978),gN=lN(15220);class nN{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new eN.fB(0,0,0),this._globalOffset=new eN.fB(0,0,0),this._inertialPanning=eN.fB.Zero()}_computeDeltaFromMouseWheelLegacyEvent(NN,BN){let lN=0;const kB=.01*NN*this.wheelDeltaPercentage*BN;return lN=NN>0?kB/(1+this.wheelDeltaPercentage):kB*(1+this.wheelDeltaPercentage),lN}attachControl(NN){NN=GN.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=BN=>{if(BN.type!==RN.b.POINTERWHEEL)return;const lN=BN.event;let kB=0;const qN=lN.deltaMode===gN.b.DOM_DELTA_LINE?40:1,cN=-lN.deltaY*qN;if(this.customComputeDeltaFromMouseWheel)kB=this.customComputeDeltaFromMouseWheel(cN,this,lN);else if(this.wheelDeltaPercentage){if(kB=this._computeDeltaFromMouseWheelLegacyEvent(cN,this.camera.radius),kB>0){let NN=this.camera.radius,BN=this.camera.inertialRadiusOffset+kB;for(let lN=0;lN<20&&!(NN<=BN)&&!(Math.abs(BN*this.camera.inertia)<.001);lN++)NN-=BN,BN*=this.camera.inertia;NN=(0,vN.Clamp)(NN,0,Number.MAX_VALUE),kB=this._computeDeltaFromMouseWheelLegacyEvent(cN,NN)}}else kB=cN/(40*this.wheelPrecision);kB&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(kB)):this.camera.inertialRadiusOffset+=kB),lN.preventDefault&&(NN||lN.preventDefault())},this._observer=this.camera.VB()._inputManager._addCameraPointerObserver(this._wheel,RN.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.nc(0)}qZ(){this._observer&&(this.camera.VB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const NN=this.camera;0+NN.inertialAlphaOffset+NN.inertialBetaOffset+NN.inertialRadiusOffset&&(this._updateHitPlane(),NN.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(NN.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const NN=this.camera,BN=NN.target.ZB(NN.position);this._hitPlane=KN.d.FromPositionAndNormal(NN.target,BN)}_getPosition(){const NN=this.camera,BN=NN.VB(),lN=BN.createPickingRay(BN.pointerX,BN.pointerY,eN.Matrix.Identity(),NN,!1);0===NN.targetScreenOffset.x&&0===NN.targetScreenOffset.y||(this._viewOffset.set(NN.targetScreenOffset.x,NN.targetScreenOffset.y,0),NN.getViewMatrix().invertToRef(NN._cameraTransformMatrix),this._globalOffset=eN.fB.TransformNormal(this._viewOffset,NN._cameraTransformMatrix),lN.origin.addInPlace(this._globalOffset));let kB=0;var qN;this._hitPlane&&(kB=null!==(qN=lN.intersectsPlane(this._hitPlane))&&void 0!==qN?qN:0);return lN.origin.addInPlace(lN.direction.scaleInPlace(kB))}_zoomToMouse(NN){const BN=this.camera,lN=1-BN.inertia;if(BN.lowerRadiusLimit){var kB;const qN=null!==(kB=BN.lowerRadiusLimit)&&void 0!==kB?kB:0;BN.radius-(BN.inertialRadiusOffset+NN)/lN<qN&&(NN=(BN.radius-qN)*lN-BN.inertialRadiusOffset)}if(BN.upperRadiusLimit){var qN;const kB=null!==(qN=BN.upperRadiusLimit)&&void 0!==qN?qN:0;BN.radius-(BN.inertialRadiusOffset+NN)/lN>kB&&(NN=(BN.radius-kB)*lN-BN.inertialRadiusOffset)}const cN=NN/lN/BN.radius,vN=this._getPosition(),HN=eN.TmpVectors.fB[6];vN.subtractToRef(BN.target,HN),HN.scaleInPlace(cN),HN.scaleInPlace(lN),this._inertialPanning.addInPlace(HN),BN.inertialRadiusOffset+=NN}_zeroIfClose(NN){Math.abs(NN.x)<VN.e&&(NN.x=0),Math.abs(NN.y)<VN.e&&(NN.y=0),Math.abs(NN.z)<VN.e&&(NN.z=0)}}(0,kB.c)([(0,qN.G)()],nN.prototype,"wheelPrecision",void 0),(0,kB.c)([(0,qN.G)()],nN.prototype,"zoomToMouseLocation",void 0),(0,kB.c)([(0,qN.G)()],nN.prototype,"wheelDeltaPercentage",void 0),MN.b.ArcRotateCameraMouseWheelInput=nN;class rN extends MN.f{constructor(NN){super(NN)}addMouseWheel(){return this.add(new nN),this}addPointers(){return this.add(new uN),this}addKeyboard(){return this.add(new EN),this}}var pN=lN(14881);function xN(NN,BN){return isNaN(NN)?BN:NN}HN.c.AddNodeConstructor("ArcRotateCamera",((NN,BN)=>()=>new ON(NN,0,0,1,eN.fB.Zero(),BN)));class ON extends AN.e{get target(){return this._target}set target(NN){this.setTarget(NN)}get targetHost(){return this._targetHost}set targetHost(NN){NN&&this.setTarget(NN)}getTarget(){return this.target}get position(){return this._position}set position(NN){this.setPosition(NN)}set upVector(NN){this._upToYMatrix||(this._yToUpMatrix=new eN.Matrix,this._upToYMatrix=new eN.Matrix,this._upVector=eN.fB.Zero()),NN.normalize(),this._upVector.kB(NN),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){eN.Matrix.RotationAlignToRef(eN.fB.UpReadOnly,this._upVector,this._yToUpMatrix),eN.Matrix.RotationAlignToRef(this._upVector,eN.fB.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const NN=this.inputs.attached.pointers;return NN?NN.angularSensibilityX:0}set angularSensibilityX(NN){const BN=this.inputs.attached.pointers;BN&&(BN.angularSensibilityX=NN)}get angularSensibilityY(){const NN=this.inputs.attached.pointers;return NN?NN.angularSensibilityY:0}set angularSensibilityY(NN){const BN=this.inputs.attached.pointers;BN&&(BN.angularSensibilityY=NN)}get pinchPrecision(){const NN=this.inputs.attached.pointers;return NN?NN.pinchPrecision:0}set pinchPrecision(NN){const BN=this.inputs.attached.pointers;BN&&(BN.pinchPrecision=NN)}get pinchDeltaPercentage(){const NN=this.inputs.attached.pointers;return NN?NN.pinchDeltaPercentage:0}set pinchDeltaPercentage(NN){const BN=this.inputs.attached.pointers;BN&&(BN.pinchDeltaPercentage=NN)}get useNaturalPinchZoom(){const NN=this.inputs.attached.pointers;return!!NN&&NN.useNaturalPinchZoom}set useNaturalPinchZoom(NN){const BN=this.inputs.attached.pointers;BN&&(BN.useNaturalPinchZoom=NN)}get panningSensibility(){const NN=this.inputs.attached.pointers;return NN?NN.panningSensibility:0}set panningSensibility(NN){const BN=this.inputs.attached.pointers;BN&&(BN.panningSensibility=NN)}get keysUp(){const NN=this.inputs.attached.keyboard;return NN?NN.keysUp:[]}set keysUp(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysUp=NN)}get keysDown(){const NN=this.inputs.attached.keyboard;return NN?NN.keysDown:[]}set keysDown(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysDown=NN)}get keysLeft(){const NN=this.inputs.attached.keyboard;return NN?NN.keysLeft:[]}set keysLeft(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysLeft=NN)}get keysRight(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRight:[]}set keysRight(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRight=NN)}get wheelPrecision(){const NN=this.inputs.attached.mousewheel;return NN?NN.wheelPrecision:0}set wheelPrecision(NN){const BN=this.inputs.attached.mousewheel;BN&&(BN.wheelPrecision=NN)}get zoomToMouseLocation(){const NN=this.inputs.attached.mousewheel;return!!NN&&NN.zoomToMouseLocation}set zoomToMouseLocation(NN){const BN=this.inputs.attached.mousewheel;BN&&(BN.zoomToMouseLocation=NN)}get wheelDeltaPercentage(){const NN=this.inputs.attached.mousewheel;return NN?NN.wheelDeltaPercentage:0}set wheelDeltaPercentage(NN){const BN=this.inputs.attached.mousewheel;BN&&(BN.wheelDeltaPercentage=NN)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(NN){NN!==this.useBouncingBehavior&&(NN?(this._bouncingBehavior=new CN,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(NN){NN!==this.useFramingBehavior&&(NN?(this._framingBehavior=new FN,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(NN){NN!==this.useAutoRotationBehavior&&(NN?(this._autoRotationBehavior=new fN,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(NN,BN,lN,kB,qN,vN){var HN;let TN=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(NN,eN.fB.Zero(),vN,TN),HN=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=eN.fB.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=eN.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new eN.Matrix,this.panningAxis=new eN.fB(1,1,0),this._transformedDirection=new eN.fB,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new cN.b,this.checkCollisions=!1,this.collisionRadius=new eN.fB(.5,.5,.5),this._previousPosition=eN.fB.Zero(),this._collisionVelocity=eN.fB.Zero(),this._newPosition=eN.fB.Zero(),this._computationVector=eN.fB.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new eN.fB(NaN,NaN,NaN),this._goalTargetScreenOffset=new eN.Vector2(NaN,NaN),this._onCollisionPositionChange=function(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;lN?(HN.setPosition(BN),HN.UP&&HN.UP(lN)):HN._previousPosition.kB(HN._position);const kB=Math.cos(HN.alpha),qN=Math.sin(HN.alpha),cN=Math.cos(HN.beta);let eN=Math.sin(HN.beta);0===eN&&(eN=1e-4);const vN=HN._getTargetPosition();HN._computationVector.Kc(HN.radius*kB*eN,HN.radius*cN,HN.radius*qN*eN),vN.addToRef(HN._computationVector,HN._newPosition),HN._position.kB(HN._newPosition);let TN=HN.upVector;HN.allowUpsideDown&&HN.beta<0&&(TN=TN.clone(),TN=TN.negate()),HN._computeViewMatrix(HN._position,vN,TN),HN._viewMatrix.addAtIndex(12,HN.targetScreenOffset.x),HN._viewMatrix.addAtIndex(13,HN.targetScreenOffset.y),HN._collisionTriggered=!1},this._target=eN.fB.Zero(),qN&&this.setTarget(qN),this.alpha=BN,this.beta=lN,this.radius=kB,this.getViewMatrix(),this.inputs=new rN(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new eN.fB(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=eN.Vector2.Zero()}_updateCache(NN){NN||super._updateCache(),this._cache._target.kB(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.kB(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const NN=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?NN.addToRef(this._targetBoundingCenter,this._target):this._target.kB(NN)}const NN=this._getLockedTargetPosition();return NN||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>VN.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){var NN,BN,lN,kB,qN,cN,eN;let HN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,TN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,RN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,sN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,VN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,fN=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=fN?this._currentInterpolationFactor=fN:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=xN(HN,this._goalAlpha),this._goalBeta=xN(TN,this._goalBeta),this._goalRadius=xN(RN,this._goalRadius),this._goalTarget.set(xN(sN.x,this._goalTarget.x),xN(sN.y,this._goalTarget.y),xN(sN.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(xN(VN.x,this._goalTargetScreenOffset.x),xN(VN.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,vN.Clamp)(this._goalAlpha,null!==(NN=this.lowerAlphaLimit)&&void 0!==NN?NN:-1/0,null!==(BN=this.upperAlphaLimit)&&void 0!==BN?BN:1/0),this._goalBeta=(0,vN.Clamp)(this._goalBeta,null!==(lN=this.lowerBetaLimit)&&void 0!==lN?lN:-1/0,null!==(kB=this.upperBetaLimit)&&void 0!==kB?kB:1/0),this._goalRadius=(0,vN.Clamp)(this._goalRadius,null!==(qN=this.lowerRadiusLimit)&&void 0!==qN?qN:-1/0,null!==(cN=this.upperRadiusLimit)&&void 0!==cN?cN:1/0),this._goalTarget.y=(0,vN.Clamp)(this._goalTarget.y,null!==(eN=this.lowerTargetYLimit)&&void 0!==eN?eN:-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(NN,BN){let lN=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const qN=arguments;BN=GN.Tools.BackCompatCameraNoPreventDefault(qN),this._useCtrlForPanning=lN,this._panningMouseButton=kB,"boolean"===typeof qN[0]&&(qN.length>1&&(this._useCtrlForPanning=qN[1]),qN.length>2&&(this._panningMouseButton=qN[2])),this.inputs.attachElement(BN),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}qZ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let NN=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){NN=!0;const BN=this.invertRotation?-1:1,lN=this._calculateHandednessMultiplier();let kB=this.inertialAlphaOffset*lN;this.beta<0&&(kB*=-1),this.alpha+=kB*BN,this.beta+=this.inertialBetaOffset*BN,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<VN.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<VN.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*VN.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){NN=!0;const BN=new eN.fB(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),BN.multiplyInPlace(this.panningAxis),eN.fB.TransformNormalToRef(BN,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const NN=this.upVector,BN=eN.fB.CrossToRef(this._transformedDirection,NN,this._transformedDirection);eN.fB.CrossToRef(NN,BN,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);eN.fB.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.kB(this._transformedDirection)}else{if(this.parent){const NN=eN.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(NN),NN.transposeToRef(NN),eN.fB.TransformCoordinatesToRef(this._transformedDirection,NN,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*VN.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*VN.e&&(this.inertialPanningY=0)}if(NN)this.stopInterpolation();else if(this._isInterpolating){let NN=!1;const BN=this._scene.getEngine().getDeltaTime()/1e3,lN=1-Math.pow(2,-BN/this._currentInterpolationFactor),kB=xN(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const BN=eN.TmpVectors.fB[0].set(xN(this._goalTarget.x,this._target.x),xN(this._goalTarget.y,this._target.y),xN(this._goalTarget.z,this._target.z));eN.fB.LerpToRef(this.target,BN,lN,this._target),10*eN.fB.Distance(this.target,BN)/kB<VN.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.kB(BN),this.setTarget(this.target,!1,!0,!0)):NN=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const BN=eN.Quaternion.RotationAlphaBetaGammaToRef(xN(this._goalAlpha,this.alpha),xN(this._goalBeta,this.beta),0,eN.TmpVectors.Quaternion[0]),kB=eN.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,eN.TmpVectors.Quaternion[1]),qN=eN.Quaternion.SlerpToRef(kB,BN,lN,eN.TmpVectors.Quaternion[2]);qN.normalize();const cN=qN.toAlphaBetaGammaToRef(eN.TmpVectors.fB[0]);if(this.alpha=cN.x,this.beta=cN.y,qN.isApprox(BN,VN.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const NN=BN.toAlphaBetaGammaToRef(eN.TmpVectors.fB[0]);this.alpha=NN.x,this.beta=NN.y}else NN=!0}if(isNaN(this._goalRadius)||(this.radius+=(kB-this.radius)*lN,Math.abs(kB/this.radius-1)<VN.e?(this._goalRadius=NaN,this.radius=kB):NN=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const BN=eN.TmpVectors.Vector2[0].set(xN(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),xN(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));eN.Vector2.LerpToRef(this.targetScreenOffset,BN,lN,this.targetScreenOffset),eN.Vector2.Distance(this.targetScreenOffset,BN)<VN.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.kB(BN)):NN=!0}this._isInterpolating=NN}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||eN.fB.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const NN=this.alpha;var BN,lN;this.alpha=function(NN){let BN=Math.PI/2;return 0===NN.x&&0===NN.z||(BN=Math.acos(NN.x/Math.sqrt(Math.pow(NN.x,2)+Math.pow(NN.z,2)))),NN.z<0&&(BN=2*Math.PI-BN),BN}(this._computationVector),this.beta=(BN=this._computationVector.y,lN=this.radius,Math.acos(BN/lN));const kB=Math.round((NN-this.alpha)/(2*Math.PI));this.alpha+=2*kB*Math.PI,this._checkLimits()}setPosition(NN){this._position.equals(NN)||(this._position.kB(NN),this.rebuildAnglesAndRadius())}setTarget(NN){var BN;let lN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],kB=arguments.length>2&&void 0!==arguments[2]&&arguments[2],qN=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(qN=null!==(BN=this.overrideCloneAlphaBetaRadius)&&void 0!==BN?BN:qN,NN.uc)lN&&NN.getBoundingInfo?this._targetBoundingCenter=NN.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,NN.uc(),this._targetHost=NN,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const BN=NN,lN=this._getTargetPosition();if(lN&&!kB&&lN.equals(BN))return;this._targetHost=null,this._target=BN,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}qN||this.rebuildAnglesAndRadius()}_getViewMatrix(){const NN=Math.cos(this.alpha),BN=Math.sin(this.alpha),lN=Math.cos(this.beta);let kB=Math.sin(this.beta);0===kB&&(kB=1e-4),0===this.radius&&(this.radius=1e-4);const qN=this._getTargetPosition();if(this._computationVector.Kc(this.radius*NN*kB,this.radius*lN,this.radius*BN*kB),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||eN.fB.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),qN.addToRef(this._computationVector,this._newPosition),this.VB().collisionsEnabled&&this.checkCollisions){const NN=this.VB().collisionCoordinator;this._collider||(this._collider=NN.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,NN.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.kB(this._newPosition);let NN=this.upVector;this.allowUpsideDown&&kB<0&&(NN=NN.negate()),this._computeViewMatrix(this._position,qN,NN),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.kB(qN),this._viewMatrix}zoomOn(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];NN=NN||this.VB().meshes;const lN=TN.e.MinMax(NN);let kB=this._calculateLowerRadiusFromModelBoundingSphere(lN.min,lN.max);if(kB=Math.max(Math.min(kB,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=kB*this.zoomOnFactor,this.mode===IN.c.ORTHOGRAPHIC_CAMERA){const NN=this.VB().getEngine().getAspectRatio(this),BN=kB*this.zoomOnFactor/2;this.orthoLeft=-BN*NN,this.orthoRight=BN*NN,this.orthoBottom=-BN,this.orthoTop=BN}this.focusOn({min:lN.min,max:lN.max,distance:kB},BN)}focusOn(NN){let BN,lN,kB=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===NN.min){const kB=NN||this.VB().meshes;BN=TN.e.MinMax(kB),lN=eN.fB.Distance(BN.min,BN.max)}else{BN=NN,lN=NN.distance}this._target=TN.e.Center(BN),kB||(this.Gc=2*lN)}createRigCamera(NN,BN){let lN=0;switch(this.cameraRigMode){case IN.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case IN.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case IN.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case IN.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case IN.c.RIG_MODE_VR:lN=this._cameraRigParams.stereoHalfAngle*(0===BN?1:-1);break;case IN.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:lN=this._cameraRigParams.stereoHalfAngle*(0===BN?-1:1)}const kB=new ON(NN,this.alpha+lN,this.beta,this.radius,this._target,this.VB());return kB._cameraRigParams={},kB.isRigCamera=!0,kB.rigParent=this,kB.upVector=this.upVector,kB.mode=this.mode,kB.orthoLeft=this.orthoLeft,kB.orthoRight=this.orthoRight,kB.orthoBottom=this.orthoBottom,kB.orthoTop=this.orthoTop,kB}_updateRigCameras(){const NN=this._rigCameras[0],BN=this._rigCameras[1];switch(NN.beta=BN.beta=this.beta,this.cameraRigMode){case IN.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case IN.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case IN.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case IN.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case IN.c.RIG_MODE_VR:NN.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,BN.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case IN.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:NN.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,BN.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const kB=eN.fB.Distance(NN,BN),qN=this.VB().getEngine().getAspectRatio(this),cN=Math.tan(this.fov/2),vN=cN*qN,HN=.5*kB*lN,TN=HN*Math.sqrt(1+1/(vN*vN)),RN=HN*Math.sqrt(1+1/(cN*cN));return Math.max(TN,RN)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,kB.c)([(0,qN.G)()],ON.prototype,"alpha",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"beta",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"radius",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,kB.c)([(0,qN.F)("target")],ON.prototype,"_target",void 0),(0,kB.c)([(0,qN.u)("targetHost")],ON.prototype,"_targetHost",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"inertialAlphaOffset",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"inertialBetaOffset",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"inertialRadiusOffset",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"lowerAlphaLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"upperAlphaLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"lowerBetaLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"upperBetaLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"lowerRadiusLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"upperRadiusLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"lowerTargetYLimit",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"inertialPanningX",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"inertialPanningY",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"pinchToPanMaxDistance",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"panningDistanceLimit",void 0),(0,kB.c)([(0,qN.F)()],ON.prototype,"panningOriginTarget",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"panningInertia",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"zoomToMouseLocation",null),(0,kB.c)([(0,qN.G)()],ON.prototype,"zoomOnFactor",void 0),(0,kB.c)([(0,qN.C)()],ON.prototype,"targetScreenOffset",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"allowUpsideDown",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"useInputToRestoreState",void 0),(0,kB.c)([(0,qN.G)()],ON.prototype,"restoreStateInterpolationFactor",void 0),(0,pN.f)("BABYLON.ArcRotateCamera",ON)},15790:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>eN,f:()=>vN});var kB=lN(14746),qN=lN(14959),cN=lN(15400),eN={};class vN{constructor(NN){this.attachedToElement=!1,this.attached={},this.camera=NN,this.checkInputs=()=>{}}add(NN){const BN=NN.getSimpleName();this.attached[BN]?kB.d.Warn("camera input of type "+BN+" already exists on camera"):(this.attached[BN]=NN,NN.camera=this.camera,NN.checkInputs&&(this.checkInputs=this._addCheckInputs(NN.checkInputs.bind(NN))),this.attachedToElement&&NN.attachControl(this.noPreventDefault))}remove(NN){for(const BN in this.attached){const lN=this.attached[BN];if(lN===NN)return lN.qZ(),lN.camera=null,delete this.attached[BN],void this.rebuildInputCheck()}}removeByType(NN){for(const BN in this.attached){const lN=this.attached[BN];lN.getClassName()===NN&&(lN.qZ(),lN.camera=null,delete this.attached[BN],this.rebuildInputCheck())}}_addCheckInputs(NN){const BN=this.checkInputs;return()=>{BN(),NN()}}attachInput(NN){this.attachedToElement&&NN.attachControl(this.noPreventDefault)}attachElement(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){NN=!cN.c.ForceAttachControlToAlwaysPreventDefault&&NN,this.attachedToElement=!0,this.noPreventDefault=NN;for(const BN in this.attached)this.attached[BN].attachControl(NN)}}detachElement(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const BN in this.attached)this.attached[BN].qZ(),NN&&(this.attached[BN].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const NN in this.attached){const BN=this.attached[NN];BN.checkInputs&&(this.checkInputs=this._addCheckInputs(BN.checkInputs.bind(BN)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(NN){const BN={};for(const lN in this.attached){const NN=this.attached[lN],kB=qN.b.Serialize(NN);BN[NN.getClassName()]=kB}NN.inputsmgr=BN}parse(NN){const BN=NN.inputsmgr;if(BN){this.clear();for(const NN in BN){const lN=eN[NN];if(lN){const kB=BN[NN],cN=qN.b.Parse((()=>new lN),kB,null);this.add(cN)}}}else for(const lN in this.attached){const BN=eN[this.attached[lN].getClassName()];if(BN){const kB=qN.b.Parse((()=>new BN),NN,null);this.remove(this.attached[lN]),this.add(kB)}}}}},15783:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>XN});var kB=lN(14905),qN=lN(14910),cN=lN(14925),eN=lN(15438),vN=lN(15790),HN=lN(15213),TN=lN(14727);class RN{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(NN){NN=TN.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.VB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((BN=>{const lN=BN.event;if(!lN.metaKey)if(BN.type===HN.b.KEYDOWN){if(-1!==this.keysUp.indexOf(lN.keyCode)||-1!==this.keysDown.indexOf(lN.keyCode)||-1!==this.keysLeft.indexOf(lN.keyCode)||-1!==this.keysRight.indexOf(lN.keyCode)||-1!==this.keysUpward.indexOf(lN.keyCode)||-1!==this.keysDownward.indexOf(lN.keyCode)||-1!==this.keysRotateLeft.indexOf(lN.keyCode)||-1!==this.keysRotateRight.indexOf(lN.keyCode)||-1!==this.keysRotateUp.indexOf(lN.keyCode)||-1!==this.keysRotateDown.indexOf(lN.keyCode)){-1===this._keys.indexOf(lN.keyCode)&&this._keys.push(lN.keyCode),NN||lN.preventDefault()}}else if(-1!==this.keysUp.indexOf(lN.keyCode)||-1!==this.keysDown.indexOf(lN.keyCode)||-1!==this.keysLeft.indexOf(lN.keyCode)||-1!==this.keysRight.indexOf(lN.keyCode)||-1!==this.keysUpward.indexOf(lN.keyCode)||-1!==this.keysDownward.indexOf(lN.keyCode)||-1!==this.keysRotateLeft.indexOf(lN.keyCode)||-1!==this.keysRotateRight.indexOf(lN.keyCode)||-1!==this.keysRotateUp.indexOf(lN.keyCode)||-1!==this.keysRotateDown.indexOf(lN.keyCode)){const BN=this._keys.indexOf(lN.keyCode);BN>=0&&this._keys.splice(BN,1),NN||lN.preventDefault()}})))}qZ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const NN=this.camera;for(let BN=0;BN<this._keys.length;BN++){const lN=this._keys[BN],kB=NN._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(lN)?NN._localDirection.Kc(-kB,0,0):-1!==this.keysUp.indexOf(lN)?NN._localDirection.Kc(0,0,kB):-1!==this.keysRight.indexOf(lN)?NN._localDirection.Kc(kB,0,0):-1!==this.keysDown.indexOf(lN)?NN._localDirection.Kc(0,0,-kB):-1!==this.keysUpward.indexOf(lN)?NN._localDirection.Kc(0,kB,0):-1!==this.keysDownward.indexOf(lN)?NN._localDirection.Kc(0,-kB,0):-1!==this.keysRotateLeft.indexOf(lN)?(NN._localDirection.Kc(0,0,0),NN.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(lN)?(NN._localDirection.Kc(0,0,0),NN.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(lN)?(NN._localDirection.Kc(0,0,0),NN.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(lN)&&(NN._localDirection.Kc(0,0,0),NN.cameraRotation.x+=this._getLocalRotation()),NN.VB().useRightHandedSystem&&(NN._localDirection.z*=-1),NN.getViewMatrix().invertToRef(NN._cameraTransformMatrix),cN.fB.TransformNormalToRef(NN._localDirection,NN._cameraTransformMatrix,NN._transformedDirection),NN.cameraDirection.addInPlace(NN._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const NN=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*NN}}(0,kB.c)([(0,qN.G)()],RN.prototype,"keysUp",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysUpward",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysDown",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysDownward",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysLeft",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysRight",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"rotationSpeed",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysRotateLeft",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysRotateRight",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysRotateUp",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"keysRotateDown",void 0),vN.b.FreeCameraKeyboardMoveInput=RN;var sN=lN(14731),VN=lN(15208);class fN{constructor(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=NN,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new sN.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(NN){NN=TN.Tools.BackCompatCameraNoPreventDefault(arguments);const BN=this.camera.getEngine(),lN=BN.getInputElement();this._pointerInput||(this._pointerInput=kB=>{const qN=kB.event,cN="touch"===qN.pointerType;if(!this.touchEnabled&&cN)return;if(kB.type!==VN.b.POINTERMOVE&&-1===this.buttons.indexOf(qN.button))return;const eN=qN.target;if(kB.type===VN.b.POINTERDOWN){if(cN&&-1!==this._activePointerId||!cN&&-1!==this._currentActiveButton)return;this._activePointerId=qN.pointerId;try{null===eN||void 0===eN||eN.setPointerCapture(qN.pointerId)}catch(vN){}-1===this._currentActiveButton&&(this._currentActiveButton=qN.button),this._previousPosition={x:qN.clientX,y:qN.clientY},NN||(qN.preventDefault(),lN&&lN.focus()),BN.isPointerLock&&this._onMouseMove&&this._onMouseMove(kB.event)}else if(kB.type===VN.b.POINTERUP){if(cN&&this._activePointerId!==qN.pointerId||!cN&&this._currentActiveButton!==qN.button)return;try{null===eN||void 0===eN||eN.releasePointerCapture(qN.pointerId)}catch(vN){}this._currentActiveButton=-1,this._previousPosition=null,NN||qN.preventDefault(),this._activePointerId=-1}else if(kB.type===VN.b.POINTERMOVE&&(this._activePointerId===qN.pointerId||!cN))if(BN.isPointerLock&&this._onMouseMove)this._onMouseMove(kB.event);else if(this._previousPosition){const BN=this.camera._calculateHandednessMultiplier(),lN=(qN.clientX-this._previousPosition.x)*BN,kB=qN.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=lN/this.angularSensibility,this.camera.cameraRotation.x+=kB/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:lN,offsetY:kB}),this._previousPosition={x:qN.clientX,y:qN.clientY},NN||qN.preventDefault()}}),this._onMouseMove=lN=>{if(!BN.isPointerLock)return;const kB=this.camera._calculateHandednessMultiplier(),qN=lN.movementX*kB;this.camera.cameraRotation.y+=qN/this.angularSensibility;const cN=lN.movementY;this.camera.cameraRotation.x+=cN/this.angularSensibility,this._previousPosition=null,NN||lN.preventDefault()},this._observer=this.camera.VB()._inputManager._addCameraPointerObserver(this._pointerInput,VN.b.POINTERDOWN|VN.b.POINTERUP|VN.b.POINTERMOVE),lN&&(this._contextMenuBind=NN=>this.onContextMenu(NN),lN.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(NN){NN.preventDefault()}qZ(){if(this._observer){if(this.camera.VB()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const NN=this.camera.getEngine().getInputElement();NN&&NN.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,kB.c)([(0,qN.G)()],fN.prototype,"buttons",void 0),(0,kB.c)([(0,qN.G)()],fN.prototype,"angularSensibility",void 0),vN.b.FreeCameraMouseInput=fN;var ZN,PN=lN(15220);class CN{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new sN.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(NN){NN=TN.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=BN=>{if(BN.type!==VN.b.POINTERWHEEL)return;const lN=BN.event,kB=lN.deltaMode===PN.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*kB*lN.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*kB*lN.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*kB*lN.deltaZ/this._normalize,lN.preventDefault&&(NN||lN.preventDefault())},this._observer=this.camera.VB()._inputManager._addCameraPointerObserver(this._wheel,VN.b.POINTERWHEEL)}qZ(){this._observer&&(this.camera.VB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,kB.c)([(0,qN.G)()],CN.prototype,"wheelPrecisionX",void 0),(0,kB.c)([(0,qN.G)()],CN.prototype,"wheelPrecisionY",void 0),(0,kB.c)([(0,qN.G)()],CN.prototype,"wheelPrecisionZ",void 0),function(NN){NN[NN.MoveRelative=0]="MoveRelative",NN[NN.RotateRelative=1]="RotateRelative",NN[NN.MoveScene=2]="MoveScene"}(ZN||(ZN={}));class FN extends CN{constructor(){super(...arguments),this._moveRelative=cN.fB.Zero(),this._rotateRelative=cN.fB.Zero(),this._moveScene=cN.fB.Zero(),this._wheelXAction=ZN.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=ZN.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(NN){null===NN&&this._wheelXAction!==ZN.MoveRelative||(this._wheelXAction=ZN.MoveRelative,this._wheelXActionCoordinate=NN)}get wheelXMoveRelative(){return this._wheelXAction!==ZN.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(NN){null===NN&&this._wheelYAction!==ZN.MoveRelative||(this._wheelYAction=ZN.MoveRelative,this._wheelYActionCoordinate=NN)}get wheelYMoveRelative(){return this._wheelYAction!==ZN.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(NN){null===NN&&this._wheelZAction!==ZN.MoveRelative||(this._wheelZAction=ZN.MoveRelative,this._wheelZActionCoordinate=NN)}get wheelZMoveRelative(){return this._wheelZAction!==ZN.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(NN){null===NN&&this._wheelXAction!==ZN.RotateRelative||(this._wheelXAction=ZN.RotateRelative,this._wheelXActionCoordinate=NN)}get wheelXRotateRelative(){return this._wheelXAction!==ZN.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(NN){null===NN&&this._wheelYAction!==ZN.RotateRelative||(this._wheelYAction=ZN.RotateRelative,this._wheelYActionCoordinate=NN)}get wheelYRotateRelative(){return this._wheelYAction!==ZN.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(NN){null===NN&&this._wheelZAction!==ZN.RotateRelative||(this._wheelZAction=ZN.RotateRelative,this._wheelZActionCoordinate=NN)}get wheelZRotateRelative(){return this._wheelZAction!==ZN.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(NN){null===NN&&this._wheelXAction!==ZN.MoveScene||(this._wheelXAction=ZN.MoveScene,this._wheelXActionCoordinate=NN)}get wheelXMoveScene(){return this._wheelXAction!==ZN.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(NN){null===NN&&this._wheelYAction!==ZN.MoveScene||(this._wheelYAction=ZN.MoveScene,this._wheelYActionCoordinate=NN)}get wheelYMoveScene(){return this._wheelYAction!==ZN.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(NN){null===NN&&this._wheelZAction!==ZN.MoveScene||(this._wheelZAction=ZN.MoveScene,this._wheelZActionCoordinate=NN)}get wheelZMoveScene(){return this._wheelZAction!==ZN.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.nc(0),this._rotateRelative.nc(0),this._moveScene.nc(0),this._updateCamera(),this.camera.VB().useRightHandedSystem&&(this._moveRelative.z*=-1);const NN=cN.Matrix.Zero();this.camera.getViewMatrix().invertToRef(NN);const BN=cN.fB.Zero();cN.fB.TransformNormalToRef(this._moveRelative,NN,BN),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(BN),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(NN,BN,lN){if(0===NN)return;if(null===BN||null===lN)return;let kB=null;switch(BN){case ZN.MoveRelative:kB=this._moveRelative;break;case ZN.RotateRelative:kB=this._rotateRelative;break;case ZN.MoveScene:kB=this._moveScene}switch(lN){case 0:kB.set(NN,0,0);break;case 1:kB.set(0,NN,0);break;case 2:kB.set(0,0,NN)}}}(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelXMoveRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelYMoveRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelZMoveRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelXRotateRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelYRotateRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelZRotateRelative",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelXMoveScene",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelYMoveScene",null),(0,kB.c)([(0,qN.G)()],FN.prototype,"wheelZMoveScene",null),vN.b.FreeCameraMouseWheelInput=FN;class IN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=NN,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=TN.Tools.IsSafari()}attachControl(NN){NN=TN.Tools.BackCompatCameraNoPreventDefault(arguments);let BN=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=lN=>{const kB=lN.event,qN="mouse"===kB.pointerType||this._isSafari&&"undefined"===typeof kB.pointerType;if(this.allowMouse||!qN)if(lN.type===VN.b.POINTERDOWN){if(NN||kB.preventDefault(),this._pointerPressed.push(kB.pointerId),1!==this._pointerPressed.length)return;BN={x:kB.clientX,y:kB.clientY}}else if(lN.type===VN.b.POINTERUP){NN||kB.preventDefault();const lN=this._pointerPressed.indexOf(kB.pointerId);if(-1===lN)return;if(this._pointerPressed.splice(lN,1),0!=lN)return;BN=null,this._offsetX=null,this._offsetY=null}else if(lN.type===VN.b.POINTERMOVE){if(NN||kB.preventDefault(),!BN)return;if(0!=this._pointerPressed.indexOf(kB.pointerId))return;this._offsetX=kB.clientX-BN.x,this._offsetY=-(kB.clientY-BN.y)}}),this._observer=this.camera.VB()._inputManager._addCameraPointerObserver(this._pointerInput,VN.b.POINTERDOWN|VN.b.POINTERUP|VN.b.POINTERMOVE),this._onLostFocus){const NN=this.camera.getEngine().getInputElement();NN&&NN.addEventListener("blur",this._onLostFocus)}}qZ(){if(this._pointerInput){if(this._observer&&(this.camera.VB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const NN=this.camera.getEngine().getInputElement();NN&&NN.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const NN=this.camera,BN=NN._calculateHandednessMultiplier();NN.cameraRotation.y=BN*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)NN.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const BN=NN._computeLocalCameraSpeed(),lN=new cN.fB(0,0,0!==this.touchMoveSensibility?BN*this._offsetY/this.touchMoveSensibility:0);cN.Matrix.RotationYawPitchRollToRef(NN.rotation.y,NN.rotation.x,0,NN._cameraRotationMatrix),NN.cameraDirection.addInPlace(cN.fB.TransformCoordinates(lN,NN._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,kB.c)([(0,qN.G)()],IN.prototype,"touchAngularSensibility",void 0),(0,kB.c)([(0,qN.G)()],IN.prototype,"touchMoveSensibility",void 0),vN.b.FreeCameraTouchInput=IN;class AN extends vN.f{constructor(NN){super(NN),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new RN),this}addMouse(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new fN(NN),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new FN,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new IN),this}clear(){super.clear(),this._mouseInput=null}}var MN=lN(14881),GN=lN(14818);class XN extends eN.e{get angularSensibility(){const NN=this.inputs.attached.mouse;return NN?NN.angularSensibility:0}set angularSensibility(NN){const BN=this.inputs.attached.mouse;BN&&(BN.angularSensibility=NN)}get keysUp(){const NN=this.inputs.attached.keyboard;return NN?NN.keysUp:[]}set keysUp(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysUp=NN)}get keysUpward(){const NN=this.inputs.attached.keyboard;return NN?NN.keysUpward:[]}set keysUpward(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysUpward=NN)}get keysDown(){const NN=this.inputs.attached.keyboard;return NN?NN.keysDown:[]}set keysDown(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysDown=NN)}get keysDownward(){const NN=this.inputs.attached.keyboard;return NN?NN.keysDownward:[]}set keysDownward(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysDownward=NN)}get keysLeft(){const NN=this.inputs.attached.keyboard;return NN?NN.keysLeft:[]}set keysLeft(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysLeft=NN)}get keysRight(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRight:[]}set keysRight(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRight=NN)}get keysRotateLeft(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRotateLeft:[]}set keysRotateLeft(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRotateLeft=NN)}get keysRotateRight(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRotateRight:[]}set keysRotateRight(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRotateRight=NN)}get keysRotateUp(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRotateUp:[]}set keysRotateUp(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRotateUp=NN)}get keysRotateDown(){const NN=this.inputs.attached.keyboard;return NN?NN.keysRotateDown:[]}set keysRotateDown(NN){const BN=this.inputs.attached.keyboard;BN&&(BN.keysRotateDown=NN)}constructor(NN,BN,lN){var kB;super(NN,BN,lN,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),kB=this,this.ellipsoid=new cN.fB(.5,1,.5),this.ellipsoidOffset=new cN.fB(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=cN.fB.Zero(),this._diffPosition=cN.fB.Zero(),this._newPosition=cN.fB.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;kB._newPosition.kB(BN),kB._newPosition.subtractToRef(kB._oldPosition,kB._diffPosition),kB._diffPosition.length()>GN.c.CollisionsEpsilon&&(kB.position.addToRef(kB._diffPosition,kB._deferredPositionUpdate),kB._deferOnly?kB._deferredUpdated=!0:kB.position.kB(kB._deferredPositionUpdate),kB.UP&&lN&&kB.UP(lN))},this.inputs=new AN(this),this.inputs.addKeyboard().addMouse()}attachControl(NN,BN){BN=TN.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(BN)}qZ(){this.inputs.detachElement(),this.cameraDirection=new cN.fB(0,0,0),this.cameraRotation=new cN.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(NN){this._collisionMask=isNaN(NN)?-1:NN}_collideWithWorld(NN){let BN;BN=this.parent?cN.fB.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,BN.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const lN=this.VB().collisionCoordinator;this._collider||(this._collider=lN.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let kB=NN;this.applyGravity&&(kB=NN.add(this.VB().gravity)),lN.getNewPosition(this._oldPosition,kB,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=cN.fB.Zero(),this._transformedDirection=cN.fB.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(NN){this._needMoveForGravity=NN}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.VB().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Lc"}}(0,kB.c)([(0,qN.F)()],XN.prototype,"ellipsoid",void 0),(0,kB.c)([(0,qN.F)()],XN.prototype,"ellipsoidOffset",void 0),(0,kB.c)([(0,qN.G)()],XN.prototype,"checkCollisions",void 0),(0,kB.c)([(0,qN.G)()],XN.prototype,"applyGravity",void 0),(0,MN.f)("BABYLON.FreeCamera",XN)},16805:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>cN});var kB=lN(15021),qN=lN(16808);class cN{constructor(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=lN,this.JV=[],this._maxBlockCapacity=BN||64,this._selectionContent=new kB.d(1024),this._creationFunc=NN}update(NN,BN,lN){qN.e._CreateBlocks(NN,BN,lN,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}BV(NN){for(let BN=0;BN<this.RV.length;BN++){this.RV[BN].addEntry(NN)}}ts(NN){for(let BN=0;BN<this.RV.length;BN++){this.RV[BN].removeEntry(NN)}}select(NN,BN){this._selectionContent.reset();for(let lN=0;lN<this.RV.length;lN++){this.RV[lN].select(NN,this._selectionContent,BN)}return BN?this._selectionContent.concat(this.JV):this._selectionContent.concatWithNoDuplicate(this.JV),this._selectionContent}intersects(NN,BN,lN){this._selectionContent.reset();for(let kB=0;kB<this.RV.length;kB++){this.RV[kB].intersects(NN,BN,this._selectionContent,lN)}return lN?this._selectionContent.concat(this.JV):this._selectionContent.concatWithNoDuplicate(this.JV),this._selectionContent}intersectsRay(NN){this._selectionContent.reset();for(let BN=0;BN<this.RV.length;BN++){this.RV[BN].intersectsRay(NN,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.JV),this._selectionContent}}cN.CreationFuncForMeshes=(NN,BN)=>{const lN=NN.getBoundingInfo();!NN.isBlocked&&lN.boundingBox.intersectsMinMax(BN.lf,BN.kZ)&&BN.entries.push(NN)},cN.CreationFuncForSubMeshes=(NN,BN)=>{NN.getBoundingInfo().boundingBox.intersectsMinMax(BN.lf,BN.kZ)&&BN.entries.push(NN)}},16808:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>cN});var kB=lN(14925),qN=lN(15284);class cN{constructor(NN,BN,lN,kB,qN,cN){this.entries=[],this.qf=new Array,this._capacity=lN,this._depth=kB,this._maxDepth=qN,this._creationFunc=cN,this._minPoint=NN,this._maxPoint=BN,this.qf.push(NN.clone()),this.qf.push(BN.clone()),this.qf.push(NN.clone()),this.qf[2].x=BN.x,this.qf.push(NN.clone()),this.qf[3].y=BN.y,this.qf.push(NN.clone()),this.qf[4].z=BN.z,this.qf.push(BN.clone()),this.qf[5].z=NN.z,this.qf.push(BN.clone()),this.qf[6].x=NN.x,this.qf.push(BN.clone()),this.qf[7].y=NN.y}get Fl(){return this._capacity}get lf(){return this._minPoint}get kZ(){return this._maxPoint}addEntry(NN){if(this.RV)for(let BN=0;BN<this.RV.length;BN++){this.RV[BN].addEntry(NN)}else this._creationFunc(NN,this),this.entries.length>this.Fl&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(NN){if(this.RV){for(let BN=0;BN<this.RV.length;BN++){this.RV[BN].removeEntry(NN)}return}const BN=this.entries.indexOf(NN);BN>-1&&this.entries.splice(BN,1)}addEntries(NN){for(let BN=0;BN<NN.length;BN++){const lN=NN[BN];this.addEntry(lN)}}select(NN,BN,lN){if(qN.e.IsInFrustum(this.qf,NN)){if(this.RV){for(let kB=0;kB<this.RV.length;kB++){this.RV[kB].select(NN,BN,lN)}return}lN?BN.concat(this.entries):BN.concatWithNoDuplicate(this.entries)}}intersects(NN,BN,lN,kB){if(qN.e.IntersectsSphere(this._minPoint,this._maxPoint,NN,BN)){if(this.RV){for(let qN=0;qN<this.RV.length;qN++){this.RV[qN].intersects(NN,BN,lN,kB)}return}kB?lN.concat(this.entries):lN.concatWithNoDuplicate(this.entries)}}intersectsRay(NN,BN){if(NN.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.RV){for(let lN=0;lN<this.RV.length;lN++){this.RV[lN].intersectsRay(NN,BN)}return}BN.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){cN._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(NN,BN,lN,qN,eN,vN,HN,TN){HN.RV=new Array;const RN=new kB.fB((BN.x-NN.x)/2,(BN.y-NN.y)/2,(BN.z-NN.z)/2);for(let kB=0;kB<2;kB++)for(let BN=0;BN<2;BN++)for(let sN=0;sN<2;sN++){const VN=NN.add(RN.multiplyByFloats(kB,BN,sN)),fN=NN.add(RN.multiplyByFloats(kB+1,BN+1,sN+1)),ZN=new cN(VN,fN,qN,eN+1,vN,TN);ZN.addEntries(lN),HN.RV.push(ZN)}}}},16816:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>RN});var kB=lN(15162),qN=lN(14925),cN=lN(15375),eN=lN(16047),vN=lN(15200),HN=lN(16805),TN=lN(14773);kB.d.prototype.createOrUpdateSelectionOctree=function(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,lN=this._getComponent(vN.c.NAME_OCTREE);lN||(lN=new RN(this),this.mc(lN)),this.tV||(this.tV=new HN.e(HN.e.CreationFuncForMeshes,NN,BN));const kB=this.getWorldExtends();return this.tV.update(kB.min,kB.max,this.meshes),this.tV},Object.defineProperty(kB.d.prototype,"selectionOctree",{get:function(){return this.tV},enumerable:!0,configurable:!0}),cN.e.prototype.createOrUpdateSubmeshesOctree=function(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const lN=this.VB();let kB=lN._getComponent(vN.c.NAME_OCTREE);kB||(kB=new RN(lN),lN.mc(kB)),this._submeshesOctree||(this._submeshesOctree=new HN.e(HN.e.CreationFuncForSubMeshes,NN,BN)),this.uc(!0);const qN=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(qN.minimumWorld,qN.maximumWorld,this.Pc),this._submeshesOctree};class RN{constructor(NN){this.name=vN.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new eN.d(qN.fB.Zero(),new qN.fB(1,1,1)),(NN=NN||TN.b.LastCreatedScene)&&(this.PB=NN,this.PB.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.PB.getActiveSubMeshCandidates=NN=>this.getActiveSubMeshCandidates(NN),this.PB.getCollidingSubMeshCandidates=(NN,BN)=>this.getCollidingSubMeshCandidates(NN,BN),this.PB.getIntersectingSubMeshCandidates=(NN,BN)=>this.getIntersectingSubMeshCandidates(NN,BN))}register(){this.PB.onMeshRemovedObservable.add((NN=>{const BN=this.PB.selectionOctree;if(void 0!==BN&&null!==BN){const lN=BN.JV.indexOf(NN);-1!==lN&&BN.JV.splice(lN,1)}})),this.PB.onMeshImportedObservable.add((NN=>{const BN=this.PB.selectionOctree;void 0!==BN&&null!==BN&&BN.BV(NN)}))}getActiveMeshCandidates(){var NN;return(null===(NN=this.PB.tV)||void 0===NN?void 0:NN.select(this.PB.frustumPlanes))||this.PB._getDefaultMeshCandidates()}getActiveSubMeshCandidates(NN){if(NN._submeshesOctree&&NN.useOctreeForRenderingSelection){return NN._submeshesOctree.select(this.PB.frustumPlanes)}return this.PB._getDefaultSubMeshCandidates(NN)}getIntersectingSubMeshCandidates(NN,BN){if(NN._submeshesOctree&&NN.useOctreeForPicking){eN.d.TransformToRef(BN,NN.getWorldMatrix(),this._tempRay);return NN._submeshesOctree.intersectsRay(this._tempRay)}return this.PB._getDefaultSubMeshCandidates(NN)}getCollidingSubMeshCandidates(NN,BN){if(NN._submeshesOctree&&NN.useOctreeForCollisions){const lN=BN._velocityWorldLength+Math.max(BN._radius.x,BN._radius.y,BN._radius.z);return NN._submeshesOctree.intersects(BN._basePointWorld,lN)}return this.PB._getDefaultSubMeshCandidates(NN)}rebuild(){}dispose(){}}},16047:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>fN});var kB=lN(15162),qN=lN(15400),cN=lN(14934),eN=lN(14925),vN=lN(14936),HN=lN(15272),TN=lN(15191),RN=lN(14773),sN=lN(15229);const VN={internalPickerForMesh:void 0};class fN{constructor(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cN.e;this.origin=NN,this.direction=BN,this.length=lN,this.epsilon=kB}clone(){return new fN(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const kB=fN._TmpVector3[0].Kc(NN.x-lN,NN.y-lN,NN.z-lN),qN=fN._TmpVector3[1].Kc(BN.x+lN,BN.y+lN,BN.z+lN);let cN,eN,vN,HN,TN=0,RN=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<kB.x||this.origin.x>qN.x)return!1}else if(cN=1/this.direction.x,eN=(kB.x-this.origin.x)*cN,vN=(qN.x-this.origin.x)*cN,vN===-1/0&&(vN=1/0),eN>vN&&(HN=eN,eN=vN,vN=HN),TN=Math.max(eN,TN),RN=Math.min(vN,RN),TN>RN)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<kB.y||this.origin.y>qN.y)return!1}else if(cN=1/this.direction.y,eN=(kB.y-this.origin.y)*cN,vN=(qN.y-this.origin.y)*cN,vN===-1/0&&(vN=1/0),eN>vN&&(HN=eN,eN=vN,vN=HN),TN=Math.max(eN,TN),RN=Math.min(vN,RN),TN>RN)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<kB.z||this.origin.z>qN.z)return!1}else if(cN=1/this.direction.z,eN=(kB.z-this.origin.z)*cN,vN=(qN.z-this.origin.z)*cN,vN===-1/0&&(vN=1/0),eN>vN&&(HN=eN,eN=vN,vN=HN),TN=Math.max(eN,TN),RN=Math.min(vN,RN),TN>RN)return!1;return!0}intersectsBox(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(NN.minimum,NN.maximum,BN)}intersectsSphere(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const lN=NN.center.x-this.origin.x,kB=NN.center.y-this.origin.y,qN=NN.center.z-this.origin.z,cN=lN*lN+kB*kB+qN*qN,eN=NN.radius+BN,vN=eN*eN;if(cN<=vN)return!0;const HN=lN*this.direction.x+kB*this.direction.y+qN*this.direction.z;if(HN<0)return!1;return cN-HN*HN<=vN}intersectsTriangle(NN,BN,lN){const kB=fN._TmpVector3[0],qN=fN._TmpVector3[1],cN=fN._TmpVector3[2],vN=fN._TmpVector3[3],TN=fN._TmpVector3[4];BN.subtractToRef(NN,kB),lN.subtractToRef(NN,qN),eN.fB.CrossToRef(this.direction,qN,cN);const RN=eN.fB.Dot(kB,cN);if(0===RN)return null;const sN=1/RN;this.origin.subtractToRef(NN,vN);const VN=eN.fB.Dot(vN,cN)*sN;if(VN<-this.epsilon||VN>1+this.epsilon)return null;eN.fB.CrossToRef(vN,kB,TN);const ZN=eN.fB.Dot(this.direction,TN)*sN;if(ZN<-this.epsilon||VN+ZN>1+this.epsilon)return null;const PN=eN.fB.Dot(qN,TN)*sN;return PN>this.length?null:new HN.d(1-VN-ZN,VN,PN)}intersectsPlane(NN){let BN;const lN=eN.fB.Dot(NN.normal,this.direction);if(Math.abs(lN)<9.99999997475243e-7)return null;{const kB=eN.fB.Dot(NN.normal,this.origin);return BN=(-NN.d-kB)/lN,BN<0?BN<-9.99999997475243e-7?null:0:BN}}intersectsAxis(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(NN){case"y":{const NN=(this.origin.y-BN)/this.direction.y;return NN>0?null:new eN.fB(this.origin.x+this.direction.x*-NN,BN,this.origin.z+this.direction.z*-NN)}case"x":{const NN=(this.origin.x-BN)/this.direction.x;return NN>0?null:new eN.fB(BN,this.origin.y+this.direction.y*-NN,this.origin.z+this.direction.z*-NN)}case"z":{const NN=(this.origin.z-BN)/this.direction.z;return NN>0?null:new eN.fB(this.origin.x+this.direction.x*-NN,this.origin.y+this.direction.y*-NN,BN)}default:return null}}intersectsMesh(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],qN=arguments.length>4?arguments[4]:void 0,cN=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const vN=eN.TmpVectors.Matrix[0];return NN.getWorldMatrix().invertToRef(vN),this._tmpRay?fN.TransformToRef(this,vN,this._tmpRay):this._tmpRay=fN.Transform(this,vN),NN.intersects(this._tmpRay,BN,lN,kB,qN,cN)}intersectsMeshes(NN,BN,lN){lN?lN.length=0:lN=[];for(let kB=0;kB<NN.length;kB++){const qN=this.intersectsMesh(NN[kB],BN);qN.hit&&lN.push(qN)}return lN.sort(this._comparePickingInfo),lN}_comparePickingInfo(NN,BN){return NN.distance<BN.distance?-1:NN.distance>BN.distance?1:0}intersectionSegment(NN,BN,lN){const kB=this.origin,qN=eN.TmpVectors.fB[0],cN=eN.TmpVectors.fB[1],vN=eN.TmpVectors.fB[2],HN=eN.TmpVectors.fB[3];BN.subtractToRef(NN,qN),this.direction.scaleToRef(fN._Rayl,vN),kB.addToRef(vN,cN),NN.subtractToRef(kB,HN);const TN=eN.fB.Dot(qN,qN),RN=eN.fB.Dot(qN,vN),sN=eN.fB.Dot(vN,vN),VN=eN.fB.Dot(qN,HN),ZN=eN.fB.Dot(vN,HN),PN=TN*sN-RN*RN;let CN,FN,IN=PN,AN=PN;PN<fN._Smallnum?(CN=0,IN=1,FN=ZN,AN=sN):(CN=RN*ZN-sN*VN,FN=TN*ZN-RN*VN,CN<0?(CN=0,FN=ZN,AN=sN):CN>IN&&(CN=IN,FN=ZN+RN,AN=sN)),FN<0?(FN=0,-VN<0?CN=0:-VN>TN?CN=IN:(CN=-VN,IN=TN)):FN>AN&&(FN=AN,-VN+RN<0?CN=0:-VN+RN>TN?CN=IN:(CN=-VN+RN,IN=TN));const MN=Math.abs(CN)<fN._Smallnum?0:CN/IN,GN=Math.abs(FN)<fN._Smallnum?0:FN/AN,XN=eN.TmpVectors.fB[4];vN.scaleToRef(GN,XN);const uN=eN.TmpVectors.fB[5];qN.scaleToRef(MN,uN),uN.addInPlace(HN);const dN=eN.TmpVectors.fB[6];uN.subtractToRef(XN,dN);return GN>0&&GN<=this.length&&dN.lengthSquared()<lN*lN?uN.length():-1}update(NN,BN,lN,kB,qN,cN,vN){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){fN._RayDistant||(fN._RayDistant=fN.Zero()),fN._RayDistant.unprojectRayToRef(NN,BN,lN,kB,eN.Matrix.IdentityReadOnly,cN,vN);const HN=eN.TmpVectors.Matrix[0];qN.invertToRef(HN),fN.TransformToRef(fN._RayDistant,HN,this)}else this.unprojectRayToRef(NN,BN,lN,kB,qN,cN,vN);return this}static Zero(){return new fN(eN.fB.Zero(),eN.fB.Zero())}static CreateNew(NN,BN,lN,kB,qN,cN,eN){return fN.Zero().update(NN,BN,lN,kB,qN,cN,eN)}static CreateNewFromTo(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eN.Matrix.IdentityReadOnly;const kB=new fN(new eN.fB(0,0,0),new eN.fB(0,0,0));return fN.CreateFromToToRef(NN,BN,kB,lN)}static CreateFromToToRef(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eN.Matrix.IdentityReadOnly;lN.origin.kB(NN);const qN=BN.subtractToRef(NN,lN.direction),cN=Math.sqrt(qN.x*qN.x+qN.y*qN.y+qN.z*qN.z);return lN.length=cN,lN.direction.normalize(),fN.TransformToRef(lN,kB,lN)}static Transform(NN,BN){const lN=new fN(new eN.fB(0,0,0),new eN.fB(0,0,0));return fN.TransformToRef(NN,BN,lN),lN}static TransformToRef(NN,BN,lN){eN.fB.TransformCoordinatesToRef(NN.origin,BN,lN.origin),eN.fB.TransformNormalToRef(NN.direction,BN,lN.direction),lN.length=NN.length,lN.epsilon=NN.epsilon;const kB=lN.direction,qN=kB.length();if(0!==qN&&1!==qN){const NN=1/qN;kB.x*=NN,kB.y*=NN,kB.z*=NN,lN.length*=qN}return lN}unprojectRayToRef(NN,BN,lN,kB,qN,cN,vN){const HN=eN.TmpVectors.Matrix[0];qN.multiplyToRef(cN,HN),HN.multiplyToRef(vN,HN),HN.invert();const TN=RN.b.LastCreatedEngine,sN=eN.TmpVectors.fB[0];sN.x=NN/lN*2-1,sN.y=-(BN/kB*2-1),sN.z=null!==TN&&void 0!==TN&&TN.Nc?1:null!==TN&&void 0!==TN&&TN.isNDCHalfZRange?0:-1;const VN=eN.TmpVectors.fB[1].Kc(sN.x,sN.y,1-1e-8),fN=eN.TmpVectors.fB[2],ZN=eN.TmpVectors.fB[3];eN.fB._UnprojectFromInvertedMatrixToRef(sN,HN,fN),eN.fB._UnprojectFromInvertedMatrixToRef(VN,HN,ZN),this.origin.kB(fN),ZN.subtractToRef(fN,this.direction),this.direction.normalize()}}function ZN(NN,BN,lN,kB,qN){let cN=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const eN=fN.Zero();return PN(NN,BN,lN,kB,eN,qN,cN),eN}function PN(NN,BN,lN,kB,qN,cN){let vN=arguments.length>6&&void 0!==arguments[6]&&arguments[6],HN=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const TN=NN.getEngine();if(!cN&&!(cN=NN.activeCamera))return NN;const RN=cN.viewport,sN=TN.getRenderHeight(),{x:VN,y:fN,width:ZN,height:PN}=RN.toGlobal(TN.getRenderWidth(),sN),CN=1/TN.getHardwareScalingLevel();return BN=BN*CN-VN,lN=lN*CN-(sN-fN-PN),qN.update(BN,lN,ZN,PN,kB||eN.Matrix.IdentityReadOnly,vN?eN.Matrix.IdentityReadOnly:cN.getViewMatrix(),cN.getProjectionMatrix(),HN),NN}function CN(NN,BN,lN,kB,qN){if(!TN.c)return NN;const cN=NN.getEngine();if(!qN&&!(qN=NN.activeCamera))throw new Error("Active camera not set");const vN=qN.viewport,HN=cN.getRenderHeight(),{x:RN,y:sN,width:VN,height:fN}=vN.toGlobal(cN.getRenderWidth(),HN),ZN=eN.Matrix.Identity(),PN=1/cN.getHardwareScalingLevel();return BN=BN*PN-RN,lN=lN*PN-(HN-sN-fN),kB.update(BN,lN,VN,fN,ZN,ZN,qN.getProjectionMatrix()),NN}function FN(NN,BN,lN,kB,qN,cN,eN,vN){const HN=BN(kB,lN.enableDistantPicking),TN=lN.intersects(HN,qN,eN,cN,kB,vN);return TN&&TN.hit?!qN&&null!=NN&&TN.distance>=NN.distance?null:TN:null}function IN(NN,BN,lN,kB,qN,cN){let vN=null;const HN=!!(NN.activeCameras&&NN.activeCameras.length>1&&NN.cameraToUseForPointers!==NN.activeCamera),RN=NN.cameraToUseForPointers||NN.activeCamera,sN=VN.internalPickerForMesh||FN;for(let TN=0;TN<NN.meshes.length;TN++){const VN=NN.meshes[TN];if(lN){if(!lN(VN,-1))continue}else if(!VN.isEnabled()||!VN.isVisible||!VN.nR)continue;const fN=HN&&VN.isWorldMatrixCameraDependent(),ZN=VN.uc(fN,RN);if(VN.hasThinInstances&&VN.Cs){const NN=sN(vN,BN,VN,ZN,!0,!0,cN);if(NN){if(qN)return NN;const HN=eN.TmpVectors.Matrix[1],TN=VN.thinInstanceGetWorldMatrices();for(let NN=0;NN<TN.length;NN++){if(lN&&!lN(VN,NN))continue;TN[NN].multiplyToRef(ZN,HN);const eN=sN(vN,BN,VN,HN,kB,qN,cN,!0);if(eN&&(vN=eN,vN.thinInstanceIndex=NN,kB))return vN}}}else{const NN=sN(vN,BN,VN,ZN,kB,qN,cN);if(NN&&(vN=NN,kB))return vN}}return vN||new TN.c}function AN(NN,BN,lN,kB){if(!TN.c)return null;const qN=[],cN=!!(NN.activeCameras&&NN.activeCameras.length>1&&NN.cameraToUseForPointers!==NN.activeCamera),vN=NN.cameraToUseForPointers||NN.activeCamera,HN=VN.internalPickerForMesh||FN;for(let TN=0;TN<NN.meshes.length;TN++){const RN=NN.meshes[TN];if(lN){if(!lN(RN,-1))continue}else if(!RN.isEnabled()||!RN.isVisible||!RN.nR)continue;const sN=cN&&RN.isWorldMatrixCameraDependent(),VN=RN.uc(sN,vN);if(RN.hasThinInstances&&RN.Cs){if(HN(null,BN,RN,VN,!0,!0,kB)){const NN=eN.TmpVectors.Matrix[1],cN=RN.thinInstanceGetWorldMatrices();for(let eN=0;eN<cN.length;eN++){if(lN&&!lN(RN,eN))continue;cN[eN].multiplyToRef(VN,NN);const vN=HN(null,BN,RN,NN,!1,!1,kB,!0);vN&&(vN.thinInstanceIndex=eN,qN.push(vN))}}}else{const NN=HN(null,BN,RN,VN,!1,!1,kB);NN&&qN.push(NN)}}return qN}function MN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,kB=arguments.length>3?arguments[3]:void 0,qN=arguments.length>4?arguments[4]:void 0;kB||(kB=NN.getWorldMatrix()),BN.length=lN,qN?BN.origin.kB(qN):BN.origin.kB(NN.position);const cN=eN.TmpVectors.fB[2];cN.set(0,0,NN._scene.useRightHandedSystem?-1:1);const vN=eN.TmpVectors.fB[3];return eN.fB.TransformNormalToRef(cN,kB,vN),eN.fB.NormalizeToRef(vN,BN.direction),BN}var GN,XN;fN._TmpVector3=(0,vN.d)(6,eN.fB.Zero),fN._RayDistant=fN.Zero(),fN._Smallnum=1e-8,fN._Rayl=1e9,GN=kB.d,(XN=qN.c)&&(XN.prototype.getForwardRay=function(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,BN=arguments.length>1?arguments[1]:void 0,lN=arguments.length>2?arguments[2]:void 0;return MN(this,new fN(eN.fB.Zero(),eN.fB.Zero(),NN),NN,BN,lN)},XN.prototype.getForwardRayToRef=function(NN){return MN(this,NN,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),GN&&(sN.d._IsPickingAvailable=!0,GN.prototype.createPickingRay=function(NN,BN,lN,kB){return ZN(this,NN,BN,lN,kB,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),kB.d.prototype.createPickingRayToRef=function(NN,BN,lN,kB,qN){return PN(this,NN,BN,lN,kB,qN,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},kB.d.prototype.createPickingRayInCameraSpace=function(NN,BN,lN){return function(NN,BN,lN,kB){const qN=fN.Zero();return CN(NN,BN,lN,qN,kB),qN}(this,NN,BN,lN)},kB.d.prototype.createPickingRayInCameraSpaceToRef=function(NN,BN,lN,kB){return CN(this,NN,BN,lN,kB)},kB.d.prototype.pickWithBoundingInfo=function(NN,BN,lN,kB,qN){return function(NN,BN,lN,kB,qN,cN){if(!TN.c)return null;const vN=IN(NN,(kB=>(NN._tempPickingRay||(NN._tempPickingRay=fN.Zero()),PN(NN,BN,lN,kB,NN._tempPickingRay,cN||null),NN._tempPickingRay)),kB,qN,!0);return vN&&(vN.ray=ZN(NN,BN,lN,eN.Matrix.Identity(),cN||null)),vN}(this,NN,BN,lN,kB,qN)},kB.d.prototype.fl=function(NN,BN,lN,kB,qN,cN){return function(NN,BN,lN,kB,qN,cN,vN){const HN=IN(NN,((kB,qN)=>(NN._tempPickingRay||(NN._tempPickingRay=fN.Zero()),PN(NN,BN,lN,kB,NN._tempPickingRay,cN||null,!1,qN),NN._tempPickingRay)),kB,qN,!1,vN);return HN&&(HN.ray=ZN(NN,BN,lN,eN.Matrix.Identity(),cN||null)),HN}(this,NN,BN,lN,kB,qN,cN)},kB.d.prototype.pickWithRay=function(NN,BN,lN,kB){return function(NN,BN,lN,kB,qN){const cN=IN(NN,(lN=>(NN._pickWithRayInverseMatrix||(NN._pickWithRayInverseMatrix=eN.Matrix.Identity()),lN.invertToRef(NN._pickWithRayInverseMatrix),NN._cachedRayForTransform||(NN._cachedRayForTransform=fN.Zero()),fN.TransformToRef(BN,NN._pickWithRayInverseMatrix,NN._cachedRayForTransform),NN._cachedRayForTransform)),lN,kB,!1,qN);return cN&&(cN.ray=BN),cN}(this,NN,BN,lN,kB)},kB.d.prototype.multiPick=function(NN,BN,lN,kB,qN){return function(NN,BN,lN,kB,qN,cN){return AN(NN,(kB=>ZN(NN,BN,lN,kB,qN||null)),kB,cN)}(this,NN,BN,lN,kB,qN)},kB.d.prototype.multiPickWithRay=function(NN,BN,lN){return function(NN,BN,lN,kB){return AN(NN,(lN=>(NN._pickWithRayInverseMatrix||(NN._pickWithRayInverseMatrix=eN.Matrix.Identity()),lN.invertToRef(NN._pickWithRayInverseMatrix),NN._cachedRayForTransform||(NN._cachedRayForTransform=fN.Zero()),fN.TransformToRef(BN,NN._pickWithRayInverseMatrix,NN._cachedRayForTransform),NN._cachedRayForTransform)),lN,kB)}(this,NN,BN,lN)}},15849:(NN,BN,lN)=>{"use strict";var kB=lN(14861),qN=lN(14746),cN=lN(14781),eN=lN(14885),vN=lN(14818),HN=lN(14875);vN.c.prototype._partialLoadFile=function(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(NN,(NN=>{lN[BN]=NN,lN._internalCount++,6===lN._internalCount&&kB(lN)}),void 0,void 0,!0,((NN,BN)=>{qN&&NN&&qN(NN.status+" "+NN.statusText,BN)}))},vN.c.prototype._cascadeLoadFiles=function(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const qN=[];qN._internalCount=0;for(let cN=0;cN<6;cN++)this._partialLoadFile(lN[cN],cN,qN,BN,kB)},vN.c.prototype._cascadeLoadImgs=function(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,cN=arguments.length>5?arguments[5]:void 0;const eN=[];eN._internalCount=0;for(let vN=0;vN<6;vN++)this._partialLoadImg(kB[vN],vN,eN,NN,BN,lN,qN,cN)},vN.c.prototype._partialLoadImg=function(NN,BN,lN,kB,qN,vN){let HN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,TN=arguments.length>7?arguments[7]:void 0;const RN=(0,eN.d)();(0,cN.u)(NN,(NN=>{lN[BN]=NN,lN._internalCount++,kB&&kB.removePendingData(RN),6===lN._internalCount&&vN&&vN(qN,lN)}),((NN,BN)=>{kB&&kB.removePendingData(RN),HN&&HN(NN,BN)}),kB?kB.offlineProvider:null,TN),kB&&kB.addPendingData(RN)},vN.c.prototype.createCubeTextureBase=function(NN,BN,lN,cN){let eN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,vN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,TN=arguments.length>6?arguments[6]:void 0,RN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,sN=arguments.length>8&&void 0!==arguments[8]&&arguments[8],VN=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,fN=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,ZN=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,PN=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,CN=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,FN=arguments.length>14&&void 0!==arguments[14]&&arguments[14],IN=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const AN=ZN||new kB.d(this,7);AN.isCube=!0,AN.url=NN,AN.generateMipMaps=!cN,AN._lodGenerationScale=VN,AN._lodGenerationOffset=fN,AN._useSRGBBuffer=!!FN&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!cN),AN!==ZN&&(AN.label=NN.substring(0,60)),this._doNotHandleContextLost||(AN._extension=RN,AN._files=lN,AN._buffer=IN);const MN=NN;this._transformTextureUrl&&!ZN&&(NN=this._transformTextureUrl(NN));const GN=null!==RN&&void 0!==RN?RN:function(NN){const BN=NN.split("?")[0],lN=BN.lastIndexOf(".");return lN>-1?BN.substring(lN).toLowerCase():""}(NN),XN=(0,HN.b)(GN),uN=(NN,BN)=>{AN.dispose(),vN?vN(NN,BN):NN&&qN.d.Warn(NN)},dN=(kB,vN)=>{NN===MN?kB&&uN(kB.status+" "+kB.statusText,vN):(qN.d.Warn("Failed to load ".concat(NN,", falling back to the ").concat(MN)),this.createCubeTextureBase(MN,BN,lN,!!cN,eN,uN,TN,RN,sN,VN,fN,AN,PN,CN,FN,IN))};if(XN)XN.then((kB=>{const qN=NN=>{PN&&PN(AN,NN),kB.loadCubeData(NN,AN,sN,eN,((NN,BN)=>{uN(NN,BN)}))};IN?qN(IN):lN&&6===lN.length?kB.supportCascades?this._cascadeLoadFiles(BN,(NN=>qN(NN.map((NN=>new Uint8Array(NN))))),lN,uN):uN("Textures type does not support cascades."):this._loadFile(NN,(NN=>qN(new Uint8Array(NN))),void 0,void 0,!0,dN)}));else{if(!lN||0===lN.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(BN,AN,((NN,BN)=>{CN&&CN(NN,BN)}),lN,uN)}return this._internalTexturesCache.push(AN),AN}},16825:(NN,BN,lN)=>{"use strict";lN(19),lN(14746);var kB=lN(15047);lN(14861),lN(15e3),lN(14852),lN(15095),lN(15057);kB.b},15884:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>qN});var kB=lN(14881);class qN{constructor(NN){this.value=this._toInt(NN)}_toInt(NN){return 0|NN}add(NN){return new qN(this.value+NN.value)}ZB(NN){return new qN(this.value-NN.value)}multiply(NN){return new qN(Math.imul(this.value,NN.value))}divide(NN){return new qN(this.value/NN.value)}getClassName(){return qN.ClassName}equals(NN){return this.value===NN.value}static FromValue(NN){return new qN(NN)}toString(){return this.value.toString()}}qN.ClassName="FlowGraphInteger",(0,kB.f)("FlowGraphInteger",qN)},15889:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>qN,c:()=>cN});var kB=lN(14925);class qN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.vc=NN}get m(){return this.vc}transformVector(NN){return this.transformVectorToRef(NN,new kB.Vector2)}transformVectorToRef(NN,BN){return BN.x=NN.x*this.vc[0]+NN.y*this.vc[1],BN.y=NN.x*this.vc[2]+NN.y*this.vc[3],BN}Fc(){return this.toArray()}toArray(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let BN=0;BN<4;BN++)NN[BN]=this.vc[BN];return NN}Zl(NN){for(let BN=0;BN<4;BN++)this.vc[BN]=NN[BN];return this}multiplyToRef(NN,BN){const lN=NN.vc,kB=this.vc,qN=BN.vc;return qN[0]=lN[0]*kB[0]+lN[1]*kB[2],qN[1]=lN[0]*kB[1]+lN[1]*kB[3],qN[2]=lN[2]*kB[0]+lN[3]*kB[2],qN[3]=lN[2]*kB[1]+lN[3]*kB[3],BN}multiply(NN){return this.multiplyToRef(NN,new qN)}divideToRef(NN,BN){const lN=this.vc,kB=NN.vc,qN=BN.vc;return qN[0]=lN[0]/kB[0],qN[1]=lN[1]/kB[1],qN[2]=lN[2]/kB[2],qN[3]=lN[3]/kB[3],BN}divide(NN){return this.divideToRef(NN,new qN)}addToRef(NN,BN){const lN=this.vc,kB=NN.m,qN=BN.m;return qN[0]=lN[0]+kB[0],qN[1]=lN[1]+kB[1],qN[2]=lN[2]+kB[2],qN[3]=lN[3]+kB[3],BN}add(NN){return this.addToRef(NN,new qN)}subtractToRef(NN,BN){const lN=this.vc,kB=NN.m,qN=BN.m;return qN[0]=lN[0]-kB[0],qN[1]=lN[1]-kB[1],qN[2]=lN[2]-kB[2],qN[3]=lN[3]-kB[3],BN}ZB(NN){return this.subtractToRef(NN,new qN)}transpose(){const NN=this.vc;return new qN([NN[0],NN[2],NN[1],NN[3]])}determinant(){const NN=this.vc;return NN[0]*NN[3]-NN[1]*NN[2]}inverse(){const NN=this.determinant();if(0===NN)throw new Error("Matrix is not invertible");const BN=this.vc,lN=1/NN;return new qN([BN[3]*lN,-BN[1]*lN,-BN[2]*lN,BN[0]*lN])}equals(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const lN=this.vc,kB=NN.m;return 0===BN?lN[0]===kB[0]&&lN[1]===kB[1]&&lN[2]===kB[2]&&lN[3]===kB[3]:Math.abs(lN[0]-kB[0])<BN&&Math.abs(lN[1]-kB[1])<BN&&Math.abs(lN[2]-kB[2])<BN&&Math.abs(lN[3]-kB[3])<BN}getClassName(){return"FlowGraphMatrix2D"}toString(){return"FlowGraphMatrix2D(".concat(this.vc.join(", "),")")}}class cN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.vc=NN}get m(){return this.vc}transformVector(NN){return this.transformVectorToRef(NN,new kB.fB)}transformVectorToRef(NN,BN){const lN=this.vc;return BN.x=NN.x*lN[0]+NN.y*lN[1]+NN.z*lN[2],BN.y=NN.x*lN[3]+NN.y*lN[4]+NN.z*lN[5],BN.z=NN.x*lN[6]+NN.y*lN[7]+NN.z*lN[8],BN}multiplyToRef(NN,BN){const lN=NN.vc,kB=this.vc,qN=BN.m;return qN[0]=lN[0]*kB[0]+lN[1]*kB[3]+lN[2]*kB[6],qN[1]=lN[0]*kB[1]+lN[1]*kB[4]+lN[2]*kB[7],qN[2]=lN[0]*kB[2]+lN[1]*kB[5]+lN[2]*kB[8],qN[3]=lN[3]*kB[0]+lN[4]*kB[3]+lN[5]*kB[6],qN[4]=lN[3]*kB[1]+lN[4]*kB[4]+lN[5]*kB[7],qN[5]=lN[3]*kB[2]+lN[4]*kB[5]+lN[5]*kB[8],qN[6]=lN[6]*kB[0]+lN[7]*kB[3]+lN[8]*kB[6],qN[7]=lN[6]*kB[1]+lN[7]*kB[4]+lN[8]*kB[7],qN[8]=lN[6]*kB[2]+lN[7]*kB[5]+lN[8]*kB[8],BN}multiply(NN){return this.multiplyToRef(NN,new cN)}divideToRef(NN,BN){const lN=this.vc,kB=NN.m,qN=BN.m;return qN[0]=lN[0]/kB[0],qN[1]=lN[1]/kB[1],qN[2]=lN[2]/kB[2],qN[3]=lN[3]/kB[3],qN[4]=lN[4]/kB[4],qN[5]=lN[5]/kB[5],qN[6]=lN[6]/kB[6],qN[7]=lN[7]/kB[7],qN[8]=lN[8]/kB[8],BN}divide(NN){return this.divideToRef(NN,new cN)}addToRef(NN,BN){const lN=this.vc,kB=NN.m,qN=BN.m;return qN[0]=lN[0]+kB[0],qN[1]=lN[1]+kB[1],qN[2]=lN[2]+kB[2],qN[3]=lN[3]+kB[3],qN[4]=lN[4]+kB[4],qN[5]=lN[5]+kB[5],qN[6]=lN[6]+kB[6],qN[7]=lN[7]+kB[7],qN[8]=lN[8]+kB[8],BN}add(NN){return this.addToRef(NN,new cN)}subtractToRef(NN,BN){const lN=this.vc,kB=NN.m,qN=BN.m;return qN[0]=lN[0]-kB[0],qN[1]=lN[1]-kB[1],qN[2]=lN[2]-kB[2],qN[3]=lN[3]-kB[3],qN[4]=lN[4]-kB[4],qN[5]=lN[5]-kB[5],qN[6]=lN[6]-kB[6],qN[7]=lN[7]-kB[7],qN[8]=lN[8]-kB[8],BN}ZB(NN){return this.subtractToRef(NN,new cN)}toArray(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let BN=0;BN<9;BN++)NN[BN]=this.vc[BN];return NN}Fc(){return this.toArray()}Zl(NN){for(let BN=0;BN<9;BN++)this.vc[BN]=NN[BN];return this}transpose(){const NN=this.vc;return new cN([NN[0],NN[3],NN[6],NN[1],NN[4],NN[7],NN[2],NN[5],NN[8]])}determinant(){const NN=this.vc;return NN[0]*(NN[4]*NN[8]-NN[5]*NN[7])-NN[1]*(NN[3]*NN[8]-NN[5]*NN[6])+NN[2]*(NN[3]*NN[7]-NN[4]*NN[6])}inverse(){const NN=this.determinant();if(0===NN)throw new Error("Matrix is not invertible");const BN=this.vc,lN=1/NN;return new cN([(BN[4]*BN[8]-BN[5]*BN[7])*lN,(BN[2]*BN[7]-BN[1]*BN[8])*lN,(BN[1]*BN[5]-BN[2]*BN[4])*lN,(BN[5]*BN[6]-BN[3]*BN[8])*lN,(BN[0]*BN[8]-BN[2]*BN[6])*lN,(BN[2]*BN[3]-BN[0]*BN[5])*lN,(BN[3]*BN[7]-BN[4]*BN[6])*lN,(BN[1]*BN[6]-BN[0]*BN[7])*lN,(BN[0]*BN[4]-BN[1]*BN[3])*lN])}equals(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const lN=this.vc,kB=NN.m;return 0===BN?lN[0]===kB[0]&&lN[1]===kB[1]&&lN[2]===kB[2]&&lN[3]===kB[3]&&lN[4]===kB[4]&&lN[5]===kB[5]&&lN[6]===kB[6]&&lN[7]===kB[7]&&lN[8]===kB[8]:Math.abs(lN[0]-kB[0])<BN&&Math.abs(lN[1]-kB[1])<BN&&Math.abs(lN[2]-kB[2])<BN&&Math.abs(lN[3]-kB[3])<BN&&Math.abs(lN[4]-kB[4])<BN&&Math.abs(lN[5]-kB[5])<BN&&Math.abs(lN[6]-kB[6])<BN&&Math.abs(lN[7]-kB[7])<BN&&Math.abs(lN[8]-kB[8])<BN}getClassName(){return"FlowGraphMatrix3D"}toString(){return"FlowGraphMatrix3D(".concat(this.vc.join(", "),")")}}},15894:(NN,BN,lN)=>{"use strict";var kB;function qN(NN,BN,lN,kB){var qN,cN,eN,vN,HN,TN,RN,sN,VN,fN,ZN,PN;switch(BN){case"Animation":return kB?null!==(qN=NN.animations.find((NN=>NN.uniqueId===lN)))&&void 0!==qN?qN:null:null!==(cN=NN.animations[lN])&&void 0!==cN?cN:null;case"AnimationGroup":return kB?null!==(eN=NN.animationGroups.find((NN=>NN.uniqueId===lN)))&&void 0!==eN?eN:null:null!==(vN=NN.animationGroups[lN])&&void 0!==vN?vN:null;case"Mesh":return kB?null!==(HN=NN.meshes.find((NN=>NN.uniqueId===lN)))&&void 0!==HN?HN:null:null!==(TN=NN.meshes[lN])&&void 0!==TN?TN:null;case"Material":return kB?null!==(RN=NN.materials.find((NN=>NN.uniqueId===lN)))&&void 0!==RN?RN:null:null!==(sN=NN.materials[lN])&&void 0!==sN?sN:null;case"sV":return kB?null!==(VN=NN.cameras.find((NN=>NN.uniqueId===lN)))&&void 0!==VN?VN:null:null!==(fN=NN.cameras[lN])&&void 0!==fN?fN:null;case"Light":return kB?null!==(ZN=NN.lights.find((NN=>NN.uniqueId===lN)))&&void 0!==ZN?ZN:null:null!==(PN=NN.lights[lN])&&void 0!==PN?PN:null;default:return null}}lN.d(BN,{b:()=>qN}),function(NN){NN.Animation="Animation",NN.AnimationGroup="AnimationGroup",NN.Mesh="Mesh",NN.Material="Material",NN.sV="sV",NN.Light="Light"}(kB||(kB={}))},15930:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>qN});var kB=lN(15938);class qN extends kB.b{constructor(NN,BN){if(super(NN),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),BN)for(const lN of BN)this._eventsSignalOutputs[lN]=this._registerSignalOutput(lN+"Event")}_executeOnTick(NN){}_startPendingTasks(NN){NN._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(NN),this._resetAfterCanceled(NN)),this._preparePendingTasks(NN),NN._addPendingBlock(this),this.out._activateSignal(NN),NN._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(NN){NN._deleteExecutionVariable(this,"_initialized"),NN._removePendingBlock(this)}}},15908:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>TN});var kB=lN(14885),qN=lN(14881),cN=lN(15912),eN=lN(14731),vN=lN(15878);class HN extends cN.b{constructor(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:kB.defaultValue,cN=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(NN,BN,lN),this.richType=kB,this._defaultValue=qN,this._optional=cN,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new eN.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(NN){this._isDisabled!==NN&&(this._isDisabled=NN,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(NN,BN){BN._getConnectionValue(this)!==NN&&(BN._setConnectionValue(this,NN),this.onValueChangedObservable.notifyObservers(NN))}resetToDefaultValue(NN){NN._setConnectionValue(this,this._defaultValue)}connectTo(NN){this._isDisabled||super.connectTo(NN)}_getValueOrDefault(NN){var BN;const lN=null!==(BN=NN._getConnectionValue(this))&&void 0!==BN?BN:this._defaultValue;return this.dataTransformer?this.dataTransformer(lN):lN}getValue(NN){if(1===this.connectionType){NN._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(NN);const BN=this._getValueOrDefault(NN);return this._lastValue=BN,this.richType.typeTransformer?this.richType.typeTransformer(BN):BN}const BN=this.isConnected()?this._connectedPoint[0].getValue(NN):this._getValueOrDefault(NN);return this._lastValue=BN,this.richType.typeTransformer?this.richType.typeTransformer(BN):BN}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(NN),NN.richType={},this.richType.serialize(NN.richType),NN.optional=this._optional,(0,vN.f)("defaultValue",this._defaultValue,NN)}}(0,qN.f)("FlowGraphDataConnection",HN);class TN{constructor(NN){var BN,lN;this.config=NN,this.uniqueId=(0,kB.d)(),this.name=null!==(BN=null===(lN=this.config)||void 0===lN?void 0:lN.name)&&void 0!==BN?BN:this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(NN){}registerDataInput(NN,BN,lN){const kB=new HN(NN,0,this,BN,lN);return this.dataInputs.push(kB),kB}registerDataOutput(NN,BN,lN){const kB=new HN(NN,1,this,BN,lN);return this.dataOutputs.push(kB),kB}getDataInput(NN){return this.dataInputs.find((BN=>BN.name===NN))}getDataOutput(NN){return this.dataOutputs.find((BN=>BN.name===NN))}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vN.f;if(NN.uniqueId=this.uniqueId,NN.config={},this.config){const lN=this.config,kB=Object.keys(lN);for(const qN of kB)BN(qN,lN[qN],NN.config)}NN.dataInputs=[],NN.dataOutputs=[],NN.className=this.getClassName();for(const lN of this.dataInputs){const BN={};lN.serialize(BN),NN.dataInputs.push(BN)}for(const lN of this.dataOutputs){const BN={};lN.serialize(BN),NN.dataOutputs.push(BN)}}deserialize(NN){}_log(NN,BN,lN){var kB;null===(kB=NN.logger)||void 0===kB||kB.addLogItem({action:BN,payload:lN,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},15912:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>cN});var kB,qN=lN(14885);!function(NN){NN[NN.Input=0]="Input",NN[NN.Output=1]="Output"}(kB||(kB={}));class cN{constructor(NN,BN,lN){this._ownerBlock=lN,this._connectedPoint=[],this.uniqueId=(0,qN.d)(),this.connectedPointIds=[],this.name=NN,this._connectionType=BN}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(NN){if(this._connectionType===NN._connectionType)throw new Error("Cannot connect two points of type ".concat(this.connectionType));if(this._isSingularConnection()&&this._connectedPoint.length>0||NN._isSingularConnection()&&NN._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(NN),NN._connectedPoint.push(this)}disconnectFrom(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const lN=this._connectedPoint.indexOf(NN),kB=NN._connectedPoint.indexOf(this);-1!==lN&&-1!==kB&&(BN&&this._connectedPoint.splice(lN,1),NN._connectedPoint.splice(kB,1))}disconnectFromAll(){for(const NN of this._connectedPoint)this.disconnectFrom(NN,!1);this._connectedPoint.length=0}dispose(){for(const NN of this._connectedPoint)this.disconnectFrom(NN)}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NN.uniqueId=this.uniqueId,NN.name=this.name,NN._connectionType=this._connectionType,NN.connectedPointIds=[],NN.className=this.getClassName();for(const BN of this._connectedPoint)NN.connectedPointIds.push(BN.uniqueId)}getClassName(){return"FGConnection"}deserialize(NN){this.uniqueId=NN.uniqueId,this.name=NN.name,this._connectionType=NN._connectionType,this.connectedPointIds=NN.connectedPointIds}}},15872:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>AN});var kB,qN=lN(14731),cN=lN(14905),eN=lN(14910),vN=lN(14885),HN=lN(15878),TN=lN(15894),RN=lN(14746);!function(NN){NN.ExecuteBlock="ExecuteBlock",NN.ExecuteEvent="ExecuteEvent",NN.TriggerConnection="TriggerConnection",NN.ContextVariableSet="ContextVariableSet",NN.GlobalVariableSet="GlobalVariableSet",NN.GlobalVariableDelete="GlobalVariableDelete",NN.GlobalVariableGet="GlobalVariableGet",NN.AddConnection="AddConnection",NN.GetConnectionValue="GetConnectionValue",NN.SetConnectionValue="SetConnectionValue",NN.ActivateSignal="ActivateSignal",NN.ContextVariableGet="ContextVariableGet"}(kB||(kB={}));class sN{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(NN){if(NN.time||(NN.time=Date.now()),this.log.push(NN),this.logToConsole){var BN;const lN=null===(BN=NN.payload)||void 0===BN?void 0:BN.value;"object"===typeof lN&&lN.getClassName?RN.d.Log("[FGLog] ".concat(NN.className,":").concat(NN.uniqueId.split("-")[0]," ").concat(NN.action," - ").concat(JSON.stringify(lN.getClassName()),": ").concat(lN.toString())):RN.d.Log("[FGLog] ".concat(NN.className,":").concat(NN.uniqueId.split("-")[0]," ").concat(NN.action," - ").concat(JSON.stringify(NN.payload)))}}getItemsOfType(NN){return this.log.filter((BN=>BN.action===NN))}}class VN{get enableLogging(){return this._enableLogging}set enableLogging(NN){this._enableLogging!==NN&&(this._enableLogging=NN,this._enableLogging?(this.logger=new sN,this.logger.logToConsole=!0):this.logger=null)}constructor(NN){var BN;this.uniqueId=(0,vN.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new qN.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=NN,this.assetsContext=null!==(BN=NN.assetsContext)&&void 0!==BN?BN:NN.PB}hasVariable(NN){return NN in this._userVariables}setVariable(NN,BN){var lN;this._userVariables[NN]=BN,null===(lN=this.logger)||void 0===lN||lN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:NN,value:BN}})}getAsset(NN,BN){return(0,TN.b)(this.assetsContext,NN,BN)}getVariable(NN){var BN;return null===(BN=this.logger)||void 0===BN||BN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:NN,value:this._userVariables[NN]}}),this._userVariables[NN]}get userVariables(){return this._userVariables}VB(){return this._configuration.PB}_getUniqueIdPrefixedName(NN,BN){return"".concat(NN.uniqueId,"_").concat(BN)}_getGlobalContextVariable(NN,BN){var lN;return null===(lN=this.logger)||void 0===lN||lN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:NN,defaultValue:BN,possibleValue:this._globalContextVariables[NN]}}),this._hasGlobalContextVariable(NN)?this._globalContextVariables[NN]:BN}_setGlobalContextVariable(NN,BN){var lN;null===(lN=this.logger)||void 0===lN||lN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:NN,value:BN}}),this._globalContextVariables[NN]=BN}_deleteGlobalContextVariable(NN){var BN;null===(BN=this.logger)||void 0===BN||BN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:NN}}),delete this._globalContextVariables[NN]}_hasGlobalContextVariable(NN){return NN in this._globalContextVariables}_setExecutionVariable(NN,BN,lN){this._executionVariables[this._getUniqueIdPrefixedName(NN,BN)]=lN}_getExecutionVariable(NN,BN,lN){return this._hasExecutionVariable(NN,BN)?this._executionVariables[this._getUniqueIdPrefixedName(NN,BN)]:lN}_deleteExecutionVariable(NN,BN){delete this._executionVariables[this._getUniqueIdPrefixedName(NN,BN)]}_hasExecutionVariable(NN,BN){return this._getUniqueIdPrefixedName(NN,BN)in this._executionVariables}_hasConnectionValue(NN){return NN.uniqueId in this._connectionValues}_setConnectionValue(NN,BN){var lN;this._connectionValues[NN.uniqueId]=BN,null===(lN=this.logger)||void 0===lN||lN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:NN.uniqueId,value:BN}})}_setConnectionValueByKey(NN,BN){this._connectionValues[NN]=BN}_getConnectionValue(NN){var BN;return null===(BN=this.logger)||void 0===BN||BN.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:NN.uniqueId,value:this._connectionValues[NN.uniqueId]}}),this._connectionValues[NN.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(NN){this._pendingBlocks.includes(NN)||(this._pendingBlocks.push(NN),this._pendingBlocks.sort(((NN,BN)=>NN.priority-BN.priority)))}_removePendingBlock(NN){const BN=this._pendingBlocks.indexOf(NN);-1!==BN&&this._pendingBlocks.splice(BN,1)}_clearPendingBlocks(){for(const NN of this._pendingBlocks)NN._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(NN){var BN;this.onNodeExecutedObservable.notifyObservers(NN),null===(BN=this.logger)||void 0===BN||BN.addLogItem({time:Date.now(),className:NN.getClassName(),uniqueId:NN.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(NN){this._setGlobalContextVariable("timeSinceStart",NN.timeSinceStart),this._setGlobalContextVariable("deltaTime",NN.deltaTime);for(const lN of this._pendingBlocks){var BN;null===(BN=lN._executeOnTick)||void 0===BN||BN.call(lN,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:HN.f;NN.uniqueId=this.uniqueId,NN._userVariables={};for(const kB in this._userVariables)BN(kB,this._userVariables[kB],NN._userVariables);NN._connectionValues={};for(const kB in this._connectionValues)BN(kB,this._connectionValues[kB],NN._connectionValues);var lN;this.assetsContext!==this.VB()&&(NN._assetsContext={meshes:this.assetsContext.meshes.map((NN=>NN.id)),materials:this.assetsContext.materials.map((NN=>NN.id)),textures:this.assetsContext.textures.map((NN=>NN.name)),animations:this.assetsContext.animations.map((NN=>NN.name)),lights:this.assetsContext.lights.map((NN=>NN.id)),cameras:this.assetsContext.cameras.map((NN=>NN.id)),vP:null===(lN=this.assetsContext.vP)||void 0===lN?void 0:lN.map((NN=>NN.name)),skeletons:this.assetsContext.skeletons.map((NN=>NN.id)),kP:this.assetsContext.kP.map((NN=>NN.name)),geometries:this.assetsContext.geometries.map((NN=>NN.id)),multiMaterials:this.assetsContext.multiMaterials.map((NN=>NN.id)),transformNodes:this.assetsContext.transformNodes.map((NN=>NN.id))})}getClassName(){return"FlowGraphContext"}}(0,cN.c)([(0,eN.G)()],VN.prototype,"uniqueId",void 0);var fN=lN(15901),ZN=lN(15208);class PN{constructor(NN){this.onEventTriggeredObservable=new qN.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=NN,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.qc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const NN=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:NN}}),this._startingTime+=NN})),this._meshPickedObserver=this._scene.onPointerObservable.add((NN=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:NN})}),ZN.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((NN=>{const BN=NN.pointerId,lN=NN.mesh,kB=this._pointerUnderMeshState[BN];!kB&&lN?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:BN,mesh:lN}}):kB&&!lN?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:BN,mesh:kB}}):kB&&lN&&kB!==lN&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:BN,mesh:kB,over:lN}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:BN,mesh:lN,out:kB}})),this._pointerUnderMeshState[BN]=lN}),ZN.b.POINTERMOVE)}dispose(){var NN,BN,lN,kB,qN;null===(NN=this._sceneDisposeObserver)||void 0===NN||NN.remove(),null===(BN=this._sceneReadyObserver)||void 0===BN||BN.remove(),null===(lN=this._sceneOnBeforeRenderObserver)||void 0===lN||lN.remove(),null===(kB=this._meshPickedObserver)||void 0===kB||kB.remove(),null===(qN=this._meshUnderPointerObserver)||void 0===qN||qN.remove(),this.onEventTriggeredObservable.clear()}}var CN,FN=lN(15921);!function(NN){NN[NN.Stopped=0]="Stopped",NN[NN.Started=1]="Started"}(CN||(CN={}));class IN{get state(){return this._state}set state(NN){this._state=NN,this.onStateChangedObservable.notifyObservers(NN)}constructor(NN){this.onStateChangedObservable=new qN.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=NN.PB,this._sceneEventCoordinator=new PN(this._scene),this._coordinator=NN.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((NN=>{for(const BN of this._executionContexts){const lN=this._getContextualOrder(NN.type,BN);for(const kB of lN)if(!kB._executeEvent(BN,NN.payload))break}switch(NN.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const BN of this._executionContexts)BN._notifyOnTick(NN.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const NN=new VN({PB:this._scene,coordinator:this._coordinator});return this._executionContexts.push(NN),NN}getContext(NN){return this._executionContexts[NN]}addEventBlock(NN){if("PointerOver"!==NN.type&&"PointerOut"!==NN.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==NN.type&&this._eventBlocks[NN.type].push(NN),1===this.state)for(const BN of this._executionContexts)NN._startPendingTasks(BN);else this.onStateChangedObservable.addOnce((BN=>{if(1===BN)for(const lN of this._executionContexts)NN._startPendingTasks(lN)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((NN=>{1===NN&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const NN of this._executionContexts)for(const BN in this._eventBlocks){const lN=this._getContextualOrder(BN,NN);for(const BN of lN)BN._startPendingTasks(NN)}}_getContextualOrder(NN,BN){const lN=this._eventBlocks[NN].sort(((NN,BN)=>BN.initPriority-NN.initPriority));if("MeshPick"===NN){const NN=[];for(const kB of lN){const qN=kB.asset.getValue(BN);let cN=0;for(;cN<lN.length;cN++){const NN=lN[cN].asset.getValue(BN);if(qN&&NN&&(0,FN.q)(qN,NN))break}NN.splice(cN,0,kB)}return NN}return lN}dispose(){var NN;if(0!==this.state){this.state=0;for(const NN of this._executionContexts)NN._clearPendingBlocks();this._executionContexts.length=0;for(const NN in this._eventBlocks)this._eventBlocks[NN].length=0;null===(NN=this._eventObserver)||void 0===NN||NN.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(NN){const BN=[],lN=new Set;for(const kB in this._eventBlocks)for(const NN of this._eventBlocks[kB])BN.push(NN),lN.add(NN.uniqueId);for(;BN.length>0;){const kB=BN.pop();NN(kB);for(const NN of kB.dataInputs)for(const kB of NN._connectedPoint)lN.has(kB._ownerBlock.uniqueId)||(BN.push(kB._ownerBlock),lN.add(kB._ownerBlock.uniqueId));if(kB instanceof fN.b)for(const NN of kB.signalOutputs)for(const kB of NN._connectedPoint)lN.has(kB._ownerBlock.uniqueId)||(BN.push(kB._ownerBlock),lN.add(kB._ownerBlock.uniqueId))}}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},BN=arguments.length>1?arguments[1]:void 0;NN.allBlocks=[],this.visitAllBlocks((BN=>{const lN={};BN.serialize(lN),NN.allBlocks.push(lN)})),NN.executionContexts=[];for(const lN of this._executionContexts){const kB={};lN.serialize(kB,BN),NN.executionContexts.push(kB)}}}class AN{constructor(NN){var BN;this.config=NN,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.PB.qc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.PB.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const NN=this._executeOnNextFrame.slice(0);if(NN.length)for(const BN of NN){this.notifyCustomEvent(BN.id,BN.data,!1);const NN=this._executeOnNextFrame.findIndex((NN=>NN.uniqueId===BN.uniqueId));-1!==NN&&this._executeOnNextFrame.splice(NN,1)}}));(null!==(BN=AN.SceneCoordinators.get(this.config.PB))&&void 0!==BN?BN:[]).push(this)}createGraph(){const NN=new IN({PB:this.config.PB,coordinator:this});return this._flowGraphs.push(NN),NN}removeGraph(NN){const BN=this._flowGraphs.indexOf(NN);-1!==BN&&(NN.dispose(),this._flowGraphs.splice(BN,1))}start(){for(const NN of this._flowGraphs)NN.start()}dispose(){var NN,BN,lN;for(const cN of this._flowGraphs)cN.dispose();this._flowGraphs.length=0,null===(NN=this._disposeObserver)||void 0===NN||NN.remove(),null===(BN=this._onBeforeRenderObserver)||void 0===BN||BN.remove();const kB=null!==(lN=AN.SceneCoordinators.get(this.config.PB))&&void 0!==lN?lN:[],qN=kB.indexOf(this);-1!==qN&&kB.splice(qN,1)}serialize(NN,BN){NN._flowGraphs=[];for(const lN of this._flowGraphs){const kB={};lN.serialize(kB,BN),NN._flowGraphs.push(kB)}NN.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(NN){let BN=this._customEventsMap.get(NN);return BN||(BN=new qN.b,this._customEventsMap.set(NN,BN)),BN}notifyCustomEvent(NN,BN){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:NN,data:BN,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(NN)){const BN=this._eventExecutionCounter.get(NN);if(this._eventExecutionCounter.set(NN,BN+1),BN>=AN.MaxEventTypeExecutionPerFrame)return void(BN===AN.MaxEventTypeExecutionPerFrame&&RN.d.Warn('FlowGraphCoordinator: Too many executions of event "'.concat(NN,'".')))}else this._eventExecutionCounter.set(NN,1);const lN=this._customEventsMap.get(NN);lN&&lN.notifyObservers(BN)}}AN.MaxEventsPerType=30,AN.MaxEventTypeExecutionPerFrame=30,AN.SceneCoordinators=new Map},15926:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>qN});var kB=lN(15930);class qN extends kB.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(NN){NN._notifyExecuteNode(this),this.done._activateSignal(NN)}}},15901:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>vN});var kB=lN(15908),qN=lN(15912),cN=lN(14881);class eN extends qN.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(NN){super.connectTo(NN),this._connectedPoint.sort(((NN,BN)=>BN.priority-NN.priority))}_activateSignal(NN){var BN;if(null===(BN=NN.logger)||void 0===BN||BN.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)NN._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(NN,this),NN._increaseExecutionId();else for(const lN of this._connectedPoint)lN._activateSignal(NN)}}(0,cN.f)("FlowGraphSignalConnection",eN);class vN extends kB.e{constructor(NN){super(NN),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(NN){const BN=new eN(NN,0,this);return this.signalInputs.push(BN),BN}_registerSignalOutput(NN){const BN=new eN(NN,1,this);return this.signalOutputs.push(BN),BN}_unregisterSignalInput(NN){const BN=this.signalInputs.findIndex((BN=>BN.name===NN));-1!==BN&&(this.signalInputs[BN].dispose(),this.signalInputs.splice(BN,1))}_unregisterSignalOutput(NN){const BN=this.signalOutputs.findIndex((BN=>BN.name===NN));-1!==BN&&(this.signalOutputs[BN].dispose(),this.signalOutputs.splice(BN,1))}_reportError(NN,BN){this.error.payload="string"===typeof BN?new Error(BN):BN,this.error._activateSignal(NN)}getSignalInput(NN){return this.signalInputs.find((BN=>BN.name===NN))}getSignalOutput(NN){return this.signalOutputs.find((BN=>BN.name===NN))}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(NN),NN.signalInputs=[],NN.signalOutputs=[];for(const BN of this.signalInputs){const lN={};BN.serialize(lN),NN.signalInputs.push(lN)}for(const BN of this.signalOutputs){const lN={};BN.serialize(lN),NN.signalOutputs.push(lN)}}deserialize(NN){for(let BN=0;BN<NN.signalInputs.length;BN++){const lN=this.getSignalInput(NN.signalInputs[BN].name);if(!lN)throw new Error("Could not find signal input with name "+NN.signalInputs[BN].name+" in block "+NN.className);lN.deserialize(NN.signalInputs[BN])}for(let BN=0;BN<NN.signalOutputs.length;BN++){const lN=this.getSignalOutput(NN.signalOutputs[BN].name);if(!lN)throw new Error("Could not find signal output with name "+NN.signalOutputs[BN].name+" in block "+NN.className);lN.deserialize(NN.signalOutputs[BN])}}getClassName(){return"FlowGraphExecutionBlock"}}},15938:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>qN});var kB=lN(15901);class qN extends kB.b{constructor(NN){super(NN),this.out=this._registerSignalOutput("out")}}},15886:(NN,BN,lN)=>{"use strict";lN.d(BN,{A:()=>RN,D:()=>fN,H:()=>ZN,J:()=>PN,K:()=>EN,L:()=>KN,M:()=>dN,N:()=>uN,c:()=>TN,g:()=>VN,j:()=>XN,m:()=>CN,n:()=>FN,q:()=>IN,t:()=>sN,x:()=>GN});var kB,qN=lN(14925),cN=lN(14972),eN=lN(15884),vN=lN(15889);!function(NN){NN.Any="any",NN.String="string",NN.Number="number",NN.Boolean="boolean",NN.Object="object",NN.Integer="FlowGraphInteger",NN.Vector2="Vector2",NN.fB="fB",NN.Vector4="Vector4",NN.Quaternion="Quaternion",NN.Matrix="Matrix",NN.Matrix2D="Matrix2D",NN.Matrix3D="Matrix3D",NN.FB="FB",NN.xc="xc"}(kB||(kB={}));class HN{constructor(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=NN,this.defaultValue=BN,this.animationType=lN}serialize(NN){NN.typeName=this.typeName,NN.defaultValue=this.defaultValue}}const TN=new HN("any",void 0),RN=new HN("string",""),sN=new HN("number",0,0),VN=new HN("boolean",!1),fN=new HN("Vector2",qN.Vector2.Zero(),5),ZN=new HN("fB",qN.fB.Zero(),1),PN=new HN("Vector4",qN.Vector4.Zero()),CN=new HN("Matrix",qN.Matrix.Identity(),3),FN=new HN("Matrix2D",new vN.b),IN=new HN("Matrix3D",new vN.c),AN=new HN("FB",cN.FB.Black(),4),MN=new HN("xc",new cN.xc(0,0,0,0),7),GN=new HN("Quaternion",qN.Quaternion.Identity(),2);GN.typeTransformer=NN=>{if(NN.getClassName){if("Vector4"===NN.getClassName())return qN.Quaternion.IB(NN.Fc());if("fB"===NN.getClassName())return qN.Quaternion.FromEulerVector(NN);if("Matrix"===NN.getClassName())return qN.Quaternion.FromRotationMatrix(NN)}return NN};const XN=new HN("FlowGraphInteger",new eN.d(0),0);function uN(NN){const BN=NN;switch(typeof NN){case"string":return RN;case"number":return sN;case"boolean":return VN;case"object":if(BN.getClassName)switch(BN.getClassName()){case"Vector2":return fN;case"fB":return ZN;case"Vector4":return PN;case"Matrix":return CN;case"FB":return AN;case"xc":return MN;case"Quaternion":return GN;case"FlowGraphInteger":return XN;case"Matrix2D":return FN;case"Matrix3D":return IN}return TN;default:return TN}}function dN(NN){switch(NN){case"string":return RN;case"number":return sN;case"boolean":return VN;case"Vector2":return fN;case"fB":return ZN;case"Vector4":return PN;case"Matrix":return CN;case"FB":return AN;case"xc":return MN;case"Quaternion":return GN;case"FlowGraphInteger":return XN;case"Matrix2D":return FN;case"Matrix3D":return IN;default:return TN}}function EN(NN){switch(NN){case"number":default:return 0;case"Vector2":return 5;case"fB":return 1;case"Matrix":return 3;case"FB":return 4;case"xc":return 7;case"Quaternion":return 2}}function KN(NN){switch(NN){case 0:return sN;case 5:return fN;case 1:return ZN;case 3:return CN;case 4:return AN;case 7:return MN;case 2:return GN;default:return TN}}},15878:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>RN,f:()=>TN,g:()=>sN});var kB=lN(14972),qN=lN(14925),cN=lN(15884),eN=lN(15886),vN=lN(15889);function HN(NN){return"Vector2"===NN||"fB"===NN||"Vector4"===NN||"Quaternion"===NN||"FB"===NN||"xc"===NN}function TN(NN,BN,lN){var kB,qN;const cN=null!==(kB=null===BN||void 0===BN||null===(qN=BN.getClassName)||void 0===qN?void 0:qN.call(BN))&&void 0!==kB?kB:"";if(HN(cN)||function(NN){return"Matrix"===NN||"Matrix2D"===NN||"Matrix3D"===NN}(cN))lN[NN]={value:BN.Fc(),className:cN};else if("FlowGraphInteger"===cN)lN[NN]={value:BN.value,className:cN};else if(cN&&(BN.id||BN.name))lN[NN]={id:BN.id,name:BN.name,className:cN};else{if("object"===typeof BN)throw new Error("Could not serialize value ".concat(BN));lN[NN]=BN}}function RN(NN,BN,lN,TN){var sN;const VN=BN[NN];let fN;const ZN=null!==(sN=null===VN||void 0===VN?void 0:VN.type)&&void 0!==sN?sN:null===VN||void 0===VN?void 0:VN.className;if(function(NN){return"Mesh"===NN||"AbstractMesh"===NN||"GroundMesh"===NN||"InstanceMesh"===NN||"LinesMesh"===NN||"GoldbergMesh"===NN||"GreasedLineMesh"===NN||"TrailMesh"===NN}(ZN)){let NN=TN.meshes.filter((NN=>VN.id?NN.id===VN.id:NN.name===VN.name));0===NN.length&&(NN=TN.transformNodes.filter((NN=>VN.id?NN.id===VN.id:NN.name===VN.name))),fN=VN.uniqueId?NN.find((NN=>NN.uniqueId===VN.uniqueId)):NN[0]}else if(HN(ZN))fN=function(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===NN)return qN.Vector2.IB(BN);if("fB"===NN)return lN&&(BN[2]*=-1),qN.fB.IB(BN);if("Vector4"===NN)return qN.Vector4.IB(BN);if("Quaternion"===NN)return lN&&(BN[2]*=-1,BN[3]*=-1),qN.Quaternion.IB(BN);if("FB"===NN)return new kB.FB(BN[0],BN[1],BN[2]);if("xc"===NN)return new kB.xc(BN[0],BN[1],BN[2],BN[3]);throw new Error("Unknown vector class name ".concat(NN))}(ZN,VN.value);else if(function(NN){return"AnimationGroup"===NN}(ZN)){const NN=TN.animationGroups.filter((NN=>NN.name===VN.name));fN=1===NN.length?NN[0]:NN.find((NN=>NN.uniqueId===VN.uniqueId))}else fN="Matrix"===ZN?qN.Matrix.IB(VN.value):"Matrix2D"===ZN?new vN.b(VN.value):"Matrix3D"===ZN?new vN.c(VN.value):"FlowGraphInteger"===ZN?cN.d.FromValue(VN.value):"number"===ZN||"string"===ZN||"boolean"===ZN?VN.value[0]:VN&&void 0!==VN.value?VN.value:Array.isArray(VN)?VN.reduce(((NN,BN)=>BN.eventData?(NN[BN.id]={type:(0,eN.M)(BN.type)},"undefined"!==typeof BN.value&&(NN[BN.id].value=RN("value",BN,lN,TN)),NN):NN),{}):VN;return fN}function sN(NN){return"FlowGraphJsonPointerParserBlock"===NN}},15921:(NN,BN,lN)=>{"use strict";function kB(NN,BN){return!(!NN.parent||NN.parent!==BN&&!kB(NN.parent,BN))}function qN(NN){if(NN.getClassName)return NN.getClassName()}function cN(NN,BN){return NN===BN&&("Vector2"===NN||"fB"===NN||"Vector4"===NN||"Quaternion"===NN)}function eN(NN,BN){return NN===BN&&("Matrix"===NN||"Matrix2D"===NN||"Matrix3D"===NN)}function vN(NN,BN){return"FlowGraphInteger"===NN&&"FlowGraphInteger"===BN}function HN(NN,BN){const lN="number"===typeof NN||"number"===typeof(null===NN||void 0===NN?void 0:NN.value);return lN&&!BN?!isNaN(TN(NN)):lN}function TN(NN){return"number"===typeof NN?NN:NN.value}lN.d(BN,{b:()=>vN,f:()=>eN,i:()=>cN,m:()=>qN,q:()=>kB,t:()=>TN,w:()=>HN})},16574:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{SceneInstrumentation:()=>cN});var kB=lN(14727),qN=lN(15140);class cN{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(NN){NN!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=NN,NN?(this._onBeforeActiveMeshesEvaluationObserver=this.PB.onBeforeActiveMeshesEvaluationObservable.add((()=>{kB.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.PB.onAfterActiveMeshesEvaluationObservable.add((()=>{kB.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.PB.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.PB.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(NN){NN!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=NN,NN?(this._onBeforeRenderTargetsRenderObserver=this.PB.onBeforeRenderTargetsRenderObservable.add((()=>{kB.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.PB.onAfterRenderTargetsRenderObservable.add((()=>{kB.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.PB.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.PB.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(NN){NN!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=NN,NN?(this._onBeforeParticlesRenderingObserver=this.PB.onBeforeParticlesRenderingObservable.add((()=>{kB.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.PB.onAfterParticlesRenderingObservable.add((()=>{kB.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.PB.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.PB.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(NN){NN!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=NN,this.PB.spriteManagers&&(NN?(this._onBeforeSpritesRenderingObserver=this.PB.onBeforeSpritesRenderingObservable.add((()=>{kB.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.PB.onAfterSpritesRenderingObservable.add((()=>{kB.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.PB.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.PB.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(NN){NN!==this._capturePhysicsTime&&this.PB.onBeforePhysicsObservable&&(this._capturePhysicsTime=NN,NN?(this._onBeforePhysicsObserver=this.PB.onBeforePhysicsObservable.add((()=>{kB.Tools.StartPerformanceCounter("hc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.PB.onAfterPhysicsObservable.add((()=>{kB.Tools.EndPerformanceCounter("hc"),this._physicsTime.endMonitoring()}))):(this.PB.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.PB.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(NN){NN!==this._captureAnimationsTime&&(this._captureAnimationsTime=NN,NN?this._onAfterAnimationsObserver=this.PB.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.PB.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(NN){this._captureFrameTime=NN}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(NN){this._captureInterFrameTime=NN}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(NN){NN!==this._captureRenderTime&&(this._captureRenderTime=NN,NN?(this._onBeforeDrawPhaseObserver=this.PB.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),kB.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.PB.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),kB.Tools.EndPerformanceCounter("Main render")}))):(this.PB.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.PB.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(NN){NN!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=NN,NN?(this._onBeforeCameraRenderObserver=this.PB.onBeforeCameraRenderObservable.add((NN=>{this._cameraRenderTime.beginMonitoring(),kB.Tools.StartPerformanceCounter("Rendering camera ".concat(NN.name))})),this._onAfterCameraRenderObserver=this.PB.onAfterCameraRenderObservable.add((NN=>{this._cameraRenderTime.endMonitoring(!1),kB.Tools.EndPerformanceCounter("Rendering camera ".concat(NN.name))}))):(this.PB.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.PB.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.PB.getEngine()._drawCalls}constructor(NN){this.PB=NN,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new qN.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new qN.b,this._captureFrameTime=!1,this._frameTime=new qN.b,this._captureRenderTime=!1,this._renderTime=new qN.b,this._captureInterFrameTime=!1,this._interFrameTime=new qN.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new qN.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new qN.b,this._capturePhysicsTime=!1,this._physicsTime=new qN.b,this._captureAnimationsTime=!1,this._animationsTime=new qN.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new qN.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=NN.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(kB.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.PB.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=NN.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(kB.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.lc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.lc(),this._captureParticlesRenderTime&&this._particlesRenderTime.lc(),this._captureSpritesRenderTime&&this._spritesRenderTime.lc(),this._captureRenderTime&&this._renderTime.lc(),this._captureCameraRenderTime&&this._cameraRenderTime.lc()}))}dispose(){this._disposed||(this.PB.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.PB.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.PB.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.PB.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.PB.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.PB.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.PB.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.PB.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.PB.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.PB.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.PB.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.PB.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.PB.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.PB.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.PB.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.PB.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.PB.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.PB=null,this._disposed=!0)}}},15861:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>RN});var kB=lN(14905),qN=lN(14910),cN=lN(14925),eN=lN(15370),vN=lN(15485),HN=lN(15534),TN=lN(14881);eN.c.AddNodeConstructor("Light_Type_1",((NN,BN)=>()=>new RN(NN,cN.fB.Zero(),BN)));class RN extends HN.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(NN){this._shadowFrustumSize=NN,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(NN){this._shadowOrthoScale=NN,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(NN){this._orthoLeft=NN}get orthoRight(){return this._orthoRight}set orthoRight(NN){this._orthoRight=NN}get orthoTop(){return this._orthoTop}set orthoTop(NN){this._orthoTop=NN}get orthoBottom(){return this._orthoBottom}set orthoBottom(NN){this._orthoBottom=NN}constructor(NN,BN,lN){super(NN,lN),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=BN.scale(-1),this.direction=BN}getClassName(){return"Sc"}getTypeID(){return vN.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(NN,BN,lN){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(NN):this._setDefaultAutoExtendShadowProjectionMatrix(NN,BN,lN)}_setDefaultFixedFrustumShadowProjectionMatrix(NN){const BN=this.VB().activeCamera;BN&&cN.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:BN.Mc,void 0!==this.shadowMaxZ?this.shadowMaxZ:BN.Gc,NN,this.VB().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(NN,BN,lN){const kB=this.VB().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const NN=cN.fB.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let kB=Number.MAX_VALUE,qN=-Number.MAX_VALUE;for(let eN=0;eN<lN.length;eN++){const vN=lN[eN];if(!vN)continue;const HN=vN.getBoundingInfo().boundingBox;for(let lN=0;lN<HN.vectorsWorld.length;lN++)cN.fB.TransformCoordinatesToRef(HN.vectorsWorld[lN],BN,NN),NN.x<this._orthoLeft&&(this._orthoLeft=NN.x),NN.y<this._orthoBottom&&(this._orthoBottom=NN.y),NN.x>this._orthoRight&&(this._orthoRight=NN.x),NN.y>this._orthoTop&&(this._orthoTop=NN.y),this.autoCalcShadowZBounds&&(NN.z<kB&&(kB=NN.z),NN.z>qN&&(qN=NN.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=kB,this._shadowMaxZ=qN)}const qN=this._orthoRight-this._orthoLeft,eN=this._orthoTop-this._orthoBottom,vN=void 0!==this.shadowMinZ?this.shadowMinZ:(null===kB||void 0===kB?void 0:kB.Mc)||0,HN=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===kB||void 0===kB?void 0:kB.Gc)||1e4,TN=this.VB().getEngine().Nc;cN.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-qN*this.shadowOrthoScale,this._orthoRight+qN*this.shadowOrthoScale,this._orthoBottom-eN*this.shadowOrthoScale,this._orthoTop+eN*this.shadowOrthoScale,TN?HN:vN,TN?vN:HN,NN,this.VB().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(NN,BN){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,BN),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,BN),this)}transferToNodeMaterialEffect(NN,BN){return this.computeTransformedInformation()?(NN.setFloat3(BN,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(NN.setFloat3(BN,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(NN){const BN=this._scene.getEngine();return!BN.Nc&&BN.isNDCHalfZRange?0:1}getDepthMaxZ(NN){const BN=this._scene.getEngine();return BN.Nc&&BN.isNDCHalfZRange?0:1}prepareLightSpecificDefines(NN,BN){NN["DIRLIGHT"+BN]=!0}}(0,kB.c)([(0,qN.G)()],RN.prototype,"shadowFrustumSize",null),(0,kB.c)([(0,qN.G)()],RN.prototype,"shadowOrthoScale",null),(0,kB.c)([(0,qN.G)()],RN.prototype,"autoUpdateExtends",void 0),(0,kB.c)([(0,qN.G)()],RN.prototype,"autoCalcShadowZBounds",void 0),(0,kB.c)([(0,qN.G)("orthoLeft")],RN.prototype,"_orthoLeft",void 0),(0,kB.c)([(0,qN.G)("orthoRight")],RN.prototype,"_orthoRight",void 0),(0,kB.c)([(0,qN.G)("orthoTop")],RN.prototype,"_orthoTop",void 0),(0,kB.c)([(0,qN.G)("orthoBottom")],RN.prototype,"_orthoBottom",void 0),(0,TN.f)("BABYLON.DirectionalLight",RN)},16749:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>RN});var kB=lN(14905),qN=lN(14910),cN=lN(14925),eN=lN(14972),vN=lN(15370),HN=lN(15485),TN=lN(14881);vN.c.AddNodeConstructor("Light_Type_3",((NN,BN)=>()=>new RN(NN,cN.fB.Zero(),BN)));class RN extends HN.b{constructor(NN,BN,lN){super(NN,lN),this.groundColor=new eN.FB(0,0,0),this.direction=BN||cN.fB.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ie"}setDirectionToTarget(NN){return this.direction=cN.fB.Normalize(NN.ZB(cN.fB.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(NN,BN){const lN=cN.fB.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",lN.x,lN.y,lN.z,0,BN),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bc),BN),this}transferToNodeMaterialEffect(NN,BN){const lN=cN.fB.Normalize(this.direction);return NN.setFloat3(BN,lN.x,lN.y,lN.z),this}uc(){return this._worldMatrix||(this._worldMatrix=cN.Matrix.Identity()),this._worldMatrix}getTypeID(){return HN.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(NN,BN){NN["HEMILIGHT"+BN]=!0}}(0,kB.c)([(0,qN.l)()],RN.prototype,"groundColor",void 0),(0,kB.c)([(0,qN.F)()],RN.prototype,"direction",void 0),(0,TN.f)("BABYLON.HemisphericLight",RN)},15827:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>sN});var kB=lN(14905),qN=lN(14910),cN=lN(14925),eN=lN(15370),vN=lN(15485),HN=lN(15534),TN=lN(14898),RN=lN(14881);eN.c.AddNodeConstructor("Light_Type_2",((NN,BN)=>()=>new sN(NN,cN.fB.Zero(),cN.fB.Zero(),0,0,BN)));class sN extends HN.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(NN){this._iesProfileTexture!==NN&&(this._iesProfileTexture=NN,this._iesProfileTexture&&sN._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(NN){this._angle=NN,this._cosHalfAngle=Math.cos(.5*NN),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(NN){this._innerAngle=NN,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(NN){this._shadowAngleScale=NN,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(NN){this._projectionTextureLightNear=NN,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(NN){this._projectionTextureLightFar=NN,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(NN){this._projectionTextureUpDirection=NN,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(NN){this._projectionTexture!==NN&&(this._projectionTexture=NN,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(sN._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):sN._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(NN){return void 0!==NN.onGeneratedObservable}static _IsTexture(NN){return void 0!==NN.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(NN){this._projectionTextureProjectionLightMatrix=NN,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(NN,BN,lN,kB,qN,eN){super(NN,eN),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=cN.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=cN.fB.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=cN.fB.Zero(),this._projectionTextureViewLightMatrix=cN.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=cN.Matrix.Zero(),this._projectionTextureScalingMatrix=cN.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=BN,this.direction=lN,this.angle=kB,this.exponent=qN}getClassName(){return"SpotLight"}getTypeID(){return vN.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(NN){super._setDirection(NN),this._projectionTextureViewLightDirty=!0}_setPosition(NN){super._setPosition(NN),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(NN,BN,lN){const kB=this.VB().activeCamera;if(!kB)return;this._shadowAngleScale=this._shadowAngleScale||1;const qN=this._shadowAngleScale*this._angle,eN=void 0!==this.shadowMinZ?this.shadowMinZ:kB.Mc,vN=void 0!==this.shadowMaxZ?this.shadowMaxZ:kB.Gc,HN=this.VB().getEngine().Nc;cN.Matrix.PerspectiveFovLHToRef(qN,1,HN?vN:eN,HN?eN:vN,NN,!0,this._scene.getEngine().isNDCHalfZRange,void 0,HN)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),cN.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const NN=this.projectionTextureLightFar,BN=this.projectionTextureLightNear,lN=NN/(NN-BN),kB=-lN*BN,qN=1/Math.tan(this._angle/2);cN.Matrix.FromValuesToRef(qN/1,0,0,0,0,qN,0,0,0,0,lN,1,0,0,kB,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof TN.c){const NN=this._projectionTexture.uScale/2,BN=this._projectionTexture.vScale/2;cN.Matrix.FromValuesToRef(NN,0,0,0,0,BN,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(NN,BN){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),NN.setMatrix("textureProjectionMatrix"+BN,this._projectionTextureMatrix),NN.setTexture("projectionLightTexture"+BN,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&NN.setTexture("iesLightTexture"+BN,this._iesProfileTexture),this}transferToEffect(NN,BN){let lN;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,BN),lN=cN.fB.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,BN),lN=cN.fB.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",lN.x,lN.y,lN.z,this._cosHalfAngle,BN),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,BN),this}transferToNodeMaterialEffect(NN,BN){let lN;return lN=this.computeTransformedInformation()?cN.fB.Normalize(this.transformedDirection):cN.fB.Normalize(this.direction),this.VB().useRightHandedSystem?NN.setFloat3(BN,-lN.x,-lN.y,-lN.z):NN.setFloat3(BN,lN.x,lN.y,lN.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(NN){var BN;const lN=this._scene.getEngine(),kB=void 0!==this.shadowMinZ?this.shadowMinZ:null!==(BN=null===NN||void 0===NN?void 0:NN.Mc)&&void 0!==BN?BN:0;return lN.Nc&&lN.isNDCHalfZRange?kB:this._scene.getEngine().isNDCHalfZRange?0:kB}getDepthMaxZ(NN){var BN;const lN=this._scene.getEngine(),kB=void 0!==this.shadowMaxZ?this.shadowMaxZ:null!==(BN=null===NN||void 0===NN?void 0:NN.Gc)&&void 0!==BN?BN:1e4;return lN.Nc&&lN.isNDCHalfZRange?0:kB}prepareLightSpecificDefines(NN,BN){NN["SPOTLIGHT"+BN]=!0,NN["PROJECTEDLIGHTTEXTURE"+BN]=!(!this.projectionTexture||!this.projectionTexture.isReady()),NN["IESLIGHTTEXTURE"+BN]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,kB.c)([(0,qN.G)()],sN.prototype,"angle",null),(0,kB.c)([(0,qN.G)()],sN.prototype,"innerAngle",null),(0,kB.c)([(0,qN.G)()],sN.prototype,"shadowAngleScale",null),(0,kB.c)([(0,qN.G)()],sN.prototype,"exponent",void 0),(0,kB.c)([(0,qN.G)()],sN.prototype,"projectionTextureLightNear",null),(0,kB.c)([(0,qN.G)()],sN.prototype,"projectionTextureLightFar",null),(0,kB.c)([(0,qN.G)()],sN.prototype,"projectionTextureUpDirection",null),(0,kB.c)([(0,qN.y)("projectedLightTexture")],sN.prototype,"_projectionTexture",void 0),(0,RN.f)("BABYLON.SpotLight",sN)},15866:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>eN,h:()=>cN,j:()=>vN});const kB={},qN={};function cN(NN,BN){kB[NN]=BN}function eN(NN,BN){qN[NN]=BN}function vN(NN){return qN[NN]?qN[NN]:null}},15813:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>uN,h:()=>bN});var kB,qN=lN(14727),cN=lN(14731),eN=lN(15162),vN=lN(14773),HN=lN(14746),TN=lN(15412),RN=lN(14781),sN=lN(14789),VN=lN(14885),fN=lN(14818),ZN=lN(14769);!function(NN){NN[NN.Clean=0]="Clean",NN[NN.Stop=1]="Stop",NN[NN.Sync=2]="Sync",NN[NN.NoSync=3]="NoSync"}(kB||(kB={}));const PN=new cN.b,CN={};let FN=!1;function IN(){return CN[".babylon"]}function AN(NN,BN){const lN=CN[NN];return lN||(HN.d.Warn("Unable to find a plugin to load "+NN+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),BN?IN():void 0)}function MN(NN,BN,lN){let kB="Unable to load from "+(NN.rawData?"binary data":NN.url);return BN?kB+=": ".concat(BN):lN&&(kB+=": ".concat(lN)),kB}async function GN(NN,BN,lN,kB,qN,cN,eN,vN,HN){var TN;const sN="data:"===(VN=NN.url).substring(0,5)?VN.substring(5):null;var VN;if(NN.rawData&&!eN)throw"When using ArrayBufferView to load data the file extension must be provided.";const FN=sN||eN?"":function(NN){const BN=NN.indexOf("?");-1!==BN&&(NN=NN.substring(0,BN));const lN=NN.lastIndexOf(".");return NN.substring(lN,NN.length).toLowerCase()}(NN.url);let MN=eN?AN(eN,!0):sN?function(NN){for(const BN in CN){const lN=CN[BN].plugin;if(lN.canDirectLoad&&lN.canDirectLoad(NN))return CN[BN]}return IN()}(NN.url):AN(FN,!1);if(!MN&&FN){if(NN.url&&!NN.url.startsWith("blob:")){const BN=await async function(NN,BN){const lN=BN.method||"GET";return await new Promise(((kB,qN)=>{const cN=new ZN.d;cN.addEventListener("readystatechange",(()=>{if(4==cN.readyState)if(200==cN.status){const NN={};if(BN.responseHeaders)for(const lN of BN.responseHeaders)NN[lN]=cN.getResponseHeader(lN)||"";kB({response:cN.response,headerValues:NN})}else qN("Unable to fetch data from ".concat(NN,". Error code: ").concat(cN.status))})),cN.open(lN,NN),cN.send()}))}(NN.url,{method:"HEAD",responseHeaders:["Content-Type"]}),lN=BN.headerValues?BN.headerValues["Content-Type"]:"";lN&&(MN=function(NN){for(const BN in CN){const lN=CN[BN];if(lN.mimeType===NN)return lN}}(lN))}MN||(MN=IN())}if(!MN)throw new Error("No plugin or fallback for ".concat(null!==eN&&void 0!==eN?eN:NN.url));if(!1===(null===HN||void 0===HN||null===(TN=HN[MN.plugin.name])||void 0===TN?void 0:TN.enabled))throw new Error("The '".concat(MN.plugin.name,"' plugin is disabled via the loader options passed to the loading operation."));if(NN.rawData&&!MN.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(NN=>{if(MN.plugin.createPlugin){const BN=MN.plugin.createPlugin(null!==HN&&void 0!==HN?HN:{});return BN instanceof Promise?(BN.then(NN).catch((NN=>{qN("Error instantiating plugin.",NN)})),null):(NN(BN),BN)}return NN(MN.plugin),MN.plugin})((HN=>{var TN;if(!HN)throw"The loader plugin corresponding to the '".concat(eN,"' file type has not been found. If using es6, please import the plugin you wish to use before.");if(PN.notifyObservers(HN),sN&&(HN.canDirectLoad&&HN.canDirectLoad(NN.url)||!(0,RN.l)(NN.url))){if(HN.directLoad){const NN=HN.directLoad(BN,sN);NN instanceof Promise?NN.then((NN=>{lN(HN,NN)})).catch((NN=>{qN("Error in directLoad of _loadData: "+NN,NN)})):lN(HN,NN)}else lN(HN,sN);return}const VN=MN.isBinary,ZN=(NN,kB)=>{BN.eN?qN("Scene has been disposed"):lN(HN,NN,kB)};let CN=null,FN=!1;null===(TN=HN.qc)||void 0===TN||TN.add((()=>{FN=!0,CN&&(CN.abort(),CN=null),cN()}));const IN=()=>{if(FN)return;const lN=(NN,BN)=>{qN(null===NN||void 0===NN?void 0:NN.statusText,BN)};if(!HN.loadFile&&NN.rawData)throw"Plugin does not support loading ArrayBufferView.";CN=HN.loadFile?HN.loadFile(BN,NN.rawData||NN.file||NN.url,NN.rootUrl,ZN,kB,VN,lN,vN):BN._loadFile(NN.file||NN.url,ZN,kB,!0,VN,lN)},AN=BN.getEngine();let GN=AN.enableOfflineSupport;if(GN){let lN=!1;for(const kB of BN.disableOfflineSupportExceptionRules)if(kB.test(NN.url)){lN=!0;break}GN=!lN}GN&&fN.c.OfflineProviderFactory?BN.offlineProvider=fN.c.OfflineProviderFactory(NN.url,IN,AN.disableManifestCheck):IN()}))}function XN(NN,BN){let lN,kB,cN=null,eN=null;if(BN)if(BN.name)lN="file:".concat(BN.name),kB=BN.name,cN=BN;else if(ArrayBuffer.isView(BN))lN="",kB=(0,VN.d)(),eN=BN;else if(BN.startsWith("data:"))lN=BN,kB="";else if(NN){const cN=BN;if("/"===cN.substring(0,1))return qN.Tools.Error("Wrong sceneFilename parameter"),null;lN=NN+cN,kB=cN}else lN=BN,kB=qN.Tools.GetFilename(BN),NN=qN.Tools.GetFolderPath(BN);else lN=NN,kB=qN.Tools.GetFilename(NN),NN=qN.Tools.GetFolderPath(NN);return{url:lN,rootUrl:NN,name:kB,file:cN,rawData:eN}}function uN(NN){if("string"===typeof NN.extensions){const BN=NN.extensions;CN[BN.toLowerCase()]={plugin:NN,isBinary:!1}}else{const BN=NN.extensions,lN=Object.keys(BN);for(const kB of lN)CN[kB.toLowerCase()]={plugin:NN,isBinary:BN[kB].isBinary,mimeType:BN[kB].mimeType}}}async function dN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vN.b.LastCreatedScene,qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,cN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,eN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,TN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,RN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",VN=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!kB)return HN.d.Error("No scene available to import mesh to"),null;const fN=XN(BN,lN);if(!fN)return null;const ZN={};kB.addPendingData(ZN);const PN=()=>{kB.removePendingData(ZN)},CN=(NN,BN)=>{const lN=MN(fN,NN,BN);eN?eN(kB,lN,new sN.i(lN,sN.e.SceneLoaderError,BN)):HN.d.Error(lN),PN()},FN=cN?NN=>{try{cN(NN)}catch(BN){CN("Error in onProgress callback: "+BN,BN)}}:void 0,IN=(NN,BN,lN,cN,eN,vN,HN,TN)=>{if(kB.importedMeshesFiles.push(fN.url),qN)try{qN(NN,BN,lN,cN,eN,vN,HN,TN)}catch(RN){CN("Error in onSuccess callback: "+RN,RN)}kB.removePendingData(ZN)};return await GN(fN,kB,((BN,lN,qN)=>{if(BN.rewriteRootURL&&(fN.rootUrl=BN.rewriteRootURL(fN.rootUrl,qN)),BN.importMesh){const qN=[],cN=[],eN=[];if(!BN.importMesh(NN,kB,lN,fN.rootUrl,qN,cN,eN,CN))return;kB.loadingPluginName=BN.name,IN(qN,cN,eN,[],[],[],[],[])}else{BN.importMeshAsync(NN,kB,lN,fN.rootUrl,FN,fN.name).then((NN=>{kB.loadingPluginName=BN.name,IN(NN.meshes,NN.kP,NN.skeletons,NN.animationGroups,NN.transformNodes,NN.geometries,NN.lights,NN.spriteManagers)})).catch((NN=>{CN(NN.message,NN)}))}}),FN,CN,PN,TN,RN,VN)}async function EN(NN,BN,lN,kB,qN,cN,eN,vN){return await new Promise(((HN,TN)=>{try{dN(NN,BN,lN,kB,((NN,BN,lN,kB,qN,cN,eN,vN)=>{HN({meshes:NN,kP:BN,skeletons:lN,animationGroups:kB,transformNodes:qN,geometries:cN,lights:eN,spriteManagers:vN})}),qN,((NN,BN,lN)=>{TN(lN||new Error(BN))}),cN,eN,vN).catch(TN)}catch(sN){TN(sN)}}))}async function KN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vN.b.LastCreatedEngine,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,HN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,TN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,RN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",sN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};lN?await nN(NN,BN,new eN.d(lN),kB,cN,HN,TN,RN,sN):qN.Tools.Error("No engine available")}async function gN(NN,BN,lN,kB,qN,cN,eN){return await new Promise(((vN,HN)=>{KN(NN,BN,lN,(NN=>{vN(NN)}),kB,((NN,BN,lN)=>{HN(lN||new Error(BN))}),qN,cN,eN)}))}async function nN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vN.b.LastCreatedScene,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,cN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,eN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,RN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",VN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!lN)return HN.d.Error("No scene available to append to"),null;const fN=XN(NN,BN);if(!fN)return null;const ZN={};lN.addPendingData(ZN);const PN=()=>{lN.removePendingData(ZN)};TN.c.ShowLoadingScreen&&!FN&&(FN=!0,lN.getEngine().displayLoadingUI(),lN.executeWhenReady((()=>{lN.getEngine().hideLoadingUI(),FN=!1})));const CN=(NN,BN)=>{const kB=MN(fN,NN,BN);cN?cN(lN,kB,new sN.i(kB,sN.e.SceneLoaderError,BN)):HN.d.Error(kB),PN()},IN=qN?NN=>{try{qN(NN)}catch(BN){CN("Error in onProgress callback",BN)}}:void 0,AN=()=>{if(kB)try{kB(lN)}catch(NN){CN("Error in onSuccess callback",NN)}lN.removePendingData(ZN)};return await GN(fN,lN,((NN,BN)=>{if(NN.load){if(!NN.load(lN,BN,fN.rootUrl,CN))return;lN.loadingPluginName=NN.name,AN()}else{NN.loadAsync(lN,BN,fN.rootUrl,IN,fN.name).then((()=>{lN.loadingPluginName=NN.name,AN()})).catch((NN=>{CN(NN.message,NN)}))}}),IN,CN,PN,eN,RN,VN)}async function rN(NN,BN,lN,kB,qN,cN,eN){return await new Promise(((vN,HN)=>{try{nN(NN,BN,lN,(NN=>{vN(NN)}),kB,((NN,BN,lN)=>{HN(lN||new Error(BN))}),qN,cN,eN).catch(HN)}catch(sN){HN(sN)}}))}async function pN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vN.b.LastCreatedScene,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,cN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,eN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,TN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",RN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!lN)return HN.d.Error("No scene available to load asset container to"),null;const VN=XN(NN,BN);if(!VN)return null;const fN={};lN.addPendingData(fN);const ZN=()=>{lN.removePendingData(fN)},PN=(NN,BN)=>{const kB=MN(VN,NN,BN);cN?cN(lN,kB,new sN.i(kB,sN.e.SceneLoaderError,BN)):HN.d.Error(kB),ZN()},CN=qN?NN=>{try{qN(NN)}catch(BN){PN("Error in onProgress callback",BN)}}:void 0,FN=NN=>{if(kB)try{kB(NN)}catch(BN){PN("Error in onSuccess callback",BN)}lN.removePendingData(fN)};return await GN(VN,lN,((NN,BN)=>{if(NN.loadAssetContainer){const kB=NN.loadAssetContainer(lN,BN,VN.rootUrl,PN);if(!kB)return;kB.populateRootNodes(),lN.loadingPluginName=NN.name,FN(kB)}else if(NN.loadAssetContainerAsync){NN.loadAssetContainerAsync(lN,BN,VN.rootUrl,CN,VN.name).then((BN=>{BN.populateRootNodes(),lN.loadingPluginName=NN.name,FN(BN)})).catch((NN=>{PN(NN.message,NN)}))}else PN("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),CN,PN,ZN,eN,TN,RN)}async function xN(NN,BN,lN,kB,qN,cN,eN){return await new Promise(((vN,HN)=>{try{pN(NN,BN,lN,(NN=>{vN(NN)}),kB,((NN,BN,lN)=>{HN(lN||new Error(BN))}),qN,cN,eN).catch(HN)}catch(sN){HN(sN)}}))}async function ON(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vN.b.LastCreatedScene,kB=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,cN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,eN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,TN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,RN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,sN=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,VN=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",fN=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!lN)return void HN.d.Error("No scene available to load animations to");if(kB){for(const kB of lN.animatables)kB.reset();lN.stopAllAnimations();const NN=lN.animationGroups.slice();for(const lN of NN)lN.dispose();const BN=lN.getNodes();for(const lN of BN)lN.animations&&(lN.animations=[])}else switch(qN){case 0:const NN=lN.animationGroups.slice();for(const BN of NN)BN.dispose();break;case 1:for(const BN of lN.animationGroups)BN.stop();break;case 2:for(const BN of lN.animationGroups)BN.reset(),BN.restart();break;case 3:break;default:return void HN.d.Error("Unknown animation group loading mode value '"+qN+"'")}const ZN=lN.animatables.length;await pN(NN,BN,lN,(NN=>{NN.mergeAnimationsTo(lN,lN.animatables.slice(ZN),cN),NN.dispose(),lN.onAnimationFileImportedObservable.notifyObservers(lN),eN&&eN(lN)}),TN,RN,sN,VN,fN)}async function wN(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN){return await new Promise(((RN,VN)=>{try{ON(NN,BN,lN,kB,qN,cN,(NN=>{RN(NN)}),eN,((NN,BN,lN)=>{VN(lN||new Error(BN))}),vN,HN,TN).catch(VN)}catch(sN){VN(sN)}}))}class bN{static get ForceFullSceneLoadingForIncremental(){return TN.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(NN){TN.c.ForceFullSceneLoadingForIncremental=NN}static get ShowLoadingScreen(){return TN.c.ShowLoadingScreen}static set ShowLoadingScreen(NN){TN.c.ShowLoadingScreen=NN}static get loggingLevel(){return TN.c.loggingLevel}static set loggingLevel(NN){TN.c.loggingLevel=NN}static get CleanBoneMatrixWeights(){return TN.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(NN){TN.c.CleanBoneMatrixWeights=NN}static GetDefaultPlugin(){return IN()}static GetPluginForExtension(NN){var BN;return null===(BN=AN(NN,!0))||void 0===BN?void 0:BN.plugin}static IsPluginForExtensionAvailable(NN){return function(NN){return!!CN[NN]}(NN)}static RegisterPlugin(NN){uN(NN)}static ImportMesh(NN,BN,lN,kB,qN,cN,eN,HN,TN){dN(NN,BN,lN,kB,qN,cN,eN,HN,TN).catch((NN=>null===eN||void 0===eN?void 0:eN(vN.b.LastCreatedScene,null===NN||void 0===NN?void 0:NN.message,NN)))}static async ImportMeshAsync(NN,BN,lN,kB,qN,cN,eN){return await EN(NN,BN,lN,kB,qN,cN,eN)}static Load(NN,BN,lN,kB,qN,cN,eN,HN){KN(NN,BN,lN,kB,qN,cN,eN,HN).catch((NN=>null===cN||void 0===cN?void 0:cN(vN.b.LastCreatedScene,null===NN||void 0===NN?void 0:NN.message,NN)))}static async LoadAsync(NN,BN,lN,kB,qN,cN){return await gN(NN,BN,lN,kB,qN,cN)}static Append(NN,BN,lN,kB,qN,cN,eN,HN){nN(NN,BN,lN,kB,qN,cN,eN,HN).catch((NN=>null===cN||void 0===cN?void 0:cN(null!==lN&&void 0!==lN?lN:vN.b.LastCreatedScene,null===NN||void 0===NN?void 0:NN.message,NN)))}static async AppendAsync(NN,BN,lN,kB,qN,cN){return await rN(NN,BN,lN,kB,qN,cN)}static LoadAssetContainer(NN,BN,lN,kB,qN,cN,eN,HN){pN(NN,BN,lN,kB,qN,cN,eN,HN).catch((NN=>null===cN||void 0===cN?void 0:cN(null!==lN&&void 0!==lN?lN:vN.b.LastCreatedScene,null===NN||void 0===NN?void 0:NN.message,NN)))}static async LoadAssetContainerAsync(NN,BN,lN,kB,qN,cN){return await xN(NN,BN,lN,kB,qN,cN)}static ImportAnimations(NN,BN,lN,kB,qN,cN,eN,HN,TN,RN,sN){ON(NN,BN,lN,kB,qN,cN,eN,HN,TN,RN,sN).catch((NN=>null===TN||void 0===TN?void 0:TN(null!==lN&&void 0!==lN?lN:vN.b.LastCreatedScene,null===NN||void 0===NN?void 0:NN.message,NN)))}static async ImportAnimationsAsync(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN,RN){return await wN(NN,BN,lN,kB,qN,cN,vN,TN,RN)}}bN.NO_LOGGING=0,bN.MINIMAL_LOGGING=1,bN.SUMMARY_LOGGING=2,bN.DETAILED_LOGGING=3,bN.OnPluginActivatedObservable=PN},15841:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>VN});var kB=lN(14905),qN=lN(14910),cN=lN(14727),eN=lN(14925),vN=lN(14950),HN=lN(14898),TN=lN(14881),RN=lN(14731),sN=lN(14959);lN(15849);class VN extends vN.d{set boundingBoxSize(NN){if(this._boundingBoxSize&&this._boundingBoxSize.equals(NN))return;this._boundingBoxSize=NN;const BN=this.VB();BN&&BN.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(NN){this._rotationY=NN,this.setReflectionTextureMatrix(eN.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(NN,BN,lN){let kB="";for(const qN of NN)kB+=qN;return new VN(kB,BN,null,lN,NN)}static CreateFromPrefilteredData(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,kB=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const qN=BN.useDelayedTextureLoading;BN.useDelayedTextureLoading=!1;const cN=new VN(NN,BN,null,!1,null,null,null,void 0,!0,lN,kB);return BN.useDelayedTextureLoading=qN,cN}constructor(NN,BN){var lN;let kB=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,qN=arguments.length>3&&void 0!==arguments[3]&&arguments[3],cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,vN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,TN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,sN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,VN=arguments.length>8&&void 0!==arguments[8]&&arguments[8],fN=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,ZN=arguments.length>10&&void 0!==arguments[10]&&arguments[10],PN=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,CN=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,FN=arguments.length>13?arguments[13]:void 0,IN=arguments.length>14?arguments[14]:void 0;super(BN),this.onLoadObservable=new RN.b,this.boundingBoxPosition=eN.fB.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new eN.Matrix,this._buffer=null,this.name=NN,this.url=NN,this._noMipmap=qN,this.Ic=!1,this.isCube=!0,this._textureMatrix=eN.Matrix.Identity(),this.coordinatesMode=HN.c.CUBIC_MODE;let AN=null,MN=null;var GN,XN,uN,dN,EN,KN,gN,nN,rN,pN,xN,ON;null===kB||Array.isArray(kB)?(this._noMipmap=qN,this._format=sN,this._createPolynomials=ZN,AN=kB,this._loaderOptions=FN,this._useSRGBBuffer=IN,this._lodScale=PN,this._lodOffset=CN):(AN=null!==(GN=kB.extensions)&&void 0!==GN?GN:null,this._noMipmap=null!==(XN=kB.noMipmap)&&void 0!==XN&&XN,cN=null!==(uN=kB.files)&&void 0!==uN?uN:null,MN=null!==(dN=kB.buffer)&&void 0!==dN?dN:null,this._format=null!==(EN=kB.format)&&void 0!==EN?EN:5,VN=null!==(KN=kB.prefiltered)&&void 0!==KN&&KN,fN=null!==(gN=kB.forcedExtension)&&void 0!==gN?gN:null,this._createPolynomials=null!==(nN=kB.createPolynomials)&&void 0!==nN&&nN,this._lodScale=null!==(rN=kB.lodScale)&&void 0!==rN?rN:.8,this._lodOffset=null!==(pN=kB.lodOffset)&&void 0!==pN?pN:0,this._loaderOptions=kB.loaderOptions,this._useSRGBBuffer=kB.useSRGBBuffer,vN=null!==(xN=kB.rN)&&void 0!==xN?xN:null,TN=null!==(ON=kB.onError)&&void 0!==ON?ON:null);(NN||cN)&&this.updateURL(NN,fN,vN,VN,TN,AN,null===(lN=this.VB())||void 0===lN?void 0:lN.useDelayedTextureLoading,cN,MN)}getClassName(){return"CubeTexture"}updateURL(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,cN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,eN=arguments.length>6&&void 0!==arguments[6]&&arguments[6],vN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,HN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=NN),this.url=NN,BN&&(this._forcedExtension=BN);const TN=NN.lastIndexOf("."),RN=BN||(TN>-1?NN.substring(TN).toLowerCase():""),sN=0===RN.indexOf(".dds"),VN=0===RN.indexOf(".env"),fN=0===RN.indexOf(".basis");if(VN?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=kB,kB&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),vN)this._files=vN;else if(fN||VN||sN||cN||(cN=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,cN){for(let BN=0;BN<cN.length;BN++)this._files.push(NN+cN[BN]);this._extensions=cN}this._buffer=HN,eN?(this.delayLoadState=4,this._delayedOnLoad=lN,this._delayedOnError=qN):this._loadTexture(lN,qN)}delayLoad(NN){4===this.delayLoadState&&(NN&&(this._forcedExtension=NN),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(NN){var BN,lN;if(NN.updateFlag===this._textureMatrix.updateFlag)return;NN.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(lN=this.VB())||void 0===lN||lN.markAllMaterialsAsDirty(1,(NN=>-1!==NN.getActiveTextures().indexOf(this))));if(this._textureMatrix=NN,null===(BN=this.VB())||void 0===BN||!BN.useRightHandedSystem)return;const kB=eN.TmpVectors.fB[0],qN=eN.TmpVectors.Quaternion[0],cN=eN.TmpVectors.fB[1];this._textureMatrix.decompose(kB,qN,cN),qN.z*=-1,qN.w*=-1,eN.Matrix.ComposeToRef(kB,qN,cN,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var NN;return null!==(NN=this.VB())&&void 0!==NN&&NN.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const lN=this.VB(),kB=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const qN=()=>{var BN;(this.onLoadObservable.notifyObservers(this),kB)&&(kB.dispose(),null===(BN=this.VB())||void 0===BN||BN.markAllMaterialsAsDirty(1));NN&&NN()},eN=(NN,lN)=>{this._loadingError=!0,this._errorObject={message:NN,exception:lN},BN&&BN(NN,lN),HN.c.OnTextureLoadErrorObservable.notifyObservers(this)};var vN;this._texture?this._texture.isReady?cN.Tools.SetImmediate((()=>qN())):this._texture.onLoadedObservable.add((()=>qN())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,lN,this._lodScale,this._lodOffset,NN,eN,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,lN,this._files,this._noMipmap,NN,eN,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(vN=this._texture)||void 0===vN||vN.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(NN,BN,lN){const kB=sN.b.Parse((()=>{var kB;let qN=!1;return NN.prefiltered&&(qN=NN.prefiltered),new VN(lN+(null!==(kB=NN.url)&&void 0!==kB?kB:NN.name),BN,NN.extensions,!1,NN.files||null,null,null,void 0,qN,NN.forcedExtension)}),NN,BN);if(NN.boundingBoxPosition&&(kB.boundingBoxPosition=eN.fB.IB(NN.boundingBoxPosition)),NN.boundingBoxSize&&(kB.boundingBoxSize=eN.fB.IB(NN.boundingBoxSize)),NN.animations)for(let qN=0;qN<NN.animations.length;qN++){const BN=NN.animations[qN],lN=(0,TN.b)("BABYLON.Animation");lN&&kB.animations.push(lN.Parse(BN))}return kB}clone(){let NN=0;const BN=sN.b.Clone((()=>{const BN=new VN(this.url,this.VB()||this._getEngine(),this._extensions,this._noMipmap,this._files);return NN=BN.uniqueId,BN}),this);return BN.uniqueId=NN,BN}}(0,kB.c)([(0,qN.G)()],VN.prototype,"url",void 0),(0,kB.c)([(0,qN.F)()],VN.prototype,"boundingBoxPosition",void 0),(0,kB.c)([(0,qN.F)()],VN.prototype,"boundingBoxSize",null),(0,kB.c)([(0,qN.G)("rotationY")],VN.prototype,"rotationY",null),(0,kB.c)([(0,qN.G)("files")],VN.prototype,"_files",void 0),(0,kB.c)([(0,qN.G)("forcedExtension")],VN.prototype,"_forcedExtension",void 0),(0,kB.c)([(0,qN.G)("extensions")],VN.prototype,"_extensions",void 0),(0,kB.c)([(0,qN.s)("textureMatrix")],VN.prototype,"_textureMatrix",void 0),(0,kB.c)([(0,qN.s)("textureMatrixRefraction")],VN.prototype,"_textureMatrixRefraction",void 0),HN.c._CubeTextureParser=VN.Parse,(0,TN.f)("BABYLON.CubeTexture",VN)},16759:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>HN});var kB=lN(14746),qN=lN(14898),cN=lN(14888),eN=lN(15050),vN=lN(14861);eN.ThinEngine.prototype.createDynamicTexture=function(NN,BN,lN,kB){const qN=new vN.d(this,4);return qN.baseWidth=NN,qN.baseHeight=BN,lN&&(NN=this.needPOTTextures?(0,cN.i)(NN,this._caps.maxTextureSize):NN,BN=this.needPOTTextures?(0,cN.i)(BN,this._caps.maxTextureSize):BN),qN.width=NN,qN.height=BN,qN.isReady=!1,qN.generateMipMaps=lN,qN.samplingMode=kB,this.updateTextureSamplingMode(kB,qN),this._internalTexturesCache.push(qN),qN},eN.ThinEngine.prototype.updateDynamicTexture=function(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],qN=arguments.length>4?arguments[4]:void 0,cN=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!NN)return;const eN=this._gl,vN=eN.TEXTURE_2D,HN=this._bindTextureDirectly(vN,NN,!0,cN);this._unpackFlipY(void 0===lN?NN.invertY:lN),kB&&eN.pixelStorei(eN.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const TN=this._getWebGLTextureType(NN.type),RN=this._getInternalFormat(qN||NN.format),sN=this._getRGBABufferInternalSizedFormat(NN.type,RN);eN.texImage2D(vN,0,sN,RN,TN,BN),NN.generateMipMaps&&eN.generateMipmap(vN),HN||this._bindTextureDirectly(vN,null),kB&&eN.pixelStorei(eN.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),qN&&(NN.format=qN),NN._dynamicTextureSource=BN,NN._premulAlpha=kB,NN.invertY=lN||!1,NN.isReady=!0};class HN extends qN.c{constructor(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,eN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,vN=arguments.length>6?arguments[6]:void 0;const HN=!lN||lN._isScene;super(null,HN?lN:null===lN||void 0===lN?void 0:lN.PB,HN?!kB:lN,vN,cN,void 0,void 0,void 0,void 0,eN),this.name=NN,this.wrapU=qN.c.CLAMP_ADDRESSMODE,this.wrapV=qN.c.CLAMP_ADDRESSMODE,this._generateMipMaps=kB;const TN=this._getEngine();if(!TN)return;if(BN.getContext)this._canvas=BN,this._ownCanvas=!1,this._texture=TN.createDynamicTexture(this._canvas.width,this._canvas.height,kB,cN);else{this._canvas=TN.createCanvas(1,1),this._ownCanvas=!0;const NN=BN;NN.width||0===NN.width?this._texture=TN.createDynamicTexture(NN.width,NN.height,kB,cN):this._texture=TN.createDynamicTexture(BN,BN,kB,cN)}const RN=this.getSize();this._canvas.width!==RN.width&&(this._canvas.width=RN.width),this._canvas.height!==RN.height&&(this._canvas.height=RN.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(NN){this._canvas.width=NN.width,this._canvas.height=NN.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(NN.width,NN.height,this._generateMipMaps,this.samplingMode)}scale(NN){const BN=this.getSize();BN.width*=NN,BN.height*=NN,this._recreate(BN)}scaleTo(NN,BN){const lN=this.getSize();lN.width=NN,lN.height=BN,this._recreate(lN)}getContext(){return this._context}clear(NN){const BN=this.getSize();NN&&(this._context.fillStyle=NN),this._context.clearRect(0,0,BN.width,BN.height)}update(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===NN||NN,BN,this._format||void 0,void 0,lN)}drawText(NN,BN,lN,kB,qN,cN,eN){let vN=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const HN=this.getSize();if(cN&&(this._context.fillStyle=cN,this._context.fillRect(0,0,HN.width,HN.height)),this._context.font=kB,null===BN||void 0===BN){const lN=this._context.measureText(NN);BN=(HN.width-lN.width)/2}if(null===lN||void 0===lN){const NN=parseInt(kB.replace(/\D/g,""));lN=HN.height/2+NN/3.65}this._context.fillStyle=qN||"",this._context.fillText(NN,BN,lN),vN&&this.update(eN)}dispose(){var NN,BN;(super.dispose(),this._ownCanvas)&&(null===(NN=this._canvas)||void 0===NN||null===(BN=NN.remove)||void 0===BN||BN.call(NN));this._canvas=null,this._context=null}clone(){const NN=this.VB();if(!NN)return this;const BN=this.getSize(),lN=new HN(this.name,BN,NN,this._generateMipMaps);return lN.Ic=this.Ic,lN.level=this.level,lN.wrapU=this.wrapU,lN.wrapV=this.wrapV,lN}serialize(){const NN=this.VB();NN&&!NN.isReady()&&kB.d.Warn("The scene must be ready before serializing the dynamic texture");const BN=super.serialize();return HN._IsCanvasElement(this._canvas)&&(BN.base64String=this._canvas.toDataURL()),BN.invertY=this._invertY,BN.samplingMode=this.samplingMode,BN}static _IsCanvasElement(NN){return void 0!==NN.toDataURL}_rebuild(){this.update()}}},15801:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>qN});var kB=lN(14898);class qN extends kB.c{get depth(){return this._depth}constructor(NN,BN,lN,qN,cN,eN){let vN=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],HN=arguments.length>7&&void 0!==arguments[7]&&arguments[7],TN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:kB.c.TRILINEAR_SAMPLINGMODE,RN=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,sN=arguments.length>10?arguments[10]:void 0;super(null,eN,!vN,HN),this.format=cN,this._texture=eN.getEngine().createRawTexture2DArray(NN,BN,lN,qN,cN,vN,HN,TN,null,RN,sN),this._depth=qN,this.is2DArray=!0}update(NN){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,NN,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(NN,BN,lN,kB,cN){return new qN(NN,BN,lN,kB,5,cN,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},16056:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>vN,i:()=>HN,k:()=>cN,m:()=>eN});var kB=lN(14945),qN=lN(14925);function cN(NN,BN){return"{X: ".concat(NN.x.toFixed(BN)," Y: ").concat(NN.y.toFixed(BN),"}")}function eN(NN,BN){return"{X: ".concat(NN._x.toFixed(BN)," Y: ").concat(NN._y.toFixed(BN)," Z: ").concat(NN._z.toFixed(BN),"}")}function vN(NN,BN){return 2*Math.acos((0,kB.Clamp)(qN.Quaternion.Dot(NN,BN)))}function HN(NN,BN){const lN=new qN.Quaternion;return function(NN,BN,lN){const cN=qN.fB.Cross(NN,BN),eN=Math.acos((0,kB.Clamp)(qN.fB.Dot(NN,BN),-1,1));qN.Quaternion.RotationAxisToRef(cN,eN,lN)}(NN,BN,lN),lN}},16291:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>TN});var kB=lN(14925),qN=lN(14972),cN=lN(15391),eN=lN(15379),vN=lN(14984);lN(16293);function HN(NN){let BN=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const lN=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],cN=[];let HN=[];const TN=NN.width||NN.size||1,RN=NN.height||NN.size||1,sN=NN.depth||NN.size||1,VN=NN.wrap||!1;let fN=void 0===NN.topBaseAt?1:NN.topBaseAt,ZN=void 0===NN.bottomBaseAt?0:NN.bottomBaseAt;fN=(fN+4)%4,ZN=(ZN+4)%4;let PN=[2,0,3,1][fN],CN=[2,0,1,3][ZN],FN=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(VN){BN=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],FN=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let NN=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],lN=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const kB=[17,18,19,16],qN=[22,23,20,21];for(;PN>0;)NN.unshift(NN.pop()),kB.unshift(kB.pop()),PN--;for(;CN>0;)lN.unshift(lN.pop()),qN.unshift(qN.pop()),CN--;NN=NN.flat(),lN=lN.flat(),FN=FN.concat(NN).concat(lN),BN.push(kB[0],kB[2],kB[3],kB[0],kB[1],kB[2]),BN.push(qN[0],qN[2],qN[3],qN[0],qN[1],qN[2])}const IN=[TN/2,RN/2,sN/2];HN=FN.reduce(((NN,BN,lN)=>NN.concat(BN*IN[lN%3])),[]);const AN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,MN=NN.faceUV||new Array(6),GN=NN.faceColors,XN=[];for(let eN=0;eN<6;eN++)void 0===MN[eN]&&(MN[eN]=new kB.Vector4(0,0,1,1)),GN&&void 0===GN[eN]&&(GN[eN]=new qN.xc(1,1,1,1));for(let kB=0;kB<6;kB++)if(cN.push(MN[kB].z,vN.b?1-MN[kB].w:MN[kB].w),cN.push(MN[kB].x,vN.b?1-MN[kB].w:MN[kB].w),cN.push(MN[kB].x,vN.b?1-MN[kB].y:MN[kB].y),cN.push(MN[kB].z,vN.b?1-MN[kB].y:MN[kB].y),GN)for(let NN=0;NN<4;NN++)XN.push(GN[kB].r,GN[kB].g,GN[kB].b,GN[kB].a);eN.e._ComputeSides(AN,HN,BN,lN,cN,NN.frontUVs,NN.backUVs);const uN=new eN.e;if(uN.indices=BN,uN.positions=HN,uN.normals=lN,uN.uvs=cN,GN){const NN=AN===eN.e.DOUBLESIDE?XN.concat(XN):XN;uN.colors=NN}return uN}function TN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new cN.e(NN,lN);BN.sideOrientation=cN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return HN(BN).applyToMesh(kB,BN.updatable),kB}eN.e.CreateBox=HN,cN.e.CreateBox=function(NN,BN){return TN(NN,{size:BN,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},16042:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>vN});var kB=lN(15391),qN=lN(15379),cN=lN(14984);function eN(NN){const BN=[],lN=[],kB=[],eN=[],vN=NN.radius||.5,HN=NN.tessellation||64,TN=NN.arc&&(NN.arc<=0||NN.arc>1)?1:NN.arc||1,RN=0===NN.sideOrientation?0:NN.sideOrientation||qN.e.DEFAULTSIDE;BN.push(0,0,0),eN.push(.5,.5);const sN=2*Math.PI*TN,VN=1===TN?sN/HN:sN/(HN-1);let fN=0;for(let qN=0;qN<HN;qN++){const NN=Math.cos(fN),lN=Math.sin(fN),kB=(NN+1)/2,qN=(1-lN)/2;BN.push(vN*NN,vN*lN,0),eN.push(kB,cN.b?1-qN:qN),fN+=VN}1===TN&&(BN.push(BN[3],BN[4],BN[5]),eN.push(eN[2],cN.b?1-eN[3]:eN[3]));const ZN=BN.length/3;for(let qN=1;qN<ZN-1;qN++)lN.push(qN+1,0,qN);qN.e.ComputeNormals(BN,lN,kB),qN.e._ComputeSides(RN,BN,lN,kB,eN,NN.frontUVs,NN.backUVs);const PN=new qN.e;return PN.indices=lN,PN.positions=BN,PN.normals=kB,PN.uvs=eN,PN}function vN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const qN=new kB.e(NN,lN);BN.sideOrientation=kB.e._GetDefaultSideOrientation(BN.sideOrientation),qN._originalBuilderSideOrientation=BN.sideOrientation;return eN(BN).applyToMesh(qN,BN.updatable),qN}qN.e.CreateDisc=eN,kB.e.CreateDisc=function(NN,BN,lN){return vN(NN,{radius:BN,tessellation:lN,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},16293:(NN,BN,lN)=>{"use strict";lN.d(BN,{h:()=>CN,e:()=>IN,k:()=>FN});var kB=lN(14925),qN=lN(14972),cN=lN(15391),eN=lN(15379),vN=lN(14998);cN.e._GroundMeshParser=(NN,BN)=>HN.Parse(NN,BN);class HN extends cN.e{constructor(NN,BN){super(NN,BN),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=NN,this._subdivisionsY=NN,this.subdivide(NN);const lN=this;lN.createOrUpdateSubmeshesOctree&&lN.createOrUpdateSubmeshesOctree(BN)}getHeightAtCoordinates(NN,BN){const lN=this.getWorldMatrix(),qN=kB.TmpVectors.Matrix[5];lN.invertToRef(qN);const cN=kB.TmpVectors.fB[8];if(kB.fB.TransformCoordinatesFromFloatsToRef(NN,0,BN,qN,cN),NN=cN.x,BN=cN.z,NN<this._minX||NN>=this._maxX||BN<=this._minZ||BN>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const eN=this._getFacetAt(NN,BN),vN=-(eN.x*NN+eN.z*BN+eN.w)/eN.y;return kB.fB.TransformCoordinatesFromFloatsToRef(0,vN,0,lN,cN),cN.y}getNormalAtCoordinates(NN,BN){const lN=new kB.fB(0,1,0);return this.getNormalAtCoordinatesToRef(NN,BN,lN),lN}getNormalAtCoordinatesToRef(NN,BN,lN){const qN=this.getWorldMatrix(),cN=kB.TmpVectors.Matrix[5];qN.invertToRef(cN);const eN=kB.TmpVectors.fB[8];if(kB.fB.TransformCoordinatesFromFloatsToRef(NN,0,BN,cN,eN),NN=eN.x,BN=eN.z,NN<this._minX||NN>this._maxX||BN<this._minZ||BN>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const vN=this._getFacetAt(NN,BN);return kB.fB.TransformNormalFromFloatsToRef(vN.x,vN.y,vN.z,qN,lN),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(NN,BN){const lN=Math.floor((NN+this._maxX)*this._subdivisionsX/this._width),kB=Math.floor(-(BN+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),qN=this._heightQuads[kB*this._subdivisionsX+lN];let cN;return cN=BN<qN.slope.x*NN+qN.slope.y?qN.facet1:qN.facet2,cN}_initHeightQuads(){const NN=this._subdivisionsX,BN=this._subdivisionsY;this._heightQuads=[];for(let lN=0;lN<BN;lN++)for(let BN=0;BN<NN;BN++){const qN={slope:kB.Vector2.Zero(),facet1:new kB.Vector4(0,0,0,0),facet2:new kB.Vector4(0,0,0,0)};this._heightQuads[lN*NN+BN]=qN}return this}_computeHeightQuads(){const NN=this.getVerticesData(vN.f.PositionKind);if(!NN)return this;const BN=kB.TmpVectors.fB[3],lN=kB.TmpVectors.fB[2],qN=kB.TmpVectors.fB[1],cN=kB.TmpVectors.fB[0],eN=kB.TmpVectors.fB[4],HN=kB.TmpVectors.fB[5],TN=kB.TmpVectors.fB[6],RN=kB.TmpVectors.fB[7],sN=kB.TmpVectors.fB[8];let VN=0,fN=0,ZN=0,PN=0,CN=0,FN=0,IN=0;const AN=this._subdivisionsX,MN=this._subdivisionsY;for(let vN=0;vN<MN;vN++)for(let MN=0;MN<AN;MN++){VN=3*MN,fN=vN*(AN+1)*3,ZN=(vN+1)*(AN+1)*3,BN.x=NN[fN+VN],BN.y=NN[fN+VN+1],BN.z=NN[fN+VN+2],lN.x=NN[fN+VN+3],lN.y=NN[fN+VN+4],lN.z=NN[fN+VN+5],qN.x=NN[ZN+VN],qN.y=NN[ZN+VN+1],qN.z=NN[ZN+VN+2],cN.x=NN[ZN+VN+3],cN.y=NN[ZN+VN+4],cN.z=NN[ZN+VN+5],PN=(cN.z-BN.z)/(cN.x-BN.x),CN=BN.z-PN*BN.x,lN.subtractToRef(BN,eN),qN.subtractToRef(BN,HN),cN.subtractToRef(BN,TN),kB.fB.CrossToRef(TN,HN,RN),kB.fB.CrossToRef(eN,TN,sN),RN.normalize(),sN.normalize(),FN=-(RN.x*BN.x+RN.y*BN.y+RN.z*BN.z),IN=-(sN.x*lN.x+sN.y*lN.y+sN.z*lN.z);const GN=this._heightQuads[vN*AN+MN];GN.slope.Kc(PN,CN),GN.facet1.Kc(RN.x,RN.y,RN.z,FN),GN.facet2.Kc(sN.x,sN.y,sN.z,IN)}return this}serialize(NN){super.serialize(NN),NN.subdivisionsX=this._subdivisionsX,NN.subdivisionsY=this._subdivisionsY,NN.minX=this._minX,NN.maxX=this._maxX,NN.Mc=this._minZ,NN.Gc=this._maxZ,NN.width=this._width,NN.height=this._height}static Parse(NN,BN){const lN=new HN(NN.name,BN);return lN._subdivisionsX=NN.subdivisionsX||1,lN._subdivisionsY=NN.subdivisionsY||1,lN._minX=NN.minX,lN._maxX=NN.maxX,lN._minZ=NN.Mc,lN._maxZ=NN.Gc,lN._width=NN.width,lN._height=NN.height,lN}}var TN=lN(14727),RN=lN(14773),sN=lN(14934),VN=lN(14984);function fN(NN){const BN=[],lN=[],qN=[],cN=[];let vN,HN;const TN=NN.width||NN.size||1,RN=NN.height||NN.size||1,sN=0|(NN.subdivisionsX||NN.subdivisions||1),fN=0|(NN.subdivisionsY||NN.subdivisions||1);for(vN=0;vN<=fN;vN++)for(HN=0;HN<=sN;HN++){const NN=new kB.fB(HN*TN/sN-TN/2,0,(fN-vN)*RN/fN-RN/2),BN=new kB.fB(0,1,0);lN.push(NN.x,NN.y,NN.z),qN.push(BN.x,BN.y,BN.z),cN.push(HN/sN,VN.b?vN/fN:1-vN/fN)}for(vN=0;vN<fN;vN++)for(HN=0;HN<sN;HN++)BN.push(HN+1+(vN+1)*(sN+1)),BN.push(HN+1+vN*(sN+1)),BN.push(HN+vN*(sN+1)),BN.push(HN+(vN+1)*(sN+1)),BN.push(HN+1+(vN+1)*(sN+1)),BN.push(HN+vN*(sN+1));const ZN=new eN.e;return ZN.indices=BN,ZN.positions=lN,ZN.normals=qN,ZN.uvs=cN,ZN}function ZN(NN){const BN=void 0!==NN.xmin&&null!==NN.xmin?NN.xmin:-1,lN=void 0!==NN.zmin&&null!==NN.zmin?NN.zmin:-1,qN=void 0!==NN.xmax&&null!==NN.xmax?NN.xmax:1,cN=void 0!==NN.zmax&&null!==NN.zmax?NN.zmax:1,vN=NN.subdivisions||{w:1,h:1},HN=NN.precision||{w:1,h:1},TN=[],RN=[],sN=[],VN=[];let fN,ZN,PN,CN;vN.h=vN.h<1?1:vN.h,vN.w=vN.w<1?1:vN.w,HN.w=HN.w<1?1:HN.w,HN.h=HN.h<1?1:HN.h;const FN=(qN-BN)/vN.w,IN=(cN-lN)/vN.h;function AN(NN,BN,lN,qN){const cN=RN.length/3,eN=HN.w+1;for(fN=0;fN<HN.h;fN++)for(ZN=0;ZN<HN.w;ZN++){const NN=[cN+ZN+fN*eN,cN+(ZN+1)+fN*eN,cN+(ZN+1)+(fN+1)*eN,cN+ZN+(fN+1)*eN];TN.push(NN[1]),TN.push(NN[2]),TN.push(NN[3]),TN.push(NN[0]),TN.push(NN[1]),TN.push(NN[3])}const vN=kB.fB.Zero(),PN=new kB.fB(0,1,0);for(fN=0;fN<=HN.h;fN++)for(vN.z=fN*(qN-BN)/HN.h+BN,ZN=0;ZN<=HN.w;ZN++)vN.x=ZN*(lN-NN)/HN.w+NN,vN.y=0,RN.push(vN.x,vN.y,vN.z),sN.push(PN.x,PN.y,PN.z),VN.push(ZN/HN.w,fN/HN.h)}for(PN=0;PN<vN.h;PN++)for(CN=0;CN<vN.w;CN++)AN(BN+CN*FN,lN+PN*IN,BN+(CN+1)*FN,lN+(PN+1)*IN);const MN=new eN.e;return MN.indices=TN,MN.positions=RN,MN.normals=sN,MN.uvs=VN,MN}function PN(NN){const BN=[],lN=[],cN=[],vN=[];let HN,TN;const RN=NN.colorFilter||new qN.FB(.3,.59,.11),VN=NN.alphaFilter||0;let fN=!1;if(NN.minHeight>NN.maxHeight){fN=!0;const BN=NN.maxHeight;NN.maxHeight=NN.minHeight,NN.minHeight=BN}for(HN=0;HN<=NN.subdivisions;HN++)for(TN=0;TN<=NN.subdivisions;TN++){const BN=new kB.fB(TN*NN.width/NN.subdivisions-NN.width/2,0,(NN.subdivisions-HN)*NN.height/NN.subdivisions-NN.height/2),qN=4*(((BN.x+NN.width/2)/NN.width*(NN.bufferWidth-1)|0)+((1-(BN.z+NN.height/2)/NN.height)*(NN.bufferHeight-1)|0)*NN.bufferWidth);let eN=NN.buffer[qN]/255,ZN=NN.buffer[qN+1]/255,PN=NN.buffer[qN+2]/255;const CN=NN.buffer[qN+3]/255;fN&&(eN=1-eN,ZN=1-ZN,PN=1-PN);const FN=eN*RN.r+ZN*RN.g+PN*RN.b;BN.y=CN>=VN?NN.minHeight+(NN.maxHeight-NN.minHeight)*FN:NN.minHeight-sN.e,NN.heightBuffer&&(NN.heightBuffer[HN*(NN.subdivisions+1)+TN]=BN.y),lN.push(BN.x,BN.y,BN.z),cN.push(0,0,0),vN.push(TN/NN.subdivisions,1-HN/NN.subdivisions)}for(HN=0;HN<NN.subdivisions;HN++)for(TN=0;TN<NN.subdivisions;TN++){const kB=TN+1+(HN+1)*(NN.subdivisions+1),qN=TN+1+HN*(NN.subdivisions+1),cN=TN+HN*(NN.subdivisions+1),eN=TN+(HN+1)*(NN.subdivisions+1),vN=lN[3*kB+1]>=NN.minHeight,RN=lN[3*qN+1]>=NN.minHeight,sN=lN[3*cN+1]>=NN.minHeight;vN&&RN&&sN&&(BN.push(kB),BN.push(qN),BN.push(cN));lN[3*eN+1]>=NN.minHeight&&vN&&sN&&(BN.push(eN),BN.push(kB),BN.push(cN))}eN.e.ComputeNormals(lN,BN,cN);const ZN=new eN.e;return ZN.indices=BN,ZN.positions=lN,ZN.normals=cN,ZN.uvs=vN,ZN}function CN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const lN=new HN(NN,arguments.length>2?arguments[2]:void 0);lN._setReady(!1),lN._subdivisionsX=BN.subdivisionsX||BN.subdivisions||1,lN._subdivisionsY=BN.subdivisionsY||BN.subdivisions||1,lN._width=BN.width||1,lN._height=BN.height||1,lN._maxX=lN._width/2,lN._maxZ=lN._height/2,lN._minX=-lN._maxX,lN._minZ=-lN._maxZ;return fN(BN).applyToMesh(lN,BN.updatable),lN._setReady(!0),lN}function FN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new cN.e(NN,lN);return ZN(BN).applyToMesh(kB,BN.updatable),kB}function IN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const cN=lN.width||10,eN=lN.height||10,vN=lN.subdivisions||1,sN=lN.minHeight||0,VN=lN.maxHeight||1,fN=lN.colorFilter||new qN.FB(.3,.59,.11),ZN=lN.alphaFilter||0,CN=lN.updatable,FN=lN.onReady;kB=kB||RN.b.LastCreatedScene;const IN=new HN(NN,kB);let AN;IN._subdivisionsX=vN,IN._subdivisionsY=vN,IN._width=cN,IN._height=eN,IN._maxX=IN._width/2,IN._maxZ=IN._height/2,IN._minX=-IN._maxX,IN._minZ=-IN._maxZ,IN._setReady(!1),lN.passHeightBufferInCallback&&(AN=new Float32Array((vN+1)*(vN+1)));const MN=(NN,BN,lN)=>{PN({width:cN,height:eN,subdivisions:vN,minHeight:sN,maxHeight:VN,colorFilter:fN,buffer:NN,bufferWidth:BN,bufferHeight:lN,alphaFilter:ZN,heightBuffer:AN}).applyToMesh(IN,CN),FN&&FN(IN,AN),IN._setReady(!0)};if("string"===typeof BN){const NN=NN=>{var BN;const lN=NN.width,qN=NN.height;if(kB.eN)return;const cN=null===(BN=kB)||void 0===BN?void 0:BN.getEngine().resizeImageBitmap(NN,lN,qN);MN(cN,lN,qN)};TN.Tools.LoadImage(BN,NN,lN.onError?lN.onError:()=>{},kB.offlineProvider)}else MN(BN.data,BN.width,BN.height);return IN}eN.e.CreateGround=fN,eN.e.CreateTiledGround=ZN,eN.e.CreateGroundFromHeightMap=PN,cN.e.CreateGround=(NN,BN,lN,kB,qN,cN)=>CN(NN,{width:BN,height:lN,subdivisions:kB,updatable:cN},qN),cN.e.CreateTiledGround=(NN,BN,lN,kB,qN,cN,eN,vN,HN)=>FN(NN,{xmin:BN,zmin:lN,xmax:kB,zmax:qN,subdivisions:cN,precision:eN,updatable:HN},vN),cN.e.CreateGroundFromHeightMap=(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN,RN)=>IN(NN,BN,{width:lN,height:kB,subdivisions:qN,minHeight:cN,maxHeight:eN,updatable:HN,onReady:TN,alphaFilter:RN},vN)},16321:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>fN,f:()=>sN,h:()=>VN});var kB=lN(14925),qN=lN(15391),cN=lN(15379),eN=lN(15491),vN=lN(14998),HN=lN(14746);function TN(NN){const BN=[],lN=[],kB=NN.lines,qN=NN.colors,eN=[];let vN=0;for(let cN=0;cN<kB.length;cN++){const NN=kB[cN];for(let kB=0;kB<NN.length;kB++){const{x:HN,y:TN,z:RN}=NN[kB];if(lN.push(HN,TN,RN),qN){const NN=qN[cN],{r:BN,g:lN,b:vN,a:HN}=NN[kB];eN.push(BN,lN,vN,HN)}kB>0&&(BN.push(vN-1),BN.push(vN)),vN++}}const HN=new cN.e;return HN.indices=BN,HN.positions=lN,qN&&(HN.colors=eN),HN}function RN(NN){const BN=NN.dashSize||3,lN=NN.gapSize||1,qN=NN.dashNb||200,eN=NN.points,vN=[],HN=[],TN=kB.fB.Zero();let RN=0,sN=0,VN=0,fN=0,ZN=0,PN=0,CN=0;for(CN=0;CN<eN.length-1;CN++)eN[CN+1].subtractToRef(eN[CN],TN),RN+=TN.length();for(VN=RN/qN,fN=BN*VN/(BN+lN),CN=0;CN<eN.length-1;CN++){eN[CN+1].subtractToRef(eN[CN],TN),sN=Math.floor(TN.length()/VN),TN.normalize();for(let NN=0;NN<sN;NN++)ZN=VN*NN,vN.push(eN[CN].x+ZN*TN.x,eN[CN].y+ZN*TN.y,eN[CN].z+ZN*TN.z),vN.push(eN[CN].x+(ZN+fN)*TN.x,eN[CN].y+(ZN+fN)*TN.y,eN[CN].z+(ZN+fN)*TN.z),HN.push(PN,PN+1),PN+=2}const FN=new cN.e;return FN.positions=vN,FN.indices=HN,FN}function sN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=BN.instance,qN=BN.lines,cN=BN.colors;if(kB){const NN=kB.getVerticesData(vN.f.PositionKind);let BN,lN;cN&&(BN=kB.getVerticesData(vN.f.ColorKind));let eN=0,HN=0;for(let kB=0;kB<qN.length;kB++){const vN=qN[kB];for(let qN=0;qN<vN.length;qN++)NN[eN]=vN[qN].x,NN[eN+1]=vN[qN].y,NN[eN+2]=vN[qN].z,cN&&BN&&(lN=cN[kB],BN[HN]=lN[qN].r,BN[HN+1]=lN[qN].g,BN[HN+2]=lN[qN].b,BN[HN+3]=lN[qN].a,HN+=4),eN+=3}return kB.updateVerticesData(vN.f.PositionKind,NN,!1,!1),cN&&BN&&kB.updateVerticesData(vN.f.ColorKind,BN,!1,!1),kB.refreshBoundingInfo(),kB}const HN=!!cN,RN=new eN.e(NN,lN,null,void 0,void 0,HN,BN.useVertexAlpha,BN.material);return TN(BN).applyToMesh(RN,BN.updatable),RN}function VN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=BN.colors?[BN.colors]:null;return sN(NN,{lines:[BN.points],updatable:BN.updatable,instance:BN.instance,colors:kB,useVertexAlpha:BN.useVertexAlpha,material:BN.material},lN)}function fN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const cN=BN.points,vN=BN.instance,TN=BN.gapSize||1,sN=BN.dashSize||3;if(vN){const NN=NN=>{const BN=kB.fB.Zero(),lN=NN.length/6;let qN=0,eN=0,HN=0,TN=0,RN=0,sN=0,VN=0,fN=0;for(VN=0;VN<cN.length-1;VN++)cN[VN+1].subtractToRef(cN[VN],BN),qN+=BN.length();HN=qN/lN;const ZN=vN._creationDataStorage.dashSize;for(TN=ZN*HN/(ZN+vN._creationDataStorage.gapSize),VN=0;VN<cN.length-1;VN++)for(cN[VN+1].subtractToRef(cN[VN],BN),eN=Math.floor(BN.length()/HN),BN.normalize(),fN=0;fN<eN&&sN<NN.length;)RN=HN*fN,NN[sN]=cN[VN].x+RN*BN.x,NN[sN+1]=cN[VN].y+RN*BN.y,NN[sN+2]=cN[VN].z+RN*BN.z,NN[sN+3]=cN[VN].x+(RN+TN)*BN.x,NN[sN+4]=cN[VN].y+(RN+TN)*BN.y,NN[sN+5]=cN[VN].z+(RN+TN)*BN.z,sN+=6,fN++;for(;sN<NN.length;)NN[sN]=cN[VN].x,NN[sN+1]=cN[VN].y,NN[sN+2]=cN[VN].z,sN+=3};return(BN.dashNb||BN.dashSize||BN.gapSize||BN.useVertexAlpha||BN.material)&&HN.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),vN.updateMeshPositions(NN,!1),vN}const VN=new eN.e(NN,lN,null,void 0,void 0,void 0,BN.useVertexAlpha,BN.material);return RN(BN).applyToMesh(VN,BN.updatable),VN._creationDataStorage=new qN.h,VN._creationDataStorage.dashSize=sN,VN._creationDataStorage.gapSize=TN,VN}cN.e.CreateLineSystem=TN,cN.e.CreateDashedLines=RN,qN.e.Ps=function(NN,BN){return VN(NN,{points:BN,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},qN.e.CreateDashedLines=function(NN,BN,lN,kB,qN){return fN(NN,{points:BN,dashSize:lN,gapSize:kB,dashNb:qN,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},16296:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>vN,d:()=>HN});var kB=lN(15391),qN=lN(15379),cN=lN(14984);function eN(NN){const BN=[],lN=[],kB=[],eN=[],vN=void 0!==NN.width?NN.width:void 0!==NN.size?NN.size:1,HN=void 0!==NN.height?NN.height:void 0!==NN.size?NN.size:1,TN=0===NN.sideOrientation?0:NN.sideOrientation||qN.e.DEFAULTSIDE,RN=vN/2,sN=HN/2;lN.push(-RN,-sN,0),kB.push(0,0,-1),eN.push(0,cN.b?1:0),lN.push(RN,-sN,0),kB.push(0,0,-1),eN.push(1,cN.b?1:0),lN.push(RN,sN,0),kB.push(0,0,-1),eN.push(1,cN.b?0:1),lN.push(-RN,sN,0),kB.push(0,0,-1),eN.push(0,cN.b?0:1),BN.push(0),BN.push(1),BN.push(2),BN.push(0),BN.push(2),BN.push(3),qN.e._ComputeSides(TN,lN,BN,kB,eN,NN.frontUVs,NN.backUVs);const VN=new qN.e;return VN.indices=BN,VN.positions=lN,VN.normals=kB,VN.uvs=eN,VN}function vN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const qN=new kB.e(NN,lN);BN.sideOrientation=kB.e._GetDefaultSideOrientation(BN.sideOrientation),qN._originalBuilderSideOrientation=BN.sideOrientation;return eN(BN).applyToMesh(qN,BN.updatable),BN.sourcePlane&&(qN.translate(BN.sourcePlane.normal,-BN.sourcePlane.d),qN.setDirection(BN.sourcePlane.normal.scale(-1))),qN}const HN={Is:vN};qN.e.Is=eN,kB.e.Is=(NN,BN,lN,kB,qN)=>vN(NN,{size:BN,width:BN,height:BN,sideOrientation:qN,updatable:kB},lN)},16040:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>HN});var kB=lN(14925),qN=lN(15391),cN=lN(15379),eN=lN(14984);function vN(NN){const BN=0|(NN.segments||32),lN=NN.diameterX||NN.diameter||1,qN=NN.diameterY||NN.diameter||1,vN=NN.diameterZ||NN.diameter||1,HN=NN.arc&&(NN.arc<=0||NN.arc>1)?1:NN.arc||1,TN=NN.slice&&NN.slice<=0?1:NN.slice||1,RN=0===NN.sideOrientation?0:NN.sideOrientation||cN.e.DEFAULTSIDE,sN=!!NN.dedupTopBottomIndices,VN=new kB.fB(lN/2,qN/2,vN/2),fN=2+BN,ZN=2*fN,PN=[],CN=[],FN=[],IN=[];for(let cN=0;cN<=fN;cN++){const NN=cN/fN,BN=NN*Math.PI*TN;for(let lN=0;lN<=ZN;lN++){const qN=lN/ZN,cN=qN*Math.PI*2*HN,vN=kB.Matrix.RotationZ(-BN),TN=kB.Matrix.RotationY(cN),RN=kB.fB.TransformCoordinates(kB.fB.Up(),vN),sN=kB.fB.TransformCoordinates(RN,TN),fN=sN.multiply(VN),PN=sN.divide(VN).normalize();CN.push(fN.x,fN.y,fN.z),FN.push(PN.x,PN.y,PN.z),IN.push(qN,eN.b?1-NN:NN)}if(cN>0){const NN=CN.length/3;for(let BN=NN-2*(ZN+1);BN+ZN+2<NN;BN++)sN?(cN>1&&(PN.push(BN),PN.push(BN+1),PN.push(BN+ZN+1)),(cN<fN||TN<1)&&(PN.push(BN+ZN+1),PN.push(BN+1),PN.push(BN+ZN+2))):(PN.push(BN),PN.push(BN+1),PN.push(BN+ZN+1),PN.push(BN+ZN+1),PN.push(BN+1),PN.push(BN+ZN+2))}}cN.e._ComputeSides(RN,CN,PN,FN,IN,NN.frontUVs,NN.backUVs);const AN=new cN.e;return AN.indices=PN,AN.positions=CN,AN.normals=FN,AN.uvs=IN,AN}function HN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return vN(BN).applyToMesh(kB,BN.updatable),kB}cN.e.CreateSphere=vN,qN.e.CreateSphere=(NN,BN,lN,kB,qN,cN)=>HN(NN,{segments:BN,diameterX:lN,diameterY:lN,diameterZ:lN,sideOrientation:cN,updatable:qN},kB)},16775:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>HN});var kB=lN(19),qN=lN(15509),cN=lN(15856),eN=lN(15527),vN=lN(15379);class HN{static get Configuration(){return{get decoder(){return cN.d.DefaultConfiguration},set decoder(NN){cN.d.DefaultConfiguration=NN}}}static set Configuration(NN){cN.d.DefaultConfiguration=NN.decoder}static get DecoderAvailable(){return(0,qN.f)(cN.d.DefaultConfiguration)}static get Default(){var NN;return null!==(NN=HN._Default)&&void 0!==NN||(HN._Default=new HN),HN._Default}static ResetDefault(NN){HN._Default&&(NN||HN._Default.dispose(),HN._Default=null)}constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HN.DefaultNumWorkers;const BN="number"===typeof NN?(0,kB.d)((0,kB.d)({},cN.d.DefaultConfiguration),{},{numWorkers:NN}):(0,kB.d)((0,kB.d)({},cN.d.DefaultConfiguration),NN);this._decoder=new cN.d(BN)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(NN,BN,lN){return this._decoder.decodeMeshToMeshDataAsync(NN,BN,lN)}async decodeMeshToGeometryAsync(NN,BN,lN,kB){return await this._decoder.decodeMeshToGeometryAsync(NN,BN,lN,kB)}async _decodeMeshToGeometryForGltfAsync(NN,BN,lN,kB,qN,cN){return await this._decoder._decodeMeshToGeometryForGltfAsync(NN,BN,lN,kB,qN,cN)}async decodeMeshAsync(NN,BN){const lN=await this._decoder.decodeMeshToMeshDataAsync(NN,BN),kB=new vN.e;lN.indices&&(kB.indices=lN.indices);for(const qN of lN.attributes){const NN=eN.c.GetFloatData(qN.data,qN.size,eN.c.GetDataType(qN.data),qN.byteOffset,qN.byteStride,qN.normalized,lN.totalVertices);kB.set(NN,qN.kind)}return kB}}HN.DefaultNumWorkers=(0,qN.e)(),HN._Default=null},15856:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>TN});var kB=lN(15509),qN=lN(14727),cN=lN(15408),eN=lN(15527),vN=lN(14746),HN=lN(15520);class TN extends kB.b{static get DefaultAvailable(){return(0,kB.f)(TN.DefaultConfiguration)}static get Default(){var NN;return null!==(NN=TN._Default)&&void 0!==NN||(TN._Default=new TN),TN._Default}static ResetDefault(NN){TN._Default&&(NN||TN._Default.dispose(),TN._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(NN,BN){return{module:await(BN||DracoDecoderModule)({wasmBinary:NN})}}_getWorkerContent(){return"".concat(HN.d,"(").concat(HN.e,")()")}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:TN.DefaultConfiguration)}decodeMeshToMeshDataAsync(NN,BN,lN){const kB=NN instanceof ArrayBuffer?new Int8Array(NN):new Int8Array(NN.buffer,NN.byteOffset,NN.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async NN=>await new Promise(((qN,cN)=>{NN.push(((NN,eN)=>{let HN=null;const TN=[],RN=BN=>{NN.removeEventListener("error",RN),NN.removeEventListener("message",sN),cN(BN),eN()},sN=BN=>{const kB=BN.data;switch(kB.id){case"indices":HN=kB.data;break;case"attribute":TN.push({kind:kB.kind,data:kB.data,size:kB.size,byteOffset:kB.byteOffset,byteStride:kB.byteStride,normalized:(cN=kB.kind,VN=kB.normalized,lN&&void 0!==lN[cN]?(VN!==lN[cN]&&vN.d.Warn("Normalized flag from Draco data (".concat(VN,") does not match normalized flag from glTF accessor (").concat(lN[cN],"). Using flag from glTF accessor.")),lN[cN]):VN)});break;case"decodeMeshDone":NN.removeEventListener("error",RN),NN.removeEventListener("message",sN),qN({indices:HN,attributes:TN,totalVertices:kB.totalVertices}),eN()}var cN,VN};NN.addEventListener("error",RN),NN.addEventListener("message",sN);const VN=kB.slice();NN.postMessage({id:"decodeMesh",dataView:VN,attributes:BN},[VN.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((NN=>{let lN=null;const qN=[],cN=(0,HN.d)(NN.module,kB,BN,(NN=>{lN=NN}),((NN,BN,lN,kB,cN,eN)=>{qN.push({kind:NN,data:BN,size:lN,byteOffset:kB,byteStride:cN,normalized:eN})}));return{indices:lN,attributes:qN,totalVertices:cN}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(NN,BN,lN,kB){const qN=await this.decodeMeshToMeshDataAsync(lN,kB),vN=new cN.c(NN,BN);qN.indices&&vN.setIndices(qN.indices);for(const cN of qN.attributes)vN.setVerticesBuffer(new eN.c(BN.getEngine(),cN.data,cN.kind,!1,void 0,cN.byteStride,void 0,cN.byteOffset,cN.size,void 0,cN.normalized,!0),qN.totalVertices);return vN}async _decodeMeshToGeometryForGltfAsync(NN,BN,lN,kB,qN,vN){const HN=await this.decodeMeshToMeshDataAsync(lN,kB,qN),TN=new cN.c(NN,BN);vN&&(TN._boundingInfo=vN,TN.useBoundingInfoFromGeometry=!0),HN.indices&&TN.setIndices(HN.indices);for(const cN of HN.attributes)TN.setVerticesBuffer(new eN.c(BN.getEngine(),cN.data,cN.kind,!1,void 0,cN.byteStride,void 0,cN.byteOffset,cN.size,void 0,cN.normalized,!0),HN.totalVertices);return TN}}TN.DefaultConfiguration={wasmUrl:"".concat(qN.Tools._DefaultCdnUrl,"/draco_wasm_wrapper_gltf.js"),wasmBinaryUrl:"".concat(qN.Tools._DefaultCdnUrl,"/draco_decoder_gltf.wasm"),fallbackUrl:"".concat(qN.Tools._DefaultCdnUrl,"/draco_decoder_gltf.js")},TN._Default=null},16314:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>vB});var kB=lN(14925),qN=lN(15391),cN=lN(14998),eN=lN(15379),vN=lN(14984);function HN(NN){let BN=NN.pathArray;const lN=NN.closeArray||!1,kB=NN.closePath||!1,qN=NN.invertUV||!1,HN=Math.floor(BN[0].length/2);let TN=NN.offset||HN;TN=TN>HN?HN:Math.floor(TN);const RN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,sN=NN.uvs,VN=NN.colors,fN=[],ZN=[],PN=[],CN=[],FN=[],IN=[],AN=[],MN=[];let GN;const XN=[],uN=[];let dN,EN,KN;if(BN.length<2){const NN=[],lN=[];for(EN=0;EN<BN[0].length-TN;EN++)NN.push(BN[0][EN]),lN.push(BN[0][EN+TN]);BN=[NN,lN]}let gN=0;const nN=kB?1:0,rN=lN?1:0;let pN,xN,ON,wN,bN,mB;for(GN=BN[0].length,dN=0;dN<BN.length+rN;dN++){for(AN[dN]=0,FN[dN]=[0],pN=dN===BN.length?BN[0]:BN[dN],xN=pN.length,GN=GN<xN?GN:xN,KN=0;KN<xN;)fN.push(pN[KN].x,pN[KN].y,pN[KN].z),KN>0&&(ON=pN[KN].ZB(pN[KN-1]).length(),wN=ON+AN[dN],FN[dN].push(wN),AN[dN]=wN),KN++;kB&&(KN--,fN.push(pN[0].x,pN[0].y,pN[0].z),ON=pN[KN].ZB(pN[0]).length(),wN=ON+AN[dN],FN[dN].push(wN),AN[dN]=wN),XN[dN]=xN+nN,uN[dN]=gN,gN+=xN+nN}let aN,DN,yN=null,LN=null;for(EN=0;EN<GN+nN;EN++)for(MN[EN]=0,IN[EN]=[0],dN=0;dN<BN.length-1+rN;dN++)bN=BN[dN],mB=dN===BN.length-1?BN[0]:BN[dN+1],EN===GN?(yN=bN[0],LN=mB[0]):(yN=bN[EN],LN=mB[EN]),ON=LN.ZB(yN).length(),wN=ON+MN[EN],IN[EN].push(wN),MN[EN]=wN;if(sN)for(dN=0;dN<sN.length;dN++)CN.push(sN[dN].x,vN.b?1-sN[dN].y:sN[dN].y);else for(dN=0;dN<BN.length+rN;dN++)for(EN=0;EN<GN+nN;EN++)aN=0!=AN[dN]?FN[dN][EN]/AN[dN]:0,DN=0!=MN[EN]?IN[EN][dN]/MN[EN]:0,qN?CN.push(DN,aN):CN.push(aN,vN.b?1-DN:DN);dN=0;let hN=0,UN=XN[dN]-1,WN=XN[dN+1]-1,QN=UN<WN?UN:WN,SN=uN[1]-uN[0];const iB=XN.length-1;for(;hN<=QN&&dN<iB;)ZN.push(hN,hN+SN,hN+1),ZN.push(hN+SN+1,hN+1,hN+SN),hN+=1,hN===QN&&(dN++,SN=uN[dN+1]-uN[dN],UN=XN[dN]-1,WN=XN[dN+1]-1,hN=uN[dN],QN=UN<WN?UN+hN:WN+hN);if(eN.e.ComputeNormals(fN,ZN,PN),kB){let NN=0,lN=0;for(dN=0;dN<BN.length;dN++){NN=3*uN[dN],lN=dN+1<BN.length?3*(uN[dN+1]-1):PN.length-3,PN[NN]=.5*(PN[NN]+PN[lN]),PN[NN+1]=.5*(PN[NN+1]+PN[lN+1]),PN[NN+2]=.5*(PN[NN+2]+PN[lN+2]);const kB=Math.sqrt(PN[NN]*PN[NN]+PN[NN+1]*PN[NN+1]+PN[NN+2]*PN[NN+2]);PN[NN]/=kB,PN[NN+1]/=kB,PN[NN+2]/=kB,PN[lN]=PN[NN],PN[lN+1]=PN[NN+1],PN[lN+2]=PN[NN+2]}}if(lN){let NN=3*uN[0],lN=3*uN[BN.length];for(EN=0;EN<GN+nN;EN++){PN[NN]=.5*(PN[NN]+PN[lN]),PN[NN+1]=.5*(PN[NN+1]+PN[lN+1]),PN[NN+2]=.5*(PN[NN+2]+PN[lN+2]);const BN=Math.sqrt(PN[NN]*PN[NN]+PN[NN+1]*PN[NN+1]+PN[NN+2]*PN[NN+2]);PN[NN]/=BN,PN[NN+1]/=BN,PN[NN+2]/=BN,PN[lN]=PN[NN],PN[lN+1]=PN[NN+1],PN[lN+2]=PN[NN+2],NN+=3,lN+=3}}eN.e._ComputeSides(RN,fN,ZN,PN,CN,NN.frontUVs,NN.backUVs);let tN=null;if(VN){tN=new Float32Array(4*VN.length);for(let NN=0;NN<VN.length;NN++)tN[4*NN]=VN[NN].r,tN[4*NN+1]=VN[NN].g,tN[4*NN+2]=VN[NN].b,tN[4*NN+3]=VN[NN].a}const oN=new eN.e,JN=new Float32Array(fN),YN=new Float32Array(PN),jB=new Float32Array(CN);return oN.indices=ZN,oN.positions=JN,oN.normals=YN,oN.uvs=jB,tN&&oN.set(tN,cN.f.ColorKind),kB&&(oN._idx=uN),oN}function TN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const TN=BN.pathArray,RN=BN.closeArray,sN=BN.closePath,VN=qN.e._GetDefaultSideOrientation(BN.sideOrientation),fN=BN.instance,ZN=BN.updatable;if(fN){const NN=kB.TmpVectors.fB[0].nc(Number.MAX_VALUE),lN=kB.TmpVectors.fB[1].nc(-Number.MAX_VALUE),HN=BN=>{let kB=TN[0].length;const cN=fN;let eN=0;const vN=cN._originalBuilderSideOrientation===qN.e.DOUBLESIDE?2:1;for(let qN=1;qN<=vN;++qN)for(let vN=0;vN<TN.length;++vN){const qN=TN[vN],HN=qN.length;kB=kB<HN?kB:HN;for(let cN=0;cN<kB;++cN){const kB=qN[cN];BN[eN]=kB.x,BN[eN+1]=kB.y,BN[eN+2]=kB.z,NN.minimizeInPlaceFromFloats(kB.x,kB.y,kB.z),lN.maximizeInPlaceFromFloats(kB.x,kB.y,kB.z),eN+=3}if(cN._creationDataStorage&&cN._creationDataStorage.closePath){const NN=qN[0];BN[eN]=NN.x,BN[eN+1]=NN.y,BN[eN+2]=NN.z,eN+=3}}},RN=fN.getVerticesData(cN.f.PositionKind);if(HN(RN),fN.hasBoundingInfo?fN.getBoundingInfo().reConstruct(NN,lN,fN._worldMatrix):fN.buildBoundingInfo(NN,lN,fN._worldMatrix),fN.updateVerticesData(cN.f.PositionKind,RN,!1,!1),BN.colors){const NN=fN.getVerticesData(cN.f.ColorKind);for(let lN=0,kB=0;lN<BN.colors.length;lN++,kB+=4){const qN=BN.colors[lN];NN[kB]=qN.r,NN[kB+1]=qN.g,NN[kB+2]=qN.b,NN[kB+3]=qN.a}fN.updateVerticesData(cN.f.ColorKind,NN,!1,!1)}if(BN.uvs){const NN=fN.getVerticesData(cN.f.UVKind);for(let lN=0;lN<BN.uvs.length;lN++)NN[2*lN]=BN.uvs[lN].x,NN[2*lN+1]=vN.b?1-BN.uvs[lN].y:BN.uvs[lN].y;fN.updateVerticesData(cN.f.UVKind,NN,!1,!1)}if(!fN.areNormalsFrozen||fN.isFacetDataEnabled){const NN=fN.Ec(),BN=fN.getVerticesData(cN.f.NormalKind),lN=fN.isFacetDataEnabled?fN.getFacetDataParameters():null;if(eN.e.ComputeNormals(RN,NN,BN,lN),fN._creationDataStorage&&fN._creationDataStorage.closePath){let NN=0,lN=0;for(let kB=0;kB<TN.length;kB++)NN=3*fN._creationDataStorage.idx[kB],lN=kB+1<TN.length?3*(fN._creationDataStorage.idx[kB+1]-1):BN.length-3,BN[NN]=.5*(BN[NN]+BN[lN]),BN[NN+1]=.5*(BN[NN+1]+BN[lN+1]),BN[NN+2]=.5*(BN[NN+2]+BN[lN+2]),BN[lN]=BN[NN],BN[lN+1]=BN[NN+1],BN[lN+2]=BN[NN+2]}fN.areNormalsFrozen||fN.updateVerticesData(cN.f.NormalKind,BN,!1,!1)}return fN}{const kB=new qN.e(NN,lN);kB._originalBuilderSideOrientation=VN,kB._creationDataStorage=new qN.h;const cN=HN(BN);return sN&&(kB._creationDataStorage.idx=cN._idx),kB._creationDataStorage.closePath=sN,kB._creationDataStorage.closeArray=RN,cN.applyToMesh(kB,ZN),kB}}eN.e.CreateRibbon=HN,qN.e.CreateRibbon=function(NN,BN){return TN(NN,{pathArray:BN,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var RN=lN(16042),sN=lN(16291),VN=lN(14972);function fN(NN){const BN=NN.pattern||qN.e.NO_FLIP,lN=NN.tileWidth||NN.tileSize||1,kB=NN.tileHeight||NN.tileSize||1,cN=NN.alignHorizontal||0,vN=NN.alignVertical||0,HN=NN.width||NN.size||1,TN=Math.floor(HN/lN);let RN=HN-TN*lN;const sN=NN.height||NN.size||1,VN=Math.floor(sN/kB);let fN=sN-VN*kB;const ZN=lN*TN/2,PN=kB*VN/2;let CN=0,FN=0,IN=0,AN=0,MN=0,GN=0;if(RN>0||fN>0){switch(IN=-ZN,AN=-PN,MN=ZN,GN=PN,cN){case qN.e.CENTER:RN/=2,IN-=RN,MN+=RN;break;case qN.e.LEFT:MN+=RN,CN=-RN/2;break;case qN.e.RIGHT:IN-=RN,CN=RN/2}switch(vN){case qN.e.CENTER:fN/=2,AN-=fN,GN+=fN;break;case qN.e.BOTTOM:GN+=fN,FN=-fN/2;break;case qN.e.TOP:AN-=fN,FN=fN/2}}const XN=[],uN=[],dN=[];dN[0]=[0,0,1,0,1,1,0,1],dN[1]=[0,0,1,0,1,1,0,1],BN!==qN.e.ROTATE_TILE&&BN!==qN.e.ROTATE_ROW||(dN[1]=[1,1,0,1,0,0,1,0]),BN!==qN.e.FLIP_TILE&&BN!==qN.e.FLIP_ROW||(dN[1]=[1,0,0,0,0,1,1,1]),BN!==qN.e.FLIP_N_ROTATE_TILE&&BN!==qN.e.FLIP_N_ROTATE_ROW||(dN[1]=[0,1,1,1,1,0,0,0]);let EN=[];const KN=[],gN=[];let nN=0;for(let eN=0;eN<VN;eN++)for(let NN=0;NN<TN;NN++)XN.push(NN*lN-ZN+CN,eN*kB-PN+FN,0),XN.push((NN+1)*lN-ZN+CN,eN*kB-PN+FN,0),XN.push((NN+1)*lN-ZN+CN,(eN+1)*kB-PN+FN,0),XN.push(NN*lN-ZN+CN,(eN+1)*kB-PN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),EN=BN===qN.e.FLIP_TILE||BN===qN.e.ROTATE_TILE||BN===qN.e.FLIP_N_ROTATE_TILE?EN.concat(dN[(NN%2+eN%2)%2]):BN===qN.e.FLIP_ROW||BN===qN.e.ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_ROW?EN.concat(dN[eN%2]):EN.concat(dN[0]),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),nN+=4;if(RN>0||fN>0){const NN=fN>0&&(vN===qN.e.CENTER||vN===qN.e.TOP),eN=fN>0&&(vN===qN.e.CENTER||vN===qN.e.BOTTOM),HN=RN>0&&(cN===qN.e.CENTER||cN===qN.e.RIGHT),sN=RN>0&&(cN===qN.e.CENTER||cN===qN.e.LEFT);let dN,rN,pN,xN,ON=[];if(NN&&HN&&(XN.push(IN+CN,AN+FN,0),XN.push(-ZN+CN,AN+FN,0),XN.push(-ZN+CN,AN+fN+FN,0),XN.push(IN+CN,AN+fN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,dN=1-RN/lN,rN=1-fN/kB,pN=1,xN=1,ON=[dN,rN,pN,rN,pN,xN,dN,xN],BN===qN.e.ROTATE_ROW&&(ON=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),BN===qN.e.FLIP_ROW&&(ON=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),BN===qN.e.FLIP_N_ROTATE_ROW&&(ON=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]),EN=EN.concat(ON),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),NN&&sN&&(XN.push(ZN+CN,AN+FN,0),XN.push(MN+CN,AN+FN,0),XN.push(MN+CN,AN+fN+FN,0),XN.push(ZN+CN,AN+fN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,dN=0,rN=1-fN/kB,pN=RN/lN,xN=1,ON=[dN,rN,pN,rN,pN,xN,dN,xN],(BN===qN.e.ROTATE_ROW||BN===qN.e.ROTATE_TILE&&TN%2===0)&&(ON=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),(BN===qN.e.FLIP_ROW||BN===qN.e.FLIP_TILE&&TN%2===0)&&(ON=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),(BN===qN.e.FLIP_N_ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_TILE&&TN%2===0)&&(ON=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]),EN=EN.concat(ON),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),eN&&HN&&(XN.push(IN+CN,PN+FN,0),XN.push(-ZN+CN,PN+FN,0),XN.push(-ZN+CN,GN+FN,0),XN.push(IN+CN,GN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,dN=1-RN/lN,rN=0,pN=1,xN=fN/kB,ON=[dN,rN,pN,rN,pN,xN,dN,xN],(BN===qN.e.ROTATE_ROW&&VN%2===1||BN===qN.e.ROTATE_TILE&&VN%1===0)&&(ON=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),(BN===qN.e.FLIP_ROW&&VN%2===1||BN===qN.e.FLIP_TILE&&VN%2===0)&&(ON=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),(BN===qN.e.FLIP_N_ROTATE_ROW&&VN%2===1||BN===qN.e.FLIP_N_ROTATE_TILE&&VN%2===0)&&(ON=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]),EN=EN.concat(ON),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),eN&&sN&&(XN.push(ZN+CN,PN+FN,0),XN.push(MN+CN,PN+FN,0),XN.push(MN+CN,GN+FN,0),XN.push(ZN+CN,GN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,dN=0,rN=0,pN=RN/lN,xN=fN/kB,ON=[dN,rN,pN,rN,pN,xN,dN,xN],(BN===qN.e.ROTATE_ROW&&VN%2===1||BN===qN.e.ROTATE_TILE&&(VN+TN)%2===1)&&(ON=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),(BN===qN.e.FLIP_ROW&&VN%2===1||BN===qN.e.FLIP_TILE&&(VN+TN)%2===1)&&(ON=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),(BN===qN.e.FLIP_N_ROTATE_ROW&&VN%2===1||BN===qN.e.FLIP_N_ROTATE_TILE&&(VN+TN)%2===1)&&(ON=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]),EN=EN.concat(ON),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),NN){const NN=[];dN=0,rN=1-fN/kB,pN=1,xN=1,NN[0]=[dN,rN,pN,rN,pN,xN,dN,xN],NN[1]=[dN,rN,pN,rN,pN,xN,dN,xN],BN!==qN.e.ROTATE_TILE&&BN!==qN.e.ROTATE_ROW||(NN[1]=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),BN!==qN.e.FLIP_TILE&&BN!==qN.e.FLIP_ROW||(NN[1]=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),BN!==qN.e.FLIP_N_ROTATE_TILE&&BN!==qN.e.FLIP_N_ROTATE_ROW||(NN[1]=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]);for(let kB=0;kB<TN;kB++)XN.push(kB*lN-ZN+CN,AN+FN,0),XN.push((kB+1)*lN-ZN+CN,AN+FN,0),XN.push((kB+1)*lN-ZN+CN,AN+fN+FN,0),XN.push(kB*lN-ZN+CN,AN+fN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,EN=BN===qN.e.FLIP_TILE||BN===qN.e.ROTATE_TILE||BN===qN.e.FLIP_N_ROTATE_TILE?EN.concat(NN[(kB+1)%2]):BN===qN.e.FLIP_ROW||BN===qN.e.ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_ROW?EN.concat(NN[1]):EN.concat(NN[0]),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(eN){const NN=[];dN=0,rN=0,pN=1,xN=fN/kB,NN[0]=[dN,rN,pN,rN,pN,xN,dN,xN],NN[1]=[dN,rN,pN,rN,pN,xN,dN,xN],BN!==qN.e.ROTATE_TILE&&BN!==qN.e.ROTATE_ROW||(NN[1]=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),BN!==qN.e.FLIP_TILE&&BN!==qN.e.FLIP_ROW||(NN[1]=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),BN!==qN.e.FLIP_N_ROTATE_TILE&&BN!==qN.e.FLIP_N_ROTATE_ROW||(NN[1]=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]);for(let kB=0;kB<TN;kB++)XN.push(kB*lN-ZN+CN,GN-fN+FN,0),XN.push((kB+1)*lN-ZN+CN,GN-fN+FN,0),XN.push((kB+1)*lN-ZN+CN,GN+FN,0),XN.push(kB*lN-ZN+CN,GN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,EN=BN===qN.e.FLIP_TILE||BN===qN.e.ROTATE_TILE||BN===qN.e.FLIP_N_ROTATE_TILE?EN.concat(NN[(kB+VN)%2]):BN===qN.e.FLIP_ROW||BN===qN.e.ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_ROW?EN.concat(NN[VN%2]):EN.concat(NN[0]),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(HN){const NN=[];dN=1-RN/lN,rN=0,pN=1,xN=1,NN[0]=[dN,rN,pN,rN,pN,xN,dN,xN],NN[1]=[dN,rN,pN,rN,pN,xN,dN,xN],BN!==qN.e.ROTATE_TILE&&BN!==qN.e.ROTATE_ROW||(NN[1]=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),BN!==qN.e.FLIP_TILE&&BN!==qN.e.FLIP_ROW||(NN[1]=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),BN!==qN.e.FLIP_N_ROTATE_TILE&&BN!==qN.e.FLIP_N_ROTATE_ROW||(NN[1]=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]);for(let lN=0;lN<VN;lN++)XN.push(IN+CN,lN*kB-PN+FN,0),XN.push(IN+RN+CN,lN*kB-PN+FN,0),XN.push(IN+RN+CN,(lN+1)*kB-PN+FN,0),XN.push(IN+CN,(lN+1)*kB-PN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,EN=BN===qN.e.FLIP_TILE||BN===qN.e.ROTATE_TILE||BN===qN.e.FLIP_N_ROTATE_TILE?EN.concat(NN[(lN+1)%2]):BN===qN.e.FLIP_ROW||BN===qN.e.ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_ROW?EN.concat(NN[lN%2]):EN.concat(NN[0]),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(sN){const NN=[];dN=0,rN=0,pN=RN/kB,xN=1,NN[0]=[dN,rN,pN,rN,pN,xN,dN,xN],NN[1]=[dN,rN,pN,rN,pN,xN,dN,xN],BN!==qN.e.ROTATE_TILE&&BN!==qN.e.ROTATE_ROW||(NN[1]=[1-dN,1-rN,1-pN,1-rN,1-pN,1-xN,1-dN,1-xN]),BN!==qN.e.FLIP_TILE&&BN!==qN.e.FLIP_ROW||(NN[1]=[1-dN,rN,1-pN,rN,1-pN,xN,1-dN,xN]),BN!==qN.e.FLIP_N_ROTATE_TILE&&BN!==qN.e.FLIP_N_ROTATE_ROW||(NN[1]=[dN,1-rN,pN,1-rN,pN,1-xN,dN,1-xN]);for(let lN=0;lN<VN;lN++)XN.push(MN-RN+CN,lN*kB-PN+FN,0),XN.push(MN+CN,lN*kB-PN+FN,0),XN.push(MN+CN,(lN+1)*kB-PN+FN,0),XN.push(MN-RN+CN,(lN+1)*kB-PN+FN,0),gN.push(nN,nN+1,nN+3,nN+1,nN+2,nN+3),nN+=4,EN=BN===qN.e.FLIP_TILE||BN===qN.e.ROTATE_TILE||BN===qN.e.FLIP_N_ROTATE_TILE?EN.concat(NN[(lN+TN)%2]):BN===qN.e.FLIP_ROW||BN===qN.e.ROTATE_ROW||BN===qN.e.FLIP_N_ROTATE_ROW?EN.concat(NN[lN%2]):EN.concat(NN[0]),KN.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),uN.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const rN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE;eN.e._ComputeSides(rN,XN,gN,uN,EN,NN.frontUVs,NN.backUVs);const pN=new eN.e;pN.indices=gN,pN.positions=XN,pN.normals=uN,pN.uvs=EN;const xN=rN===eN.e.DOUBLESIDE?KN.concat(KN):KN;return pN.colors=xN,pN}function ZN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return fN(BN).applyToMesh(kB,BN.updatable),kB}function PN(NN){const BN=NN.faceUV||new Array(6),lN=NN.faceColors,cN=NN.pattern||qN.e.NO_FLIP,HN=NN.width||NN.size||1,TN=NN.height||NN.size||1,RN=NN.depth||NN.size||1,sN=NN.tileWidth||NN.tileSize||1,ZN=NN.tileHeight||NN.tileSize||1,PN=NN.alignHorizontal||0,CN=NN.alignVertical||0,FN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE;for(let qN=0;qN<6;qN++)void 0===BN[qN]&&(BN[qN]=new kB.Vector4(0,0,1,1)),lN&&void 0===lN[qN]&&(lN[qN]=new VN.xc(1,1,1,1));const IN=HN/2,AN=TN/2,MN=RN/2,GN=[];for(let kB=0;kB<2;kB++)GN[kB]=fN({pattern:cN,tileWidth:sN,tileHeight:ZN,width:HN,height:TN,alignVertical:CN,alignHorizontal:PN,sideOrientation:FN});for(let kB=2;kB<4;kB++)GN[kB]=fN({pattern:cN,tileWidth:sN,tileHeight:ZN,width:RN,height:TN,alignVertical:CN,alignHorizontal:PN,sideOrientation:FN});let XN=CN;CN===qN.e.BOTTOM?XN=qN.e.TOP:CN===qN.e.TOP&&(XN=qN.e.BOTTOM);for(let kB=4;kB<6;kB++)GN[kB]=fN({pattern:cN,tileWidth:sN,tileHeight:ZN,width:HN,height:RN,alignVertical:XN,alignHorizontal:PN,sideOrientation:FN});let uN=[],dN=[],EN=[],KN=[];const gN=[],nN=[],rN=[],pN=[];let xN=0,ON=0;for(let qN=0;qN<6;qN++){const NN=GN[qN].positions.length;nN[qN]=[],rN[qN]=[];for(let BN=0;BN<NN/3;BN++)nN[qN].push(new kB.fB(GN[qN].positions[3*BN],GN[qN].positions[3*BN+1],GN[qN].positions[3*BN+2])),rN[qN].push(new kB.fB(GN[qN].normals[3*BN],GN[qN].normals[3*BN+1],GN[qN].normals[3*BN+2]));xN=GN[qN].uvs.length,pN[qN]=[];for(let lN=0;lN<xN;lN+=2)pN[qN][lN]=BN[qN].x+(BN[qN].z-BN[qN].x)*GN[qN].uvs[lN],pN[qN][lN+1]=BN[qN].y+(BN[qN].w-BN[qN].y)*GN[qN].uvs[lN+1],vN.b&&(pN[qN][lN+1]=1-pN[qN][lN+1]);if(EN=EN.concat(pN[qN]),KN=KN.concat(GN[qN].indices.map((NN=>NN+ON))),ON+=nN[qN].length,lN)for(let BN=0;BN<4;BN++)gN.push(lN[qN].r,lN[qN].g,lN[qN].b,lN[qN].a)}const wN=new kB.fB(0,0,MN),bN=kB.Matrix.RotationY(Math.PI);uN=nN[0].map((NN=>kB.fB.TransformNormal(NN,bN).add(wN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]),dN=rN[0].map((NN=>kB.fB.TransformNormal(NN,bN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]),uN=uN.concat(nN[1].map((NN=>NN.ZB(wN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),dN=dN.concat(rN[1].map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]));const mB=new kB.fB(IN,0,0),aN=kB.Matrix.RotationY(-Math.PI/2);uN=uN.concat(nN[2].map((NN=>kB.fB.TransformNormal(NN,aN).add(mB))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),dN=dN.concat(rN[2].map((NN=>kB.fB.TransformNormal(NN,aN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]));const DN=kB.Matrix.RotationY(Math.PI/2);uN=uN.concat(nN[3].map((NN=>kB.fB.TransformNormal(NN,DN).ZB(mB))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),dN=dN.concat(rN[3].map((NN=>kB.fB.TransformNormal(NN,DN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]));const yN=new kB.fB(0,AN,0),LN=kB.Matrix.RotationX(Math.PI/2);uN=uN.concat(nN[4].map((NN=>kB.fB.TransformNormal(NN,LN).add(yN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),dN=dN.concat(rN[4].map((NN=>kB.fB.TransformNormal(NN,LN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[]));const hN=kB.Matrix.RotationX(-Math.PI/2);uN=uN.concat(nN[5].map((NN=>kB.fB.TransformNormal(NN,hN).ZB(yN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),dN=dN.concat(rN[5].map((NN=>kB.fB.TransformNormal(NN,hN))).map((NN=>[NN.x,NN.y,NN.z])).reduce(((NN,BN)=>NN.concat(BN)),[])),eN.e._ComputeSides(FN,uN,KN,dN,EN);const UN=new eN.e;if(UN.indices=KN,UN.positions=uN,UN.normals=dN,UN.uvs=EN,lN){const NN=FN===eN.e.DOUBLESIDE?gN.concat(gN):gN;UN.colors=NN}return UN}function CN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return PN(BN).applyToMesh(kB,BN.updatable),kB}eN.e.CreateTiledPlane=fN;eN.e.CreateTiledBox=PN;var FN=lN(16040),IN=lN(15162),AN=lN(15123);function MN(NN){const BN=NN.height||2;let lN=0===NN.diameterTop?0:NN.diameterTop||NN.diameter||1,cN=0===NN.diameterBottom?0:NN.diameterBottom||NN.diameter||1;lN=lN||1e-5,cN=cN||1e-5;const HN=0|(NN.tessellation||24),TN=0|(NN.subdivisions||1),RN=!!NN.hasRings,sN=!!NN.enclose,fN=0===NN.cap?0:NN.cap||qN.e.CAP_ALL,ZN=NN.arc&&(NN.arc<=0||NN.arc>1)?1:NN.arc||1,PN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,CN=NN.faceUV||new Array(3),FN=NN.faceColors,IN=2+(1+(1!==ZN&&sN?2:0))*(RN?TN:1);let MN;for(MN=0;MN<IN;MN++)FN&&void 0===FN[MN]&&(FN[MN]=new VN.xc(1,1,1,1));for(MN=0;MN<IN;MN++)CN&&void 0===CN[MN]&&(CN[MN]=new kB.Vector4(0,0,1,1));const GN=[],XN=[],uN=[],dN=[],EN=[],KN=2*Math.PI*ZN/HN;let gN,nN,rN;const pN=(cN-lN)/2/BN,xN=kB.fB.Zero(),ON=kB.fB.Zero(),wN=kB.fB.Zero(),bN=kB.fB.Zero(),mB=kB.fB.Zero(),aN=AN.c.Y;let DN,yN,LN,hN=1,UN=1,WN=0,QN=0;for(DN=0;DN<=TN;DN++)for(nN=DN/TN,rN=(nN*(lN-cN)+cN)/2,hN=RN&&0!==DN&&DN!==TN?2:1,LN=0;LN<hN;LN++){for(RN&&(UN+=LN),sN&&(UN+=2*LN),yN=0;yN<=HN;yN++)gN=yN*KN,xN.x=Math.cos(-gN)*rN,xN.y=-BN/2+nN*BN,xN.z=Math.sin(-gN)*rN,0===lN&&DN===TN?(ON.x=uN[uN.length-3*(HN+1)],ON.y=uN[uN.length-3*(HN+1)+1],ON.z=uN[uN.length-3*(HN+1)+2]):(ON.x=xN.x,ON.z=xN.z,ON.y=Math.sqrt(ON.x*ON.x+ON.z*ON.z)*pN,ON.normalize()),0===yN&&(wN.kB(xN),bN.kB(ON)),XN.push(xN.x,xN.y,xN.z),uN.push(ON.x,ON.y,ON.z),QN=RN?WN!==UN?CN[UN].y:CN[UN].w:CN[UN].y+(CN[UN].w-CN[UN].y)*nN,dN.push(CN[UN].x+(CN[UN].z-CN[UN].x)*yN/HN,vN.b?1-QN:QN),FN&&EN.push(FN[UN].r,FN[UN].g,FN[UN].b,FN[UN].a);1!==ZN&&sN&&(XN.push(xN.x,xN.y,xN.z),XN.push(0,xN.y,0),XN.push(0,xN.y,0),XN.push(wN.x,wN.y,wN.z),kB.fB.CrossToRef(aN,ON,mB),mB.normalize(),uN.push(mB.x,mB.y,mB.z,mB.x,mB.y,mB.z),kB.fB.CrossToRef(bN,aN,mB),mB.normalize(),uN.push(mB.x,mB.y,mB.z,mB.x,mB.y,mB.z),QN=RN?WN!==UN?CN[UN+1].y:CN[UN+1].w:CN[UN+1].y+(CN[UN+1].w-CN[UN+1].y)*nN,dN.push(CN[UN+1].x,vN.b?1-QN:QN),dN.push(CN[UN+1].z,vN.b?1-QN:QN),QN=RN?WN!==UN?CN[UN+2].y:CN[UN+2].w:CN[UN+2].y+(CN[UN+2].w-CN[UN+2].y)*nN,dN.push(CN[UN+2].x,vN.b?1-QN:QN),dN.push(CN[UN+2].z,vN.b?1-QN:QN),FN&&(EN.push(FN[UN+1].r,FN[UN+1].g,FN[UN+1].b,FN[UN+1].a),EN.push(FN[UN+1].r,FN[UN+1].g,FN[UN+1].b,FN[UN+1].a),EN.push(FN[UN+2].r,FN[UN+2].g,FN[UN+2].b,FN[UN+2].a),EN.push(FN[UN+2].r,FN[UN+2].g,FN[UN+2].b,FN[UN+2].a))),WN!==UN&&(WN=UN)}const SN=1!==ZN&&sN?HN+4:HN;for(DN=0,UN=0;UN<TN;UN++){let NN=0,BN=0,lN=0,kB=0;for(yN=0;yN<HN;yN++)NN=DN*(SN+1)+yN,BN=(DN+1)*(SN+1)+yN,lN=DN*(SN+1)+(yN+1),kB=(DN+1)*(SN+1)+(yN+1),GN.push(NN,BN,lN),GN.push(kB,lN,BN);1!==ZN&&sN&&(GN.push(NN+2,BN+2,lN+2),GN.push(kB+2,lN+2,BN+2),GN.push(NN+4,BN+4,lN+4),GN.push(kB+4,lN+4,BN+4)),DN=RN?DN+2:DN+1}const iB=NN=>{const qN=NN?lN/2:cN/2;if(0===qN)return;let eN,TN,RN;const sN=NN?CN[IN-1]:CN[0];let VN=null;FN&&(VN=NN?FN[IN-1]:FN[0]);const fN=XN.length/3,PN=NN?BN/2:-BN/2,AN=new kB.fB(0,PN,0);XN.push(AN.x,AN.y,AN.z),uN.push(0,NN?1:-1,0);const MN=sN.y+.5*(sN.w-sN.y);dN.push(sN.x+.5*(sN.z-sN.x),vN.b?1-MN:MN),VN&&EN.push(VN.r,VN.g,VN.b,VN.a);const KN=new kB.Vector2(.5,.5);for(RN=0;RN<=HN;RN++){eN=2*Math.PI*RN*ZN/HN;const BN=Math.cos(-eN),lN=Math.sin(-eN);TN=new kB.fB(BN*qN,PN,lN*qN);const cN=new kB.Vector2(BN*KN.x+.5,lN*KN.y+.5);XN.push(TN.x,TN.y,TN.z),uN.push(0,NN?1:-1,0);const fN=sN.y+(sN.w-sN.y)*cN.y;dN.push(sN.x+(sN.z-sN.x)*cN.x,vN.b?1-fN:fN),VN&&EN.push(VN.r,VN.g,VN.b,VN.a)}for(RN=0;RN<HN;RN++)NN?(GN.push(fN),GN.push(fN+(RN+2)),GN.push(fN+(RN+1))):(GN.push(fN),GN.push(fN+(RN+1)),GN.push(fN+(RN+2)))};fN!==qN.e.CAP_START&&fN!==qN.e.CAP_ALL||iB(!1),fN!==qN.e.CAP_END&&fN!==qN.e.CAP_ALL||iB(!0),eN.e._ComputeSides(PN,XN,GN,uN,dN,NN.frontUVs,NN.backUVs);const tN=new eN.e;return tN.indices=GN,tN.positions=XN,tN.normals=uN,tN.uvs=dN,FN&&(tN.colors=EN),tN}function GN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return MN(BN).applyToMesh(kB,BN.updatable),kB}function XN(NN){const BN=[],lN=[],qN=[],cN=[],HN=NN.diameter||1,TN=NN.thickness||.5,RN=0|(NN.tessellation||16),sN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,VN=RN+1;for(let eN=0;eN<=RN;eN++){const NN=eN/RN,sN=eN*Math.PI*2/RN-Math.PI/2,fN=kB.Matrix.Translation(HN/2,0,0).multiply(kB.Matrix.RotationY(sN));for(let HN=0;HN<=RN;HN++){const sN=1-HN/RN,ZN=HN*Math.PI*2/RN+Math.PI,PN=Math.cos(ZN),CN=Math.sin(ZN);let FN=new kB.fB(PN,CN,0),IN=FN.scale(TN/2);const AN=new kB.Vector2(NN,sN);IN=kB.fB.TransformCoordinates(IN,fN),FN=kB.fB.TransformNormal(FN,fN),lN.push(IN.x,IN.y,IN.z),qN.push(FN.x,FN.y,FN.z),cN.push(AN.x,vN.b?1-AN.y:AN.y);const MN=(eN+1)%VN,GN=(HN+1)%VN;BN.push(eN*VN+HN),BN.push(eN*VN+GN),BN.push(MN*VN+HN),BN.push(eN*VN+GN),BN.push(MN*VN+GN),BN.push(MN*VN+HN)}}eN.e._ComputeSides(sN,lN,BN,qN,cN,NN.frontUVs,NN.backUVs);const fN=new eN.e;return fN.indices=BN,fN.positions=lN,fN.normals=qN,fN.uvs=cN,fN}function uN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return XN(BN).applyToMesh(kB,BN.updatable),kB}eN.e.CreateCylinder=MN,qN.e.CreateCylinder=(NN,BN,lN,kB,cN,eN,vN,HN,TN)=>{void 0!==vN&&vN instanceof IN.d||(void 0!==vN&&(TN=HN||qN.e.DEFAULTSIDE,HN=vN),vN=eN,eN=1);return GN(NN,{height:BN,diameterTop:lN,diameterBottom:kB,tessellation:cN,subdivisions:eN,sideOrientation:TN,updatable:HN},vN)};function dN(NN){const BN=[],lN=[],qN=[],cN=[],HN=NN.radius||2,TN=NN.tube||.5,RN=NN.radialSegments||32,sN=NN.tubularSegments||32,VN=NN.p||2,fN=NN.q||3,ZN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,PN=NN=>{const BN=Math.cos(NN),lN=Math.sin(NN),qN=fN/VN*NN,cN=Math.cos(qN),eN=HN*(2+cN)*.5*BN,vN=HN*(2+cN)*lN*.5,TN=HN*Math.sin(qN)*.5;return new kB.fB(eN,vN,TN)};let CN,FN;for(CN=0;CN<=RN;CN++){const NN=CN%RN/RN*2*VN*Math.PI,BN=PN(NN),qN=PN(NN+.01),eN=qN.ZB(BN);let HN=qN.add(BN);const fN=kB.fB.Cross(eN,HN);for(HN=kB.fB.Cross(fN,eN),fN.normalize(),HN.normalize(),FN=0;FN<sN;FN++){const NN=FN%sN/sN*2*Math.PI,kB=-TN*Math.cos(NN),qN=TN*Math.sin(NN);lN.push(BN.x+kB*HN.x+qN*fN.x),lN.push(BN.y+kB*HN.y+qN*fN.y),lN.push(BN.z+kB*HN.z+qN*fN.z),cN.push(CN/RN),cN.push(vN.b?1-FN/sN:FN/sN)}}for(CN=0;CN<RN;CN++)for(FN=0;FN<sN;FN++){const NN=(FN+1)%sN,lN=CN*sN+FN,kB=(CN+1)*sN+FN,qN=(CN+1)*sN+NN,cN=CN*sN+NN;BN.push(cN),BN.push(kB),BN.push(lN),BN.push(cN),BN.push(qN),BN.push(kB)}eN.e.ComputeNormals(lN,BN,qN),eN.e._ComputeSides(ZN,lN,BN,qN,cN,NN.frontUVs,NN.backUVs);const IN=new eN.e;return IN.indices=BN,IN.positions=lN,IN.normals=qN,IN.uvs=cN,IN}function EN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2?arguments[2]:void 0;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return dN(BN).applyToMesh(kB,BN.updatable),kB}eN.e.CreateTorus=XN,qN.e.CreateTorus=(NN,BN,lN,kB,qN,cN,eN)=>uN(NN,{diameter:BN,thickness:lN,tessellation:kB,sideOrientation:eN,updatable:cN},qN);eN.e.CreateTorusKnot=dN,qN.e.CreateTorusKnot=(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN)=>EN(NN,{radius:BN,tube:lN,radialSegments:kB,tubularSegments:qN,p:cN,q:eN,sideOrientation:TN,updatable:HN},vN);var KN=lN(16321),gN=lN(15499),nN=lN(15136);function rN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=BN.path,cN=BN.shape,eN=BN.scale||1,vN=BN.rotation||0,HN=0===BN.cap?0:BN.cap||qN.e.NO_CAP,TN=BN.updatable,RN=qN.e._GetDefaultSideOrientation(BN.sideOrientation),sN=BN.instance||null,VN=BN.invertUV||!1,fN=BN.closeShape||!1,ZN=BN.closePath||!1,PN=BN.capFunction||null;return xN(NN,cN,kB,eN,vN,null,null,ZN,fN,HN,!1,lN,!!TN,RN,sN,VN,BN.frontUVs||null,BN.backUVs||null,BN.firstNormal||null,!!BN.adjustFrame,PN)}function pN(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=BN.path,cN=BN.shape,eN=BN.scaleFunction||(()=>1),vN=BN.rotationFunction||(()=>0),HN=BN.closePath||BN.ribbonCloseArray||!1,TN=BN.closeShape||BN.ribbonClosePath||!1,RN=0===BN.cap?0:BN.cap||qN.e.NO_CAP,sN=BN.updatable,VN=BN.firstNormal||null,fN=BN.adjustFrame||!1,ZN=qN.e._GetDefaultSideOrientation(BN.sideOrientation),PN=BN.instance,CN=BN.invertUV||!1,FN=BN.capFunction||null;return xN(NN,cN,kB,null,null,eN,vN,HN,TN,RN,!0,lN,!!sN,ZN,PN||null,CN,BN.frontUVs||null,BN.backUVs||null,VN,fN,FN||null)}function xN(NN,BN,lN,cN,eN,vN,HN,RN,sN,VN,fN,ZN,PN,CN,FN,IN,AN,MN,GN,XN,uN){const dN=(NN,BN,lN,cN,eN,vN,HN,TN,RN,sN,VN)=>{const fN=lN.getTangents(),ZN=lN.getNormals(),PN=lN.getBinormals(),CN=lN.getDistances();if(VN)for(let qN=0;qN<fN.length;qN++)if(0==fN[qN].x&&0==fN[qN].y&&0==fN[qN].z&&fN[qN].kB(fN[qN-1]),0==ZN[qN].x&&0==ZN[qN].y&&0==ZN[qN].z&&ZN[qN].kB(ZN[qN-1]),0==PN[qN].x&&0==PN[qN].y&&0==PN[qN].z&&PN[qN].kB(PN[qN-1]),qN>0){let NN=fN[qN-1];kB.fB.Dot(NN,fN[qN])<0&&fN[qN].scaleInPlace(-1),NN=ZN[qN-1],kB.fB.Dot(NN,ZN[qN])<0&&ZN[qN].scaleInPlace(-1),NN=PN[qN-1],kB.fB.Dot(NN,PN[qN])<0&&PN[qN].scaleInPlace(-1)}let FN=0;const IN=sN&&TN?TN:()=>null!==vN?vN:0,AN=sN&&HN?HN:()=>null!==eN?eN:1;let MN=RN===qN.e.NO_CAP||RN===qN.e.CAP_END?0:2;const GN=kB.TmpVectors.Matrix[0];for(let qN=0;qN<BN.length;qN++){const lN=[],eN=IN(qN,CN[qN]),vN=AN(qN,CN[qN]);kB.Matrix.RotationAxisToRef(fN[qN],FN,GN);for(let cN=0;cN<NN.length;cN++){const eN=fN[qN].scale(NN[cN].z).add(ZN[qN].scale(NN[cN].x)).add(PN[qN].scale(NN[cN].y)),HN=kB.fB.Zero();kB.fB.TransformCoordinatesToRef(eN,GN,HN),HN.scaleInPlace(vN).addInPlace(BN[qN]),lN[cN]=HN}cN[MN]=lN,FN+=eN,MN++}const XN=uN||(NN=>{const BN=Array(),lN=kB.fB.Zero();let qN;for(qN=0;qN<NN.length;qN++)lN.addInPlace(NN[qN]);for(lN.scaleInPlace(1/NN.length),qN=0;qN<NN.length;qN++)BN.push(lN);return BN});switch(RN){case qN.e.NO_CAP:break;case qN.e.CAP_START:cN[0]=XN(cN[2]),cN[1]=cN[2];break;case qN.e.CAP_END:cN[MN]=cN[MN-1],cN[MN+1]=XN(cN[MN-1]);break;case qN.e.CAP_ALL:cN[0]=XN(cN[2]),cN[1]=cN[2],cN[MN]=cN[MN-1],cN[MN+1]=XN(cN[MN-1])}return cN};let EN,KN;if(FN){const NN=FN._creationDataStorage;return EN=GN?NN.path3D.update(lN,GN):NN.path3D.update(lN),KN=dN(BN,lN,NN.path3D,NN.pathArray,cN,eN,vN,HN,NN.cap,fN,XN),FN=TN("",{pathArray:KN,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:FN},ZN||void 0)}EN=GN?new nN.m(lN,GN):new nN.m(lN);KN=dN(BN,lN,EN,new Array,cN,eN,vN,HN,VN=VN<0||VN>3?0:VN,fN,XN);const gN=TN(NN,{pathArray:KN,closeArray:RN,closePath:sN,updatable:PN,sideOrientation:CN,invertUV:IN,frontUVs:AN||void 0,backUVs:MN||void 0},ZN);return gN._creationDataStorage.pathArray=KN,gN._creationDataStorage.path3D=EN,gN._creationDataStorage.cap=VN,gN}function ON(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const cN=BN.arc?BN.arc<=0||BN.arc>1?1:BN.arc:1,eN=void 0===BN.closed||BN.closed,vN=BN.shape,HN=BN.radius||1,RN=BN.tessellation||64,sN=BN.clip||0,VN=BN.updatable,fN=qN.e._GetDefaultSideOrientation(BN.sideOrientation),ZN=BN.cap||qN.e.NO_CAP,PN=2*Math.PI,CN=[],FN=BN.invertUV||!1;let IN=0,AN=0;const MN=PN/RN*cN;let GN,XN;for(IN=0;IN<=RN-sN;IN++){for(XN=[],ZN!=qN.e.CAP_START&&ZN!=qN.e.CAP_ALL||(XN.push(new kB.fB(0,vN[0].y,0)),XN.push(new kB.fB(Math.cos(IN*MN)*vN[0].x*HN,vN[0].y,Math.sin(IN*MN)*vN[0].x*HN))),AN=0;AN<vN.length;AN++)GN=new kB.fB(Math.cos(IN*MN)*vN[AN].x*HN,vN[AN].y,Math.sin(IN*MN)*vN[AN].x*HN),XN.push(GN);ZN!=qN.e.CAP_END&&ZN!=qN.e.CAP_ALL||(XN.push(new kB.fB(Math.cos(IN*MN)*vN[vN.length-1].x*HN,vN[vN.length-1].y,Math.sin(IN*MN)*vN[vN.length-1].x*HN)),XN.push(new kB.fB(0,vN[vN.length-1].y,0))),CN.push(XN)}return TN(NN,{pathArray:CN,closeArray:eN,sideOrientation:fN,updatable:VN,invertUV:FN,frontUVs:BN.frontUVs,backUVs:BN.backUVs},lN)}qN.e.ExtrudeShape=function(NN,BN,lN,kB,cN,eN){let vN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,HN=arguments.length>7?arguments[7]:void 0,TN=arguments.length>8?arguments[8]:void 0,RN=arguments.length>9?arguments[9]:void 0;return rN(NN,{shape:BN,path:lN,scale:kB,rotation:cN,cap:0===eN?0:eN||qN.e.NO_CAP,sideOrientation:TN,instance:RN,updatable:HN},vN)},qN.e.ExtrudeShapeCustom=(NN,BN,lN,kB,cN,eN,vN,HN,TN,RN,sN,VN)=>pN(NN,{shape:BN,path:lN,scaleFunction:kB,rotationFunction:cN,ribbonCloseArray:eN,ribbonClosePath:vN,cap:0===HN?0:HN||qN.e.NO_CAP,sideOrientation:sN,instance:VN,updatable:RN},TN);qN.e.CreateLathe=(NN,BN,lN,kB,qN,cN,eN)=>ON(NN,{shape:BN,radius:lN,tessellation:kB,sideOrientation:eN,updatable:cN},qN);var wN=lN(16296),bN=lN(16293);function mB(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const cN=BN.path;let eN=BN.instance,vN=1;void 0!==BN.radius?vN=BN.radius:eN&&(vN=eN._creationDataStorage.radius);const HN=BN.tessellation||64,RN=BN.radiusFunction||null;let sN=BN.cap||qN.e.NO_CAP;const VN=BN.invertUV||!1,fN=BN.updatable,ZN=qN.e._GetDefaultSideOrientation(BN.sideOrientation);BN.arc=BN.arc&&(BN.arc<=0||BN.arc>1)?1:BN.arc||1;const PN=(NN,BN,lN,cN,eN,vN,HN,TN)=>{const RN=BN.getTangents(),sN=BN.getNormals(),VN=BN.getDistances(),fN=2*Math.PI/eN*TN,ZN=vN||(()=>cN);let PN,CN,FN,IN;const AN=kB.TmpVectors.Matrix[0];let MN=HN===qN.e.NO_CAP||HN===qN.e.CAP_END?0:2;for(let qN=0;qN<NN.length;qN++){CN=ZN(qN,VN[qN]),PN=Array(),FN=sN[qN];for(let BN=0;BN<eN;BN++)kB.Matrix.RotationAxisToRef(RN[qN],fN*BN,AN),IN=PN[BN]?PN[BN]:kB.fB.Zero(),kB.fB.TransformCoordinatesToRef(FN,AN,IN),IN.scaleInPlace(CN).addInPlace(NN[qN]),PN[BN]=IN;lN[MN]=PN,MN++}const GN=(BN,lN)=>{const kB=Array();for(let qN=0;qN<BN;qN++)kB.push(NN[lN]);return kB};switch(HN){case qN.e.NO_CAP:break;case qN.e.CAP_START:lN[0]=GN(eN,0),lN[1]=lN[2].slice(0);break;case qN.e.CAP_END:lN[MN]=lN[MN-1].slice(0),lN[MN+1]=GN(eN,NN.length-1);break;case qN.e.CAP_ALL:lN[0]=GN(eN,0),lN[1]=lN[2].slice(0),lN[MN]=lN[MN-1].slice(0),lN[MN+1]=GN(eN,NN.length-1)}return lN};let CN,FN;if(eN){const NN=eN._creationDataStorage,lN=BN.arc||NN.arc;return CN=NN.path3D.update(cN),FN=PN(cN,CN,NN.pathArray,vN,NN.tessellation,RN,NN.cap,lN),eN=TN("",{pathArray:FN,instance:eN}),NN.path3D=CN,NN.pathArray=FN,NN.arc=lN,NN.radius=vN,eN}CN=new nN.m(cN);sN=sN<0||sN>3?0:sN,FN=PN(cN,CN,new Array,vN,HN,RN,sN,BN.arc);const IN=TN(NN,{pathArray:FN,closePath:!0,closeArray:!1,updatable:fN,sideOrientation:ZN,invertUV:VN,frontUVs:BN.frontUVs,backUVs:BN.backUVs},lN);return IN._creationDataStorage.pathArray=FN,IN._creationDataStorage.path3D=CN,IN._creationDataStorage.tessellation=HN,IN._creationDataStorage.cap=sN,IN._creationDataStorage.arc=BN.arc,IN._creationDataStorage.radius=vN,IN}function aN(NN){const BN=[];BN[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},BN[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},BN[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},BN[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},BN[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},BN[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},BN[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},BN[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},BN[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},BN[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},BN[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},BN[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},BN[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},BN[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},BN[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const lN=NN.type&&(NN.type<0||NN.type>=BN.length)?0:NN.type||0,qN=NN.size,cN=NN.sizeX||qN||1,HN=NN.sizeY||qN||1,TN=NN.sizeZ||qN||1,RN=NN.custom||BN[lN],sN=RN.face.length,fN=NN.faceUV||new Array(sN),ZN=NN.faceColors,PN=void 0===NN.flat||NN.flat,CN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,FN=[],IN=[],AN=[],MN=[],GN=[];let XN=0,uN=0;const dN=[];let EN,KN,gN,nN,rN,pN,xN=0,ON=0;if(PN)for(ON=0;ON<sN;ON++)ZN&&void 0===ZN[ON]&&(ZN[ON]=new VN.xc(1,1,1,1)),fN&&void 0===fN[ON]&&(fN[ON]=new kB.Vector4(0,0,1,1));if(PN)for(ON=0;ON<sN;ON++){const NN=RN.face[ON].length;for(gN=2*Math.PI/NN,nN=.5*Math.tan(gN/2),rN=.5,xN=0;xN<NN;xN++)FN.push(RN.vertex[RN.face[ON][xN]][0]*cN,RN.vertex[RN.face[ON][xN]][1]*HN,RN.vertex[RN.face[ON][xN]][2]*TN),dN.push(XN),XN++,EN=fN[ON].x+(fN[ON].z-fN[ON].x)*(.5+nN),KN=fN[ON].y+(fN[ON].w-fN[ON].y)*(rN-.5),MN.push(EN,vN.b?1-KN:KN),pN=nN*Math.cos(gN)-rN*Math.sin(gN),rN=nN*Math.sin(gN)+rN*Math.cos(gN),nN=pN,ZN&&GN.push(ZN[ON].r,ZN[ON].g,ZN[ON].b,ZN[ON].a);for(xN=0;xN<NN-2;xN++)IN.push(dN[0+uN],dN[xN+2+uN],dN[xN+1+uN]);uN+=NN}else{for(xN=0;xN<RN.vertex.length;xN++)FN.push(RN.vertex[xN][0]*cN,RN.vertex[xN][1]*HN,RN.vertex[xN][2]*TN),MN.push(0,vN.b?1:0);for(ON=0;ON<sN;ON++)for(xN=0;xN<RN.face[ON].length-2;xN++)IN.push(RN.face[ON][0],RN.face[ON][xN+2],RN.face[ON][xN+1])}eN.e.ComputeNormals(FN,IN,AN),eN.e._ComputeSides(CN,FN,IN,AN,MN,NN.frontUVs,NN.backUVs);const wN=new eN.e;return wN.positions=FN,wN.indices=IN,wN.normals=AN,wN.uvs=MN,ZN&&PN&&(wN.colors=GN),wN}function DN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return aN(BN).applyToMesh(kB,BN.updatable),kB}qN.e.CreateTube=(NN,BN,lN,kB,qN,cN,eN,vN,HN,TN)=>mB(NN,{path:BN,radius:lN,tessellation:kB,radiusFunction:qN,arc:1,cap:cN,updatable:vN,sideOrientation:HN,instance:TN},eN);function yN(NN){const BN=NN.sideOrientation||eN.e.DEFAULTSIDE,lN=NN.radius||1,qN=void 0===NN.flat||NN.flat,cN=0|(NN.subdivisions||4),HN=NN.radiusX||lN,TN=NN.radiusY||lN,RN=NN.radiusZ||lN,sN=(1+Math.sqrt(5))/2,VN=[-1,sN,-0,1,sN,0,-1,-sN,0,1,-sN,0,0,-1,-sN,0,1,-sN,0,-1,sN,0,1,sN,sN,0,1,sN,0,-1,-sN,0,1,-sN,0,-1],fN=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],ZN=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],PN=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],CN=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],FN=[],IN=[],AN=[],MN=[];let GN=0;const XN=new Array(3),uN=new Array(3);let dN;for(dN=0;dN<3;dN++)XN[dN]=kB.fB.Zero(),uN[dN]=kB.Vector2.Zero();for(let eN=0;eN<20;eN++){for(dN=0;dN<3;dN++){const NN=fN[3*eN+dN];XN[dN].Kc(VN[3*ZN[NN]],VN[3*ZN[NN]+1],VN[3*ZN[NN]+2]),XN[dN].normalize(),uN[dN].Kc(.134765625*PN[2*NN]+.05859375+-.0390625*CN[eN],.2333984375*PN[2*NN+1]+.025390625+.01953125*CN[eN])}const NN=(NN,BN,lN,eN)=>{const sN=kB.fB.Lerp(XN[0],XN[2],BN/cN),VN=kB.fB.Lerp(XN[1],XN[2],BN/cN),fN=cN===BN?XN[2]:kB.fB.Lerp(sN,VN,NN/(cN-BN));let ZN;if(fN.normalize(),qN){const NN=kB.fB.Lerp(XN[0],XN[2],eN/cN),BN=kB.fB.Lerp(XN[1],XN[2],eN/cN);ZN=kB.fB.Lerp(NN,BN,lN/(cN-eN))}else ZN=new kB.fB(fN.x,fN.y,fN.z);ZN.x/=HN,ZN.y/=TN,ZN.z/=RN,ZN.normalize();const PN=kB.Vector2.Lerp(uN[0],uN[2],BN/cN),CN=kB.Vector2.Lerp(uN[1],uN[2],BN/cN),dN=cN===BN?uN[2]:kB.Vector2.Lerp(PN,CN,NN/(cN-BN));IN.push(fN.x*HN,fN.y*TN,fN.z*RN),AN.push(ZN.x,ZN.y,ZN.z),MN.push(dN.x,vN.b?1-dN.y:dN.y),FN.push(GN),GN++};for(let BN=0;BN<cN;BN++)for(let lN=0;lN+BN<cN;lN++)NN(lN,BN,lN+1/3,BN+1/3),NN(lN+1,BN,lN+1/3,BN+1/3),NN(lN,BN+1,lN+1/3,BN+1/3),lN+BN+1<cN&&(NN(lN+1,BN,lN+2/3,BN+2/3),NN(lN+1,BN+1,lN+2/3,BN+2/3),NN(lN,BN+1,lN+2/3,BN+2/3))}eN.e._ComputeSides(BN,IN,FN,AN,MN,NN.frontUVs,NN.backUVs);const EN=new eN.e;return EN.indices=FN,EN.positions=IN,EN.normals=AN,EN.uvs=MN,EN}function LN(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const kB=new qN.e(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),kB._originalBuilderSideOrientation=BN.sideOrientation;return yN(BN).applyToMesh(kB,BN.updatable),kB}eN.e.CreatePolyhedron=aN,qN.e.CreatePolyhedron=(NN,BN,lN)=>DN(NN,BN,lN);eN.e.CreateIcoSphere=yN,qN.e.CreateIcoSphere=(NN,BN,lN)=>LN(NN,BN,lN);var hN=lN(14945);const UN=new kB.fB(1,0,0),WN=new kB.fB(-1,0,0),QN=new kB.fB(0,1,0),SN=new kB.fB(0,-1,0),iB=new kB.fB(0,0,1),tN=new kB.fB(0,0,-1);class oN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kB.fB.Zero(),BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kB.fB.Up(),lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kB.Vector2.Zero(),qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,eN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,vN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,HN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,TN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=NN,this.normal=BN,this.uv=lN,this.vertexIdx=qN,this.vertexIdxForBones=cN,this.localPositionOverride=eN,this.localNormalOverride=vN,this.matrixIndicesOverride=HN,this.matrixWeightsOverride=TN}clone(){var NN,BN,lN,kB;return new oN(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(NN=this.localPositionOverride)||void 0===NN?void 0:NN.slice(),null===(BN=this.localNormalOverride)||void 0===BN?void 0:BN.slice(),null===(lN=this.matrixIndicesOverride)||void 0===lN?void 0:lN.slice(),null===(kB=this.matrixWeightsOverride)||void 0===kB?void 0:kB.slice())}}function JN(NN,BN,lN){var HN,TN,RN,sN,VN;const fN=!!BN.skeleton,ZN=!(null===(HN=BN.morphTargetManager)||void 0===HN||!HN.numTargets),PN=lN.localMode||fN,CN=BN.Ec(),FN=fN||ZN?BN.OT(!0,!0):BN.getVerticesData(cN.f.PositionKind),IN=fN||ZN?BN.getNormalsData(!0,!0):BN.getVerticesData(cN.f.NormalKind),AN=PN?fN?BN.getVerticesData(cN.f.PositionKind):FN:null,MN=PN?fN?BN.getVerticesData(cN.f.NormalKind):IN:null,GN=BN.getVerticesData(cN.f.UVKind),XN=fN?BN.getVerticesData(cN.f.MatricesIndicesKind):null,uN=fN?BN.getVerticesData(cN.f.MatricesWeightsKind):null,dN=fN?BN.getVerticesData(cN.f.MatricesIndicesExtraKind):null,EN=fN?BN.getVerticesData(cN.f.MatricesWeightsExtraKind):null,KN=lN.position||kB.fB.Zero();let gN=lN.normal||kB.fB.Up();const nN=lN.size||kB.fB.One(),rN=lN.angle||0;if(!gN){const NN=new kB.fB(0,0,1),lN=BN.VB().activeCamera,qN=kB.fB.TransformCoordinates(NN,lN.getWorldMatrix());gN=lN.globalPosition.ZB(qN)}const pN=-Math.atan2(gN.z,gN.x)-Math.PI/2,xN=Math.sqrt(gN.x*gN.x+gN.z*gN.z),ON=Math.atan2(gN.y,xN),wN=new eN.e;wN.indices=[],wN.positions=[],wN.normals=[],wN.uvs=[],wN.matricesIndices=fN?[]:null,wN.matricesWeights=fN?[]:null,wN.matricesIndicesExtra=dN?[]:null,wN.matricesWeightsExtra=EN?[]:null;let bN=0;const mB=(NN,BN)=>{const qN=new oN;if(!CN||!FN||!IN)return qN;const cN=CN[NN];if(qN.vertexIdx=3*cN,qN.vertexIdxForBones=4*cN,qN.position=new kB.fB(FN[3*cN],FN[3*cN+1],FN[3*cN+2]),kB.fB.TransformCoordinatesToRef(qN.position,BN,qN.position),qN.normal=new kB.fB(IN[3*cN],IN[3*cN+1],IN[3*cN+2]),kB.fB.TransformNormalToRef(qN.normal,BN,qN.normal),lN.captureUVS&&GN){const NN=GN[2*cN+1];qN.uv=new kB.Vector2(GN[2*cN],vN.b?1-NN:NN)}return qN},aN=[0,0,0,0],DN=(NN,BN)=>{var lN,qN;if(0===NN.length)return NN;const cN=.5*Math.abs(kB.fB.Dot(nN,BN)),eN=(NN,BN,lN,kB)=>{for(let qN=0;qN<kB;++qN)if(NN[lN+qN]===BN)return lN+qN;return-1},vN=(NN,lN)=>{var qN,vN,HN,TN,RN,sN,VN,fN,ZN,PN,CN,FN;const IN=kB.fB.GetClipFactor(NN.position,lN.position,BN,cN);let GN=aN,dN=aN;if(XN&&uN){var EN,KN,gN,nN;const BN=NN.matrixIndicesOverride?0:NN.vertexIdxForBones,kB=null!==(EN=NN.matrixIndicesOverride)&&void 0!==EN?EN:XN,qN=null!==(KN=NN.matrixWeightsOverride)&&void 0!==KN?KN:uN,cN=lN.matrixIndicesOverride?0:lN.vertexIdxForBones,vN=null!==(gN=lN.matrixIndicesOverride)&&void 0!==gN?gN:XN,HN=null!==(nN=lN.matrixWeightsOverride)&&void 0!==nN?nN:uN;GN=[0,0,0,0],dN=[0,0,0,0];let TN=0;for(let NN=0;NN<4;++NN)if(qN[BN+NN]>0){const lN=eN(vN,kB[BN+NN],cN,4);GN[TN]=kB[BN+NN],dN[TN]=(0,hN.Lerp)(qN[BN+NN],lN>=0?HN[lN]:0,IN),TN++}for(let NN=0;NN<4&&TN<4;++NN){const lN=vN[cN+NN];-1===eN(kB,lN,BN,4)&&(GN[TN]=lN,dN[TN]=(0,hN.Lerp)(0,HN[cN+NN],IN),TN++)}const RN=dN[0]+dN[1]+dN[2]+dN[3];dN[0]/=RN,dN[1]/=RN,dN[2]/=RN,dN[3]/=RN}const rN=NN.localPositionOverride?NN.localPositionOverride[0]:null!==(qN=null===AN||void 0===AN?void 0:AN[NN.vertexIdx])&&void 0!==qN?qN:0,pN=NN.localPositionOverride?NN.localPositionOverride[1]:null!==(vN=null===AN||void 0===AN?void 0:AN[NN.vertexIdx+1])&&void 0!==vN?vN:0,xN=NN.localPositionOverride?NN.localPositionOverride[2]:null!==(HN=null===AN||void 0===AN?void 0:AN[NN.vertexIdx+2])&&void 0!==HN?HN:0,ON=lN.localPositionOverride?lN.localPositionOverride[0]:null!==(TN=null===AN||void 0===AN?void 0:AN[lN.vertexIdx])&&void 0!==TN?TN:0,wN=lN.localPositionOverride?lN.localPositionOverride[1]:null!==(RN=null===AN||void 0===AN?void 0:AN[lN.vertexIdx+1])&&void 0!==RN?RN:0,bN=lN.localPositionOverride?lN.localPositionOverride[2]:null!==(sN=null===AN||void 0===AN?void 0:AN[lN.vertexIdx+2])&&void 0!==sN?sN:0,mB=NN.localNormalOverride?NN.localNormalOverride[0]:null!==(VN=null===MN||void 0===MN?void 0:MN[NN.vertexIdx])&&void 0!==VN?VN:0,DN=NN.localNormalOverride?NN.localNormalOverride[1]:null!==(fN=null===MN||void 0===MN?void 0:MN[NN.vertexIdx+1])&&void 0!==fN?fN:0,yN=NN.localNormalOverride?NN.localNormalOverride[2]:null!==(ZN=null===MN||void 0===MN?void 0:MN[NN.vertexIdx+2])&&void 0!==ZN?ZN:0,LN=mB+((lN.localNormalOverride?lN.localNormalOverride[0]:null!==(PN=null===MN||void 0===MN?void 0:MN[lN.vertexIdx])&&void 0!==PN?PN:0)-mB)*IN,UN=DN+((lN.localNormalOverride?lN.localNormalOverride[1]:null!==(CN=null===MN||void 0===MN?void 0:MN[lN.vertexIdx+1])&&void 0!==CN?CN:0)-DN)*IN,WN=yN+((lN.localNormalOverride?lN.localNormalOverride[2]:null!==(FN=null===MN||void 0===MN?void 0:MN[lN.vertexIdx+2])&&void 0!==FN?FN:0)-yN)*IN,QN=Math.sqrt(LN*LN+UN*UN+WN*WN);return new oN(kB.fB.Lerp(NN.position,lN.position,IN),kB.fB.Lerp(NN.normal,lN.normal,IN).normalize(),kB.Vector2.Lerp(NN.uv,lN.uv,IN),-1,-1,AN?[rN+(ON-rN)*IN,pN+(wN-pN)*IN,xN+(bN-xN)*IN]:null,MN?[LN/QN,UN/QN,WN/QN]:null,GN,dN)};let HN=null;NN.length>3&&(HN=[]);for(let TN=0;TN<NN.length;TN+=3){let eN=0,RN=null,sN=null,VN=null,fN=null;const ZN=kB.fB.Dot(NN[TN].position,BN)-cN>0,PN=kB.fB.Dot(NN[TN+1].position,BN)-cN>0,CN=kB.fB.Dot(NN[TN+2].position,BN)-cN>0;switch(eN=(ZN?1:0)+(PN?1:0)+(CN?1:0),eN){case 0:NN.length>3?(HN.push(NN[TN]),HN.push(NN[TN+1]),HN.push(NN[TN+2])):HN=NN;break;case 1:if(HN=null!==(lN=HN)&&void 0!==lN?lN:new Array,ZN&&(RN=NN[TN+1],sN=NN[TN+2],VN=vN(NN[TN],RN),fN=vN(NN[TN],sN)),PN){RN=NN[TN],sN=NN[TN+2],VN=vN(NN[TN+1],RN),fN=vN(NN[TN+1],sN),HN.push(VN),HN.push(sN.clone()),HN.push(RN.clone()),HN.push(sN.clone()),HN.push(VN.clone()),HN.push(fN);break}CN&&(RN=NN[TN],sN=NN[TN+1],VN=vN(NN[TN+2],RN),fN=vN(NN[TN+2],sN)),RN&&sN&&VN&&fN&&(HN.push(RN.clone()),HN.push(sN.clone()),HN.push(VN),HN.push(fN),HN.push(VN.clone()),HN.push(sN.clone()));break;case 2:HN=null!==(qN=HN)&&void 0!==qN?qN:new Array,ZN||(RN=NN[TN].clone(),sN=vN(RN,NN[TN+1]),VN=vN(RN,NN[TN+2]),HN.push(RN),HN.push(sN),HN.push(VN)),PN||(RN=NN[TN+1].clone(),sN=vN(RN,NN[TN+2]),VN=vN(RN,NN[TN]),HN.push(RN),HN.push(sN),HN.push(VN)),CN||(RN=NN[TN+2].clone(),sN=vN(RN,NN[TN]),VN=vN(RN,NN[TN+1]),HN.push(RN),HN.push(sN),HN.push(VN))}}return HN},yN=BN instanceof qN.e?BN:null,LN=null===yN||void 0===yN?void 0:yN._thinInstanceDataStorage.matrixData,JN=(null===yN||void 0===yN?void 0:yN.wc)||1,YN=kB.TmpVectors.Matrix[0];YN.kB(kB.Matrix.IdentityReadOnly);for(let qN=0;qN<JN;++qN){if(null!==yN&&void 0!==yN&&yN.hasThinInstances&&LN){const NN=16*qN;YN.setRowFromFloats(0,LN[NN+0],LN[NN+1],LN[NN+2],LN[NN+3]),YN.setRowFromFloats(1,LN[NN+4],LN[NN+5],LN[NN+6],LN[NN+7]),YN.setRowFromFloats(2,LN[NN+8],LN[NN+9],LN[NN+10],LN[NN+11]),YN.setRowFromFloats(3,LN[NN+12],LN[NN+13],LN[NN+14],LN[NN+15])}const NN=kB.Matrix.RotationYawPitchRoll(pN,ON,rN).multiply(kB.Matrix.Translation(KN.x,KN.y,KN.z)),cN=kB.Matrix.Invert(NN),eN=BN.getWorldMatrix(),HN=YN.multiply(eN).multiply(cN),TN=new Array(3);for(let BN=0;BN<CN.length;BN+=3){let NN=TN;if(NN[0]=mB(BN,HN),NN[1]=mB(BN+1,HN),NN[2]=mB(BN+2,HN),!(lN.cullBackFaces&&-NN[0].normal.z<=0&&-NN[1].normal.z<=0&&-NN[2].normal.z<=0)&&(NN=DN(NN,UN),NN&&(NN=DN(NN,WN),NN&&(NN=DN(NN,QN),NN&&(NN=DN(NN,SN),NN&&(NN=DN(NN,iB),NN&&(NN=DN(NN,tN),NN)))))))for(let BN=0;BN<NN.length;BN++){const kB=NN[BN];if(wN.indices.push(bN),PN?(kB.localPositionOverride?(wN.positions[3*bN]=kB.localPositionOverride[0],wN.positions[3*bN+1]=kB.localPositionOverride[1],wN.positions[3*bN+2]=kB.localPositionOverride[2]):AN&&(wN.positions[3*bN]=AN[kB.vertexIdx],wN.positions[3*bN+1]=AN[kB.vertexIdx+1],wN.positions[3*bN+2]=AN[kB.vertexIdx+2]),kB.localNormalOverride?(wN.normals[3*bN]=kB.localNormalOverride[0],wN.normals[3*bN+1]=kB.localNormalOverride[1],wN.normals[3*bN+2]=kB.localNormalOverride[2]):MN&&(wN.normals[3*bN]=MN[kB.vertexIdx],wN.normals[3*bN+1]=MN[kB.vertexIdx+1],wN.normals[3*bN+2]=MN[kB.vertexIdx+2])):(kB.position.toArray(wN.positions,3*bN),kB.normal.toArray(wN.normals,3*bN)),wN.matricesIndices&&wN.matricesWeights&&(kB.matrixIndicesOverride?(wN.matricesIndices[4*bN]=kB.matrixIndicesOverride[0],wN.matricesIndices[4*bN+1]=kB.matrixIndicesOverride[1],wN.matricesIndices[4*bN+2]=kB.matrixIndicesOverride[2],wN.matricesIndices[4*bN+3]=kB.matrixIndicesOverride[3]):(XN&&(wN.matricesIndices[4*bN]=XN[kB.vertexIdxForBones],wN.matricesIndices[4*bN+1]=XN[kB.vertexIdxForBones+1],wN.matricesIndices[4*bN+2]=XN[kB.vertexIdxForBones+2],wN.matricesIndices[4*bN+3]=XN[kB.vertexIdxForBones+3]),dN&&wN.matricesIndicesExtra&&(wN.matricesIndicesExtra[4*bN]=dN[kB.vertexIdxForBones],wN.matricesIndicesExtra[4*bN+1]=dN[kB.vertexIdxForBones+1],wN.matricesIndicesExtra[4*bN+2]=dN[kB.vertexIdxForBones+2],wN.matricesIndicesExtra[4*bN+3]=dN[kB.vertexIdxForBones+3])),kB.matrixWeightsOverride?(wN.matricesWeights[4*bN]=kB.matrixWeightsOverride[0],wN.matricesWeights[4*bN+1]=kB.matrixWeightsOverride[1],wN.matricesWeights[4*bN+2]=kB.matrixWeightsOverride[2],wN.matricesWeights[4*bN+3]=kB.matrixWeightsOverride[3]):(uN&&(wN.matricesWeights[4*bN]=uN[kB.vertexIdxForBones],wN.matricesWeights[4*bN+1]=uN[kB.vertexIdxForBones+1],wN.matricesWeights[4*bN+2]=uN[kB.vertexIdxForBones+2],wN.matricesWeights[4*bN+3]=uN[kB.vertexIdxForBones+3]),EN&&wN.matricesWeightsExtra&&(wN.matricesWeightsExtra[4*bN]=EN[kB.vertexIdxForBones],wN.matricesWeightsExtra[4*bN+1]=EN[kB.vertexIdxForBones+1],wN.matricesWeightsExtra[4*bN+2]=EN[kB.vertexIdxForBones+2],wN.matricesWeightsExtra[4*bN+3]=EN[kB.vertexIdxForBones+3]))),lN.captureUVS)kB.uv.toArray(wN.uvs,2*bN);else{wN.uvs.push(.5+kB.position.x/nN.x);const NN=.5+kB.position.y/nN.y;wN.uvs.push(vN.b?1-NN:NN)}bN++}}}0===wN.indices.length&&(wN.indices=null),0===wN.positions.length&&(wN.positions=null),0===wN.normals.length&&(wN.normals=null),0===wN.uvs.length&&(wN.uvs=null),0===(null===(TN=wN.matricesIndices)||void 0===TN?void 0:TN.length)&&(wN.matricesIndices=null),0===(null===(RN=wN.matricesWeights)||void 0===RN?void 0:RN.length)&&(wN.matricesWeights=null),0===(null===(sN=wN.matricesIndicesExtra)||void 0===sN?void 0:sN.length)&&(wN.matricesIndicesExtra=null),0===(null===(VN=wN.matricesWeightsExtra)||void 0===VN?void 0:VN.length)&&(wN.matricesWeightsExtra=null);const jB=new qN.e(NN,BN.VB());return wN.applyToMesh(jB),PN?(jB.skeleton=BN.skeleton,jB.parent=BN):(jB.position=KN.clone(),jB.rotation=new kB.fB(ON,pN,rN)),jB.uc(!0),jB.refreshBoundingInfo(!0,!0),jB}function YN(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const BN=0|Math.max(NN.subdivisions?NN.subdivisions:2,1),lN=0|Math.max(NN.tessellation?NN.tessellation:16,3),qN=Math.max(NN.height?NN.height:1,0),cN=Math.max(NN.radius?NN.radius:.25,0),HN=0|Math.max(NN.capSubdivisions?NN.capSubdivisions:6,1),TN=lN,RN=BN,sN=Math.max(NN.radiusTop?NN.radiusTop:cN,0),VN=Math.max(NN.radiusBottom?NN.radiusBottom:cN,0),fN=qN-(sN+VN),ZN=2*Math.PI,PN=Math.max(NN.topCapSubdivisions?NN.topCapSubdivisions:HN,1),CN=Math.max(NN.bottomCapSubdivisions?NN.bottomCapSubdivisions:HN,1),FN=Math.acos((VN-sN)/qN);let IN=[];const AN=[],MN=[],GN=[];let XN=0;const uN=[],dN=.5*fN,EN=.5*Math.PI;let KN,gN;const nN=kB.fB.Zero(),rN=kB.fB.Zero(),pN=Math.cos(FN),xN=Math.sin(FN),ON=new kB.Vector2(sN*xN,dN+sN*pN).ZB(new kB.Vector2(VN*xN,VN*pN-dN)).length(),wN=sN*FN+ON+VN*(EN-FN);let bN=0;for(gN=0;gN<=PN;gN++){const NN=[],BN=EN-FN*(gN/PN);bN+=sN*FN/PN;const lN=Math.cos(BN),kB=Math.sin(BN),qN=lN*sN;for(KN=0;KN<=TN;KN++){const BN=KN/TN,cN=BN*ZN+0,eN=Math.sin(cN),HN=Math.cos(cN);rN.x=qN*eN,rN.y=dN+kB*sN,rN.z=qN*HN,AN.push(rN.x,rN.y,rN.z),nN.set(lN*eN,kB,lN*HN),MN.push(nN.x,nN.y,nN.z),GN.push(BN,vN.b?bN/wN:1-bN/wN),NN.push(XN),XN++}uN.push(NN)}const mB=qN-sN-VN+pN*sN-pN*VN,aN=xN*(VN-sN)/mB;for(gN=1;gN<=RN;gN++){const NN=[];bN+=ON/RN;const BN=xN*(gN*(VN-sN)/RN+sN);for(KN=0;KN<=TN;KN++){const lN=KN/TN,kB=lN*ZN+0,qN=Math.sin(kB),cN=Math.cos(kB);rN.x=BN*qN,rN.y=dN+pN*sN-gN*mB/RN,rN.z=BN*cN,AN.push(rN.x,rN.y,rN.z),nN.set(qN,aN,cN).normalize(),MN.push(nN.x,nN.y,nN.z),GN.push(lN,vN.b?bN/wN:1-bN/wN),NN.push(XN),XN++}uN.push(NN)}for(gN=1;gN<=CN;gN++){const NN=[],BN=EN-FN-(Math.PI-FN)*(gN/CN);bN+=VN*FN/CN;const lN=Math.cos(BN),kB=Math.sin(BN),qN=lN*VN;for(KN=0;KN<=TN;KN++){const BN=KN/TN,cN=BN*ZN+0,eN=Math.sin(cN),HN=Math.cos(cN);rN.x=qN*eN,rN.y=kB*VN-dN,rN.z=qN*HN,AN.push(rN.x,rN.y,rN.z),nN.set(lN*eN,kB,lN*HN),MN.push(nN.x,nN.y,nN.z),GN.push(BN,vN.b?bN/wN:1-bN/wN),NN.push(XN),XN++}uN.push(NN)}for(KN=0;KN<TN;KN++)for(gN=0;gN<PN+RN+CN;gN++){const NN=uN[gN][KN],BN=uN[gN+1][KN],lN=uN[gN+1][KN+1],kB=uN[gN][KN+1];IN.push(NN),IN.push(BN),IN.push(kB),IN.push(BN),IN.push(lN),IN.push(kB)}if(IN=IN.reverse(),NN.orientation&&!NN.orientation.equals(kB.fB.Up())){const BN=new kB.Matrix;NN.orientation.clone().scale(.5*Math.PI).cross(kB.fB.Up()).toQuaternion().toRotationMatrix(BN);const lN=kB.fB.Zero();for(let NN=0;NN<AN.length;NN+=3)lN.set(AN[NN],AN[NN+1],AN[NN+2]),kB.fB.TransformCoordinatesToRef(lN.clone(),BN,lN),AN[NN]=lN.x,AN[NN+1]=lN.y,AN[NN+2]=lN.z}const DN=new eN.e;return DN.positions=AN,DN.normals=MN,DN.uvs=GN,DN.indices=IN,DN}function jB(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:kB.fB.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const cN=new qN.e(NN,lN);return YN(BN).applyToMesh(cN,BN.updatable),cN}qN.e.CreateDecal=(NN,BN,lN,kB,qN,cN)=>JN(NN,BN,{position:lN,normal:kB,size:qN,angle:cN});qN.e.CreateCapsule=(NN,BN,lN)=>jB(NN,BN,lN),eN.e.CreateCapsule=YN;var zN=lN(14746),NB=lN(14934);class BB{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=NN,this.y=BN,NN!==Math.floor(NN)&&(NN=Math.floor(NN),zN.d.Warn("x is not an integer, floor(x) used")),BN!==Math.floor(BN)&&(BN=Math.floor(BN),zN.d.Warn("y is not an integer, floor(y) used"))}clone(){return new BB(this.x,this.y)}rotate60About(NN){const BN=this.x;return this.x=NN.x+NN.y-this.y,this.y=BN+this.y-NN.x,this}rotateNeg60About(NN){const BN=this.x;return this.x=BN+this.y-NN.y,this.y=NN.x+NN.y-BN,this}rotate120(NN,BN){NN!==Math.floor(NN)&&(NN=Math.floor(NN),zN.d.Warn("m not an integer only floor(m) used")),BN!==Math.floor(BN)&&(BN=Math.floor(BN),zN.d.Warn("n not an integer only floor(n) used"));const lN=this.x;return this.x=NN-lN-this.y,this.y=BN+lN,this}rotateNeg120(NN,BN){NN!==Math.floor(NN)&&(NN=Math.floor(NN),zN.d.Warn("m is not an integer, floor(m) used")),BN!==Math.floor(BN)&&(BN=Math.floor(BN),zN.d.Warn("n is not an integer,   floor(n) used"));const lN=this.x;return this.x=this.y-BN,this.y=NN+BN-lN-this.y,this}toCartesianOrigin(NN,BN){const lN=kB.fB.Zero();return lN.x=NN.x+2*this.x*BN+this.y*BN,lN.y=NN.y+Math.sqrt(3)*this.y*BN,lN}static Zero(){return new BB(0,0)}}class lB{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new kl("icosahedron","Regular",[[0,NB.f,-1],[-NB.f,1,0],[-1,0,-NB.f],[1,0,-NB.f],[NB.f,1,0],[0,NB.f,1],[-1,0,NB.f],[-NB.f,-1,0],[0,-NB.f,-1],[NB.f,-1,0],[1,0,NB.f],[0,-NB.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let NN=12;const BN={},lN=this.m,kB=this.n;let qN,cN,eN,vN,HN,TN=lN,RN=1,sN=0;0!==kB&&(TN=(0,hN.HighestCommonFactor)(lN,kB)),RN=lN/TN,sN=kB/TN;const VN=BB.Zero(),fN=new BB(lN,kB),ZN=new BB(-kB,lN+kB),PN=BB.Zero(),CN=BB.Zero(),FN=BB.Zero();let IN,AN,MN,GN,XN=[];const uN=[],dN=this.vertByDist,EN=(lN,kB,qN,cN)=>{IN=lN+"|"+qN,AN=kB+"|"+cN,IN in BN||AN in BN?IN in BN&&!(AN in BN)?BN[AN]=BN[IN]:AN in BN&&!(IN in BN)&&(BN[IN]=BN[AN]):(BN[IN]=NN,BN[AN]=NN,NN++),dN[qN][0]>2?uN[BN[IN]]=[-dN[qN][0],dN[qN][1],BN[IN]]:uN[BN[IN]]=[XN[dN[qN][0]],dN[qN][1],BN[IN]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let KN=0;KN<20;KN++){if(XN=this.IDATA.face[KN],eN=XN[2],vN=XN[1],HN=XN[0],MN=VN.x+"|"+VN.y,IN=KN+"|"+MN,IN in BN||(BN[IN]=eN,uN[eN]=[XN[dN[MN][0]],dN[MN][1]]),MN=fN.x+"|"+fN.y,IN=KN+"|"+MN,IN in BN||(BN[IN]=vN,uN[vN]=[XN[dN[MN][0]],dN[MN][1]]),MN=ZN.x+"|"+ZN.y,IN=KN+"|"+MN,IN in BN||(BN[IN]=HN,uN[HN]=[XN[dN[MN][0]],dN[MN][1]]),qN=this.IDATA.edgematch[KN][0],cN=this.IDATA.edgematch[KN][1],"B"===cN)for(let NN=1;NN<TN;NN++)CN.x=lN-NN*(RN+sN),CN.y=kB+NN*RN,FN.x=-NN*sN,FN.y=NN*(RN+sN),MN=CN.x+"|"+CN.y,GN=FN.x+"|"+FN.y,EN(KN,qN,MN,GN);if("O"===cN)for(let NN=1;NN<TN;NN++)FN.x=-NN*sN,FN.y=NN*(RN+sN),PN.x=NN*RN,PN.y=NN*sN,MN=FN.x+"|"+FN.y,GN=PN.x+"|"+PN.y,EN(KN,qN,MN,GN);if(qN=this.IDATA.edgematch[KN][2],cN=this.IDATA.edgematch[KN][3],cN&&"A"===cN)for(let NN=1;NN<TN;NN++)PN.x=NN*RN,PN.y=NN*sN,CN.x=lN-(TN-NN)*(RN+sN),CN.y=kB+(TN-NN)*RN,MN=PN.x+"|"+PN.y,GN=CN.x+"|"+CN.y,EN(KN,qN,MN,GN);for(let lN=0;lN<this.vertices.length;lN++)MN=this.vertices[lN].x+"|"+this.vertices[lN].y,IN=KN+"|"+MN,IN in BN||(BN[IN]=NN++,dN[MN][0]>2?uN[BN[IN]]=[-dN[MN][0],dN[MN][1],BN[IN]]:uN[BN[IN]]=[XN[dN[MN][0]],dN[MN][1],BN[IN]])}this.closestTo=uN,this.vecToidx=BN}calcCoeffs(){const NN=this.m,BN=this.n,lN=Math.sqrt(3)/3,kB=NN*NN+BN*BN+NN*BN;this.coau=(NN+BN)/kB,this.cobu=-BN/kB,this.coav=-lN*(NN-BN)/kB,this.cobv=lN*(2*NN+BN)/kB}createInnerFacets(){const NN=this.m,BN=this.n;for(let lN=0;lN<BN+NN+1;lN++)for(let NN=this.min[lN];NN<this.max[lN]+1;NN++)NN<this.max[lN]&&NN<this.max[lN+1]+1&&this.innerFacets.push(["|"+NN+"|"+lN,"|"+NN+"|"+(lN+1),"|"+(NN+1)+"|"+lN]),lN>0&&NN<this.max[lN-1]&&NN+1<this.max[lN]+1&&this.innerFacets.push(["|"+NN+"|"+lN,"|"+(NN+1)+"|"+lN,"|"+(NN+1)+"|"+(lN-1)])}edgeVecsABOB(){const NN=this.m,BN=this.n,lN=new BB(-BN,NN+BN);for(let kB=1;kB<NN+BN;kB++){const NN=new BB(this.min[kB],kB),BN=new BB(this.min[kB-1],kB-1),qN=new BB(this.min[kB+1],kB+1),cN=NN.clone(),eN=BN.clone(),vN=qN.clone();cN.rotate60About(lN),eN.rotate60About(lN),vN.rotate60About(lN);const HN=new BB(this.max[cN.y],cN.y),TN=new BB(this.max[cN.y-1],cN.y-1),RN=new BB(this.max[cN.y-1]-1,cN.y-1);cN.x===HN.x&&cN.y===HN.y||(cN.x!==TN.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([NN,TN,RN]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([NN,RN,HN])):cN.y===vN.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([NN,BN,TN]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([NN,TN,qN])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([NN,BN,TN]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([NN,TN,HN])))}}mapABOBtoOBOA(){const NN=new BB(0,0);for(let BN=0;BN<this.isoVecsABOB.length;BN++){const lN=[];for(let kB=0;kB<3;kB++)NN.x=this.isoVecsABOB[BN][kB].x,NN.y=this.isoVecsABOB[BN][kB].y,0===this.vertexTypes[BN][kB]&&NN.rotateNeg120(this.m,this.n),lN.push(NN.clone());this.isoVecsOBOA.push(lN)}}mapABOBtoBAOA(){const NN=new BB(0,0);for(let BN=0;BN<this.isoVecsABOB.length;BN++){const lN=[];for(let kB=0;kB<3;kB++)NN.x=this.isoVecsABOB[BN][kB].x,NN.y=this.isoVecsABOB[BN][kB].y,1===this.vertexTypes[BN][kB]&&NN.rotate120(this.m,this.n),lN.push(NN.clone());this.isoVecsBAOA.push(lN)}}MapToFace(NN,BN){const lN=this.IDATA.face[NN],qN=lN[2],cN=lN[1],eN=lN[0],vN=kB.fB.IB(this.IDATA.vertex[qN]),HN=kB.fB.IB(this.IDATA.vertex[cN]),TN=kB.fB.IB(this.IDATA.vertex[eN]),RN=HN.ZB(vN),sN=TN.ZB(vN),VN=RN.scale(this.coau).add(sN.scale(this.cobu)),fN=RN.scale(this.coav).add(sN.scale(this.cobv)),ZN=[];let PN,CN=kB.TmpVectors.fB[0];for(let kB=0;kB<this.cartesian.length;kB++)CN=VN.scale(this.cartesian[kB].x).add(fN.scale(this.cartesian[kB].y)).add(vN),ZN[kB]=[CN.x,CN.y,CN.z],PN=NN+"|"+this.vertices[kB].x+"|"+this.vertices[kB].y,BN.vertex[this.vecToidx[PN]]=[CN.x,CN.y,CN.z]}build(NN,BN){const lN=[],kB=BB.Zero(),qN=new BB(NN,BN),cN=new BB(-BN,NN+BN);lN.push(kB,qN,cN);for(let MN=BN;MN<NN+1;MN++)for(let BN=0;BN<NN+1-MN;BN++)lN.push(new BB(BN,MN));if(BN>0){const kB=(0,hN.HighestCommonFactor)(NN,BN),qN=NN/kB,cN=BN/kB;for(let vN=1;vN<kB;vN++)lN.push(new BB(vN*qN,vN*cN)),lN.push(new BB(-vN*cN,vN*(qN+cN))),lN.push(new BB(NN-vN*(qN+cN),BN+vN*qN));const eN=NN/BN;for(let vN=1;vN<BN;vN++)for(let kB=0;kB<vN*eN;kB++)lN.push(new BB(kB,vN)),lN.push(new BB(kB,vN).rotate120(NN,BN)),lN.push(new BB(kB,vN).rotateNeg120(NN,BN))}lN.sort(((NN,BN)=>NN.x-BN.x)),lN.sort(((NN,BN)=>NN.y-BN.y));const eN=new Array(NN+BN+1),vN=new Array(NN+BN+1);for(let MN=0;MN<eN.length;MN++)eN[MN]=1/0,vN[MN]=-1/0;let HN=0,TN=0;const RN=lN.length;for(let MN=0;MN<RN;MN++)TN=lN[MN].x,HN=lN[MN].y,eN[HN]=Math.min(TN,eN[HN]),vN[HN]=Math.max(TN,vN[HN]);const sN=(lN,kB)=>{const qN=lN.clone();return"A"===kB&&qN.rotateNeg120(NN,BN),"B"===kB&&qN.rotate120(NN,BN),qN.x<0?qN.y:qN.x+qN.y},VN=[],fN=[],ZN=[],PN=[],CN={},FN=[];let IN=-1,AN=-1;for(let MN=0;MN<RN;MN++)VN[MN]=lN[MN].toCartesianOrigin(new BB(0,0),.5),fN[MN]=sN(lN[MN],"O"),ZN[MN]=sN(lN[MN],"A"),PN[MN]=sN(lN[MN],"B"),fN[MN]===ZN[MN]&&ZN[MN]===PN[MN]?(IN=3,AN=fN[MN]):fN[MN]===ZN[MN]?(IN=4,AN=fN[MN]):ZN[MN]===PN[MN]?(IN=5,AN=ZN[MN]):PN[MN]===fN[MN]&&(IN=6,AN=fN[MN]),fN[MN]<ZN[MN]&&fN[MN]<PN[MN]&&(IN=2,AN=fN[MN]),ZN[MN]<fN[MN]&&ZN[MN]<PN[MN]&&(IN=1,AN=ZN[MN]),PN[MN]<ZN[MN]&&PN[MN]<fN[MN]&&(IN=0,AN=PN[MN]),FN.push([IN,AN,lN[MN].x,lN[MN].y]);FN.sort(((NN,BN)=>NN[2]-BN[2])),FN.sort(((NN,BN)=>NN[3]-BN[3])),FN.sort(((NN,BN)=>NN[1]-BN[1])),FN.sort(((NN,BN)=>NN[0]-BN[0]));for(let MN=0;MN<FN.length;MN++)CN[FN[MN][2]+"|"+FN[MN][3]]=[FN[MN][0],FN[MN][1],MN];return this.m=NN,this.n=BN,this.vertices=lN,this.vertByDist=CN,this.cartesian=VN,this.min=eN,this.max=vN,this}}class kl{constructor(NN,BN,lN,kB){this.name=NN,this.category=BN,this.vertex=lN,this.face=kB}}class qB extends kl{innerToData(NN,BN){for(let lN=0;lN<BN.innerFacets.length;lN++)this.face.push(BN.innerFacets[lN].map((lN=>BN.vecToidx[NN+lN])))}mapABOBtoDATA(NN,BN){const lN=BN.IDATA.edgematch[NN][0];for(let kB=0;kB<BN.isoVecsABOB.length;kB++){const qN=[];for(let cN=0;cN<3;cN++)0===BN.vertexTypes[kB][cN]?qN.push(NN+"|"+BN.isoVecsABOB[kB][cN].x+"|"+BN.isoVecsABOB[kB][cN].y):qN.push(lN+"|"+BN.isoVecsABOB[kB][cN].x+"|"+BN.isoVecsABOB[kB][cN].y);this.face.push([BN.vecToidx[qN[0]],BN.vecToidx[qN[1]],BN.vecToidx[qN[2]]])}}mapOBOAtoDATA(NN,BN){const lN=BN.IDATA.edgematch[NN][0];for(let kB=0;kB<BN.isoVecsOBOA.length;kB++){const qN=[];for(let cN=0;cN<3;cN++)1===BN.vertexTypes[kB][cN]?qN.push(NN+"|"+BN.isoVecsOBOA[kB][cN].x+"|"+BN.isoVecsOBOA[kB][cN].y):qN.push(lN+"|"+BN.isoVecsOBOA[kB][cN].x+"|"+BN.isoVecsOBOA[kB][cN].y);this.face.push([BN.vecToidx[qN[0]],BN.vecToidx[qN[1]],BN.vecToidx[qN[2]]])}}mapBAOAtoDATA(NN,BN){const lN=BN.IDATA.edgematch[NN][2];for(let kB=0;kB<BN.isoVecsBAOA.length;kB++){const qN=[];for(let cN=0;cN<3;cN++)1===BN.vertexTypes[kB][cN]?qN.push(NN+"|"+BN.isoVecsBAOA[kB][cN].x+"|"+BN.isoVecsBAOA[kB][cN].y):qN.push(lN+"|"+BN.isoVecsBAOA[kB][cN].x+"|"+BN.isoVecsBAOA[kB][cN].y);this.face.push([BN.vecToidx[qN[0]],BN.vecToidx[qN[1]],BN.vecToidx[qN[2]]])}}orderData(NN){const BN=[];for(let cN=0;cN<13;cN++)BN[cN]=[];const lN=NN.closestTo;for(let cN=0;cN<lN.length;cN++)lN[cN][0]>-1?lN[cN][1]>0&&BN[lN[cN][0]].push([cN,lN[cN][1]]):BN[12].push([cN,lN[cN][0]]);const kB=[];for(let cN=0;cN<12;cN++)kB[cN]=cN;let qN=12;for(let cN=0;cN<12;cN++){BN[cN].sort(((NN,BN)=>NN[1]-BN[1]));for(let NN=0;NN<BN[cN].length;NN++)kB[BN[cN][NN][0]]=qN++}for(let cN=0;cN<BN[12].length;cN++)kB[BN[12][cN][0]]=qN++;for(let cN=0;cN<this.vertex.length;cN++)this.vertex[cN].push(kB[cN]);this.vertex.sort(((NN,BN)=>NN[3]-BN[3]));for(let cN=0;cN<this.vertex.length;cN++)this.vertex[cN].pop();for(let cN=0;cN<this.face.length;cN++)for(let NN=0;NN<this.face[cN].length;NN++)this.face[cN][NN]=kB[this.face[cN][NN]];this.sharedNodes=BN[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(NN,BN){const lN=[],kB=[];let qN=BN.pop();kB.push(qN);let cN=this.face[qN].indexOf(NN);cN=(cN+2)%3;let eN=this.face[qN][cN];lN.push(eN);let vN=0;for(;BN.length>0;)qN=BN[vN],this.face[qN].indexOf(eN)>-1?(cN=(this.face[qN].indexOf(eN)+1)%3,eN=this.face[qN][cN],lN.push(eN),kB.push(qN),BN.splice(vN,1),vN=0):vN++;return this.adjacentFaces.push(lN),kB}toGoldbergPolyhedronData(){const NN=new kl("GeoDual","Goldberg",[],[]);NN.name="GD dual";const BN=this.vertex.length,lN=new Array(BN);for(let HN=0;HN<BN;HN++)lN[HN]=[];for(let HN=0;HN<this.face.length;HN++)for(let NN=0;NN<3;NN++)lN[this.face[HN][NN]].push(HN);let kB=0,qN=0,cN=0,eN=[],vN=[];this.adjacentFaces=[];for(let HN=0;HN<lN.length;HN++){NN.face[HN]=this.setOrder(HN,lN[HN].concat([]));for(const BN of lN[HN]){kB=0,qN=0,cN=0,eN=this.face[BN];for(let NN=0;NN<3;NN++)vN=this.vertex[eN[NN]],kB+=vN[0],qN+=vN[1],cN+=vN[2];NN.vertex[BN]=[kB/3,qN/3,cN/3]}}return NN}static BuildGeodesicData(NN){const BN=new qB("Geodesic-m-n","Geodesic",[[0,NB.f,-1],[-NB.f,1,0],[-1,0,-NB.f],[1,0,-NB.f],[NB.f,1,0],[0,NB.f,1],[-1,0,NB.f],[-NB.f,-1,0],[0,-NB.f,-1],[NB.f,-1,0],[1,0,NB.f],[0,-NB.f,1]],[]);NN.setIndices(),NN.calcCoeffs(),NN.createInnerFacets(),NN.edgeVecsABOB(),NN.mapABOBtoOBOA(),NN.mapABOBtoBAOA();for(let lN=0;lN<NN.IDATA.face.length;lN++)NN.MapToFace(lN,BN),BN.innerToData(lN,NN),"B"===NN.IDATA.edgematch[lN][1]&&BN.mapABOBtoDATA(lN,NN),"O"===NN.IDATA.edgematch[lN][1]&&BN.mapOBOAtoDATA(lN,NN),"A"===NN.IDATA.edgematch[lN][3]&&BN.mapBAOAtoDATA(lN,NN);BN.orderData(NN);return BN.vertex=BN.vertex.map((function(NN){const BN=NN[0],lN=NN[1],kB=NN[2],qN=Math.sqrt(BN*BN+lN*lN+kB*kB);return NN[0]*=1/qN,NN[1]*=1/qN,NN[2]*=1/qN,NN})),BN}}qN.e._GoldbergMeshParser=(NN,BN)=>cB.Parse(NN,BN);class cB extends qN.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(NN,BN){return void 0===BN?(NN>this.goldbergData.nbUnsharedFaces-1&&(zN.d.Warn("Maximum number of unshared faces used"),NN=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+NN):(NN>11&&(zN.d.Warn("Last pole used"),NN=11),BN>this.goldbergData.nbFacesAtPole-1&&(zN.d.Warn("Maximum number of faces at a pole used"),BN=this.goldbergData.nbFacesAtPole-1),12+NN*this.goldbergData.nbFacesAtPole+BN)}_changeGoldbergFaceColors(NN){for(let lN=0;lN<NN.length;lN++){const BN=NN[lN][0],kB=NN[lN][1],qN=NN[lN][2];for(let NN=BN;NN<kB+1;NN++)this.goldbergData.faceColors[NN]=qN}const BN=[];for(let lN=0;lN<12;lN++)for(let NN=0;NN<5;NN++)BN.push(this.goldbergData.faceColors[lN].r,this.goldbergData.faceColors[lN].g,this.goldbergData.faceColors[lN].b,this.goldbergData.faceColors[lN].a);for(let lN=12;lN<this.goldbergData.faceColors.length;lN++)for(let NN=0;NN<6;NN++)BN.push(this.goldbergData.faceColors[lN].r,this.goldbergData.faceColors[lN].g,this.goldbergData.faceColors[lN].b,this.goldbergData.faceColors[lN].a);return BN}setGoldbergFaceColors(NN){const BN=this._changeGoldbergFaceColors(NN);this.setVerticesData(cN.f.ColorKind,BN)}updateGoldbergFaceColors(NN){const BN=this._changeGoldbergFaceColors(NN);this.updateVerticesData(cN.f.ColorKind,BN)}_changeGoldbergFaceUVs(NN){const BN=this.getVerticesData(cN.f.UVKind);for(let lN=0;lN<NN.length;lN++){const kB=NN[lN][0],qN=NN[lN][1],cN=NN[lN][2],eN=NN[lN][3],vN=NN[lN][4],HN=[],TN=[];let RN,sN;for(let NN=0;NN<5;NN++)RN=cN.x+eN*Math.cos(vN+NN*Math.PI/2.5),sN=cN.y+eN*Math.sin(vN+NN*Math.PI/2.5),RN<0&&(RN=0),RN>1&&(RN=1),HN.push(RN,sN);for(let NN=0;NN<6;NN++)RN=cN.x+eN*Math.cos(vN+NN*Math.PI/3),sN=cN.y+eN*Math.sin(vN+NN*Math.PI/3),RN<0&&(RN=0),RN>1&&(RN=1),TN.push(RN,sN);for(let NN=kB;NN<Math.min(12,qN+1);NN++)for(let lN=0;lN<5;lN++)BN[10*NN+2*lN]=HN[2*lN],BN[10*NN+2*lN+1]=HN[2*lN+1];for(let NN=Math.max(12,kB);NN<qN+1;NN++)for(let lN=0;lN<6;lN++)BN[12*NN-24+2*lN]=TN[2*lN],BN[12*NN-23+2*lN]=TN[2*lN+1]}return BN}setGoldbergFaceUVs(NN){const BN=this._changeGoldbergFaceUVs(NN);this.setVerticesData(cN.f.UVKind,BN)}updateGoldbergFaceUVs(NN){const BN=this._changeGoldbergFaceUVs(NN);this.updateVerticesData(cN.f.UVKind,BN)}placeOnGoldbergFaceAt(NN,BN,lN){const qN=kB.fB.RotationFromAxis(this.goldbergData.faceXaxis[BN],this.goldbergData.faceYaxis[BN],this.goldbergData.faceZaxis[BN]);NN.rotation=qN,NN.position=this.goldbergData.faceCenters[BN].add(this.goldbergData.faceXaxis[BN].scale(lN.x)).add(this.goldbergData.faceYaxis[BN].scale(lN.y)).add(this.goldbergData.faceZaxis[BN].scale(lN.z))}serialize(NN){super.serialize(NN),NN.type="GoldbergMesh";const BN={};if(BN.adjacentFaces=this.goldbergData.adjacentFaces,BN.nbSharedFaces=this.goldbergData.nbSharedFaces,BN.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,BN.nbFaces=this.goldbergData.nbFaces,BN.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){BN.faceColors=[];for(const NN of this.goldbergData.faceColors)BN.faceColors.push(NN.Fc())}if(this.goldbergData.faceCenters){BN.faceCenters=[];for(const NN of this.goldbergData.faceCenters)BN.faceCenters.push(NN.Fc())}if(this.goldbergData.faceZaxis){BN.faceZaxis=[];for(const NN of this.goldbergData.faceZaxis)BN.faceZaxis.push(NN.Fc())}if(this.goldbergData.faceYaxis){BN.faceYaxis=[];for(const NN of this.goldbergData.faceYaxis)BN.faceYaxis.push(NN.Fc())}if(this.goldbergData.faceXaxis){BN.faceXaxis=[];for(const NN of this.goldbergData.faceXaxis)BN.faceXaxis.push(NN.Fc())}NN.goldbergData=BN}static Parse(NN,BN){const lN=NN.goldbergData;lN.faceColors=lN.faceColors.map((NN=>VN.xc.IB(NN))),lN.faceCenters=lN.faceCenters.map((NN=>kB.fB.IB(NN))),lN.faceZaxis=lN.faceZaxis.map((NN=>kB.fB.IB(NN))),lN.faceXaxis=lN.faceXaxis.map((NN=>kB.fB.IB(NN))),lN.faceYaxis=lN.faceYaxis.map((NN=>kB.fB.IB(NN)));const qN=new cB(NN.name,BN);return qN.goldbergData=lN,qN}}var eB=lN(15496);const vB={CreateBox:sN.e,CreateTiledBox:CN,CreateSphere:FN.d,CreateDisc:RN.c,CreateIcoSphere:LN,CreateRibbon:TN,CreateCylinder:GN,CreateTorus:uN,CreateTorusKnot:EN,CreateLineSystem:KN.f,Ps:KN.h,CreateDashedLines:KN.c,ExtrudeShape:rN,ExtrudeShapeCustom:pN,CreateLathe:ON,CreateTiledPlane:ZN,Is:wN.c,CreateGround:bN.h,CreateTiledGround:bN.k,CreateGroundFromHeightMap:bN.e,CreatePolygon:gN.d,ExtrudePolygon:gN.e,CreateTube:mB,CreatePolyhedron:DN,CreateGeodesic:function(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,kB=BN.m||1;kB!==Math.floor(kB)&&(kB=Math.floor(kB),zN.d.Warn("m not an integer only floor(m) used"));let qN=BN.n||0;if(qN!==Math.floor(qN)&&(qN=Math.floor(qN),zN.d.Warn("n not an integer only floor(n) used")),qN>kB){const NN=qN;qN=kB,kB=NN,zN.d.Warn("n > m therefore m and n swapped")}const cN=new lB;return cN.build(kB,qN),DN(NN,{custom:qB.BuildGeodesicData(cN),size:BN.size,sizeX:BN.sizeX,sizeY:BN.sizeY,sizeZ:BN.sizeZ,faceUV:BN.faceUV,faceColors:BN.faceColors,flat:BN.flat,updatable:BN.updatable,sideOrientation:BN.sideOrientation,frontUVs:BN.frontUVs,backUVs:BN.backUVs},lN)},CreateGoldberg:function(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const cN=BN.size,HN=BN.sizeX||cN||1,TN=BN.sizeY||cN||1,RN=BN.sizeZ||cN||1;let sN=BN.m||1;sN!==Math.floor(sN)&&(sN=Math.floor(sN),zN.d.Warn("m not an integer only floor(m) used"));let fN=BN.n||0;if(fN!==Math.floor(fN)&&(fN=Math.floor(fN),zN.d.Warn("n not an integer only floor(n) used")),fN>sN){const NN=fN;fN=sN,sN=NN,zN.d.Warn("n > m therefore m and n swapped")}const ZN=new lB;ZN.build(sN,fN);const PN=qB.BuildGeodesicData(ZN),CN=PN.toGoldbergPolyhedronData(),FN=new cB(NN,lN);BN.sideOrientation=qN.e._GetDefaultSideOrientation(BN.sideOrientation),FN._originalBuilderSideOrientation=BN.sideOrientation;(function(NN,BN){const lN=NN.size,qN=NN.sizeX||lN||1,cN=NN.sizeY||lN||1,HN=NN.sizeZ||lN||1,TN=0===NN.sideOrientation?0:NN.sideOrientation||eN.e.DEFAULTSIDE,RN=[],sN=[],VN=[],fN=[];let ZN=1/0,PN=-1/0,CN=1/0,FN=-1/0;for(let kB=0;kB<BN.vertex.length;kB++)ZN=Math.min(ZN,BN.vertex[kB][0]*qN),PN=Math.max(PN,BN.vertex[kB][0]*qN),CN=Math.min(CN,BN.vertex[kB][1]*cN),FN=Math.max(FN,BN.vertex[kB][1]*cN);let IN=0;for(let eN=0;eN<BN.face.length;eN++){const NN=BN.face[eN],lN=kB.fB.IB(BN.vertex[NN[0]]),TN=kB.fB.IB(BN.vertex[NN[2]]),AN=kB.fB.IB(BN.vertex[NN[1]]),MN=TN.ZB(lN),GN=AN.ZB(lN),XN=kB.fB.Cross(GN,MN).normalize();for(let kB=0;kB<NN.length;kB++){VN.push(XN.x,XN.y,XN.z);const lN=BN.vertex[NN[kB]];RN.push(lN[0]*qN,lN[1]*cN,lN[2]*HN);const eN=(lN[1]*cN-CN)/(FN-CN);fN.push((lN[0]*qN-ZN)/(PN-ZN),vN.b?1-eN:eN)}for(let BN=0;BN<NN.length-2;BN++)sN.push(IN,IN+BN+2,IN+BN+1);IN+=NN.length}eN.e._ComputeSides(TN,RN,sN,VN,fN);const AN=new eN.e;return AN.positions=RN,AN.indices=sN,AN.normals=VN,AN.uvs=fN,AN})(BN,CN).applyToMesh(FN,BN.updatable),FN.goldbergData.nbSharedFaces=PN.sharedNodes,FN.goldbergData.nbUnsharedFaces=PN.poleNodes,FN.goldbergData.adjacentFaces=PN.adjacentFaces,FN.goldbergData.nbFaces=FN.goldbergData.nbSharedFaces+FN.goldbergData.nbUnsharedFaces,FN.goldbergData.nbFacesAtPole=(FN.goldbergData.nbUnsharedFaces-12)/12;for(let qN=0;qN<PN.vertex.length;qN++)FN.goldbergData.faceCenters.push(kB.fB.IB(PN.vertex[qN])),FN.goldbergData.faceCenters[qN].x*=HN,FN.goldbergData.faceCenters[qN].y*=TN,FN.goldbergData.faceCenters[qN].z*=RN,FN.goldbergData.faceColors.push(new VN.xc(1,1,1,1));for(let qN=0;qN<CN.face.length;qN++){const NN=CN.face[qN],BN=kB.fB.IB(CN.vertex[NN[0]]),lN=kB.fB.IB(CN.vertex[NN[2]]),cN=kB.fB.IB(CN.vertex[NN[1]]),eN=lN.ZB(BN),vN=cN.ZB(BN),HN=kB.fB.Cross(vN,eN).normalize(),TN=kB.fB.Cross(vN,HN).normalize();FN.goldbergData.faceXaxis.push(vN.normalize()),FN.goldbergData.faceYaxis.push(HN),FN.goldbergData.faceZaxis.push(TN)}return FN},CreateDecal:JN,CreateCapsule:jB,CreateText:eB.d}},15969:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>Hl});var kB=lN(14925),qN=lN(15325);class cN extends qN.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var eN=lN(14972),vN=(lN(15087),lN(14881));class HN{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(NN){this._targetStopDuration!==NN&&(this._targetStopDuration=NN)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(NN){this._noiseTexture!==NN&&(this._noiseTexture=NN,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(NN){this._animationSheetEnabled!==NN&&(this._animationSheetEnabled=NN)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(NN){this._isAnimationSheetEnabled!=NN&&(this._isAnimationSheetEnabled=NN,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(NN){this._useLogarithmicDepth=NN&&this.VB().getEngine().getCaps().fragmentDepthSupported}VB(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(NN){switch(NN){case HN.BLENDMODE_MULTIPLYADD:return;case HN.BLENDMODE_ADD:NN=1;break;case HN.BLENDMODE_ONEONE:NN=6;break;case HN.BLENDMODE_STANDARD:NN=2;break;case HN.BLENDMODE_MULTIPLY:NN=4;break;case HN.BLENDMODE_SUBTRACT:NN=3}this._engine.setAlphaMode(NN)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:kB.fB.Zero()}set direction1(NN){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=NN)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:kB.fB.Zero()}set direction2(NN){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=NN)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:kB.fB.Zero()}set minEmitBox(NN){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=NN)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:kB.fB.Zero()}set maxEmitBox(NN){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=NN)}get billboardMode(){return this._billboardMode}set billboardMode(NN){this._billboardMode!==NN&&(this._billboardMode=NN,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(NN){this._isBillboardBased!==NN&&(this._isBillboardBased=NN,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(NN){this._attachImageProcessingConfiguration(NN)}_attachImageProcessingConfiguration(NN){NN!==this._imageProcessingConfiguration&&(!NN&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=NN)}_reset(){}_removeGradientAndTexture(NN,BN,lN){if(!BN)return this;let kB=0;for(const qN of BN){if(qN.gradient===NN){BN.splice(kB,1);break}kB++}return lN&&lN.dispose(),this}constructor(NN){this.animations=[],this.renderingGroupId=0,this.NB=kB.fB.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new kB.fB(10,10,10),this.onAnimationEnd=null,this.blendMode=HN.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new kB.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Vs=new kB.fB(0,0,0),this._useLogarithmicDepth=!1,this.gravity=kB.fB.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new eN.xc(1,1,1,1),this.color2=new eN.xc(1,1,1,1),this.colorDead=new eN.xc(0,0,0,1),this.textureMask=new eN.xc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new cN,this.id=NN,this.name=NN}createPointEmitter(NN,BN){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new kB.fB(0,1,0),arguments.length>2&&void 0!==arguments[2]||new kB.fB(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new kB.fB(0,1,0),arguments.length>4&&void 0!==arguments[4]||new kB.fB(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new kB.fB(0,1,0),arguments.length>3&&void 0!==arguments[3]||new kB.fB(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(NN,BN,lN,kB){throw new Error("Method not implemented.")}}HN.BLENDMODE_ONEONE=0,HN.BLENDMODE_STANDARD=1,HN.BLENDMODE_ADD=2,HN.BLENDMODE_MULTIPLY=3,HN.BLENDMODE_MULTIPLYADD=4,HN.BLENDMODE_SUBTRACT=-1,(0,vN.f)("BABYLON.BaseParticleSystem",HN);var TN=lN(14945),RN=lN(14754);class sN{constructor(){this.direction1=new kB.fB(0,1,0),this.direction2=new kB.fB(0,1,0),this.minEmitBox=new kB.fB(-.5,-.5,-.5),this.maxEmitBox=new kB.fB(.5,.5,.5)}startDirectionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),eN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),vN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);if(qN)return BN.x=cN,BN.y=eN,void(BN.z=vN);kB.fB.TransformNormalFromFloatsToRef(cN,eN,vN,NN,BN)}startPositionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),eN=(0,TN.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),vN=(0,TN.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(qN)return BN.x=cN,BN.y=eN,void(BN.z=vN);kB.fB.TransformCoordinatesFromFloatsToRef(cN,eN,vN,NN,BN)}clone(){const NN=new sN;return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2),NN.setVector3("minEmitBox",this.minEmitBox),NN.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(NN){NN.addUniform("direction1",3),NN.addUniform("direction2",3),NN.addUniform("minEmitBox",3),NN.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.direction1=this.direction1.Fc(),NN.direction2=this.direction2.Fc(),NN.minEmitBox=this.minEmitBox.Fc(),NN.maxEmitBox=this.maxEmitBox.Fc(),NN}parse(NN){kB.fB.FromArrayToRef(NN.direction1,0,this.direction1),kB.fB.FromArrayToRef(NN.direction2,0,this.direction2),kB.fB.FromArrayToRef(NN.minEmitBox,0,this.minEmitBox),kB.fB.FromArrayToRef(NN.maxEmitBox,0,this.maxEmitBox)}}class VN{get radius(){return this._radius}set radius(NN){this._radius=NN,this._buildHeight()}get angle(){return this._angle}set angle(NN){this._angle=NN,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=lN,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=BN,this.radius=NN}startDirectionFunction(NN,BN,lN,qN){qN?kB.TmpVectors.fB[0].kB(lN.aT).normalize():lN.position.subtractToRef(NN.getTranslation(),kB.TmpVectors.fB[0]).normalize();const cN=(0,TN.RandomRange)(0,this.directionRandomizer),eN=(0,TN.RandomRange)(0,this.directionRandomizer),vN=(0,TN.RandomRange)(0,this.directionRandomizer);BN.x=kB.TmpVectors.fB[0].x+cN,BN.y=kB.TmpVectors.fB[0].y+eN,BN.z=kB.TmpVectors.fB[0].z+vN,BN.normalize()}startPositionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(0,2*Math.PI);let eN;this.emitFromSpawnPointOnly?eN=1e-4:(eN=(0,TN.RandomRange)(0,this.heightRange),eN=1-eN*eN);let vN=this._radius-(0,TN.RandomRange)(0,this._radius*this.radiusRange);vN*=eN;const HN=vN*Math.sin(cN),RN=vN*Math.cos(cN),sN=eN*this._height;if(qN)return BN.x=HN,BN.y=sN,void(BN.z=RN);kB.fB.TransformCoordinatesFromFloatsToRef(HN,sN,RN,NN,BN)}clone(){const NN=new VN(this._radius,this._angle,this.directionRandomizer);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat2("radius",this._radius,this.radiusRange),NN.setFloat("coneAngle",this._angle),NN.setFloat2("height",this._height,this.heightRange),NN.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(NN){NN.addUniform("radius",2),NN.addUniform("coneAngle",1),NN.addUniform("height",2),NN.addUniform("directionRandomizer",1)}getEffectDefines(){let NN="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(NN+="\n#define CONEEMITTERSPAWNPOINT"),NN}getClassName(){return"ConeParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.radius=this._radius,NN.angle=this._angle,NN.directionRandomizer=this.directionRandomizer,NN.radiusRange=this.radiusRange,NN.heightRange=this.heightRange,NN.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,NN}parse(NN){this.radius=NN.radius,this.angle=NN.angle,this.directionRandomizer=NN.directionRandomizer,this.radiusRange=void 0!==NN.radiusRange?NN.radiusRange:1,this.heightRange=void 0!==NN.radiusRange?NN.heightRange:1,this.emitFromSpawnPointOnly=void 0!==NN.emitFromSpawnPointOnly&&NN.emitFromSpawnPointOnly}}class fN extends VN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0),qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0);super(NN,BN),this.direction1=lN,this.direction2=qN}startDirectionFunction(NN,BN){const lN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),qN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),cN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);kB.fB.TransformNormalFromFloatsToRef(lN,qN,cN,NN,BN)}clone(){const NN=new fN(this.radius,this.angle,this.direction1,this.direction2);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("radiusRange",this.radiusRange),NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("radiusRange",1),NN.addUniform("direction1",3),NN.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const NN=super.serialize();return NN.direction1=this.direction1.Fc(),NN.direction2=this.direction2.Fc(),NN}parse(NN){super.parse(NN),this.direction1.kB(NN.direction1),this.direction2.kB(NN.direction2)}}class ZN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=NN,this.height=BN,this.radiusRange=lN,this.directionRandomizer=qN,this._tempVector=kB.fB.Zero()}startDirectionFunction(NN,BN,lN,qN,cN){lN.position.subtractToRef(NN.getTranslation(),this._tempVector),this._tempVector.normalize(),kB.fB.TransformNormalToRef(this._tempVector,cN,this._tempVector);const eN=(0,TN.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let vN=Math.atan2(this._tempVector.x,this._tempVector.z);vN+=(0,TN.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=eN,this._tempVector.x=Math.sin(vN),this._tempVector.z=Math.cos(vN),this._tempVector.normalize(),qN?BN.kB(this._tempVector):kB.fB.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,NN,BN)}startPositionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(-this.height/2,this.height/2),eN=(0,TN.RandomRange)(0,2*Math.PI),vN=(0,TN.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),HN=Math.sqrt(vN)*this.radius,RN=HN*Math.cos(eN),sN=HN*Math.sin(eN);qN?BN.Kc(RN,cN,sN):kB.fB.TransformCoordinatesFromFloatsToRef(RN,cN,sN,NN,BN)}clone(){const NN=new ZN(this.radius,this.directionRandomizer);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("height",this.height),NN.setFloat("radiusRange",this.radiusRange),NN.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("height",1),NN.addUniform("radiusRange",1),NN.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.radius=this.radius,NN.height=this.height,NN.radiusRange=this.radiusRange,NN.directionRandomizer=this.directionRandomizer,NN}parse(NN){this.radius=NN.radius,this.height=NN.height,this.radiusRange=NN.radiusRange,this.directionRandomizer=NN.directionRandomizer}}class PN extends ZN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0),cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new kB.fB(0,1,0);super(NN,BN,lN),this.direction1=qN,this.direction2=cN}startDirectionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),eN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),vN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);qN?BN.Kc(cN,eN,vN):kB.fB.TransformNormalFromFloatsToRef(cN,eN,vN,NN,BN)}clone(){const NN=new PN(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("height",this.height),NN.setFloat("radiusRange",this.radiusRange),NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("height",1),NN.addUniform("radiusRange",1),NN.addUniform("direction1",3),NN.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const NN=super.serialize();return NN.direction1=this.direction1.Fc(),NN.direction2=this.direction2.Fc(),NN}parse(NN){super.parse(NN),kB.fB.FromArrayToRef(NN.direction1,0,this.direction1),kB.fB.FromArrayToRef(NN.direction2,0,this.direction2)}}class CN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=NN,this.radiusRange=BN,this.directionRandomizer=lN}startDirectionFunction(NN,BN,lN,qN){const cN=lN.position.ZB(NN.getTranslation()).normalize(),eN=(0,TN.RandomRange)(0,this.directionRandomizer),vN=(0,TN.RandomRange)(0,this.directionRandomizer),HN=(0,TN.RandomRange)(0,this.directionRandomizer);cN.x+=eN,cN.y+=vN,cN.z+=HN,cN.normalize(),qN?BN.kB(cN):kB.fB.TransformNormalFromFloatsToRef(cN.x,cN.y,cN.z,NN,BN)}startPositionFunction(NN,BN,lN,qN){const cN=this.radius-(0,TN.RandomRange)(0,this.radius*this.radiusRange),eN=(0,TN.RandomRange)(0,1),vN=(0,TN.RandomRange)(0,2*Math.PI),HN=Math.acos(2*eN-1),RN=cN*Math.cos(vN)*Math.sin(HN),sN=cN*Math.cos(HN),VN=cN*Math.sin(vN)*Math.sin(HN);qN?BN.Kc(RN,Math.abs(sN),VN):kB.fB.TransformCoordinatesFromFloatsToRef(RN,Math.abs(sN),VN,NN,BN)}clone(){const NN=new CN(this.radius,this.directionRandomizer);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("radiusRange",this.radiusRange),NN.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("radiusRange",1),NN.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.radius=this.radius,NN.radiusRange=this.radiusRange,NN.directionRandomizer=this.directionRandomizer,NN}parse(NN){this.radius=NN.radius,this.radiusRange=NN.radiusRange,this.directionRandomizer=NN.directionRandomizer}}class FN{constructor(){this.direction1=new kB.fB(0,1,0),this.direction2=new kB.fB(0,1,0)}startDirectionFunction(NN,BN,lN,qN){const cN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),eN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),vN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);qN?BN.Kc(cN,eN,vN):kB.fB.TransformNormalFromFloatsToRef(cN,eN,vN,NN,BN)}startPositionFunction(NN,BN,lN,qN){qN?BN.Kc(0,0,0):kB.fB.TransformCoordinatesFromFloatsToRef(0,0,0,NN,BN)}clone(){const NN=new FN;return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2)}buildUniformLayout(NN){NN.addUniform("direction1",3),NN.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.direction1=this.direction1.Fc(),NN.direction2=this.direction2.Fc(),NN}parse(NN){kB.fB.FromArrayToRef(NN.direction1,0,this.direction1),kB.fB.FromArrayToRef(NN.direction2,0,this.direction2)}}class IN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=NN,this.radiusRange=BN,this.directionRandomizer=lN}startDirectionFunction(NN,BN,lN,qN){const cN=lN.position.ZB(NN.getTranslation()).normalize(),eN=(0,TN.RandomRange)(0,this.directionRandomizer),vN=(0,TN.RandomRange)(0,this.directionRandomizer),HN=(0,TN.RandomRange)(0,this.directionRandomizer);cN.x+=eN,cN.y+=vN,cN.z+=HN,cN.normalize(),qN?BN.kB(cN):kB.fB.TransformNormalFromFloatsToRef(cN.x,cN.y,cN.z,NN,BN)}startPositionFunction(NN,BN,lN,qN){const cN=this.radius-(0,TN.RandomRange)(0,this.radius*this.radiusRange),eN=(0,TN.RandomRange)(0,1),vN=(0,TN.RandomRange)(0,2*Math.PI),HN=Math.acos(2*eN-1),RN=cN*Math.cos(vN)*Math.sin(HN),sN=cN*Math.cos(HN),VN=cN*Math.sin(vN)*Math.sin(HN);qN?BN.Kc(RN,sN,VN):kB.fB.TransformCoordinatesFromFloatsToRef(RN,sN,VN,NN,BN)}clone(){const NN=new IN(this.radius,this.directionRandomizer);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("radiusRange",this.radiusRange),NN.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("radiusRange",1),NN.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.radius=this.radius,NN.radiusRange=this.radiusRange,NN.directionRandomizer=this.directionRandomizer,NN}parse(NN){this.radius=NN.radius,this.radiusRange=NN.radiusRange,this.directionRandomizer=NN.directionRandomizer}}class AN extends IN{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kB.fB(0,1,0),lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0);super(NN),this.direction1=BN,this.direction2=lN}startDirectionFunction(NN,BN){const lN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),qN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),cN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);kB.fB.TransformNormalFromFloatsToRef(lN,qN,cN,NN,BN)}clone(){const NN=new AN(this.radius,this.direction1,this.direction2);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setFloat("radius",this.radius),NN.setFloat("radiusRange",this.radiusRange),NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2)}buildUniformLayout(NN){NN.addUniform("radius",1),NN.addUniform("radiusRange",1),NN.addUniform("direction1",3),NN.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const NN=super.serialize();return NN.direction1=this.direction1.Fc(),NN.direction2=this.direction2.Fc(),NN}parse(NN){super.parse(NN),this.direction1.kB(NN.direction1),this.direction2.kB(NN.direction2)}}class MN{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(NN,BN,lN,qN){const cN=kB.TmpVectors.fB[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,lN,cN);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,lN,cN);const NN=kB.TmpVectors.fB[1];cN.subtractToRef(lN.position,NN),NN.scaleToRef(1/lN.lifeTime,cN)}else cN.set(0,0,0);qN?BN.kB(cN):kB.fB.TransformNormalToRef(cN,NN,BN)}startPositionFunction(NN,BN,lN,qN){const cN=kB.TmpVectors.fB[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,lN,cN):cN.set(0,0,0),qN?BN.kB(cN):kB.fB.TransformCoordinatesToRef(cN,NN,BN)}clone(){const NN=new MN;return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){}buildUniformLayout(NN){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const NN={};return NN.type=this.getClassName(),NN.particlePositionGenerator=this.particlePositionGenerator,NN.particleDestinationGenerator=this.particleDestinationGenerator,NN}parse(NN){NN.particlePositionGenerator&&(this.particlePositionGenerator=NN.particlePositionGenerator),NN.particleDestinationGenerator&&(this.particleDestinationGenerator=NN.particleDestinationGenerator)}}var GN=lN(14998);class XN{get mesh(){return this._mesh}set mesh(NN){this._mesh!==NN&&(this._mesh=NN,NN?(this._indices=NN.Ec(),this._positions=NN.getVerticesData(GN.f.PositionKind),this._normals=NN.getVerticesData(GN.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=kB.fB.Zero(),this._mesh=null,this.direction1=new kB.fB(0,1,0),this.direction2=new kB.fB(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=NN}startDirectionFunction(NN,BN,lN,qN){if(this.useMeshNormalsForDirection&&this._normals)return void kB.fB.TransformNormalToRef(this._storedNormal,NN,BN);const cN=(0,TN.RandomRange)(this.direction1.x,this.direction2.x),eN=(0,TN.RandomRange)(this.direction1.y,this.direction2.y),vN=(0,TN.RandomRange)(this.direction1.z,this.direction2.z);qN?BN.Kc(cN,eN,vN):kB.fB.TransformNormalFromFloatsToRef(cN,eN,vN,NN,BN)}startPositionFunction(NN,BN,lN,qN){if(!this._indices||!this._positions)return;const cN=3*(Math.random()*(this._indices.length/3)|0),eN=Math.random(),vN=Math.random()*(1-eN),HN=1-eN-vN,TN=this._indices[cN],RN=this._indices[cN+1],sN=this._indices[cN+2],VN=kB.TmpVectors.fB[0],fN=kB.TmpVectors.fB[1],ZN=kB.TmpVectors.fB[2],PN=kB.TmpVectors.fB[3];kB.fB.FromArrayToRef(this._positions,3*TN,VN),kB.fB.FromArrayToRef(this._positions,3*RN,fN),kB.fB.FromArrayToRef(this._positions,3*sN,ZN),PN.x=eN*VN.x+vN*fN.x+HN*ZN.x,PN.y=eN*VN.y+vN*fN.y+HN*ZN.y,PN.z=eN*VN.z+vN*fN.z+HN*ZN.z,qN?BN.Kc(PN.x,PN.y,PN.z):kB.fB.TransformCoordinatesFromFloatsToRef(PN.x,PN.y,PN.z,NN,BN),this.useMeshNormalsForDirection&&this._normals&&(kB.fB.FromArrayToRef(this._normals,3*TN,VN),kB.fB.FromArrayToRef(this._normals,3*RN,fN),kB.fB.FromArrayToRef(this._normals,3*sN,ZN),this._storedNormal.x=eN*VN.x+vN*fN.x+HN*ZN.x,this._storedNormal.y=eN*VN.y+vN*fN.y+HN*ZN.y,this._storedNormal.z=eN*VN.z+vN*fN.z+HN*ZN.z)}clone(){const NN=new XN(this.mesh);return RN.b.DeepCopy(this,NN),NN}applyToShader(NN){NN.setVector3("direction1",this.direction1),NN.setVector3("direction2",this.direction2)}buildUniformLayout(NN){NN.addUniform("direction1",3),NN.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var NN;const BN={};return BN.type=this.getClassName(),BN.direction1=this.direction1.Fc(),BN.direction2=this.direction2.Fc(),BN.meshId=null===(NN=this.mesh)||void 0===NN?void 0:NN.id,BN.useMeshNormalsForDirection=this.useMeshNormalsForDirection,BN}parse(NN,BN){kB.fB.FromArrayToRef(NN.direction1,0,this.direction1),kB.fB.FromArrayToRef(NN.direction2,0,this.direction2),NN.meshId&&BN&&(this.mesh=BN.getLastMeshById(NN.meshId)),this.useMeshNormalsForDirection=NN.useMeshNormalsForDirection}}class uN{_isUbo(NN){return void 0!==NN.addUniform}constructor(NN){this._isUbo(NN)?(this.setMatrix3x3=NN.updateMatrix3x3.bind(NN),this.setMatrix2x2=NN.updateMatrix2x2.bind(NN),this.setFloat=NN.updateFloat.bind(NN),this.setFloat2=NN.updateFloat2.bind(NN),this.setFloat3=NN.updateFloat3.bind(NN),this.setFloat4=NN.updateFloat4.bind(NN),this.setFloatArray=NN.updateFloatArray.bind(NN),this.setArray=NN.updateArray.bind(NN),this.setIntArray=NN.updateIntArray.bind(NN),this.setMatrix=NN.Xc.bind(NN),this.setMatrices=NN.updateMatrices.bind(NN),this.setVector3=NN.updateVector3.bind(NN),this.setVector4=NN.updateVector4.bind(NN),this.setColor3=NN.updateColor3.bind(NN),this.setColor4=NN.updateColor4.bind(NN),this.setDirectColor4=NN.updateDirectColor4.bind(NN),this.setInt=NN.updateInt.bind(NN),this.setInt2=NN.updateInt2.bind(NN),this.setInt3=NN.updateInt3.bind(NN),this.setInt4=NN.updateInt4.bind(NN)):(this.setMatrix3x3=NN.setMatrix3x3.bind(NN),this.setMatrix2x2=NN.setMatrix2x2.bind(NN),this.setFloat=NN.setFloat.bind(NN),this.setFloat2=NN.setFloat2.bind(NN),this.setFloat3=NN.setFloat3.bind(NN),this.setFloat4=NN.setFloat4.bind(NN),this.setFloatArray=NN.setFloatArray.bind(NN),this.setArray=NN.setArray.bind(NN),this.setIntArray=NN.setIntArray.bind(NN),this.setMatrix=NN.setMatrix.bind(NN),this.setMatrices=NN.setMatrices.bind(NN),this.setVector3=NN.setVector3.bind(NN),this.setVector4=NN.setVector4.bind(NN),this.setColor3=NN.setColor3.bind(NN),this.setColor4=NN.setColor4.bind(NN),this.setDirectColor4=NN.setDirectColor4.bind(NN),this.setInt=NN.setInt.bind(NN),this.setInt2=NN.setInt2.bind(NN),this.setInt3=NN.setInt3.bind(NN),this.setInt4=NN.setInt4.bind(NN))}}var dN=lN(14833);const EN="gpuUpdateParticlesPixelShader",KN="#version 300 es\nvoid main() {discard;}\n";dN.c.ShadersStore[EN]||(dN.c.ShadersStore[EN]=KN);const gN="gpuUpdateParticlesVertexShader",nN="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";dN.c.ShadersStore[gN]||(dN.c.ShadersStore[gN]=nN);(0,vN.f)("BABYLON.WebGL2ParticleSystem",class{constructor(NN,BN){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=NN,this._engine=BN,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var NN,BN;return null!==(NN=null===(BN=this._updateEffect)||void 0===BN?void 0:BN.isReady())&&void 0!==NN&&NN}createUpdateBuffer(NN){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof MN&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=NN,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new uN(this._updateEffect)}createVertexBuffers(NN,BN){this._updateVAO.push(this._createUpdateVAO(NN)),this._renderVAO.push(this._engine.recordVertexArrayObject(BN,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=BN}createParticleBuffer(NN){return NN}bindDrawBuffers(NN,BN,lN){lN?this._engine.bindBuffers(this._renderVertexBuffers,lN,BN):this._engine.bindVertexArrayObject(this._renderVAO[NN],null)}preUpdateParticleBuffer(){const NN=this._engine;if(this._engine.enableEffect(this._updateEffect),!NN.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(NN,BN,lN){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[NN],null);const kB=this._engine;kB.bindTransformFeedbackBuffer(BN.getBuffer()),kB.setRasterizerState(!1),kB.beginTransformFeedback(!0),kB.drawArraysType(3,0,lN),kB.endTransformFeedback(),kB.setRasterizerState(!0),kB.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let NN=0;NN<this._updateVAO.length;NN++)this._engine.releaseVertexArrayObject(this._updateVAO[NN]);this._updateVAO.length=0;for(let NN=0;NN<this._renderVAO.length;NN++)this._engine.releaseVertexArrayObject(this._renderVAO[NN]);this._renderVAO.length=0}_createUpdateVAO(NN){const BN={};BN.position=NN.createVertexBuffer("position",0,3);let lN=3;BN.age=NN.createVertexBuffer("age",lN,1),lN+=1,BN.size=NN.createVertexBuffer("size",lN,3),lN+=3,BN.life=NN.createVertexBuffer("life",lN,1),lN+=1,BN.seed=NN.createVertexBuffer("seed",lN,4),lN+=4,BN.direction=NN.createVertexBuffer("direction",lN,3),lN+=3,this._parent.particleEmitterType instanceof MN&&(BN.initialPosition=NN.createVertexBuffer("initialPosition",lN,3),lN+=3),this._parent._colorGradientsTexture||(BN.color=NN.createVertexBuffer("color",lN,4),lN+=4),this._parent._isBillboardBased||(BN.initialDirection=NN.createVertexBuffer("initialDirection",lN,3),lN+=3),this._parent.noiseTexture&&(BN.noiseCoordinates1=NN.createVertexBuffer("noiseCoordinates1",lN,3),lN+=3,BN.noiseCoordinates2=NN.createVertexBuffer("noiseCoordinates2",lN,3),lN+=3),this._parent._angularSpeedGradientsTexture?(BN.angle=NN.createVertexBuffer("angle",lN,1),lN+=1):(BN.angle=NN.createVertexBuffer("angle",lN,2),lN+=2),this._parent._isAnimationSheetEnabled&&(BN.cellIndex=NN.createVertexBuffer("cellIndex",lN,1),lN+=1,this._parent.spriteRandomStartCell&&(BN.cellStartOffset=NN.createVertexBuffer("cellStartOffset",lN,1),lN+=1));const kB=this._engine.recordVertexArrayObject(BN,null,this._updateEffect);return this._engine.bindArrayBuffer(null),kB}});class rN{constructor(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,kB=arguments.length>3?arguments[3]:void 0;this._engine=NN,this._label=kB,this._engine._storageBuffers.push(this),this._create(BN,lN)}_create(NN,BN){this._bufferSize=NN,this._creationFlags=BN,this._buffer=this._engine.createStorageBuffer(NN,BN,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(NN,BN,lN){this._buffer&&this._engine.updateStorageBuffer(this._buffer,NN,BN,lN)}async read(NN,BN,lN,kB){return await this._engine.readFromStorageBuffer(this._buffer,NN,BN,lN,kB)}dispose(){const NN=this._engine._storageBuffers,BN=NN.indexOf(this);-1!==BN&&(NN[BN]=NN[NN.length-1],NN.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var pN=lN(19),xN=lN(14905),ON=lN(14910),wN=lN(14959),bN=lN(14898),mB=lN(15233),aN=lN(14746),DN=lN(14868),yN=lN(15140);class LN{constructor(){this._gpuTimeInFrameId=-1,this.counter=new yN.b}_addDuration(NN,BN){NN<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==NN?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(BN,!1),this._gpuTimeInFrameId=NN):this.counter.addCount(BN,!1))}}var hN=lN(14813);class UN{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=NN,this._engine=BN,this.uniqueId=mB.b.UniqueId,BN.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new LN),this._engine.getCaps().supportComputeShaders?kB.bindingsMapping?(this._context=BN.createComputeContext(),this._shaderPath=lN,this._options=(0,pN.d)({bindingsMapping:{},defines:[]},kB)):aN.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):aN.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(NN,BN){let lN=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const kB=this._bindings[NN];this._bindings[NN]={type:lN?0:4,object:BN,indexInGroupEntries:null===kB||void 0===kB?void 0:kB.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!kB||kB.object!==BN||kB.type!==this._bindings[NN].type)}setStorageTexture(NN,BN){const lN=this._bindings[NN];this._contextIsDirty||(this._contextIsDirty=!lN||lN.object!==BN),this._bindings[NN]={type:1,object:BN,indexInGroupEntries:null===lN||void 0===lN?void 0:lN.indexInGroupEntries}}setExternalTexture(NN,BN){const lN=this._bindings[NN];this._contextIsDirty||(this._contextIsDirty=!lN||lN.object!==BN),this._bindings[NN]={type:6,object:BN,indexInGroupEntries:null===lN||void 0===lN?void 0:lN.indexInGroupEntries}}setVideoTexture(NN,BN){return!!BN.externalTexture&&(this.setExternalTexture(NN,BN.externalTexture),!0)}setUniformBuffer(NN,BN){const lN=this._bindings[NN];this._contextIsDirty||(this._contextIsDirty=!lN||lN.object!==BN),this._bindings[NN]={type:UN._BufferIsDataBuffer(BN)?7:2,object:BN,indexInGroupEntries:null===lN||void 0===lN?void 0:lN.indexInGroupEntries}}setStorageBuffer(NN,BN){const lN=this._bindings[NN];this._contextIsDirty||(this._contextIsDirty=!lN||lN.object!==BN),this._bindings[NN]={type:UN._BufferIsDataBuffer(BN)?7:3,object:BN,indexInGroupEntries:null===lN||void 0===lN?void 0:lN.indexInGroupEntries}}setTextureSampler(NN,BN){const lN=this._bindings[NN];this._contextIsDirty||(this._contextIsDirty=!lN||!BN.compareSampler(lN.object)),this._bindings[NN]={type:5,object:BN,indexInGroupEntries:null===lN||void 0===lN?void 0:lN.indexInGroupEntries}}isReady(){let NN=this._effect;for(const qN in this._bindings){const NN=this._bindings[qN],BN=NN.type,lN=NN.object;switch(BN){case 0:case 4:case 1:if(!lN.isReady())return!1;break;case 6:if(!lN.isReady())return!1;break}}const BN=[],lN=this._shaderPath;if(this._options.defines)for(let qN=0;qN<this._options.defines.length;qN++)BN.push(this._options.defines[qN]);const kB=BN.join("\n");return this._cachedDefines!==kB&&(this._cachedDefines=kB,NN=this._engine.createComputeEffect(lN,{defines:kB,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=NN),!!NN.isReady()}dispatch(NN,BN,lN){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,NN,BN,lN,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const lN=UN._BufferIsDataBuffer(NN)?NN:NN.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,lN,BN,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const BN in this._bindings){const lN=this._bindings[BN];if(!this._options.bindingsMapping[BN])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+BN+"'");switch(lN.type){case 0:{const kB=this._samplers[BN],qN=lN.object;var NN;if(!kB||!qN._texture||!kB.compareSampler(qN._texture))this._samplers[BN]=(new DN.e).setParameters(qN.wrapU,qN.wrapV,qN.wrapR,qN.anisotropicFilteringLevel,qN._texture.samplingMode,null===(NN=qN._texture)||void 0===NN?void 0:NN._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const NN=lN.object;NN.getBuffer()!==lN.buffer&&(lN.buffer=NN.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((qN=>{(0,hN.g)((()=>this.dispatch(NN,BN,lN)),qN,void 0,kB)}))}serialize(){const NN=wN.b.Serialize(this);NN.options=this._options,NN.shaderPath=this._shaderPath,NN.wZ={},NN.textures={};for(const BN in this._bindings){const lN=this._bindings[BN],kB=lN.object;switch(lN.type){case 0:case 4:case 1:{const qN=kB.serialize();qN&&(NN.textures[BN]=qN,NN.wZ[BN]={type:lN.type});break}}}return NN}static Parse(NN,BN,lN){const kB=wN.b.Parse((()=>new UN(NN.name,BN.getEngine(),NN.shaderPath,NN.options)),NN,BN,lN);for(const qN in NN.textures){const cN=NN.wZ[qN],eN=bN.c.Parse(NN.textures[qN],BN,lN);0===cN.type?kB.setTexture(qN,eN):4===cN.type?kB.setTexture(qN,eN,!1):kB.setStorageTexture(qN,eN)}return kB}static _BufferIsDataBuffer(NN){return void 0!==NN.underlyingResource}}(0,xN.c)([(0,ON.G)()],UN.prototype,"name",void 0),(0,xN.c)([(0,ON.G)()],UN.prototype,"fastMode",void 0),(0,vN.f)("BABYLON.ComputeShader",UN);var WN=lN(15182);const QN="gpuUpdateParticlesComputeShader",SN="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";dN.c.ShadersStoreWGSL[QN]||(dN.c.ShadersStoreWGSL[QN]=SN);(0,vN.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(NN,BN){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=NN,this._engine=BN}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var NN,BN;return null!==(NN=null===(BN=this._updateComputeShader)||void 0===BN?void 0:BN.isReady())&&void 0!==NN&&NN}createUpdateBuffer(NN){var BN;const lN={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(lN.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(lN.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(lN.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(lN.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(lN.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(lN.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(lN.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new UN("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:lN,defines:NN.split("\n")}),null===(BN=this._simParamsComputeShader)||void 0===BN||BN.dispose(),this._simParamsComputeShader=new WN.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new uN(this._simParamsComputeShader)}createVertexBuffers(NN,BN){this._renderVertexBuffers.push(BN)}createParticleBuffer(NN){const BN=new rN(this._engine,4*NN.length,11,"ComputeShaderParticleSystemBuffer");return BN.update(NN),this._bufferComputeShader.push(BN),BN.getBuffer()}bindDrawBuffers(NN,BN,lN){this._engine.bindBuffers(this._renderVertexBuffers[NN],lN,BN)}preUpdateParticleBuffer(){}updateParticleBuffer(NN,BN,lN){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[NN]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^NN]),this._updateComputeShader.dispatch(Math.ceil(lN/64))}releaseBuffers(){var NN;for(let BN=0;BN<this._bufferComputeShader.length;++BN)this._bufferComputeShader[BN].dispose();this._bufferComputeShader.length=0,null===(NN=this._simParamsComputeShader)||void 0===NN||NN.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class iB{constructor(NN,BN,lN){this.gradient=NN,this.color1=BN,this.color2=lN}getColorToRef(NN){this.color2?eN.xc.LerpToRef(this.color1,this.color2,Math.random(),NN):NN.kB(this.color1)}}class tN{constructor(NN,BN){this.gradient=NN,this.color=BN}}class oN{constructor(NN,BN,lN){this.gradient=NN,this.factor1=BN,this.factor2=lN}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class JN{static GetCurrentGradient(NN,BN,lN){if(BN[0].gradient>NN)return void lN(BN[0],BN[0],1);for(let qN=0;qN<BN.length-1;qN++){const kB=BN[qN],cN=BN[qN+1];if(NN>=kB.gradient&&NN<=cN.gradient){return void lN(kB,cN,(NN-kB.gradient)/(cN.gradient-kB.gradient))}}const kB=BN.length-1;lN(BN[kB],BN[kB],1)}}var YN=lN(14731),jB=lN(15424),zN=lN(14773);class NB{constructor(NN){this.particleSystem=NN,this.position=kB.fB.Zero(),this.direction=kB.fB.Zero(),this.color=new eN.xc(0,0,0,0),this.colorStep=new eN.xc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new kB.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new eN.xc(0,0,0,0),this._currentColor2=new eN.xc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=NB._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let NN=this.age,BN=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===BN?(BN=1,NN=this._randomCellOffset):NN+=this._randomCellOffset);const lN=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let kB;kB=this._initialSpriteCellLoop?(0,TN.Clamp)(NN*BN%this.lifeTime/this.lifeTime):(0,TN.Clamp)(NN*BN/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+kB*lN|0}_inheritParticleInfoToSubEmitter(NN){if(NN.particleSystem.NB.position){const BN=NN.particleSystem.NB;if(BN.position.kB(this.position),NN.inheritDirection){const NN=kB.TmpVectors.fB[0];this.direction.normalizeToRef(NN),BN.setDirection(NN,0,Math.PI/2)}}else{NN.particleSystem.NB.kB(this.position)}this.direction.scaleToRef(NN.inheritedVelocityAmount/2,kB.TmpVectors.fB[0]),NN.particleSystem._inheritedVelocityOffset.kB(kB.TmpVectors.fB[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const NN of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(NN)}_reset(){this.age=0,this.id=NB._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(NN){NN.position.kB(this.position),this._initialDirection?NN._initialDirection?NN._initialDirection.kB(this._initialDirection):NN._initialDirection=this._initialDirection.clone():NN._initialDirection=null,NN.direction.kB(this.direction),this.aT&&(NN.aT?NN.aT.kB(this.aT):NN.aT=this.aT.clone()),NN.color.kB(this.color),NN.colorStep.kB(this.colorStep),NN.lifeTime=this.lifeTime,NN.age=this.age,NN._randomCellOffset=this._randomCellOffset,NN.size=this.size,NN.scale.kB(this.scale),NN.angle=this.angle,NN.angularSpeed=this.angularSpeed,NN.particleSystem=this.particleSystem,NN.cellIndex=this.cellIndex,NN.id=this.id,NN._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(NN._currentColorGradient=this._currentColorGradient,NN._currentColor1.kB(this._currentColor1),NN._currentColor2.kB(this._currentColor2)),this._currentSizeGradient&&(NN._currentSizeGradient=this._currentSizeGradient,NN._currentSize1=this._currentSize1,NN._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(NN._currentAngularSpeedGradient=this._currentAngularSpeedGradient,NN._currentAngularSpeed1=this._currentAngularSpeed1,NN._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(NN._currentVelocityGradient=this._currentVelocityGradient,NN._currentVelocity1=this._currentVelocity1,NN._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(NN._currentLimitVelocityGradient=this._currentLimitVelocityGradient,NN._currentLimitVelocity1=this._currentLimitVelocity1,NN._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(NN._currentDragGradient=this._currentDragGradient,NN._currentDrag1=this._currentDrag1,NN._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(NN._initialStartSpriteCellId=this._initialStartSpriteCellId,NN._initialEndSpriteCellId=this._initialEndSpriteCellId,NN._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(NN.remapData&&this.remapData?NN.remapData.kB(this.remapData):NN.remapData=new kB.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(NN._randomNoiseCoordinates1?(NN._randomNoiseCoordinates1.kB(this._randomNoiseCoordinates1),NN._randomNoiseCoordinates2.kB(this._randomNoiseCoordinates2)):(NN._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),NN._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}NB._Count=0;var BB=lN(15043),lB=(lN(15082),lN(15306)),kl=lN(15297),qB=lN(15174);function cB(NN,BN){const lN=(0,TN.RandomRange)(0,1);eN.xc.LerpToRef(BN.color1,BN.color2,lN,NN.color),BN.colorDead.subtractToRef(NN.color,BN._colorDiff),BN._colorDiff.scaleToRef(1/NN.lifeTime,NN.colorStep)}function eB(NN,BN){NN._currentColorGradient=BN._colorGradients[0],NN._currentColorGradient.getColorToRef(NN.color),NN._currentColor1.kB(NN.color),BN._colorGradients.length>1?BN._colorGradients[1].getColorToRef(NN._currentColor2):NN._currentColor2.kB(NN.color)}function vB(NN,BN){const lN=BN._colorGradients;JN.GetCurrentGradient(BN._ratio,lN,((BN,lN,kB)=>{BN!==NN._currentColorGradient&&(NN._currentColor1.kB(NN._currentColor2),lN.getColorToRef(NN._currentColor2),NN._currentColorGradient=BN),eN.xc.LerpToRef(NN._currentColor1,NN._currentColor2,kB,NN.color)}))}function HB(NN,BN){NN.colorStep.scaleToRef(BN._scaledUpdateSpeed,BN._scaledColorStep),NN.color.addInPlace(BN._scaledColorStep),NN.color.a<0&&(NN.color.a=0)}function TB(NN,BN){JN.GetCurrentGradient(BN._ratio,BN._angularSpeedGradients,((BN,lN,kB)=>{BN!==NN._currentAngularSpeedGradient&&(NN._currentAngularSpeed1=NN._currentAngularSpeed2,NN._currentAngularSpeed2=lN.getFactor(),NN._currentAngularSpeedGradient=BN),NN.angularSpeed=(0,TN.Lerp)(NN._currentAngularSpeed1,NN._currentAngularSpeed2,kB)}))}function RB(NN,BN){NN.angle+=NN.angularSpeed*BN._scaledUpdateSpeed}function sB(NN,BN){BN.particleEmitterType.startDirectionFunction(BN._emitterWorldMatrix,NN.direction,NN,BN.isLocal,BN._emitterInverseWorldMatrix)}function VB(NN,BN){BN.startDirectionFunction(BN._emitterWorldMatrix,NN.direction,NN,BN.isLocal)}function fB(NN,BN){NN._currentVelocityGradient=BN._velocityGradients[0],NN._currentVelocity1=NN._currentVelocityGradient.getFactor(),BN._velocityGradients.length>1?NN._currentVelocity2=BN._velocityGradients[1].getFactor():NN._currentVelocity2=NN._currentVelocity1}function ZB(NN,BN){NN._currentLimitVelocityGradient=BN._limitVelocityGradients[0],NN._currentLimitVelocity1=NN._currentLimitVelocityGradient.getFactor(),BN._limitVelocityGradients.length>1?NN._currentLimitVelocity2=BN._limitVelocityGradients[1].getFactor():NN._currentLimitVelocity2=NN._currentLimitVelocity1}function PB(NN,BN){JN.GetCurrentGradient(BN._ratio,BN._velocityGradients,((lN,kB,qN)=>{lN!==NN._currentVelocityGradient&&(NN._currentVelocity1=NN._currentVelocity2,NN._currentVelocity2=kB.getFactor(),NN._currentVelocityGradient=lN),BN._directionScale*=(0,TN.Lerp)(NN._currentVelocity1,NN._currentVelocity2,qN)}))}function CB(NN,BN){JN.GetCurrentGradient(BN._ratio,BN._limitVelocityGradients,((lN,kB,qN)=>{lN!==NN._currentLimitVelocityGradient&&(NN._currentLimitVelocity1=NN._currentLimitVelocity2,NN._currentLimitVelocity2=kB.getFactor(),NN._currentLimitVelocityGradient=lN);const cN=(0,TN.Lerp)(NN._currentLimitVelocity1,NN._currentLimitVelocity2,qN);NN.direction.length()>cN&&NN.direction.scaleInPlace(BN.limitVelocityDamping)}))}function FB(NN,BN){NN.direction.scaleToRef(BN._directionScale,BN._scaledDirection)}function IB(NN,BN){BN.particleEmitterType.startPositionFunction(BN._emitterWorldMatrix,NN.position,NN,BN.isLocal)}function AB(NN,BN){BN.startPositionFunction(BN._emitterWorldMatrix,NN.position,NN,BN.isLocal)}function MB(NN,BN){NN.aT?NN.aT.kB(NN.position):NN.aT=NN.position.clone(),kB.fB.TransformCoordinatesToRef(NN.aT,BN._emitterWorldMatrix,NN.position)}function GB(NN,BN){BN.isLocal&&NN.aT?(NN.aT.addInPlace(BN._scaledDirection),kB.fB.TransformCoordinatesToRef(NN.aT,BN._emitterWorldMatrix,NN.position)):NN.position.addInPlace(BN._scaledDirection)}function XB(NN,BN){NN._currentDragGradient=BN._dragGradients[0],NN._currentDrag1=NN._currentDragGradient.getFactor(),BN._dragGradients.length>1?NN._currentDrag2=BN._dragGradients[1].getFactor():NN._currentDrag2=NN._currentDrag1}function uB(NN,BN){JN.GetCurrentGradient(BN._ratio,BN._dragGradients,((lN,kB,qN)=>{lN!==NN._currentDragGradient&&(NN._currentDrag1=NN._currentDrag2,NN._currentDrag2=kB.getFactor(),NN._currentDragGradient=lN);const cN=(0,TN.Lerp)(NN._currentDrag1,NN._currentDrag2,qN);BN._scaledDirection.scaleInPlace(1-cN)}))}function dB(NN,BN){NN._randomNoiseCoordinates1?(NN._randomNoiseCoordinates1.Kc(Math.random(),Math.random(),Math.random()),NN._randomNoiseCoordinates2.Kc(Math.random(),Math.random(),Math.random())):(NN._randomNoiseCoordinates1=new kB.fB(Math.random(),Math.random(),Math.random()),NN._randomNoiseCoordinates2=new kB.fB(Math.random(),Math.random(),Math.random()))}function EB(NN,BN){const lN=BN._noiseTextureData,qN=BN._noiseTextureSize;if(lN&&qN&&NN._randomNoiseCoordinates1){const cN=BN._fetchR(NN._randomNoiseCoordinates1.x,NN._randomNoiseCoordinates1.y,qN.width,qN.height,lN),eN=BN._fetchR(NN._randomNoiseCoordinates1.z,NN._randomNoiseCoordinates2.x,qN.width,qN.height,lN),vN=BN._fetchR(NN._randomNoiseCoordinates2.y,NN._randomNoiseCoordinates2.z,qN.width,qN.height,lN),HN=kB.TmpVectors.fB[0],TN=kB.TmpVectors.fB[1];HN.Kc((2*cN-1)*BN.noiseStrength.x,(2*eN-1)*BN.noiseStrength.y,(2*vN-1)*BN.noiseStrength.z),HN.scaleToRef(BN._tempScaledUpdateSpeed,TN),NN.direction.addInPlace(TN)}}function KB(NN,BN){BN.gravity.scaleToRef(BN._tempScaledUpdateSpeed,BN._scaledGravity),NN.direction.addInPlace(BN._scaledGravity)}function gB(NN,BN){NN.size=(0,TN.RandomRange)(BN.minSize,BN.maxSize),NN.scale.Kc((0,TN.RandomRange)(BN.minScaleX,BN.maxScaleX),(0,TN.RandomRange)(BN.minScaleY,BN.maxScaleY))}function nB(NN,BN){NN._currentSizeGradient=BN._sizeGradients[0],NN._currentSize1=NN._currentSizeGradient.getFactor(),NN.size=NN._currentSize1,BN._sizeGradients.length>1?NN._currentSize2=BN._sizeGradients[1].getFactor():NN._currentSize2=NN._currentSize1,NN.scale.Kc((0,TN.RandomRange)(BN.minScaleX,BN.maxScaleX),(0,TN.RandomRange)(BN.minScaleY,BN.maxScaleY))}function rB(NN,BN){const lN=BN._actualFrame/BN.targetStopDuration;JN.GetCurrentGradient(lN,BN._startSizeGradients,((lN,kB,qN)=>{lN!==BN._currentStartSizeGradient&&(BN._currentStartSize1=BN._currentStartSize2,BN._currentStartSize2=kB.getFactor(),BN._currentStartSizeGradient=lN);const cN=(0,TN.Lerp)(BN._currentStartSize1,BN._currentStartSize2,qN);NN.scale.scaleInPlace(cN)}))}function pB(NN,BN){JN.GetCurrentGradient(BN._ratio,BN._sizeGradients,((BN,lN,kB)=>{BN!==NN._currentSizeGradient&&(NN._currentSize1=NN._currentSize2,NN._currentSize2=lN.getFactor(),NN._currentSizeGradient=BN),NN.size=(0,TN.Lerp)(NN._currentSize1,NN._currentSize2,kB)}))}function xB(NN,BN){NN.remapData=new kB.Vector4(0,1,0,1)}function OB(NN,BN){BN._colorRemapGradients&&BN._colorRemapGradients.length>0&&JN.GetCurrentGradient(BN._ratio,BN._colorRemapGradients,((BN,lN,kB)=>{const qN=(0,TN.Lerp)(BN.factor1,lN.factor1,kB),cN=(0,TN.Lerp)(BN.factor2,lN.factor2,kB);NN.remapData.x=qN,NN.remapData.y=cN-qN})),BN._alphaRemapGradients&&BN._alphaRemapGradients.length>0&&JN.GetCurrentGradient(BN._ratio,BN._alphaRemapGradients,((BN,lN,kB)=>{const qN=(0,TN.Lerp)(BN.factor1,lN.factor1,kB),cN=(0,TN.Lerp)(BN.factor2,lN.factor2,kB);NN.remapData.z=qN,NN.remapData.w=cN-qN}))}function wB(NN,BN){const lN=(0,TN.Clamp)(BN._actualFrame/BN.targetStopDuration);JN.GetCurrentGradient(lN,BN._lifeTimeGradients,((BN,kB)=>{const qN=BN,cN=kB,eN=qN.getFactor(),vN=cN.getFactor(),HN=(lN-qN.gradient)/(cN.gradient-qN.gradient);NN.lifeTime=(0,TN.Lerp)(eN,vN,HN)})),BN._emitPower=(0,TN.RandomRange)(BN.minEmitPower,BN.maxEmitPower)}function bB(NN,BN){NN.lifeTime=(0,TN.RandomRange)(BN.minLifeTime,BN.maxLifeTime),BN._emitPower=(0,TN.RandomRange)(BN.minEmitPower,BN.maxEmitPower)}function ml(NN,BN){0===BN._emitPower?(NN._initialDirection?NN._initialDirection.kB(NN.direction):NN._initialDirection=NN.direction.clone(),NN.direction.set(0,0,0)):(NN._initialDirection=null,NN.direction.scaleInPlace(BN._emitPower)),NN.direction.addInPlace(BN._inheritedVelocityOffset)}function aB(NN,BN){NN.angularSpeed=(0,TN.RandomRange)(BN.minAngularSpeed,BN.maxAngularSpeed),NN.angle=(0,TN.RandomRange)(BN.minInitialRotation,BN.maxInitialRotation)}function DB(NN,BN){NN._currentAngularSpeedGradient=BN._angularSpeedGradients[0],NN.angularSpeed=NN._currentAngularSpeedGradient.getFactor(),NN._currentAngularSpeed1=NN.angularSpeed,BN._angularSpeedGradients.length>1?NN._currentAngularSpeed2=BN._angularSpeedGradients[1].getFactor():NN._currentAngularSpeed2=NN._currentAngularSpeed1,NN.angle=(0,TN.RandomRange)(BN.minInitialRotation,BN.maxInitialRotation)}function yB(NN,BN){NN._initialStartSpriteCellId=BN.startSpriteCellID,NN._initialEndSpriteCellId=BN.endSpriteCellID,NN._initialSpriteCellLoop=BN.spriteCellLoop}function LB(NN,BN){NN.previousItem=BN.previousItem,NN.nextItem=BN,BN.previousItem&&(BN.previousItem.nextItem=NN),BN.previousItem=NN}function hB(NN,BN){NN.previousItem=BN,NN.nextItem=BN.nextItem,BN.nextItem&&(BN.nextItem.previousItem=NN),BN.nextItem=NN}function UB(NN,BN){let lN=BN;for(;lN.nextItem;)lN=lN.nextItem;NN.previousItem=lN,NN.nextItem=lN.nextItem,lN.nextItem=NN}function WB(NN){NN.previousItem&&(NN.previousItem.nextItem=NN.nextItem),NN.nextItem&&(NN.nextItem.previousItem=NN.previousItem)}class QB extends HN{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(NN){this._startDirectionFunction!==NN&&(this._startDirectionFunction=NN,this._directionProcessing.process=NN?VB:sB)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(NN){this._startPositionFunction!==NN&&(this._startPositionFunction=NN,this._positionCreation.process=NN?AB:IB)}set onDispose(NN){this._onDisposeObserver&&this.qc.remove(this._onDisposeObserver),this._onDisposeObserver=this.qc.add(NN)}get eN(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(NN){this._useRampGradients!==NN&&(this._useRampGradients=NN,this._resetEffect(),NN?(this._rampCreation={process:xB,previousItem:null,nextItem:null},hB(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:OB,previousItem:null,nextItem:null},hB(this._remapGradientProcessing,this._gravityProcessing)):(WB(this._rampCreation),WB(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(NN){this._isLocal!==NN&&(this._isLocal=NN,NN?(this._isLocalCreation={process:MB,previousItem:null,nextItem:null},hB(this._isLocalCreation,this._positionCreation)):WB(this._isLocalCreation))}get particles(){return this.nZ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(NN){this._animationSheetEnabled!==NN&&(this._animationSheetEnabled=NN,NN?(this._sheetCreation={process:yB,previousItem:null,nextItem:null},hB(this._sheetCreation,this._colorCreation)):WB(this._sheetCreation),this._reset())}getActiveCount(){return this.nZ.length}getClassName(){return"ac"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var NN,BN;let lN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(NN=null===(BN=this._customWrappers[lN])||void 0===BN?void 0:BN.effect)&&void 0!==NN?NN:this._customWrappers[0].effect}_getCustomDrawWrapper(){var NN;let BN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(NN=this._customWrappers[BN])&&void 0!==NN?NN:this._customWrappers[0]}setCustomEffect(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[BN]=new BB.b(this._engine),this._customWrappers[BN].effect=NN,this._customWrappers[BN].drawContext&&(this._customWrappers[BN].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new YN.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(NN){if(this.noiseTexture!==NN){if(this._noiseTexture=NN,!NN)return WB(this._noiseCreation),void WB(this._noiseProcessing);this._noiseCreation={process:dB,previousItem:null,nextItem:null},hB(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:EB,previousItem:null,nextItem:null},hB(this._noiseProcessing,this._positionProcessing)}}constructor(NN,BN,lN){let qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,cN=arguments.length>4&&void 0!==arguments[4]&&arguments[4],vN=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,HN=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(NN),this._emitterInverseWorldMatrix=kB.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new kB.fB,this.qc=new YN.b,this.onStoppedObservable=new YN.b,this.onStartedObservable=new YN.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.nZ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new eN.xc(0,0,0,0),this._colorDiff=new eN.xc(0,0,0,0),this._scaledDirection=kB.fB.Zero(),this._scaledGravity=kB.fB.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=NN=>{},this.recycleParticle=NN=>{const BN=this.nZ.pop();BN!==NN&&BN.copyTo(NN),this._stockParticles.push(BN)},this._createParticle=()=>{let NN;return 0!==this._stockParticles.length?(NN=this._stockParticles.pop(),NN._reset()):NN=new NB(this),this._prepareParticle(NN),NN},this.paused=!1,this._shadersLoaded=!1,this._capacity=BN,this._epsilon=vN,lN&&"Scene"!==lN.getClassName()?(this._engine=lN,this.defaultProjectionMatrix=kB.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=lN||zN.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kP.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:bB,previousItem:null,nextItem:null},this._positionCreation={process:IB,previousItem:null,nextItem:null},hB(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:sB,previousItem:null,nextItem:null},hB(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ml,previousItem:null,nextItem:null},hB(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:gB,previousItem:null,nextItem:null},hB(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:aB,previousItem:null,nextItem:null},hB(this._angleCreation,this._sizeCreation),this._colorCreation={process:cB,previousItem:null,nextItem:null},hB(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,HN||(this._colorProcessing={process:HB,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:RB,previousItem:null,nextItem:null},hB(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:FB,previousItem:null,nextItem:null},hB(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:GB,previousItem:null,nextItem:null},hB(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:KB,previousItem:null,nextItem:null},hB(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=cN,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=qN,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new sN,this.updateFunction=NN=>{var BN;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(BN=this.noiseTexture.getContent())||void 0===BN||BN.then((NN=>{this._noiseTextureData=NN})));const lN=NN===this.nZ;for(let kB=0;kB<NN.length;kB++){const BN=NN[kB];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const qN=BN.age;if(BN.age+=this._tempScaledUpdateSpeed,BN.age>BN.lifeTime){const NN=BN.age-qN,lN=BN.lifeTime-qN;this._tempScaledUpdateSpeed=lN*this._tempScaledUpdateSpeed/NN,BN.age=BN.lifeTime}this._ratio=BN.age/BN.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let cN=this._updateQueueStart;for(;cN;)cN.process(BN,this),cN=cN.nextItem;if(this._isAnimationSheetEnabled&&!HN&&BN.updateCellIndex(),BN._inheritParticleInfoToSubEmitters(),BN.age>=BN.lifeTime){if(this._emitFromParticle(BN),BN._attachedSubEmitters){for(const NN of BN._attachedSubEmitters)NN.particleSystem.disposeOnStop=!0,NN.particleSystem.stop();BN._attachedSubEmitters=null}this.recycleParticle(BN),lN&&kB--}else;}}}serialize(NN){throw new Error("Method not implemented.")}clone(NN,BN){throw new Error("Method not implemented.")}_addFactorGradient(NN,BN,lN,kB){const qN=new oN(BN,lN,kB);NN.push(qN),NN.sort(((NN,BN)=>NN.gradient<BN.gradient?-1:NN.gradient>BN.gradient?1:0))}_removeFactorGradient(NN,BN){if(!NN)return;let lN=0;for(const kB of NN){if(kB.gradient===BN){NN.splice(lN,1);break}lN++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=wB:this._lifeTimeCreation.process=bB}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:rB,previousItem:null,nextItem:null},hB(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(WB(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(NN){this.targetStopDuration!==NN&&(this._targetStopDuration=NN,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(NN,BN,lN){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,NN,BN,lN),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(NN){return this._removeFactorGradient(this._lifeTimeGradients,NN),this._syncLifeTimeCreation(),this}addSizeGradient(NN,BN,lN){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=nB,this._sizeGradientProcessing={process:pB,previousItem:null,nextItem:null},LB(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,NN,BN,lN),this}removeSizeGradient(NN){var BN;return this._removeFactorGradient(this._sizeGradients,NN),0===(null===(BN=this._sizeGradients)||void 0===BN?void 0:BN.length)&&(WB(this._sizeGradientProcessing),this._sizeCreation.process=gB),this}addColorRemapGradient(NN,BN,lN){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,NN,BN,lN),this}removeColorRemapGradient(NN){return this._removeFactorGradient(this._colorRemapGradients,NN),this}addAlphaRemapGradient(NN,BN,lN){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,NN,BN,lN),this}removeAlphaRemapGradient(NN){return this._removeFactorGradient(this._alphaRemapGradients,NN),this}addAngularSpeedGradient(NN,BN,lN){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=DB,this._angularSpeedGradientProcessing={process:TB,previousItem:null,nextItem:null},LB(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,NN,BN,lN),this}removeAngularSpeedGradient(NN){var BN;return this._removeFactorGradient(this._angularSpeedGradients,NN),0===(null===(BN=this._angularSpeedGradients)||void 0===BN?void 0:BN.length)&&(this._angleCreation.process=aB,WB(this._angularSpeedGradientProcessing)),this}addVelocityGradient(NN,BN,lN){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:fB,previousItem:null,nextItem:null},hB(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:PB,previousItem:null,nextItem:null},LB(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,NN,BN,lN),this}removeVelocityGradient(NN){var BN;return this._removeFactorGradient(this._velocityGradients,NN),0===(null===(BN=this._velocityGradients)||void 0===BN?void 0:BN.length)&&(WB(this._velocityCreation),WB(this._velocityGradientProcessing)),this}addLimitVelocityGradient(NN,BN,lN){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ZB,previousItem:null,nextItem:null},hB(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:CB,previousItem:null,nextItem:null},hB(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,NN,BN,lN),this}removeLimitVelocityGradient(NN){var BN;return this._removeFactorGradient(this._limitVelocityGradients,NN),0===(null===(BN=this._limitVelocityGradients)||void 0===BN?void 0:BN.length)&&(WB(this._limitVelocityCreation),WB(this._limitVelocityGradientProcessing)),this}addDragGradient(NN,BN,lN){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:XB,previousItem:null,nextItem:null},LB(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:uB,previousItem:null,nextItem:null},LB(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,NN,BN,lN),this}removeDragGradient(NN){var BN;return this._removeFactorGradient(this._dragGradients,NN),0===(null===(BN=this._dragGradients)||void 0===BN?void 0:BN.length)&&(WB(this._dragCreation),WB(this._dragGradientProcessing)),this}addEmitRateGradient(NN,BN,lN){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,NN,BN,lN),this}removeEmitRateGradient(NN){return this._removeFactorGradient(this._emitRateGradients,NN),this}addStartSizeGradient(NN,BN,lN){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,NN,BN,lN),this._syncStartSizeCreation(),this}removeStartSizeGradient(NN){return this._removeFactorGradient(this._startSizeGradients,NN),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const NN=new Uint8Array(4*this._rawTextureWidth),BN=eN.TmpColors.FB[0];for(let lN=0;lN<this._rawTextureWidth;lN++){const kB=lN/this._rawTextureWidth;JN.GetCurrentGradient(kB,this._rampGradients,((kB,qN,cN)=>{eN.FB.LerpToRef(kB.color,qN.color,cN,BN),NN[4*lN]=255*BN.r,NN[4*lN+1]=255*BN.g,NN[4*lN+2]=255*BN.b,NN[4*lN+3]=255}))}this._rampGradientsTexture=jB.d.CreateRGBATexture(NN,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((NN,BN)=>NN.gradient<BN.gradient?-1:NN.gradient>BN.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(NN,BN){this._rampGradients||(this._rampGradients=[]);const lN=new tN(NN,BN);return this._rampGradients.push(lN),this._syncRampGradientTexture(),this}removeRampGradient(NN){return this._removeGradientAndTexture(NN,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(NN,BN,lN){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=eB,this._colorProcessing.process=vB);const kB=new iB(NN,BN,lN);return this._colorGradients.push(kB),this._colorGradients.sort(((NN,BN)=>NN.gradient<BN.gradient?-1:NN.gradient>BN.gradient?1:0)),this}removeColorGradient(NN){if(!this._colorGradients)return this;let BN=0;for(const lN of this._colorGradients){if(lN.gradient===NN){this._colorGradients.splice(BN,1);break}BN++}return 0===this._colorGradients.length&&(this._colorCreation.process=cB,this._colorProcessing.process=HB),this}resetDrawCache(){if(this._drawWrappers){for(const NN of this._drawWrappers)if(NN)for(const BN of NN)null===BN||void 0===BN||BN.dispose();this._drawWrappers=[]}}_fetchR(NN,BN,lN,kB,qN){return qN[4*(((NN=.5*Math.abs(NN)+.5)*lN%lN|0)+((BN=.5*Math.abs(BN)+.5)*kB%kB|0)*lN)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const NN=this._engine,BN=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*BN),this._vertexBuffer=new GN.e(NN,this._vertexData,!0,BN);let lN=0;const kB=this._vertexBuffer.createVertexBuffer(GN.f.PositionKind,lN,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[GN.f.PositionKind]=kB,lN+=3;const qN=this._vertexBuffer.createVertexBuffer(GN.f.ColorKind,lN,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[GN.f.ColorKind]=qN,lN+=4;const cN=this._vertexBuffer.createVertexBuffer("angle",lN,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=cN,lN+=1;const eN=this._vertexBuffer.createVertexBuffer("size",lN,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=eN,lN+=2,this._isAnimationSheetEnabled){const NN=this._vertexBuffer.createVertexBuffer("cellIndex",lN,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=NN,lN+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const NN=this._vertexBuffer.createVertexBuffer("direction",lN,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=NN,lN+=3}if(this._useRampGradients){const NN=this._vertexBuffer.createVertexBuffer("remapData",lN,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=NN,lN+=4}let vN;if(this._useInstancing){const BN=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new GN.e(NN,BN,!1,2),vN=this._spriteBuffer.createVertexBuffer("offset",0,2)}else vN=this._vertexBuffer.createVertexBuffer("offset",lN,2,this._vertexBufferSize,this._useInstancing),lN+=2;this._vertexBuffers.offset=vN,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const NN=[],BN=[];let lN=0;for(let kB=0;kB<this._capacity;kB++)NN.push(lN),NN.push(lN+1),NN.push(lN+2),NN.push(lN),NN.push(lN+2),NN.push(lN+3),BN.push(lN,lN+1,lN+1,lN+2,lN+2,lN+3,lN+3,lN,lN,lN+3),lN+=4;this._indexBuffer=this._engine.createIndexBuffer(NN),this._linesIndexBuffer=this._engine.createIndexBuffer(BN)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(NN)setTimeout((()=>{this.start(0)}),NN);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var BN;-1!==(null===(BN=this.NB)||void 0===BN?void 0:BN.getClassName().indexOf("Mesh"))&&this.NB.uc(!0);const NN=this.noiseTexture;if(NN&&NN.onGeneratedObservable)NN.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let BN=0;BN<this.preWarmCycles;BN++)this.animate(!0),NN.render()}))}));else for(let BN=0;BN<this.preWarmCycles;BN++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(NN))}_postStop(NN){}reset(){this._stockParticles.length=0,this.nZ.length=0}_appendParticleVertex(NN,BN,lN,qN){let cN=NN*this._vertexBufferSize;if(this._vertexData[cN++]=BN.position.x+this.Vs.x,this._vertexData[cN++]=BN.position.y+this.Vs.y,this._vertexData[cN++]=BN.position.z+this.Vs.z,this._vertexData[cN++]=BN.color.r,this._vertexData[cN++]=BN.color.g,this._vertexData[cN++]=BN.color.b,this._vertexData[cN++]=BN.color.a,this._vertexData[cN++]=BN.angle,this._vertexData[cN++]=BN.scale.x*BN.size,this._vertexData[cN++]=BN.scale.y*BN.size,this._isAnimationSheetEnabled&&(this._vertexData[cN++]=BN.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[cN++]=BN.direction.x,this._vertexData[cN++]=BN.direction.y,this._vertexData[cN++]=BN.direction.z);else if(BN._initialDirection){let NN=BN._initialDirection;this.isLocal&&(kB.fB.TransformNormalToRef(NN,this._emitterWorldMatrix,kB.TmpVectors.fB[0]),NN=kB.TmpVectors.fB[0]),0===NN.x&&0===NN.z&&(NN.x=.001),this._vertexData[cN++]=NN.x,this._vertexData[cN++]=NN.y,this._vertexData[cN++]=NN.z}else{let NN=BN.direction;this.isLocal&&(kB.fB.TransformNormalToRef(NN,this._emitterWorldMatrix,kB.TmpVectors.fB[0]),NN=kB.TmpVectors.fB[0]),0===NN.x&&0===NN.z&&(NN.x=.001),this._vertexData[cN++]=NN.x,this._vertexData[cN++]=NN.y,this._vertexData[cN++]=NN.z}this._useRampGradients&&BN.remapData&&(this._vertexData[cN++]=BN.remapData.x,this._vertexData[cN++]=BN.remapData.y,this._vertexData[cN++]=BN.remapData.z,this._vertexData[cN++]=BN.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===lN?lN=this._epsilon:1===lN&&(lN=1-this._epsilon),0===qN?qN=this._epsilon:1===qN&&(qN=1-this._epsilon)),this._vertexData[cN++]=lN,this._vertexData[cN++]=qN)}_prepareParticle(NN){}_createNewOnes(NN){let BN;for(let lN=0;lN<NN&&this.nZ.length!==this._capacity;lN++){BN=this._createParticle(),this.nZ.push(BN);let NN=this._createQueueStart;for(;NN;)NN.process(BN,this),NN=NN.nextItem;BN._inheritParticleInfoToSubEmitters()}}_update(NN){if(this._alive=this.nZ.length>0,this.NB.position){const NN=this.NB;this._emitterWorldMatrix=NN.getWorldMatrix()}else{const NN=this.NB;this._emitterWorldMatrix=kB.Matrix.Translation(NN.x,NN.y,NN.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.nZ),this._createNewOnes(NN)}static _GetAttributeNamesOrOptions(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const kB=[GN.f.PositionKind,GN.f.ColorKind,"angle","offset","size"];return NN&&kB.push("cellIndex"),BN||kB.push("direction"),lN&&kB.push("remapData"),kB}static _GetEffectCreationOptions(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const kB=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,lB.e)(kB),NN&&kB.push("particlesInfos"),BN&&kB.push("logarithmicDepthConstant"),lN&&(kB.push("vFogInfos"),kB.push("vFogColor")),kB}fillDefines(NN,BN){let lN=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lB.m)(this,this._scene,NN),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&NN.push("#define FOG")),this._isAnimationSheetEnabled&&NN.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&NN.push("#define LOGARITHMICDEPTH"),BN===HN.BLENDMODE_MULTIPLY&&NN.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&NN.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(NN.push("#define BILLBOARD"),this.billboardMode){case 2:NN.push("#define BILLBOARDY");break;case 8:case 9:NN.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&NN.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:NN.push("#define BILLBOARDMODE_ALL")}lN&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),NN.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(NN,BN,lN){BN.push(...QB._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),NN.push(...QB._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),lN.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,qB.g)(NN,this._imageProcessingConfigurationDefines),(0,qB.c)(lN,this._imageProcessingConfigurationDefines))}_getWrapper(NN){const BN=this._getCustomDrawWrapper(NN);if(null!==BN&&void 0!==BN&&BN.effect)return BN;const lN=[];this.fillDefines(lN,NN);const kB=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let qN=this._drawWrappers[kB];qN||(qN=this._drawWrappers[kB]=[]);let cN=qN[NN];cN||(cN=new BB.b(this._engine),cN.drawContext&&(cN.drawContext.useInstancing=this._useInstancing),qN[NN]=cN);const eN=lN.join("\n");if(cN.defines!==eN){const NN=[],BN=[],lN=[];this.fillUniformsAttributesAndSamplerNames(BN,NN,lN),cN.setEffect(this._engine.createEffect("particles",NN,BN,lN,eN,void 0,void 0,void 0,void 0,this._shaderLanguage),eN)}return cN}animate(){var NN;let BN,lN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!lN&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(lN?this.preWarmStepOffset:(null===(NN=this._scene)||void 0===NN?void 0:NN.getAnimationRatio())||1),this.manualEmitCount>-1)BN=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let NN=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const BN=this._actualFrame/this.targetStopDuration;JN.GetCurrentGradient(BN,this._emitRateGradients,((BN,lN,kB)=>{BN!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=lN.getFactor(),this._currentEmitRateGradient=BN),NN=(0,TN.Lerp)(this._currentEmitRate1,this._currentEmitRate2,kB)}))}BN=NN*this._scaledUpdateSpeed|0,this._newPartsExcess+=NN*this._scaledUpdateSpeed-BN}if(this._newPartsExcess>1&&(BN+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?BN=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(BN),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!lN){let NN=0;for(let BN=0;BN<this.nZ.length;BN++){const lN=this.nZ[BN];this._appendParticleVertices(NN,lN),NN+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.nZ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(NN,BN){this._appendParticleVertex(NN++,BN,0,0),this._useInstancing||(this._appendParticleVertex(NN++,BN,1,0),this._appendParticleVertex(NN++,BN,1,1),this._appendParticleVertex(NN++,BN,0,1))}rebuild(){var NN;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(NN=this._spriteBuffer)||void 0===NN||NN._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!QB.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(lN.bind(lN,16138)),Promise.resolve().then(lN.bind(lN,16081))])):await Promise.all([Promise.resolve().then(lN.bind(lN,16074)),Promise.resolve().then(lN.bind(lN,16062))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.NB||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==HN.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(HN.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(HN.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(NN){var BN,lN;const qN=this._getWrapper(NN),cN=qN.effect,eN=this._engine;eN.enableEffect(qN);const vN=null!==(BN=this.defaultViewMatrix)&&void 0!==BN?BN:this._scene.getViewMatrix();if(cN.setTexture("diffuseSampler",this.particleTexture),cN.setMatrix("view",vN),cN.setMatrix("projection",null!==(lN=this.defaultProjectionMatrix)&&void 0!==lN?lN:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const NN=this.particleTexture.getBaseSize();cN.setFloat3("particlesInfos",this.spriteCellWidth/NN.width,this.spriteCellHeight/NN.height,this.spriteCellWidth/NN.width)}if(cN.setVector2("translationPivot",this.translationPivot),cN.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const NN=this._scene.activeCamera;cN.setVector3("eyePosition",NN.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),cN.setTexture("rampSampler",this._rampGradientsTexture));const HN=cN.defines;var TN,RN,sN,VN,fN,ZN;(this._scene&&((0,lB.g)(cN,this,this._scene),this.applyFog&&(0,kl.d)(this._scene,void 0,cN)),HN.indexOf("#define BILLBOARDMODE_ALL")>=0&&(vN.invertToRef(kB.TmpVectors.Matrix[0]),cN.setMatrix("invView",kB.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(TN=this._scene)&&void 0!==TN&&TN.forceWireframe?eN.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,cN):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,cN)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(RN=this._scene)&&void 0!==RN&&RN.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?eN.bindBuffers(this._vertexBuffers,null!==(sN=this._scene)&&void 0!==sN&&sN.forceWireframe?this._linesIndexBuffer:this._indexBuffer,cN):eN.bindBuffers(this._vertexBuffers,null!==(VN=this._scene)&&void 0!==VN&&VN.forceWireframe?this._linesIndexBufferUseInstancing:null,cN);(this.useLogarithmicDepth&&this._scene&&(0,kl.h)(HN,cN,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(cN),this._setEngineBasedOnBlendMode(NN),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(cN),this._useInstancing)?null!==(fN=this._scene)&&void 0!==fN&&fN.forceWireframe?eN.drawElementsType(6,0,10,this.nZ.length):eN.drawArraysType(7,0,4,this.nZ.length):null!==(ZN=this._scene)&&void 0!==ZN&&ZN.forceWireframe?eN.drawElementsType(1,0,10*this.nZ.length):eN.drawElementsType(0,0,6*this.nZ.length);return this.nZ.length}render(){if(!this.isReady()||!this.nZ.length)return 0;const NN=this._engine;NN.setState&&(NN.setState(!1),this.forceDepthWrite&&NN.setDepthWrite(!0));let BN=0;return BN=this.blendMode===HN.BLENDMODE_MULTIPLYADD?this._render(HN.BLENDMODE_MULTIPLY)+this._render(HN.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),BN}_onDispose(){}dispose(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),NN&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),NN&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(BN,lN),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const NN=this._scene.kP.indexOf(this);NN>-1&&this._scene.kP.splice(NN,1),this._scene._activeParticleSystems.dispose()}this.qc.notifyObservers(this),this.qc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}QB.ForceGLSL=!1;var SB,il=lN(14760);!function(NN){NN[NN.ATTACHED=0]="ATTACHED",NN[NN.END=1]="END"}(SB||(SB={}));class tB{constructor(NN){if(this.particleSystem=NN,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!NN.NB||!NN.NB.dispose){const BN=(0,vN.b)("BABYLON.AbstractMesh");NN.NB=new BN("SubemitterSystemEmitter",NN.VB()),NN._disposeEmitterOnDispose=!0}}clone(){let NN=this.particleSystem.NB;if(NN){if(NN instanceof kB.fB)NN=NN.clone();else if(-1!==NN.getClassName().indexOf("Mesh")){NN=new((0,vN.b)("BABYLON.Mesh"))("",NN.VB()),NN.isVisible=!1}}else NN=new kB.fB;const BN=new tB(this.particleSystem.clone(this.particleSystem.name,NN));return BN.particleSystem.name+="Clone",BN.type=this.type,BN.inheritDirection=this.inheritDirection,BN.inheritedVelocityAmount=this.inheritedVelocityAmount,BN.particleSystem._disposeEmitterOnDispose=!0,BN.particleSystem.disposeOnStop=!0,BN}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const BN={};return BN.type=this.type,BN.inheritDirection=this.inheritDirection,BN.inheritedVelocityAmount=this.inheritedVelocityAmount,BN.particleSystem=this.particleSystem.serialize(NN),BN}static _ParseParticleSystem(NN,BN,lN){throw(0,il.b)("ParseParticle")}static Parse(NN,BN,lN){const kB=NN.particleSystem,qN=new tB(tB._ParseParticleSystem(kB,BN,lN,!0));return qN.type=NN.type,qN.inheritDirection=NN.inheritDirection,qN.inheritedVelocityAmount=NN.inheritedVelocityAmount,qN.particleSystem._isSubEmitter=!0,qN}dispose(){this.particleSystem.dispose()}}var oB=lN(14818);function JB(NN,BN){const lN=new FN;return lN.direction1=NN,lN.direction2=BN,lN}function YB(){return new CN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jl(){return new IN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function zB(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kB.fB(0,1,0),lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0);return new AN(NN,BN,lN)}function Nl(){return new ZN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Bl(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0),cN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new kB.fB(0,1,0);return new PN(NN,BN,lN,qN,cN)}function ll(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new VN(NN,BN)}function kk(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0),qN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0);return new fN(NN,BN,lN,qN)}const ql=kB.fB.Zero(),cl=kB.fB.Zero(),el=kB.fB.Zero();class vl{constructor(){this.strength=0,this.position=kB.fB.Zero()}_processParticle(NN,BN){this.position.subtractToRef(NN.position,ql);const lN=ql.lengthSquared()+1;ql.normalize().scaleToRef(this.strength/lN,cl),cl.scaleToRef(BN._tempScaledUpdateSpeed,el),NN.direction.addInPlace(el)}serialize(){return{position:this.position.Fc(),strength:this.strength}}}class Hl extends QB{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=NN=>{if(!this._subEmitters||0===this._subEmitters.length)return;const BN=Math.floor(Math.random()*this._subEmitters.length);for(const lN of this._subEmitters[BN])if(1===lN.type){const BN=lN.clone();NN._inheritParticleInfoToSubEmitter(BN),BN.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(BN.particleSystem),BN.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(NN,BN){const lN=JB(NN,BN);return this.particleEmitterType=lN,lN}get flowMap(){return this._flowMap}set flowMap(NN){this._flowMap!==NN&&(this._flowMap=NN,this._flowMapUpdate&&(WB(this._flowMapUpdate),this._flowMapUpdate=null),NN&&(this._flowMapUpdate={process:NN=>{var BN;const lN=null===(BN=this.VB())||void 0===BN?void 0:BN.getTransformMatrix();this._flowMap._processParticle(NN,this.flowMapStrength*this._tempScaledUpdateSpeed,lN)},previousItem:null,nextItem:null},hB(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(NN){this._attractors.push(NN),1===this._attractors.length&&(this._attractorUpdate={process:NN=>{for(const BN of this._attractors)BN._processParticle(NN,this)},previousItem:null,nextItem:null},hB(this._attractorUpdate,this._directionProcessing))}removeAttractor(NN){const BN=this._attractors.indexOf(NN);-1!==BN&&this._attractors.splice(BN,1),0===this._attractors.length&&WB(this._attractorUpdate)}start(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(NN)}createHemisphericEmitter(){const NN=YB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=NN,NN}createSphereEmitter(){const NN=jl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=NN,NN}createDirectedSphereEmitter(){const NN=zB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kB.fB(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createCylinderEmitter(){const NN=Nl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=NN,NN}createDirectedCylinderEmitter(){const NN=Bl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createConeEmitter(){const NN=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=NN,NN}createDirectedConeEmitter(){const NN=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createBoxEmitter(NN,BN,lN,kB){const qN=new sN;return this.particleEmitterType=qN,this.direction1=NN,this.direction2=BN,this.minEmitBox=lN,this.maxEmitBox=kB,qN}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const NN of this.subEmitters)NN instanceof Hl?this._subEmitters.push([new tB(NN)]):NN instanceof tB?this._subEmitters.push([NN]):NN instanceof Array&&this._subEmitters.push(NN)}_stopSubEmitters(){if(this.activeSubSystems){for(const NN of this.activeSubSystems)NN.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const NN=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==NN&&this._rootParticleSystem.activeSubSystems.splice(NN,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(NN){NN&&this._stopSubEmitters()}_prepareParticle(NN){if(this._subEmitters&&this._subEmitters.length>0){const BN=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];NN._attachedSubEmitters=[];for(const lN of BN)if(0===lN.type){const BN=lN.clone();NN._attachedSubEmitters.push(BN),BN.particleSystem.start()}}}_onDispose(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),NN&&this.particles)for(const lN of this.particles)if(lN._attachedSubEmitters)for(let NN=lN._attachedSubEmitters.length-1;NN>=0;NN-=1)lN._attachedSubEmitters[NN].dispose();if(BN&&this.activeSubSystems)for(let lN=this.activeSubSystems.length-1;lN>=0;lN-=1)this.activeSubSystems[lN].dispose();if(this._subEmitters&&this._subEmitters.length){for(let NN=0;NN<this._subEmitters.length;NN++)for(const BN of this._subEmitters[NN])BN.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.NB&&this.NB.dispose&&this.NB.dispose(!0)}static _Parse(NN,BN,lN,qN){var cN,HN,TN;let RN;RN=lN instanceof oB.c?null:lN;const GN=(0,vN.b)("BABYLON.Texture");if(GN&&RN&&(NN.texture?BN.particleTexture=GN.Parse(NN.texture,RN,qN):NN.textureName&&(BN.particleTexture=new GN(qN+NN.textureName,RN,!1,void 0===NN.invertY||NN.invertY),BN.particleTexture.name=NN.textureName)),NN.emitterId||0===NN.emitterId||void 0!==NN.NB?NN.emitterId&&RN?BN.NB=RN.getLastMeshById(NN.emitterId):BN.NB=kB.fB.IB(NN.NB):BN.NB=kB.fB.Zero(),BN.isLocal=!!NN.isLocal,void 0!==NN.renderingGroupId&&(BN.renderingGroupId=NN.renderingGroupId),void 0!==NN.isBillboardBased&&(BN.isBillboardBased=NN.isBillboardBased),void 0!==NN.billboardMode&&(BN.billboardMode=NN.billboardMode),void 0!==NN.useLogarithmicDepth&&(BN.useLogarithmicDepth=NN.useLogarithmicDepth),NN.animations){for(let lN=0;lN<NN.animations.length;lN++){const kB=NN.animations[lN],qN=(0,vN.b)("BABYLON.Animation");qN&&BN.animations.push(qN.Parse(kB))}BN.beginAnimationOnStart=NN.beginAnimationOnStart,BN.beginAnimationFrom=NN.beginAnimationFrom,BN.beginAnimationTo=NN.beginAnimationTo,BN.beginAnimationLoop=NN.beginAnimationLoop}if(NN.autoAnimate&&RN&&RN.beginAnimation(BN,NN.autoAnimateFrom,NN.autoAnimateTo,NN.autoAnimateLoop,NN.autoAnimateSpeed||1),BN.startDelay=0|NN.startDelay,BN.minAngularSpeed=NN.minAngularSpeed,BN.maxAngularSpeed=NN.maxAngularSpeed,BN.minSize=NN.minSize,BN.maxSize=NN.maxSize,NN.minScaleX&&(BN.minScaleX=NN.minScaleX,BN.maxScaleX=NN.maxScaleX,BN.minScaleY=NN.minScaleY,BN.maxScaleY=NN.maxScaleY),void 0!==NN.preWarmCycles&&(BN.preWarmCycles=NN.preWarmCycles,BN.preWarmStepOffset=NN.preWarmStepOffset),void 0!==NN.minInitialRotation&&(BN.minInitialRotation=NN.minInitialRotation,BN.maxInitialRotation=NN.maxInitialRotation),BN.minLifeTime=NN.minLifeTime,BN.maxLifeTime=NN.maxLifeTime,BN.minEmitPower=NN.minEmitPower,BN.maxEmitPower=NN.maxEmitPower,BN.emitRate=NN.emitRate,BN.gravity=kB.fB.IB(NN.gravity),NN.noiseStrength&&(BN.noiseStrength=kB.fB.IB(NN.noiseStrength)),BN.color1=eN.xc.IB(NN.color1),BN.color2=eN.xc.IB(NN.color2),BN.colorDead=eN.xc.IB(NN.colorDead),BN.updateSpeed=NN.updateSpeed,BN.targetStopDuration=NN.targetStopDuration,BN.blendMode=NN.blendMode,NN.colorGradients)for(const kB of NN.colorGradients)BN.addColorGradient(kB.gradient,eN.xc.IB(kB.color1),kB.color2?eN.xc.IB(kB.color2):void 0);if(NN.rampGradients){for(const lN of NN.rampGradients)BN.addRampGradient(lN.gradient,eN.FB.IB(lN.color));BN.useRampGradients=NN.useRampGradients}if(NN.colorRemapGradients)for(const kB of NN.colorRemapGradients)BN.addColorRemapGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.alphaRemapGradients)for(const kB of NN.alphaRemapGradients)BN.addAlphaRemapGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.sizeGradients)for(const kB of NN.sizeGradients)BN.addSizeGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.angularSpeedGradients)for(const kB of NN.angularSpeedGradients)BN.addAngularSpeedGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.velocityGradients)for(const kB of NN.velocityGradients)BN.addVelocityGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.dragGradients)for(const kB of NN.dragGradients)BN.addDragGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.emitRateGradients)for(const kB of NN.emitRateGradients)BN.addEmitRateGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.startSizeGradients)for(const kB of NN.startSizeGradients)BN.addStartSizeGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.lifeTimeGradients)for(const kB of NN.lifeTimeGradients)BN.addLifeTimeGradient(kB.gradient,void 0!==kB.factor1?kB.factor1:kB.factor,kB.factor2);if(NN.limitVelocityGradients){for(const lN of NN.limitVelocityGradients)BN.addLimitVelocityGradient(lN.gradient,void 0!==lN.factor1?lN.factor1:lN.factor,lN.factor2);BN.limitVelocityDamping=NN.limitVelocityDamping}if(NN.noiseTexture&&RN){const lN=(0,vN.b)("BABYLON.ProceduralTexture");BN.noiseTexture=lN.Parse(NN.noiseTexture,RN,qN)}let uN;if(NN.particleEmitterType){switch(NN.particleEmitterType.type){case"SphereParticleEmitter":uN=new IN;break;case"SphereDirectedParticleEmitter":uN=new AN;break;case"ConeEmitter":case"ConeParticleEmitter":uN=new VN;break;case"ConeDirectedParticleEmitter":uN=new fN;break;case"CylinderParticleEmitter":uN=new ZN;break;case"CylinderDirectedParticleEmitter":uN=new PN;break;case"HemisphericParticleEmitter":uN=new CN;break;case"PointParticleEmitter":uN=new FN;break;case"MeshParticleEmitter":uN=new XN;break;case"CustomParticleEmitter":uN=new MN;break;default:uN=new sN}uN.parse(NN.particleEmitterType,RN)}else uN=new sN,uN.parse(NN,RN);BN.particleEmitterType=uN,BN.startSpriteCellID=NN.startSpriteCellID,BN.endSpriteCellID=NN.endSpriteCellID,BN.spriteCellLoop=null===(cN=NN.spriteCellLoop)||void 0===cN||cN,BN.spriteCellWidth=NN.spriteCellWidth,BN.spriteCellHeight=NN.spriteCellHeight,BN.spriteCellChangeSpeed=NN.spriteCellChangeSpeed,BN.spriteRandomStartCell=NN.spriteRandomStartCell,BN.disposeOnStop=null!==(HN=NN.disposeOnStop)&&void 0!==HN&&HN,BN.manualEmitCount=null!==(TN=NN.manualEmitCount)&&void 0!==TN?TN:-1}static Parse(NN,BN,lN){let qN=arguments.length>3&&void 0!==arguments[3]&&arguments[3],cN=arguments.length>4?arguments[4]:void 0;const vN=NN.name;let HN,TN,RN=null,sN=null;if(BN instanceof oB.c?HN=BN:(TN=BN,HN=TN.getEngine()),NN.customShader&&HN.createEffectForParticles){sN=NN.customShader;const BN=sN.shaderOptions.defines.length>0?sN.shaderOptions.defines.join("\n"):"";RN=HN.createEffectForParticles(sN.shaderPath.fragmentElement,sN.shaderOptions.uniforms,sN.shaderOptions.samplers,BN)}const VN=new Hl(vN,cN||NN.Fl,BN,RN,NN.isAnimationSheetEnabled);if(VN.customShader=sN,VN._rootUrl=lN,NN.id&&(VN.id=NN.id),NN.subEmitters){VN.subEmitters=[];for(const kB of NN.subEmitters){const NN=[];for(const qN of kB)NN.push(tB.Parse(qN,BN,lN));VN.subEmitters.push(NN)}}if(NN.attractors)for(const eN of NN.attractors){const NN=new vl;NN.position=kB.fB.IB(eN.position),NN.strength=eN.strength,VN.addAttractor(NN)}return Hl._Parse(NN,VN,BN,lN),NN.textureMask&&(VN.textureMask=eN.xc.IB(NN.textureMask)),NN.Vs&&(VN.Vs=kB.fB.IB(NN.Vs)),NN.preventAutoStart&&(VN.preventAutoStart=NN.preventAutoStart),qN||VN.preventAutoStart||VN.start(),VN}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const BN={};if(Hl._Serialize(BN,this,NN),BN.textureMask=this.textureMask.Fc(),BN.customShader=this.customShader,BN.preventAutoStart=this.preventAutoStart,BN.Vs=this.Vs.Fc(),this.subEmitters){BN.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const lN of this._subEmitters){const kB=[];for(const BN of lN)kB.push(BN.serialize(NN));BN.subEmitters.push(kB)}}if(this._attractors&&this._attractors.length){BN.attractors=[];for(const NN of this._attractors)BN.attractors.push(NN.serialize())}return BN}static _Serialize(NN,BN,lN){if(NN.name=BN.name,NN.id=BN.id,NN.Fl=BN.getCapacity(),NN.disposeOnStop=BN.disposeOnStop,NN.manualEmitCount=BN.manualEmitCount,BN.NB.position){const lN=BN.NB;NN.emitterId=lN.id}else{const lN=BN.NB;NN.NB=lN.Fc()}BN.particleEmitterType&&(NN.particleEmitterType=BN.particleEmitterType.serialize()),BN.particleTexture&&(lN?NN.texture=BN.particleTexture.serialize():(NN.textureName=BN.particleTexture.name,NN.invertY=!!BN.particleTexture._invertY)),NN.isLocal=BN.isLocal,wN.b.AppendSerializedAnimations(BN,NN),NN.beginAnimationOnStart=BN.beginAnimationOnStart,NN.beginAnimationFrom=BN.beginAnimationFrom,NN.beginAnimationTo=BN.beginAnimationTo,NN.beginAnimationLoop=BN.beginAnimationLoop,NN.startDelay=BN.startDelay,NN.renderingGroupId=BN.renderingGroupId,NN.isBillboardBased=BN.isBillboardBased,NN.billboardMode=BN.billboardMode,NN.minAngularSpeed=BN.minAngularSpeed,NN.maxAngularSpeed=BN.maxAngularSpeed,NN.minSize=BN.minSize,NN.maxSize=BN.maxSize,NN.minScaleX=BN.minScaleX,NN.maxScaleX=BN.maxScaleX,NN.minScaleY=BN.minScaleY,NN.maxScaleY=BN.maxScaleY,NN.minEmitPower=BN.minEmitPower,NN.maxEmitPower=BN.maxEmitPower,NN.minLifeTime=BN.minLifeTime,NN.maxLifeTime=BN.maxLifeTime,NN.emitRate=BN.emitRate,NN.gravity=BN.gravity.Fc(),NN.noiseStrength=BN.noiseStrength.Fc(),NN.color1=BN.color1.Fc(),NN.color2=BN.color2.Fc(),NN.colorDead=BN.colorDead.Fc(),NN.updateSpeed=BN.updateSpeed,NN.targetStopDuration=BN.targetStopDuration,NN.blendMode=BN.blendMode,NN.preWarmCycles=BN.preWarmCycles,NN.preWarmStepOffset=BN.preWarmStepOffset,NN.minInitialRotation=BN.minInitialRotation,NN.maxInitialRotation=BN.maxInitialRotation,NN.startSpriteCellID=BN.startSpriteCellID,NN.spriteCellLoop=BN.spriteCellLoop,NN.endSpriteCellID=BN.endSpriteCellID,NN.spriteCellChangeSpeed=BN.spriteCellChangeSpeed,NN.spriteCellWidth=BN.spriteCellWidth,NN.spriteCellHeight=BN.spriteCellHeight,NN.spriteRandomStartCell=BN.spriteRandomStartCell,NN.isAnimationSheetEnabled=BN.isAnimationSheetEnabled,NN.useLogarithmicDepth=BN.useLogarithmicDepth;const kB=BN.getColorGradients();if(kB){NN.colorGradients=[];for(const BN of kB){const lN={gradient:BN.gradient,color1:BN.color1.Fc()};BN.color2?lN.color2=BN.color2.Fc():lN.color2=BN.color1.Fc(),NN.colorGradients.push(lN)}}const qN=BN.getRampGradients();if(qN){NN.rampGradients=[];for(const BN of qN){const lN={gradient:BN.gradient,color:BN.color.Fc()};NN.rampGradients.push(lN)}NN.useRampGradients=BN.useRampGradients}const cN=BN.getColorRemapGradients();if(cN){NN.colorRemapGradients=[];for(const BN of cN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.colorRemapGradients.push(lN)}}const eN=BN.getAlphaRemapGradients();if(eN){NN.alphaRemapGradients=[];for(const BN of eN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.alphaRemapGradients.push(lN)}}const vN=BN.getSizeGradients();if(vN){NN.sizeGradients=[];for(const BN of vN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.sizeGradients.push(lN)}}const HN=BN.getAngularSpeedGradients();if(HN){NN.angularSpeedGradients=[];for(const BN of HN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.angularSpeedGradients.push(lN)}}const TN=BN.getVelocityGradients();if(TN){NN.velocityGradients=[];for(const BN of TN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.velocityGradients.push(lN)}}const RN=BN.getDragGradients();if(RN){NN.dragGradients=[];for(const BN of RN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.dragGradients.push(lN)}}const sN=BN.getEmitRateGradients();if(sN){NN.emitRateGradients=[];for(const BN of sN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.emitRateGradients.push(lN)}}const VN=BN.getStartSizeGradients();if(VN){NN.startSizeGradients=[];for(const BN of VN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.startSizeGradients.push(lN)}}const fN=BN.getLifeTimeGradients();if(fN){NN.lifeTimeGradients=[];for(const BN of fN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.lifeTimeGradients.push(lN)}}const ZN=BN.getLimitVelocityGradients();if(ZN){NN.limitVelocityGradients=[];for(const BN of ZN){const lN={gradient:BN.gradient,factor1:BN.factor1};void 0!==BN.factor2?lN.factor2=BN.factor2:lN.factor2=BN.factor1,NN.limitVelocityGradients.push(lN)}NN.limitVelocityDamping=BN.limitVelocityDamping}BN.noiseTexture&&(NN.noiseTexture=BN.noiseTexture.serialize())}clone(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const kB=(0,pN.d)({},this._customWrappers);let qN=null;const cN=this._engine;if(cN.createEffectForParticles&&null!=this.customShader){qN=this.customShader;const NN=qN.shaderOptions.defines.length>0?qN.shaderOptions.defines.join("\n"):"",BN=cN.createEffectForParticles(qN.shaderPath.fragmentElement,qN.shaderOptions.uniforms,qN.shaderOptions.samplers,NN);kB[0]?kB[0].effect=BN:this.setCustomEffect(BN,0)}const eN=this.serialize(lN),vN=Hl.Parse(eN,this._scene||this._engine,this._rootUrl);return vN.name=NN,vN.customShader=qN,vN._customWrappers=kB,void 0===BN&&(BN=this.NB),this.noiseTexture&&(vN.noiseTexture=this.noiseTexture.clone()),vN.NB=BN,this.preventAutoStart||vN.start(),vN}}Hl.BILLBOARDMODE_Y=2,Hl.BILLBOARDMODE_ALL=7,Hl.BILLBOARDMODE_STRETCHED=8,Hl.BILLBOARDMODE_STRETCHED_LOCAL=9,tB._ParseParticleSystem=Hl.Parse;var Tl=lN(15166),Rl=lN(15162),sl=lN(15047);sl.b.prototype.createTransformFeedback=function(){const NN=this._gl.createTransformFeedback();if(!NN)throw new Error("Unable to create Transform Feedback");return NN},sl.b.prototype.deleteTransformFeedback=function(NN){this._gl.deleteTransformFeedback(NN)},sl.b.prototype.bindTransformFeedback=function(NN){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,NN)},sl.b.prototype.beginTransformFeedback=function(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(NN?this._gl.POINTS:this._gl.TRIANGLES)},sl.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},sl.b.prototype.setTranformFeedbackVaryings=function(NN,BN){this._gl.transformFeedbackVaryings(NN,BN,this._gl.INTERLEAVED_ATTRIBS)},sl.b.prototype.bindTransformFeedbackBuffer=function(NN){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,NN?NN.underlyingResource:null)},sl.b.prototype.readTransformFeedbackBuffer=function(NN){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,NN)};const Vl="clipPlaneFragmentDeclaration2",fl="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";dN.c.IncludesShadersStore[Vl]||(dN.c.IncludesShadersStore[Vl]=fl);lN(15978),lN(15983),lN(15985),lN(15990),lN(15992),lN(16001),lN(16006),lN(16015);const Zl="gpuRenderParticlesPixelShader",Pl="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";dN.c.ShadersStore[Zl]||(dN.c.ShadersStore[Zl]=Pl);const Cl="clipPlaneVertexDeclaration2",Fl="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";dN.c.IncludesShadersStore[Cl]||(dN.c.IncludesShadersStore[Cl]=Fl);lN(16018),lN(16021),lN(16023),lN(16032);const Il="gpuRenderParticlesVertexShader",Al="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";dN.c.ShadersStore[Il]||(dN.c.ShadersStore[Il]=Al);class Ml extends HN{static get IsSupported(){if(!zN.b.LastCreatedEngine)return!1;const NN=zN.b.LastCreatedEngine.getCaps();return NN.supportTransformFeedbacks||NN.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(NN){this._maxActiveParticleCount=Math.min(NN,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(NN){this.maxActiveParticleCount=NN}createPointEmitter(NN,BN){const lN=JB(NN,BN);return this.particleEmitterType=lN,lN}createHemisphericEmitter(){const NN=YB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=NN,NN}createSphereEmitter(){const NN=jl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=NN,NN}createDirectedSphereEmitter(){const NN=zB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kB.fB(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createCylinderEmitter(){const NN=Nl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=NN,NN}createDirectedCylinderEmitter(){const NN=Bl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createConeEmitter(){const NN=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=NN,NN}createDirectedConeEmitter(){const NN=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kB.fB(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new kB.fB(0,1,0));return this.particleEmitterType=NN,NN}createBoxEmitter(NN,BN,lN,kB){const qN=new sN;return this.particleEmitterType=qN,this.direction1=NN,this.direction2=BN,this.minEmitBox=lN,this.maxEmitBox=kB,qN}get flowMap(){return this._flowMap}set flowMap(NN){this._flowMap!==NN&&(this._flowMap=NN)}isReady(){if(!this.NB||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Hl.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Hl.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Hl.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";NN?setTimeout((()=>{this.start(0)}),NN):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var NN,BN;let lN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(NN=null===(BN=this._customWrappers[lN])||void 0===BN?void 0:BN.effect)&&void 0!==NN?NN:this._customWrappers[0].effect}_getCustomDrawWrapper(){var NN;let BN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(NN=this._customWrappers[BN])&&void 0!==NN?NN:this._customWrappers[0]}setCustomEffect(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[BN]=new BB.b(this._engine),this._customWrappers[BN].effect=NN}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new YN.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(NN,BN,lN){return super._removeGradientAndTexture(NN,BN,lN),this._releaseBuffers(),this}addColorGradient(NN,BN){this._colorGradients||(this._colorGradients=[]);const lN=new iB(NN,BN);return this._colorGradients.push(lN),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(NN&&this._colorGradients.sort(((NN,BN)=>NN.gradient<BN.gradient?-1:NN.gradient>BN.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(NN){return this._removeGradientAndTexture(NN,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const BN in this._drawWrappers){var NN;null===(NN=this._drawWrappers[BN].drawContext)||void 0===NN||NN.reset()}}_addFactorGradient(NN,BN,lN){const kB=new oN(BN,lN);NN.push(kB),this._releaseBuffers()}addSizeGradient(NN,BN){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,NN,BN),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(NN){return this._removeGradientAndTexture(NN,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(NN,BN){if(!NN)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&NN.sort(((NN,BN)=>NN.gradient<BN.gradient?-1:NN.gradient>BN.gradient?1:0));const lN=this;lN[BN]&&(lN[BN].dispose(),lN[BN]=null)}addAngularSpeedGradient(NN,BN){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,NN,BN),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(NN){return this._removeGradientAndTexture(NN,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(NN,BN){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,NN,BN),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(NN){return this._removeGradientAndTexture(NN,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(NN,BN){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,NN,BN),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(NN){return this._removeGradientAndTexture(NN,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(NN,BN){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,NN,BN),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(NN){return this._removeGradientAndTexture(NN,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(NN){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(NN,BN,lN){var qN;let cN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,eN=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(NN),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.qc=new YN.b,this.onStoppedObservable=new YN.b,this.onStartedObservable=new YN.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,lN&&"Scene"!==lN.getClassName()?(this._engine=lN,this.defaultProjectionMatrix=kB.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=lN||zN.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kP.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,vN.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,vN.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,vN.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,vN.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=cN,this._drawWrappers={0:new BB.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(BN=null!==(qN=BN)&&void 0!==qN?qN:{}).randomTextureSize||delete BN.randomTextureSize;const HN=(0,pN.d)({Fl:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize},BN),TN=BN;isFinite(TN)&&(HN.Fl=TN),this._capacity=HN.Fl,this._maxActiveParticleCount=HN.Fl,this._currentActiveCount=0,this._isAnimationSheetEnabled=eN,this.particleEmitterType=new sN;const RN=Math.min(this._engine.getCaps().maxTextureSize,HN.randomTextureSize);let VN=[];for(let kB=0;kB<RN;++kB)VN.push(Math.random()),VN.push(Math.random()),VN.push(Math.random()),VN.push(Math.random());this._randomTexture=new jB.d(new Float32Array(VN),RN,1,5,lN,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,VN=[];for(let kB=0;kB<RN;++kB)VN.push(Math.random()),VN.push(Math.random()),VN.push(Math.random()),VN.push(Math.random());this._randomTexture2=new jB.d(new Float32Array(VN),RN,1,5,lN,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=RN}_reset(){this._releaseBuffers()}_createVertexBuffers(NN,BN,lN){const kB={};kB.position=BN.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let qN=3;kB.age=BN.createVertexBuffer("age",qN,1,this._attributesStrideSize,!0),qN+=1,kB.size=BN.createVertexBuffer("size",qN,3,this._attributesStrideSize,!0),qN+=3,kB.life=BN.createVertexBuffer("life",qN,1,this._attributesStrideSize,!0),qN+=1,qN+=4,this.billboardMode===Hl.BILLBOARDMODE_STRETCHED&&(kB.direction=BN.createVertexBuffer("direction",qN,3,this._attributesStrideSize,!0)),qN+=3,this._platform.alignDataInBuffer&&(qN+=1),this.particleEmitterType instanceof MN&&(qN+=3,this._platform.alignDataInBuffer&&(qN+=1)),this._colorGradientsTexture||(kB.color=BN.createVertexBuffer("color",qN,4,this._attributesStrideSize,!0),qN+=4),this._isBillboardBased||(kB.initialDirection=BN.createVertexBuffer("initialDirection",qN,3,this._attributesStrideSize,!0),qN+=3,this._platform.alignDataInBuffer&&(qN+=1)),this.noiseTexture&&(kB.noiseCoordinates1=BN.createVertexBuffer("noiseCoordinates1",qN,3,this._attributesStrideSize,!0),qN+=3,this._platform.alignDataInBuffer&&(qN+=1),kB.noiseCoordinates2=BN.createVertexBuffer("noiseCoordinates2",qN,3,this._attributesStrideSize,!0),qN+=3,this._platform.alignDataInBuffer&&(qN+=1)),kB.angle=BN.createVertexBuffer("angle",qN,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?qN++:qN+=2,this._isAnimationSheetEnabled&&(kB.cellIndex=BN.createVertexBuffer("cellIndex",qN,1,this._attributesStrideSize,!0),qN+=1,this.spriteRandomStartCell&&(kB.cellStartOffset=BN.createVertexBuffer("cellStartOffset",qN,1,this._attributesStrideSize,!0),qN+=1)),kB.offset=lN.createVertexBuffer("offset",0,2),kB.uv=lN.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(kB),this._platform.createVertexBuffers(NN,kB),this.resetDrawCache()}_initialize(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!NN)return;const BN=this._engine,lN=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof MN&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const qN=this.particleEmitterType instanceof MN,cN=kB.TmpVectors.fB[0];let eN=0;for(let kB=0;kB<this._capacity;kB++)if(lN.push(0),lN.push(0),lN.push(0),lN.push(0),lN.push(0),lN.push(0),lN.push(0),lN.push(0),lN.push(Math.random()),lN.push(Math.random()),lN.push(Math.random()),lN.push(Math.random()),qN?(this.particleEmitterType.particleDestinationGenerator(kB,null,cN),lN.push(cN.x),lN.push(cN.y),lN.push(cN.z)):(lN.push(0),lN.push(0),lN.push(0)),this._platform.alignDataInBuffer&&lN.push(0),eN+=16,qN&&(this.particleEmitterType.particlePositionGenerator(kB,null,cN),lN.push(cN.x),lN.push(cN.y),lN.push(cN.z),this._platform.alignDataInBuffer&&lN.push(0),eN+=4),this._colorGradientsTexture||(lN.push(0),lN.push(0),lN.push(0),lN.push(0),eN+=4),this.isBillboardBased||(lN.push(0),lN.push(0),lN.push(0),this._platform.alignDataInBuffer&&lN.push(0),eN+=4),this.noiseTexture&&(lN.push(Math.random()),lN.push(Math.random()),lN.push(Math.random()),this._platform.alignDataInBuffer&&lN.push(0),lN.push(Math.random()),lN.push(Math.random()),lN.push(Math.random()),this._platform.alignDataInBuffer&&lN.push(0),eN+=8),lN.push(0),eN+=1,this._angularSpeedGradientsTexture||(lN.push(0),eN+=1),this._isAnimationSheetEnabled&&(lN.push(0),eN+=1,this.spriteRandomStartCell&&(lN.push(0),eN+=1)),this._platform.alignDataInBuffer){let NN=3-(eN+3&3);for(eN+=NN;NN-- >0;)lN.push(0)}const vN=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),HN=this._platform.createParticleBuffer(lN),TN=this._platform.createParticleBuffer(lN);this._buffer0=new GN.e(BN,HN,!1,this._attributesStrideSize),this._buffer1=new GN.e(BN,TN,!1,this._attributesStrideSize),this._spriteBuffer=new GN.e(BN,vN,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let NN=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(NN+="\n#define BILLBOARD"),this._colorGradientsTexture&&(NN+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(NN+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(NN+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(NN+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(NN+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(NN+="\n#define DRAGGRADIENTS"),this._flowMap&&(NN+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(NN+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(NN+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(NN+="\n#define NOISE"),this.isLocal&&(NN+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===NN||(this._cachedUpdateDefines=NN,this._updateBuffer=this._platform.createUpdateBuffer(NN)),this._platform.isUpdateBufferReady()}_getWrapper(NN){const BN=this._getCustomDrawWrapper(NN);if(null!==BN&&void 0!==BN&&BN.effect)return BN;const lN=[];this.fillDefines(lN,NN);let kB=this._drawWrappers[NN];kB||(kB=new BB.b(this._engine),kB.drawContext&&(kB.drawContext.useInstancing=!0),this._drawWrappers[NN]=kB);const qN=lN.join("\n");if(kB.defines!==qN){const NN=[],BN=[],lN=[];this.fillUniformsAttributesAndSamplerNames(BN,NN,lN),kB.setEffect(this._engine.createEffect("gpuRenderParticles",NN,BN,lN,qN),qN)}return kB}static _GetAttributeNamesOrOptions(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2],kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const qN=[GN.f.PositionKind,"age","life","size","angle"];return NN||qN.push(GN.f.ColorKind),BN&&qN.push("cellIndex"),lN||qN.push("initialDirection"),kB&&qN.push("direction"),qN.push("offset",GN.f.UVKind),qN}static _GetEffectCreationOptions(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const kB=["emitterWM","Vs","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,lB.e)(kB),NN&&kB.push("sheetInfos"),BN&&kB.push("logarithmicDepthConstant"),lN&&(kB.push("vFogInfos"),kB.push("vFogColor")),kB}fillDefines(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lB.m)(this,this._scene,NN),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Rl.d.FOGMODE_NONE&&NN.push("#define FOG")),BN===Hl.BLENDMODE_MULTIPLY&&NN.push("#define BLENDMULTIPLYMODE"),this.isLocal&&NN.push("#define LOCAL"),this.useLogarithmicDepth&&NN.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(NN.push("#define BILLBOARD"),this.billboardMode){case Hl.BILLBOARDMODE_Y:NN.push("#define BILLBOARDY");break;case Hl.BILLBOARDMODE_STRETCHED:NN.push("#define BILLBOARDSTRETCHED");break;case Hl.BILLBOARDMODE_ALL:NN.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&NN.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&NN.push("#define ANIMATESHEET"),lN&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),NN.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(NN,BN,lN){BN.push(...Ml._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Hl.BILLBOARDMODE_STRETCHED)),NN.push(...Ml._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),lN.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Tl.b.PrepareUniforms(NN,this._imageProcessingConfigurationDefines),Tl.b.PrepareSamplers(lN,this._imageProcessingConfigurationDefines))}animate(){var NN;let BN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(BN?this.preWarmStepOffset:(null===(NN=this._scene)||void 0===NN?void 0:NN.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(NN,BN){const lN=this[BN];if(!NN||!NN.length||lN)return;const kB=new Float32Array(this._rawTextureWidth);for(let qN=0;qN<this._rawTextureWidth;qN++){const BN=qN/this._rawTextureWidth;JN.GetCurrentGradient(BN,NN,((NN,BN,lN)=>{kB[qN]=(0,TN.Lerp)(NN.factor1,BN.factor1,lN)}))}this[BN]=jB.d.CreateRTexture(kB,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[BN].name=BN.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const NN=new Uint8Array(4*this._rawTextureWidth),BN=eN.TmpColors.xc[0];for(let lN=0;lN<this._rawTextureWidth;lN++){const kB=lN/this._rawTextureWidth;JN.GetCurrentGradient(kB,this._colorGradients,((kB,qN,cN)=>{eN.xc.LerpToRef(kB.color1,qN.color1,cN,BN),NN[4*lN]=255*BN.r,NN[4*lN+1]=255*BN.g,NN[4*lN+2]=255*BN.b,NN[4*lN+3]=255*BN.a}))}this._colorGradientsTexture=jB.d.CreateRGBATexture(NN,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(NN,BN){var lN,qN,cN,eN,vN;const HN=this._getWrapper(NN),TN=HN.effect;this._engine.enableEffect(HN);const RN=(null===(lN=this._scene)||void 0===lN?void 0:lN.getViewMatrix())||kB.Matrix.IdentityReadOnly;if(TN.setMatrix("view",RN),TN.setMatrix("projection",null!==(qN=this.defaultProjectionMatrix)&&void 0!==qN?qN:this._scene.getProjectionMatrix()),TN.setTexture("diffuseSampler",this.particleTexture),TN.setVector2("translationPivot",this.translationPivot),TN.setVector3("Vs",this.Vs),this.isLocal&&TN.setMatrix("emitterWM",BN),this._colorGradientsTexture?TN.setTexture("colorGradientSampler",this._colorGradientsTexture):TN.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const NN=this.particleTexture.getBaseSize();TN.setFloat3("sheetInfos",this.spriteCellWidth/NN.width,this.spriteCellHeight/NN.height,NN.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const NN=this._scene.activeCamera;TN.setVector3("eyePosition",NN.globalPosition)}const sN=TN.defines;if(this._scene&&((0,lB.g)(TN,this,this._scene),this.applyFog&&(0,kl.d)(this._scene,void 0,TN)),sN.indexOf("#define BILLBOARDMODE_ALL")>=0){const NN=RN.clone();NN.invert(),TN.setMatrix("invView",NN)}return this.useLogarithmicDepth&&this._scene&&(0,kl.h)(sN,TN,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(TN),this._setEngineBasedOnBlendMode(NN),this._platform.bindDrawBuffers(this._targetIndex,TN,null!==(cN=this._scene)&&void 0!==cN&&cN.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(TN),null!==(eN=this._scene)&&void 0!==eN&&eN.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(vN=this._scene)&&void 0!==vN&&vN.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(NN){if(!this.NB||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!NN)if(this.NB.position){NN=this.NB.getWorldMatrix()}else{const BN=this.NB;NN=kB.TmpVectors.Matrix[0],kB.Matrix.TranslationToRef(BN.x,BN.y,BN.z,NN)}const BN=this._engine,lN=BN.getDepthWrite();if(BN.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const NN=this.VB();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",NN.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",NN),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const qN=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=qN,BN.setDepthWrite(lN)}render(){let NN,BN=arguments.length>0&&void 0!==arguments[0]&&arguments[0],lN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!BN&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let NN=0;NN<this.preWarmCycles;NN++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const NN=0|this._accumulatedCount;this._accumulatedCount-=NN,this._currentActiveCount+=NN}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.NB.position){NN=this.NB.getWorldMatrix()}else{const BN=this.NB;NN=kB.TmpVectors.Matrix[0],kB.Matrix.TranslationToRef(BN.x,BN.y,BN.z,NN)}const qN=this._engine;this.updateInAnimate||this._update(NN);let cN=0;return BN||lN||(qN.setState(!1),this.forceDepthWrite&&qN.setDepthWrite(!0),cN=this.blendMode===Hl.BLENDMODE_MULTIPLYADD?this._render(Hl.BLENDMODE_MULTIPLY,NN)+this._render(Hl.BLENDMODE_ADD,NN):this._render(this.blendMode,NN),this._engine.setAlphaMode(0)),cN}rebuild(){const NN=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(NN,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,NN()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const BN in this._drawWrappers){this._drawWrappers[BN].dispose()}if(this._drawWrappers={},this._scene){const NN=this._scene.kP.indexOf(this);NN>-1&&this._scene.kP.splice(NN,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let BN=0;BN<this._renderVertexBuffers.length;++BN){const NN=this._renderVertexBuffers[BN];for(const BN in NN)NN[BN].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),NN&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),NN&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.qc.notifyObservers(this),this.qc.clear()}clone(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const kB=(0,pN.d)({},this._customWrappers);let qN=null;const cN=this._engine;if(cN.createEffectForParticles&&null!=this.customShader){qN=this.customShader;const NN=qN.shaderOptions.defines.length>0?qN.shaderOptions.defines.join("\n"):"";kB[0]=cN.createEffectForParticles(qN.shaderPath.fragmentElement,qN.shaderOptions.uniforms,qN.shaderOptions.samplers,NN,void 0,void 0,void 0,this)}const eN=this.serialize(lN),vN=Ml.Parse(eN,this._scene||this._engine,this._rootUrl);return vN.name=NN,vN.customShader=qN,vN._customWrappers=kB,void 0===BN&&(BN=this.NB),this.noiseTexture&&(vN.noiseTexture=this.noiseTexture.clone()),vN.NB=BN,vN}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const BN={};return Hl._Serialize(BN,this,NN),BN.activeParticleCount=this.activeParticleCount,BN.randomTextureSize=this._randomTextureSize,BN.customShader=this.customShader,BN}static Parse(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],qN=arguments.length>4?arguments[4]:void 0;const cN=NN.name;let eN,vN;BN instanceof oB.c?eN=BN:(vN=BN,eN=vN.getEngine());const HN=new Ml(cN,{Fl:qN||NN.Fl,randomTextureSize:NN.randomTextureSize},BN,null,NN.isAnimationSheetEnabled);if(HN._rootUrl=lN,NN.customShader&&eN.createEffectForParticles){const BN=NN.customShader,lN=BN.shaderOptions.defines.length>0?BN.shaderOptions.defines.join("\n"):"",kB=eN.createEffectForParticles(BN.shaderPath.fragmentElement,BN.shaderOptions.uniforms,BN.shaderOptions.samplers,lN,void 0,void 0,void 0,HN);HN.setCustomEffect(kB,0),HN.customShader=BN}return NN.id&&(HN.id=NN.id),NN.activeParticleCount&&(HN.activeParticleCount=NN.activeParticleCount),Hl._Parse(NN,HN,BN,lN),NN.preventAutoStart&&(HN.preventAutoStart=NN.preventAutoStart),kB||HN.preventAutoStart||HN.start(),HN}}var Gl=lN(14727),Xl=lN(16040),ul=lN(15314);class dl{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(NN){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const BN of this.systems)BN.NB=NN;this._emitterNode=NN}setEmitterAsSphere(NN,BN,lN){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:NN,renderingGroupId:BN};const kB=(0,Xl.d)("emitterSphere",{diameter:NN.diameter,segments:NN.segments},lN);kB.renderingGroupId=BN;const qN=new ul.CB("emitterSphereMaterial",lN);qN.emissiveColor=NN.color,kB.material=qN;for(const cN of this.systems)cN.NB=kB;this._emitterNode=kB}start(NN){for(const BN of this.systems)NN&&(BN.NB=NN),BN.start()}dispose(){for(const NN of this.systems)NN.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const BN={systems:[]};for(const lN of this.systems)BN.systems.push(lN.serialize(NN));return this._emitterNode&&(BN.NB=this._emitterCreationOptions),BN}static Parse(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2],kB=arguments.length>3?arguments[3]:void 0;const qN=new dl,cN=this.BaseAssetsUrl+"/textures/";BN=BN||zN.b.LastCreatedScene;for(const eN of NN.systems)qN.systems.push(lN?Ml.Parse(eN,BN,cN,!0,kB):Hl.Parse(eN,BN,cN,!0,kB));if(NN.NB){const lN=NN.NB.options;if("Sphere"===NN.NB.kind)qN.setEmitterAsSphere({diameter:lN.diameter,segments:lN.segments,color:eN.FB.IB(lN.color)},NN.NB.renderingGroupId,BN)}return qN}}dl.BaseAssetsUrl="https://assets.babylonjs.com/particles";var El=lN(14769);class Kl{static CreateDefault(NN){let BN,lN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,kB=arguments.length>2?arguments[2]:void 0;BN=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ml("default system",{Fl:lN},kB):new Hl("default system",lN,kB),BN.NB=NN;const qN=Gl.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return BN.particleTexture=new bN.c(qN,BN.VB()),BN.createConeEmitter(.1,Math.PI/4),BN.color1=new eN.xc(1,1,1,1),BN.color2=new eN.xc(1,1,1,1),BN.colorDead=new eN.xc(1,1,1,0),BN.minSize=.1,BN.maxSize=.1,BN.minEmitPower=2,BN.maxEmitPower=2,BN.updateSpeed=1/60,BN.emitRate=30,BN}static CreateAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2],kB=arguments.length>3?arguments[3]:void 0;BN||(BN=zN.b.LastCreatedScene);const qN={};return BN.addPendingData(qN),new Promise(((cN,eN)=>{if(lN&&!Ml.IsSupported)return BN.removePendingData(qN),eN("Particle system with GPU is not supported.");Gl.Tools.LoadFile("".concat(Kl.BaseAssetsUrl,"/systems/").concat(NN,".json"),(NN=>{BN.removePendingData(qN);const eN=JSON.parse(NN.toString());return cN(dl.Parse(eN,BN,lN,kB))}),void 0,void 0,void 0,(()=>(BN.removePendingData(qN),eN("An error occurred with the creation of your particle system. Check if your type '".concat(NN,"' exists.")))))}))}static ExportSet(NN){const BN=new dl;for(const lN of NN)BN.systems.push(lN);return BN}static ParseFromFileAsync(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]&&arguments[3],qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",cN=arguments.length>5?arguments[5]:void 0;return new Promise(((eN,vN)=>{const HN=new El.d;HN.addEventListener("readystatechange",(()=>{if(4==HN.readyState)if(200==HN.status){const BN=JSON.parse(HN.responseText);let vN;vN=kB?Ml.Parse(BN,lN,qN,!1,cN):Hl.Parse(BN,lN,qN,!1,cN),NN&&(vN.name=NN),eN(vN)}else vN("Unable to load the particle system")})),HN.open("GET",BN),HN.send()}))}static ParseFromSnippetAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2],kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",qN=arguments.length>4?arguments[4]:void 0;if("_BLANK"===NN){const NN=this.CreateDefault(null);return NN.start(),Promise.resolve(NN)}return new Promise(((cN,eN)=>{const vN=new El.d;vN.addEventListener("readystatechange",(()=>{if(4==vN.readyState)if(200==vN.status){const eN=JSON.parse(JSON.parse(vN.responseText).jsonPayload),HN=JSON.parse(eN.particleSystem);let TN;TN=lN?Ml.Parse(HN,BN,kB,!1,qN):Hl.Parse(HN,BN,kB,!1,qN),TN.snippetId=NN,cN(TN)}else eN("Unable to load the snippet "+NN)})),vN.open("GET",this.SnippetUrl+"/"+NN.replace(/#/g,"/")),vN.send()}))}}Kl.BaseAssetsUrl=dl.BaseAssetsUrl,Kl.SnippetUrl="https://snippet.babylonjs.com",Kl.CreateFromSnippetAsync=Kl.ParseFromSnippetAsync;var gl=lN(15391),nl=lN(15200),rl=lN(15866);(0,rl.h)(nl.c.NAME_PARTICLESYSTEM,((NN,BN,lN,kB)=>{const qN=(0,rl.j)(nl.c.NAME_PARTICLESYSTEM);if(qN&&void 0!==NN.kP&&null!==NN.kP)for(let cN=0,eN=NN.kP.length;cN<eN;cN++){const eN=NN.kP[cN];lN.kP.push(qN(eN,BN,kB))}})),(0,rl.e)(nl.c.NAME_PARTICLESYSTEM,((NN,BN,lN)=>{if(NN.activeParticleCount){return Ml.Parse(NN,BN,lN)}return Hl.Parse(NN,BN,lN)})),oB.c.prototype.createEffectForParticles=function(NN){var BN;let kB=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],qN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],cN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",eN=arguments.length>4?arguments[4]:void 0,vN=arguments.length>5?arguments[5]:void 0,HN=arguments.length>6?arguments[6]:void 0,TN=arguments.length>7?arguments[7]:void 0,RN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,sN=arguments.length>9?arguments[9]:void 0,VN=[],fN=[];const ZN=[];return TN?TN.fillUniformsAttributesAndSamplerNames(fN,VN,ZN):(VN=Hl._GetAttributeNamesOrOptions(),fN=Hl._GetEffectCreationOptions()),-1===cN.indexOf(" BILLBOARD")&&(cN+="\n#define BILLBOARD\n"),null!==TN&&void 0!==TN&&TN.isAnimationSheetEnabled&&-1===cN.indexOf(" ANIMATESHEET")&&(cN+="\n#define ANIMATESHEET\n"),-1===qN.indexOf("diffuseSampler")&&qN.push("diffuseSampler"),this.createEffect({vertex:null!==(BN=null!==sN&&void 0!==sN?sN:null===TN||void 0===TN?void 0:TN.vertexShaderName)&&void 0!==BN?BN:"particles",fragmentElement:NN},VN,fN.concat(kB),ZN.concat(qN),cN,eN,vN,HN,void 0,RN,(async()=>{0===RN?await Promise.resolve().then(lN.bind(lN,16074)):await Promise.resolve().then(lN.bind(lN,16138))}))},gl.e.prototype.getEmittedParticleSystems=function(){const NN=[];for(let BN=0;BN<this.VB().kP.length;BN++){const lN=this.VB().kP[BN];lN.NB===this&&NN.push(lN)}return NN},gl.e.prototype.getHierarchyEmittedParticleSystems=function(){const NN=[],BN=this.getDescendants();BN.push(this);for(let lN=0;lN<this.VB().kP.length;lN++){const kB=this.VB().kP[lN],qN=kB.NB;qN.position&&-1!==BN.indexOf(qN)&&NN.push(kB)}return NN};lN(15280),lN(15286),lN(15375);lN(15379),lN(16042),lN(15123),lN(15267),lN(15419);lN(15119);var pl;lN(16047),lN(14950);!function(NN){NN[NN.Color=2]="Color",NN[NN.UV=1]="UV",NN[NN.Random=0]="Random",NN[NN.Stated=3]="Stated"}(pl||(pl={}));var xl=lN(15151);const Ol=new kB.fB(0,0,0),wl=new kB.fB(0,0,0),bl=new kB.fB(0,0,0);class mk{constructor(NN,BN,lN){this.width=NN,this.height=BN,this.data=lN}processFlowable(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2?arguments[2]:void 0;if(!lN)return;lN instanceof kB.Matrix?kB.fB.TransformCoordinatesToRef(NN.position,lN,bl):(bl.x=lN.x,bl.y=lN.y,bl.z=lN.z);const qN=.5*bl.x+.5,cN=1-(.5*bl.y+.5),eN=Math.floor(qN*this.width),vN=Math.floor(cN*this.height);if(eN<0||eN>=this.width||vN<0||vN>=this.height)return;const HN=4*(vN*this.width+eN),TN=this.data[HN]/255*2-1,RN=this.data[HN+1]/255*2-1,sN=this.data[HN+2]/255*2-1,VN=this.data[HN+3]/255;Ol.set(TN,RN,sN),Ol.scaleToRef(BN*VN,wl),NN.direction.addInPlace(wl)}_processParticle(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lN=arguments.length>2?arguments[2]:void 0;this.processFlowable(NN,BN,lN)}static async FromUrlAsync(NN){return await new Promise(((BN,lN)=>{const kB=document.createElement("canvas"),qN=kB.getContext("2d");let cN=null;const eN=new Image;eN.crossOrigin="anonymous",eN.src=NN,eN.onerror=BN=>{lN(new Error("Failed to load image: ".concat(NN," : ").concat(BN)))},eN.onload=()=>{kB.width=eN.width,kB.height=eN.height,qN.drawImage(eN,0,0),cN=qN.getImageData(0,0,kB.width,kB.height),BN(new mk(kB.width,kB.height,cN.data))}}))}static async ExtractFromTextureAsync(NN){return await new Promise(((BN,lN)=>{if(!NN.isReady())return void NN.onLoadObservable.addOnce((async()=>{try{const lN=await this.ExtractFromTextureAsync(NN);BN(lN)}catch(kB){lN(kB)}}));const kB=NN.getSize();xl.j.GetTextureDataAsync(NN,kB.width,kB.height).then((NN=>{BN(new mk(kB.width,kB.height,new Uint8ClampedArray(NN)))})).catch(lN)}))}}var al,Dl,yl,Ll,hl,Ul,Wl,Ql,Sl;!function(NN){NN[NN.Int=1]="Int",NN[NN.Float=2]="Float",NN[NN.Vector2=4]="Vector2",NN[NN.fB=8]="fB",NN[NN.Matrix=16]="Matrix",NN[NN.Particle=32]="Particle",NN[NN.Texture=64]="Texture",NN[NN.xc=128]="xc",NN[NN.FloatGradient=256]="FloatGradient",NN[NN.Vector2Gradient=512]="Vector2Gradient",NN[NN.Vector3Gradient=1024]="Vector3Gradient",NN[NN.Color4Gradient=2048]="Color4Gradient",NN[NN.System=4096]="System",NN[NN.AutoDetect=8192]="AutoDetect",NN[NN.BasedOnInput=16384]="BasedOnInput",NN[NN.Undefined=32768]="Undefined",NN[NN.All=65535]="All"}(al||(al={})),function(NN){NN[NN.Compatible=0]="Compatible",NN[NN.TypeIncompatible=1]="TypeIncompatible",NN[NN.HierarchyIssue=2]="HierarchyIssue"}(Dl||(Dl={})),function(NN){NN[NN.Input=0]="Input",NN[NN.Output=1]="Output"}(yl||(yl={}));class ik{get direction(){return this._direction}get type(){if(this._type===al.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===al.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(NN){this._type=NN}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((NN=>NN.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(NN,BN,lN){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=al.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new YN.b,this.onDisconnectionObservable=new YN.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=BN,this.name=NN,this._direction=lN}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(NN){var BN;return this.isConnected?null!==(BN=this._connectedPoint)&&void 0!==BN&&BN._storedFunction?this._connectedPoint._storedFunction(NN):this._connectedPoint._storedValue:this.value}canConnectTo(NN){return 0===this.checkCompatibilityState(NN)}checkCompatibilityState(NN){const BN=this._ownerBlock,lN=NN.ownerBlock;if(this.type!==NN.type&&NN.innerType!==al.AutoDetect)return NN.acceptedConnectionPointTypes&&-1!==NN.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(NN.excludedConnectionPointTypes&&-1!==NN.excludedConnectionPointTypes.indexOf(this.type))return 1;let kB=lN,qN=BN;return 0===this.direction&&(kB=BN,qN=lN),kB.isAnAncestorOf(qN)?2:0}connectTo(NN){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(NN))throw'Cannot connect these two connectors. source: "'.concat(this.ownerBlock.name,'".').concat(this.name,', target: "').concat(NN.ownerBlock.name,'".').concat(NN.name);return this._endpoints.push(NN),NN._connectedPoint=this,this.onConnectionObservable.notifyObservers(NN),NN.onConnectionObservable.notifyObservers(this),this}disconnectFrom(NN){const BN=this._endpoints.indexOf(NN);return-1===BN||(this._endpoints.splice(BN,1),NN._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(NN),NN.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(NN){let BN=1;for(;BN<al.All;)NN&BN||this.excludedConnectionPointTypes.push(BN),BN<<=1}serialize(){let NN=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const BN={};return BN.name=this.name,BN.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Fc?(BN.valueType="BABYLON."+this.value.getClassName(),BN.value=this.value.Fc()):(BN.valueType="number",BN.value=this.value)),NN&&this.connectedPoint&&(BN.inputName=this.name,BN.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,BN.targetConnectionName=this.connectedPoint.name,BN.isExposedOnFrame=!0,BN.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(BN.isExposedOnFrame=!0,BN.exposedPortPosition=this.exposedPortPosition),BN}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class tl{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(NN){this._name=NN}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(NN){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new YN.b,this.qc=new YN.b,this.onInputChangedObservable=new YN.b,this.visibleOnFrame=!1,this._name=NN,this.uniqueId=mB.b.UniqueId}_inputRename(NN){return NN}_outputRename(NN){return NN}isAnAncestorOf(NN){for(const BN of this._outputs)if(BN.hasEndpoints)for(const lN of BN.endpoints){if(lN.ownerBlock===NN)return!0;if(lN.ownerBlock.isAnAncestorOf(NN))return!0}return!1}isAnAncestorOfType(NN){if(this.getClassName()===NN)return!0;for(const BN of this._outputs)if(BN.hasEndpoints)for(const lN of BN.endpoints)if(lN.ownerBlock.isAnAncestorOfType(NN))return!0;return!1}getInputByName(NN){const BN=this._inputs.filter((BN=>BN.name===NN));return BN.length?BN[0]:null}_linkConnectionTypes(NN,BN){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[BN]._acceptedConnectionPointType=this._inputs[NN]:(this._inputs[NN]._linkedConnectionSource=this._inputs[BN],this._inputs[NN]._isMainLinkSource=!0),this._inputs[BN]._linkedConnectionSource=this._inputs[NN]}registerInput(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2],kB=arguments.length>3?arguments[3]:void 0,qN=arguments.length>4?arguments[4]:void 0,cN=arguments.length>5?arguments[5]:void 0;const eN=new ik(NN,this,0);return eN.type=BN,eN.isOptional=lN,eN.defaultValue=kB,eN.value=kB,eN.valueMin=qN,eN.valueMax=cN,this._inputs.push(eN),this.onInputChangedObservable.notifyObservers(eN),this}registerOutput(NN,BN,lN){var kB;return(lN=null!==(kB=lN)&&void 0!==kB?kB:new ik(NN,this,1)).type=BN,this._outputs.push(lN),this}_build(NN){}_customBuildStep(NN){}build(NN){if(this._buildId===NN.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((NN=>NN.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=NN.buildId;for(const BN of this._inputs){if(!BN.connectedPoint){BN.isOptional||NN.notConnectedNonOptionalInputs.push(BN);continue}const lN=BN.connectedPoint.ownerBlock;lN&&lN!==this&&!lN.isSystem&&lN.build(NN)}return this._customBuildStep(NN),NN.verbose&&aN.d.Log("Building ".concat(this.name," [").concat(this.getClassName(),"]")),this._build(NN),this.onBuildObservable.notifyObservers(this),!1}serialize(){const NN={};NN.customType="BABYLON."+this.getClassName(),NN.id=this.uniqueId,NN.name=this.name,NN.visibleOnFrame=this.visibleOnFrame,NN.inputs=[],NN.outputs=[];for(const BN of this.inputs)NN.inputs.push(BN.serialize());for(const BN of this.outputs)NN.outputs.push(BN.serialize(!1));return NN}_deserialize(NN){this._name=NN.name,this.comments=NN.comments,this.visibleOnFrame=!!NN.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(NN)}_deserializePortDisplayNamesAndExposedOnFrame(NN){const BN=NN.inputs,lN=NN.outputs;if(BN)for(const kB of BN){const NN=this.inputs.find((NN=>NN.name===kB.name));if(!NN)return;if(kB.displayName&&(NN.displayName=kB.displayName),kB.isExposedOnFrame&&(NN.isExposedOnFrame=kB.isExposedOnFrame,NN.exposedPortPosition=kB.exposedPortPosition),void 0!==kB.value&&null!==kB.value)if("number"===kB.valueType)NN.value=kB.value;else{const BN=(0,vN.b)(kB.valueType);BN&&(NN.value=BN.IB(kB.value))}}if(lN)for(let kB=0;kB<lN.length;kB++){const NN=lN[kB];NN.displayName&&(this.outputs[kB].displayName=NN.displayName),NN.isExposedOnFrame&&(this.outputs[kB].isExposedOnFrame=NN.isExposedOnFrame,this.outputs[kB].exposedPortPosition=NN.exposedPortPosition)}}clone(){const NN=this.serialize(),BN=(0,vN.b)(NN.customType);if(BN){const lN=new BN;return lN._deserialize(NN),lN}return null}dispose(){this.qc.notifyObservers(this),this.qc.clear();for(const NN of this.inputs)NN.dispose();for(const NN of this.outputs)NN.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ol(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",kB=arguments.length>3?arguments[3]:void 0;return(qN,cN)=>{let eN=qN._propStore;eN||(eN=[],qN._propStore=eN),eN.push({propertyName:cN,displayName:NN,type:BN,groupName:lN,options:null!==kB&&void 0!==kB?kB:{},className:qN.getClassName()})}}(0,xN.c)([(0,ON.G)("comment")],tl.prototype,"comments",void 0),function(NN){NN[NN.Boolean=0]="Boolean",NN[NN.Float=1]="Float",NN[NN.Int=2]="Int",NN[NN.Vector2=3]="Vector2",NN[NN.List=4]="List",NN[NN.xc=5]="xc",NN[NN.SamplingMode=6]="SamplingMode",NN[NN.TextureFormat=7]="TextureFormat",NN[NN.TextureType=8]="TextureType"}(Ll||(Ll={})),function(NN){NN[NN.None=0]="None",NN[NN.Position=1]="Position",NN[NN.Direction=2]="Direction",NN[NN.Age=3]="Age",NN[NN.Lifetime=4]="Lifetime",NN[NN.Color=5]="Color",NN[NN.ScaledDirection=6]="ScaledDirection",NN[NN.Scale=7]="Scale",NN[NN.AgeGradient=8]="AgeGradient",NN[NN.Angle=9]="Angle",NN[NN.SpriteCellIndex=16]="SpriteCellIndex",NN[NN.SpriteCellStart=17]="SpriteCellStart",NN[NN.SpriteCellEnd=18]="SpriteCellEnd"}(hl||(hl={})),function(NN){NN[NN.None=0]="None",NN[NN.Time=1]="Time",NN[NN.Delta=2]="Delta",NN[NN.Emitter=3]="Emitter"}(Ul||(Ul={}));class Jl{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let NN="";for(const BN of this.notConnectedNonOptionalInputs)NN+="input ".concat(BN.name," from block ").concat(BN.ownerBlock.name,"[").concat(BN.ownerBlock.getClassName(),"] is not connected and is not optional.\n");if(NN)throw"Build of Node Particle System Set failed:\n"+NN}adapt(NN,BN){const lN=NN.getConnectedValue(this)||0;if(NN.type===BN)return lN;switch(BN){case al.Vector2:return new kB.Vector2(lN,lN);case al.fB:return new kB.fB(lN,lN,lN);case al.xc:return new eN.xc(lN,lN,lN,lN)}return null}getContextualValue(NN){if(!this.particleContext||!this.systemContext)return null;switch(NN){case hl.Position:return this.particleContext.position;case hl.Direction:return this.particleContext.direction;case hl.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case hl.Color:return this.particleContext.color;case hl.Age:return this.particleContext.age;case hl.Lifetime:return this.particleContext.lifeTime;case hl.Angle:return this.particleContext.angle;case hl.Scale:return this.particleContext.scale;case hl.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case hl.SpriteCellEnd:return this.systemContext.endSpriteCellID;case hl.SpriteCellIndex:return this.particleContext.cellIndex;case hl.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.NB.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.NB.absolutePosition:this.systemContext.NB:null}getSystemValue(NN){if(!this.particleContext||!this.systemContext)return null;switch(NN){case Ul.Time:return this.systemContext._actualFrame;case Ul.Delta:return this.systemContext._scaledUpdateSpeed;case Ul.Emitter:if(this.isEmitterTransformNode){return this.systemContext.NB.absolutePosition}return this.systemContext.NB}return null}}function Yl(NN,BN,lN){const kB=new Jl;kB.PB=BN;const qN=NN.createSystem(kB);return qN.canStart=()=>!0,qN.NB=lN.clone(),qN.disposeOnStop=!0,qN.start(),qN}class jk extends tl{constructor(NN){super(NN),this.blendMode=HN.BLENDMODE_ONEONE,this.Fl=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",al.Particle),this.registerInput("texture",al.Texture),this.registerInput("onStart",al.System,!0),this.registerInput("onEnd",al.System,!0),this.registerOutput("system",al.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(NN){NN.Fl=this.Fl,NN.buildId=this._buildId++,this.build(NN);const BN=this.particle.getConnectedValue(NN);return BN.particleTexture=this.texture.getConnectedValue(NN),BN.emitRate=this.emitRate,BN.blendMode=this.blendMode,BN.name=this.name,BN._nodeGenerated=!0,BN._targetStopDuration=this.targetStopDuration,BN.startDelay=this.startDelay,this.system._storedValue=this,BN.canStart=()=>!this.doNoStart,BN.onStartedObservable.add((lN=>{const kB=this.onStart.getConnectedValue(NN);kB&&lN.onStartedObservable.addOnce((()=>{NN.systemContext=BN;const lN=Yl(kB,NN.PB,NN.emitterPosition);this.qc.addOnce((()=>{lN.dispose()}))}));const qN=this.onEnd.getConnectedValue(NN);qN&&lN.onStoppedObservable.addOnce((()=>{NN.systemContext=BN;const lN=Yl(qN,NN.PB,NN.emitterPosition);this.qc.addOnce((()=>{lN.dispose()}))}))})),this.qc.addOnce((()=>{BN.dispose()})),BN}serialize(){const NN=super.serialize();return NN.Fl=this.Fl,NN.emitRate=this.emitRate,NN.blendMode=this.blendMode,NN.doNoStart=this.doNoStart,NN.targetStopDuration=this.targetStopDuration,NN.startDelay=this.startDelay,NN}_deserialize(NN){super._deserialize(NN),this.Fl=NN.Fl,this.emitRate=NN.emitRate,this.doNoStart=!!NN.doNoStart,void 0!==NN.blendMode&&(this.blendMode=NN.blendMode),void 0!==NN.targetStopDuration&&(this.targetStopDuration=NN.targetStopDuration),void 0!==NN.startDelay&&(this.startDelay=NN.startDelay)}}(0,xN.c)([ol("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:HN.BLENDMODE_ONEONE},{label:"Standard",value:HN.BLENDMODE_STANDARD},{label:"Add",value:HN.BLENDMODE_ADD},{label:"Multiply",value:HN.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:HN.BLENDMODE_MULTIPLYADD}]})],jk.prototype,"blendMode",void 0),(0,xN.c)([ol("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],jk.prototype,"Fl",void 0),(0,xN.c)([ol("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jk.prototype,"emitRate",void 0),(0,xN.c)([ol("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jk.prototype,"targetStopDuration",void 0),(0,xN.c)([ol("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jk.prototype,"startDelay",void 0),(0,xN.c)([ol("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jk.prototype,"doNoStart",void 0),(0,vN.f)("BABYLON.SystemBlock",jk);class zl extends tl{get type(){if(this._type===al.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=al.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=al.Vector2,this._type;case"fB":return this._type=al.fB,this._type;case"xc":return this._type=al.xc,this._type;case"Matrix":return this._type=al.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===hl.None&&this._systemSource!==Ul.None}get systemSource(){return this._systemSource}set systemSource(NN){if(this._systemSource=NN,NN!==Ul.None){switch(this._contextualSource=hl.None,this._type=al.Float,NN){case Ul.Time:case Ul.Delta:this._type=al.Float;break;case Ul.Emitter:this._type=al.fB}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==hl.None}get contextualValue(){return this._contextualSource}set contextualValue(NN){if(this._contextualSource=NN,NN!==hl.None){switch(this._systemSource=Ul.None,NN){case hl.Scale:this._type=al.Vector2;break;case hl.Position:case hl.Direction:case hl.ScaledDirection:this._type=al.fB;break;case hl.Color:this._type=al.xc;break;case hl.Age:case hl.Lifetime:case hl.Angle:case hl.AgeGradient:this._type=al.Float;break;case hl.SpriteCellEnd:case hl.SpriteCellStart:case hl.SpriteCellIndex:this._type=al.Int}this.output&&(this.output.type=this._type)}}constructor(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:al.AutoDetect;super(NN),this._type=al.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new YN.b,this._systemSource=Ul.None,this._contextualSource=hl.None,this._type=BN,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",BN)}get value(){return this._storedValue}set value(NN){this.type===al.Float&&this.min!==this.max&&(NN=Math.max(this.min,NN),NN=Math.min(this.max,NN)),this._storedValue=NN,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(NN){this._valueCallback=NN}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case al.Int:case al.Float:this.value=0;break;case al.Vector2:this.value=kB.Vector2.Zero();break;case al.fB:this.value=kB.fB.Zero();break;case al.xc:this.value=new eN.xc(1,1,1,1);break;case al.Matrix:this.value=kB.Matrix.Identity()}}_build(NN){super._build(NN),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=NN=>NN.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=NN=>NN.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const NN=super.serialize();return NN.type=this.type,NN.contextualValue=this.contextualValue,NN.systemSource=this.systemSource,NN.min=this.min,NN.max=this.max,NN.groupInInspector=this.groupInInspector,NN.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Fc?(NN.valueType="BABYLON."+this._storedValue.getClassName(),NN.value=this._storedValue.Fc()):(NN.valueType="number",NN.value=this._storedValue)),NN}_deserialize(NN){if(super._deserialize(NN),this._type=NN.type,this.contextualValue=NN.contextualValue,this.systemSource=NN.systemSource||Ul.None,this.min=NN.min||0,this.max=NN.max||0,this.groupInInspector=NN.groupInInspector||"",void 0!==NN.displayInInspector&&(this.displayInInspector=NN.displayInInspector),NN.valueType)if("number"===NN.valueType)this._storedValue=NN.value;else{const BN=(0,vN.b)(NN.valueType);BN&&(this._storedValue=BN.IB(NN.value))}}}(0,vN.f)("BABYLON.ParticleInputBlock",zl);class Nk extends tl{get url(){return this._url}set url(NN){this._url!==NN&&(this._cachedData=null,this._url=NN,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(NN){this._textureDataUrl!==NN&&(this._cachedData=null,this._textureDataUrl=NN,this._url="",this._sourceTexture=null)}set sourceTexture(NN){this._sourceTexture!==NN&&(this._cachedData=null,this._sourceTexture=NN,this._url="",this._textureDataUrl="")}constructor(NN){super(NN),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",al.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const NN=this.texture._storedValue;return await new Promise(((BN,lN)=>{if(!NN.isReady())return void NN.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),BN(this._cachedData)}catch(NN){lN(NN)}}));const kB=NN.getSize();xl.j.GetTextureDataAsync(NN,kB.width,kB.height).then((lN=>{this._cachedData={width:kB.width,height:kB.height,data:new Uint8ClampedArray(lN)},NN.dispose(),BN(this._cachedData)})).catch(lN)}))}_build(NN){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new bN.c(this._textureDataUrl,NN.PB):this.texture._storedValue=new bN.c(this._url,NN.PB):this.texture._storedValue=null}serialize(){const NN=super.serialize();return NN.url=this.url,NN.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(NN.textureDataUrl=this.textureDataUrl),NN}_deserialize(NN){super._deserialize(NN),this.url=NN.url,this.serializedCachedData=!!NN.serializedCachedData,NN.textureDataUrl&&(this.textureDataUrl=NN.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,vN.f)("BABYLON.ParticleTextureSourceBlock",Nk);class Bk extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("position",al.fB),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.position.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.position.kB(this.position.getConnectedValue(NN))},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}}(0,vN.f)("BABYLON.UpdatePositionBlock",Bk),function(NN){NN[NN.Add=0]="Add",NN[NN.Subtract=1]="Subtract",NN[NN.Multiply=2]="Multiply",NN[NN.Divide=3]="Divide",NN[NN.Max=4]="Max",NN[NN.Min=5]="Min"}(Wl||(Wl={}));class lk extends tl{constructor(NN){super(NN),this.operation=Wl.Add,this.registerInput("left",al.AutoDetect),this.registerInput("right",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this.output._typeConnectionSource=this.left;const BN=[al.Matrix,al.Particle,al.Texture,al.System,al.FloatGradient,al.Color4Gradient,al.Vector2Gradient,al.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...BN),this.right.excludedConnectionPointTypes.push(...BN),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(NN){let BN;const lN=this.left,qN=this.right;if(!lN.isConnected||!qN.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const cN=lN.type===al.Float||lN.type===al.Int,vN=qN.type===al.Float||qN.type===al.Int,HN=cN&&vN;switch(this.operation){case Wl.Add:BN=HN?NN=>lN.getConnectedValue(NN)+qN.getConnectedValue(NN):cN?NN=>NN.adapt(lN,qN.type).add(qN.getConnectedValue(NN)):NN=>lN.getConnectedValue(NN).add(NN.adapt(qN,lN.type));break;case Wl.Subtract:BN=HN?NN=>lN.getConnectedValue(NN)-qN.getConnectedValue(NN):cN?NN=>NN.adapt(lN,qN.type).ZB(qN.getConnectedValue(NN)):NN=>lN.getConnectedValue(NN).ZB(NN.adapt(qN,lN.type));break;case Wl.Multiply:BN=HN?NN=>lN.getConnectedValue(NN)*qN.getConnectedValue(NN):cN?NN=>NN.adapt(lN,qN.type).multiply(qN.getConnectedValue(NN)):NN=>lN.getConnectedValue(NN).multiply(NN.adapt(qN,lN.type));break;case Wl.Divide:BN=HN?NN=>lN.getConnectedValue(NN)/qN.getConnectedValue(NN):cN?NN=>NN.adapt(lN,qN.type).divide(qN.getConnectedValue(NN)):NN=>lN.getConnectedValue(NN).divide(NN.adapt(qN,lN.type));break;case Wl.Min:if(HN)BN=NN=>Math.min(lN.getConnectedValue(NN),qN.getConnectedValue(NN));else{const[NN,vN]=cN?[qN,lN]:[lN,qN];switch(NN.type){case al.Vector2:BN=BN=>kB.Vector2.Minimize(NN.getConnectedValue(BN),BN.adapt(vN,NN.type));break;case al.fB:BN=BN=>kB.fB.Minimize(NN.getConnectedValue(BN),BN.adapt(vN,NN.type));break;case al.xc:BN=BN=>{const lN=NN.getConnectedValue(BN),{r:kB,g:qN,b:cN,a:HN}=BN.adapt(vN,NN.type);return new eN.xc(Math.min(lN.r,kB),Math.min(lN.g,qN),Math.min(lN.b,cN),Math.min(lN.a,HN))}}}break;case Wl.Max:if(!HN){const[NN,vN]=cN?[qN,lN]:[lN,qN];switch(NN.type){case al.Vector2:BN=BN=>kB.Vector2.Maximize(NN.getConnectedValue(BN),BN.adapt(vN,NN.type));break;case al.fB:BN=BN=>kB.fB.Maximize(NN.getConnectedValue(BN),BN.adapt(vN,NN.type));break;case al.xc:BN=BN=>{const lN=NN.getConnectedValue(BN),{r:kB,g:qN,b:cN,a:HN}=BN.adapt(vN,NN.type);return new eN.xc(Math.max(lN.r,kB),Math.min(lN.g,qN),Math.min(lN.b,cN),Math.min(lN.a,HN))}}break}BN=NN=>Math.max(lN.getConnectedValue(NN),qN.getConnectedValue(NN))}this.output._storedFunction=NN=>lN.type===al.Int?0|BN(NN):BN(NN)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===al.Int||this.left.type===al.Float&&this.right.type!==al.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[NN,BN]of[[this.left,this.right],[this.right,this.left]])NN.acceptedConnectionPointTypes=[al.Int,al.Float],BN.isConnected&&(NN.acceptedConnectionPointTypes.push(BN.type),BN.type!==al.Int&&BN.type!==al.Float||NN.acceptedConnectionPointTypes.push(al.Vector2,al.fB,al.xc))}dispose(){super.dispose();for(const NN of this._connectionObservers)NN.remove();this._connectionObservers.length=0}serialize(){const NN=super.serialize();return NN.operation=this.operation,NN}_deserialize(NN){super._deserialize(NN),this.operation=NN.operation}}(0,xN.c)([ol("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Wl.Add},{label:"Subtract",value:Wl.Subtract},{label:"Multiply",value:Wl.Multiply},{label:"Divide",value:Wl.Divide},{label:"Max",value:Wl.Max},{label:"Min",value:Wl.Min}]})],lk.prototype,"operation",void 0),(0,vN.f)("BABYLON.ParticleMathBlock",lk);class kq extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("direction1",al.fB,!0,new kB.fB(0,1,0)),this.registerInput("direction2",al.fB,!0,new kB.fB(0,1,0)),this.registerInput("minEmitBox",al.fB,!0,new kB.fB(-.5,-.5,-.5)),this.registerInput("maxEmitBox",al.fB,!0,new kB.fB(.5,.5,.5)),this.registerOutput("output",al.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(NN){const BN=this.particle.getConnectedValue(NN);BN._directionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.direction1.getConnectedValue(NN),cN=this.direction2.getConnectedValue(NN),eN=(0,TN.RandomRange)(qN.x,cN.x),vN=(0,TN.RandomRange)(qN.y,cN.y),HN=(0,TN.RandomRange)(qN.z,cN.z);NN.isEmitterTransformNode?kB.fB.TransformNormalFromFloatsToRef(eN,vN,HN,NN.emitterWorldMatrix,lN.direction):lN.direction.Kc(eN,vN,HN)},BN._positionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.minEmitBox.getConnectedValue(NN),cN=this.maxEmitBox.getConnectedValue(NN),eN=(0,TN.RandomRange)(qN.x,cN.x),vN=(0,TN.RandomRange)(qN.y,cN.y),HN=(0,TN.RandomRange)(qN.z,cN.z);NN.isEmitterTransformNode?kB.fB.TransformCoordinatesFromFloatsToRef(eN,vN,HN,NN.emitterWorldMatrix,lN.position):(lN.position.Kc(eN,vN,HN),lN.position.addInPlace(NN.emitterPosition))},this.output._storedValue=BN}}(0,vN.f)("BABYLON.BoxShapeBlock",kq);class qk extends tl{constructor(NN){super(NN),this.registerInput("emitPower",al.Float,!0,1),this.registerInput("lifeTime",al.Float,!0,1),this.registerInput("color",al.xc,!0,new eN.xc(1,1,1,1)),this.registerInput("scale",al.Vector2,!0,new kB.Vector2(1,1)),this.registerInput("angle",al.Float,!0,0),this.registerOutput("particle",al.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(NN){const BN=new Hl(this.name,NN.Fl,NN.PB,null,!1,void 0,!0);BN.particleEmitterType=new FN,BN._lifeTimeCreation.process=(BN,lN)=>{NN.particleContext=BN,BN.lifeTime=this.lifeTime.getConnectedValue(NN),lN._emitPower=this.emitPower.getConnectedValue(NN)},BN._colorCreation.process=BN=>{NN.particleContext=BN,BN.color.kB(this.color.getConnectedValue(NN))},BN._sizeCreation.process=BN=>{NN.particleContext=BN,BN.size=1,BN.scale.kB(this.scale.getConnectedValue(NN))},BN._angleCreation.process=BN=>{NN.particleContext=BN,BN.angle=this.angle.getConnectedValue(NN)},this.particle._storedValue=BN}}(0,vN.f)("BABYLON.CreateParticleBlock",qk);class ck{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const NN=[];for(const BN of this.attachedBlocks)BN.isInput&&NN.push(BN);return NN}constructor(NN){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new YN.b,this.name=NN}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(NN)&&this.attachedBlocks.push(NN);for(const lN of NN.inputs){const kB=lN.connectedPoint;if(kB){const lN=kB.ownerBlock;lN!==NN&&this._initializeBlock(lN,BN)}}}async buildAsync(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((lN=>{const kB=new dl;for(const NN of this._systemBlocks)this._initializeBlock(NN);for(const qN of this.systemBlocks){const lN=new Jl;lN.buildId=this._buildId++,lN.PB=NN,lN.verbose=BN;const cN=qN.createSystem(lN);lN.emitErrors(),kB.systems.push(cN)}this.onBuildObservable.notifyObservers(this),lN(kB)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const NN=new jk("Particle system"),BN=new Bk("Update position");BN.output.connectTo(NN.particle);const lN=new zl("Position");lN.contextualValue=hl.Position;const kB=new zl("Scaled direction");kB.contextualValue=hl.ScaledDirection;const qN=new lk("Add");qN.operation=Wl.Add,lN.output.connectTo(qN.left),kB.output.connectTo(qN.right),qN.output.connectTo(BN.position);const cN=new qk("Create particle"),eN=new kq("Box shape");cN.particle.connectTo(eN.particle),eN.output.connectTo(BN.particle);const vN=new Nk("Texture");vN.texture.connectTo(NN.texture),vN.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(NN)}removeBlock(NN){const BN=this.attachedBlocks.indexOf(NN);if(BN>-1&&this.attachedBlocks.splice(BN,1),NN.isSystem){const BN=this._systemBlocks.indexOf(NN);BN>-1&&this._systemBlocks.splice(BN,1)}}parseSerializedObject(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];BN||this.clear();const lN={};for(const kB of NN.RV){const NN=(0,vN.b)(kB.customType);if(NN){const BN=new NN;BN._deserialize(kB),lN[kB.id]=BN,this.attachedBlocks.push(BN),BN.isSystem&&this._systemBlocks.push(BN)}}for(const kB of this.attachedBlocks)if(kB.isTeleportOut){const NN=kB,BN=NN._tempEntryPointUniqueId;if(BN){const kB=lN[BN];kB&&kB.attachToEndpoint(NN)}}for(let kB=0;kB<NN.RV.length;kB++){const qN=NN.RV[kB],cN=lN[qN.id];cN&&(cN.inputs.length&&qN.inputs.some((NN=>NN.targetConnectionName))&&!BN||this._restoreConnections(cN,NN,lN))}if(NN.locations||NN.editorData&&NN.editorData.locations){const kB=NN.locations||NN.editorData.locations;for(const NN of kB)lN[NN.zl]&&(NN.zl=lN[NN.zl].uniqueId);BN&&this.editorData&&this.editorData.locations&&kB.concat(this.editorData.locations),NN.locations?this.editorData={locations:kB}:(this.editorData=NN.editorData,this.editorData.locations=kB);const qN=[];for(const NN in lN)qN[NN]=lN[NN].uniqueId;this.editorData.map=qN}this.comment=NN.comment}_restoreConnections(NN,BN,lN){for(const kB of NN.outputs)for(const qN of BN.RV){const cN=lN[qN.id];if(cN)for(const eN of qN.inputs)if(lN[eN.targetBlockId]!==NN||eN.targetConnectionName!==kB.name);else{const NN=cN.getInputByName(eN.inputName);if(!NN||NN.isConnected)continue;kB.connectTo(NN,!0),this._restoreConnections(cN,BN,lN)}}}serialize(NN){const BN=NN?{}:wN.b.Serialize(this);BN.editorData=JSON.parse(JSON.stringify(this.editorData));let lN=[];NN?lN=NN:BN.customType="BABYLON.NodeParticleSystemSet",BN.RV=[];for(const kB of lN)BN.RV.push(kB.serialize());if(!NN)for(const kB of this.attachedBlocks)-1===lN.indexOf(kB)&&BN.RV.push(kB.serialize());return BN}dispose(){for(const NN of this.attachedBlocks)NN.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(NN){const BN=new ck(NN);return BN.setToDefault(),BN}static Parse(NN){const BN=wN.b.Parse((()=>new ck(NN.name)),NN,null);return BN.parseSerializedObject(NN),BN}static ParseFromSnippetAsync(NN,BN){return"_BLANK"===NN?Promise.resolve(ck.CreateDefault("blank")):new Promise(((lN,kB)=>{const qN=new El.d;qN.addEventListener("readystatechange",(()=>{if(4==qN.readyState)if(200==qN.status){const eN=JSON.parse(JSON.parse(qN.responseText).jsonPayload),vN=JSON.parse(eN.nodeParticle);BN||(BN=wN.b.Parse((()=>new ck(NN)),vN,null)),BN.parseSerializedObject(vN),BN.snippetId=NN;try{lN(BN)}catch(cN){kB(cN)}}else kB("Unable to load the snippet "+NN)})),qN.open("GET",this.SnippetUrl+"/"+NN.replace(/#/g,"/")),qN.send()}))}}ck.EditorURL="".concat(Gl.Tools._DefaultCdnUrl,"/v").concat(oB.c.Version,"/nodeParticleEditor/babylon.nodeParticleEditor.js"),ck.SnippetUrl="https://snippet.babylonjs.com",(0,xN.c)([(0,ON.G)()],ck.prototype,"name",void 0),(0,xN.c)([(0,ON.G)("comment")],ck.prototype,"comment",void 0),function(NN){NN[NN.None=0]="None",NN[NN.PerParticle=1]="PerParticle",NN[NN.PerSystem=2]="PerSystem"}(Ql||(Ql={}));class ek extends tl{constructor(NN){super(NN),this._currentLockId=-2,this.lockMode=Ql.PerParticle,this.registerInput("min",al.AutoDetect,!0,0),this.registerInput("max",al.AutoDetect,!0,1),this.registerOutput("output",al.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(al.Float|al.Int|al.Vector2|al.fB|al.xc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(al.Float|al.Int|al.Vector2|al.fB|al.xc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=al.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let NN=null;switch(this._currentLockId=-2,this.min.type){case al.AutoDetect:case al.Int:case al.Float:NN=NN=>{const BN=this.min.getConnectedValue(NN)||0,lN=this.max.getConnectedValue(NN)||1;return BN+Math.random()*(lN-BN)};break;case al.Vector2:NN=NN=>{const BN=this.min.getConnectedValue(NN)||kB.Vector2.Zero(),lN=this.max.getConnectedValue(NN)||kB.Vector2.One();return new kB.Vector2(BN.x+Math.random()*(lN.x-BN.x),BN.y+Math.random()*(lN.y-BN.y))};break;case al.fB:NN=NN=>{const BN=this.min.getConnectedValue(NN)||kB.fB.Zero(),lN=this.max.getConnectedValue(NN)||kB.fB.One();return new kB.fB(BN.x+Math.random()*(lN.x-BN.x),BN.y+Math.random()*(lN.y-BN.y),BN.z+Math.random()*(lN.z-BN.z))};break;case al.xc:NN=NN=>{const BN=this.min.getConnectedValue(NN)||new eN.xc(0,0,0,0),lN=this.max.getConnectedValue(NN)||new eN.xc(1,1,1,1);return new eN.xc(BN.x+Math.random()*(lN.x-BN.x),BN.y+Math.random()*(lN.y-BN.y),BN.z+Math.random()*(lN.z-BN.z),BN.w+Math.random()*(lN.w-BN.w))}}this.output._storedFunction=BN=>{var lN;let kB=0;switch(this.lockMode){case Ql.PerParticle:kB=(null===(lN=BN.particleContext)||void 0===lN?void 0:lN.id)||-1;break;case Ql.PerSystem:kB=BN.buildId||0}return this._currentLockId!==kB&&(this.lockMode!==Ql.None&&(this._currentLockId=kB),this.output._storedValue=NN(BN)),this.output._storedValue}}serialize(){const NN=super.serialize();return NN.lockMode=this.lockMode,NN}_deserialize(NN){super._deserialize(NN),this.lockMode=NN.lockMode}}(0,xN.c)([ol("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Ql.None},{label:"Per particle",value:Ql.PerParticle},{label:"Per system",value:Ql.PerSystem}]})],ek.prototype,"lockMode",void 0),(0,vN.f)("BABYLON.ParticleRandomBlock",ek);class vk extends tl{constructor(NN){super(NN),this._currentLockId=-2,this.lockMode=Ql.PerParticle,this.registerInput("min",al.AutoDetect),this.registerInput("max",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const BN=[al.Matrix,al.Particle,al.Texture,al.System,al.FloatGradient,al.Color4Gradient,al.Vector2Gradient,al.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...BN),this.max.excludedConnectionPointTypes.push(...BN)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let NN=null;switch(this._currentLockId=-2,this.min.type){case al.Float:case al.Int:NN=NN=>{const BN=this.min.getConnectedValue(NN),lN=this.max.getConnectedValue(NN);return Math.random()*(lN-BN)+BN};break;case al.Vector2:NN=NN=>{const BN=this.min.getConnectedValue(NN),lN=this.max.getConnectedValue(NN);return new kB.Vector2(Math.random()*(lN.x-BN.x)+BN.x,Math.random()*(lN.y-BN.y)+BN.y)};break;case al.fB:NN=NN=>{const BN=this.min.getConnectedValue(NN),lN=this.max.getConnectedValue(NN);return new kB.fB(Math.random()*(lN.x-BN.x)+BN.x,Math.random()*(lN.y-BN.y)+BN.y,Math.random()*(lN.z-BN.z)+BN.z)};break;case al.xc:NN=NN=>{const BN=this.min.getConnectedValue(NN),lN=this.max.getConnectedValue(NN);return new eN.xc(Math.random()*(lN.r-BN.r)+BN.r,Math.random()*(lN.g-BN.g)+BN.g,Math.random()*(lN.b-BN.b)+BN.b,Math.random()*(lN.a-BN.a)+BN.a)}}this.output._storedFunction=BN=>{var lN;let kB=0;switch(this.lockMode){case Ql.PerParticle:kB=(null===(lN=BN.particleContext)||void 0===lN?void 0:lN.id)||-1;break;case Ql.PerSystem:kB=BN.buildId||0}return this._currentLockId!==kB&&(this.lockMode!==Ql.None&&(this._currentLockId=kB),this.output._storedValue=NN(BN)),this.output._storedValue}}serialize(){const NN=super.serialize();return NN.lockMode=this.lockMode,NN}_deserialize(NN){super._deserialize(NN),void 0!==NN.lockMode&&(this.lockMode=NN.lockMode)}}(0,xN.c)([ol("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Ql.None},{label:"Per particle",value:Ql.PerParticle},{label:"Per system",value:Ql.PerSystem}]})],vk.prototype,"lockMode",void 0),(0,vN.f)("BABYLON.RandomRangeBlock",vk);(0,vN.f)("BABYLON.ParticleLerpBlock",class extends tl{constructor(NN){super(NN),this.registerInput("left",al.AutoDetect),this.registerInput("right",al.AutoDetect),this.registerInput("gradient",al.Float,!0,0,0,1),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(al.Float|al.Int|al.Vector2|al.fB|al.xc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const NN=(NN,BN,lN)=>(1-NN)*BN+NN*lN;this.output._storedFunction=BN=>{const lN=this.left.getConnectedValue(BN),qN=this.right.getConnectedValue(BN),cN=this.gradient.getConnectedValue(BN);switch(this.left.type){case al.Int:case al.Float:return NN(cN,lN,qN);case al.Vector2:return new kB.Vector2(NN(cN,lN.x,qN.x),NN(cN,lN.y,qN.y));case al.fB:return new kB.fB(NN(cN,lN.x,qN.x),NN(cN,lN.y,qN.y),NN(cN,lN.z,qN.z));case al.xc:return new eN.xc(NN(cN,lN.r,qN.r),NN(cN,lN.g,qN.g),NN(cN,lN.b,qN.b),NN(cN,lN.a,qN.a))}return 0}}});(0,vN.f)("BABYLON.UpdateDirectionBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("direction",al.fB),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.direction.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.direction.kB(this.direction.getConnectedValue(NN))},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}});(0,vN.f)("BABYLON.UpdateColorBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("color",al.xc),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.color.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.color.kB(this.color.getConnectedValue(NN))},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}});(0,vN.f)("BABYLON.UpdateScaleBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("scale",al.Vector2),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.scale.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.scale.kB(this.scale.getConnectedValue(NN))},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}});(0,vN.f)("BABYLON.UpdateAngleBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("angle",al.Float),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.angle.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.angle=this.angle.getConnectedValue(NN)},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}});(0,vN.f)("BABYLON.BasicPositionUpdateBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN),lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.direction.scaleToRef(BN._directionScale,BN._scaledDirection),lN.position.addInPlace(BN._scaledDirection)},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN,this.output._storedValue=BN}});(0,vN.f)("BABYLON.BasicSpriteUpdateBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN),lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.updateCellIndex()},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN,this.output._storedValue=BN}});(0,vN.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("cellIndex",al.Int),this.registerOutput("output",al.Particle),this.cellIndex.acceptedConnectionPointTypes=[al.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(NN){const BN=this.particle.getConnectedValue(NN);if(this.output._storedValue=BN,!this.cellIndex.isConnected)return;const lN={process:lN=>{NN.particleContext=lN,NN.systemContext=BN,lN.cellIndex=Math.floor(this.cellIndex.getConnectedValue(NN))},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN}});class Hk extends tl{constructor(NN){super(NN),this.strength=1,this.registerInput("particle",al.Particle),this.registerInput("flowMap",al.Texture),this.registerOutput("output",al.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(NN){var BN;const lN=this.particle.getConnectedValue(NN),kB=NN.PB;let qN;(null===(BN=this.flowMap.connectedPoint)||void 0===BN?void 0:BN.ownerBlock).extractTextureContentAsync().then((NN=>{NN&&(qN=new mk(NN.width,NN.height,NN.data))}));const cN={process:NN=>{const BN=kB.getTransformMatrix();qN&&qN._processParticle(NN,this.strength*lN._tempScaledUpdateSpeed,BN)},previousItem:null,nextItem:null};lN._updateQueueStart?UB(cN,lN._updateQueueStart):lN._updateQueueStart=cN,this.output._storedValue=lN}serialize(){const NN=super.serialize();return NN.strength=this.strength,NN}_deserialize(NN){super._deserialize(NN),this.strength=NN.strength}}(0,xN.c)([ol("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hk.prototype,"strength",void 0),(0,vN.f)("BABYLON.UpdateFlowMapBlock",Hk);(0,vN.f)("BABYLON.SphereShapeBlock",class extends tl{constructor(NN){super(NN),this.registerInput("input",al.Particle),this.registerInput("radius",al.Float,!0,1),this.registerInput("radiusRange",al.Float,!0,1,0,1),this.registerInput("directionRandomizer",al.Float,!0,0,0,1),this.registerOutput("output",al.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(NN){const BN=this.input.getConnectedValue(NN);BN._directionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.directionRandomizer.getConnectedValue(NN),cN=lN.position.ZB(NN.emitterPosition).normalize(),eN=(0,TN.RandomRange)(0,qN),vN=(0,TN.RandomRange)(0,qN),HN=(0,TN.RandomRange)(0,qN);cN.x+=eN,cN.y+=vN,cN.z+=HN,cN.normalize(),NN.isEmitterTransformNode?kB.fB.TransformNormalFromFloatsToRef(eN,vN,HN,NN.emitterWorldMatrix,lN.direction):lN.direction.Kc(eN,vN,HN)},BN._positionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.radius.getConnectedValue(NN),cN=this.radiusRange.getConnectedValue(NN),eN=qN-(0,TN.RandomRange)(0,qN*cN),vN=(0,TN.RandomRange)(0,1),HN=(0,TN.RandomRange)(0,2*Math.PI),RN=Math.acos(2*vN-1),sN=eN*Math.cos(HN)*Math.sin(RN),VN=eN*Math.cos(RN),fN=eN*Math.sin(HN)*Math.sin(RN);NN.isEmitterTransformNode?kB.fB.TransformCoordinatesFromFloatsToRef(sN,VN,fN,NN.emitterWorldMatrix,lN.position):(lN.position.Kc(sN,VN,fN),lN.position.addInPlace(NN.emitterPosition))},this.output._storedValue=BN}});(0,vN.f)("BABYLON.PointShapeBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("direction1",al.fB,!0,new kB.fB(0,1,0)),this.registerInput("direction2",al.fB,!0,new kB.fB(0,1,0)),this.registerOutput("output",al.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(NN){const BN=this.particle.getConnectedValue(NN);BN._directionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.direction1.getConnectedValue(NN),cN=this.direction2.getConnectedValue(NN),eN=(0,TN.RandomRange)(qN.x,cN.x),vN=(0,TN.RandomRange)(qN.y,cN.y),HN=(0,TN.RandomRange)(qN.z,cN.z);NN.isEmitterTransformNode?kB.fB.TransformNormalFromFloatsToRef(eN,vN,HN,NN.emitterWorldMatrix,lN.direction):lN.direction.Kc(eN,vN,HN)},BN._positionCreation.process=lN=>{NN.systemContext=BN,NN.isEmitterTransformNode?kB.fB.TransformCoordinatesFromFloatsToRef(0,0,0,NN.emitterWorldMatrix,lN.position):lN.position.kB(NN.emitterPosition)},this.output._storedValue=BN}});(0,vN.f)("BABYLON.CustomShapeBlock",class extends tl{constructor(NN){super(NN),this.registerInput("particle",al.Particle),this.registerInput("position",al.fB,!0,new kB.fB(0,0,0)),this.registerInput("direction",al.fB,!0,new kB.fB(0,1,0)),this.registerOutput("output",al.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(NN){const BN=this.particle.getConnectedValue(NN);BN._directionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.direction.getConnectedValue(NN);NN.isEmitterTransformNode?kB.fB.TransformNormalToRef(qN,NN.emitterWorldMatrix,lN.direction):lN.direction.kB(qN)},BN._positionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.position.getConnectedValue(NN);NN.isEmitterTransformNode?kB.fB.TransformCoordinatesToRef(qN,NN.emitterWorldMatrix,lN.position):(lN.position.kB(qN),lN.position.addInPlace(NN.emitterPosition))},this.output._storedValue=BN}});(0,vN.f)("BABYLON.CylinderShapeBlock",class extends tl{constructor(NN){super(NN),this._tempVector=kB.fB.Zero(),this.registerInput("particle",al.Particle),this.registerInput("radius",al.Float,!0,1),this.registerInput("height",al.Float,!0,1,0),this.registerInput("radiusRange",al.Float,!0,1,0,1),this.registerInput("directionRandomizer",al.Float,!0,0,0,1),this.registerOutput("output",al.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(NN){const BN=this.particle.getConnectedValue(NN);BN._directionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.directionRandomizer.getConnectedValue(NN);lN.position.subtractToRef(NN.emitterPosition,this._tempVector),this._tempVector.normalize(),NN.isEmitterTransformNode&&kB.fB.TransformNormalToRef(this._tempVector,NN.emitterInverseWorldMatrix,this._tempVector);const cN=(0,TN.RandomRange)(-qN/2,qN/2);let eN=Math.atan2(this._tempVector.x,this._tempVector.z);eN+=(0,TN.RandomRange)(-Math.PI/2,Math.PI/2)*qN,this._tempVector.y=cN,this._tempVector.x=Math.sin(eN),this._tempVector.z=Math.cos(eN),this._tempVector.normalize(),NN.isEmitterTransformNode?kB.fB.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,NN.emitterWorldMatrix,lN.direction):lN.direction.kB(this._tempVector)},BN._positionCreation.process=lN=>{NN.particleContext=lN,NN.systemContext=BN;const qN=this.height.getConnectedValue(NN),cN=this.radiusRange.getConnectedValue(NN),eN=this.radius.getConnectedValue(NN),vN=(0,TN.RandomRange)(-qN/2,qN/2),HN=(0,TN.RandomRange)(0,2*Math.PI),RN=(0,TN.RandomRange)((1-cN)*(1-cN),1),sN=Math.sqrt(RN)*eN,VN=sN*Math.cos(HN),fN=sN*Math.sin(HN);NN.isEmitterTransformNode?kB.fB.TransformCoordinatesFromFloatsToRef(VN,vN,fN,NN.emitterWorldMatrix,lN.position):(lN.position.Kc(VN,vN,fN),lN.position.addInPlace(NN.emitterPosition))},this.output._storedValue=BN}});class Tk extends tl{constructor(NN){super(NN),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",al.Particle),this.registerOutput("output",al.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(NN){super._build(NN);const BN=this.particle.getConnectedValue(NN);BN._isAnimationSheetEnabled=!0,BN.spriteCellWidth=this.width,BN.spriteCellHeight=this.height,BN.startSpriteCellID=this.start,BN.endSpriteCellID=this.end,BN.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=BN}serialize(){const NN=super.serialize();return NN.width=this.width,NN.height=this.height,NN.start=this.start,NN.end=this.end,NN.randomStartCell=this.randomStartCell,NN}_deserialize(NN){super._deserialize(NN),this.width=NN.width,this.height=NN.height,this.start=NN.start,this.end=NN.end,this.randomStartCell=NN.randomStartCell}}(0,xN.c)([ol("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tk.prototype,"start",void 0),(0,xN.c)([ol("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tk.prototype,"end",void 0),(0,xN.c)([ol("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tk.prototype,"width",void 0),(0,xN.c)([ol("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tk.prototype,"height",void 0),(0,xN.c)([ol("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tk.prototype,"loop",void 0),(0,xN.c)([ol("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tk.prototype,"randomStartCell",void 0),(0,vN.f)("BABYLON.SetupSpriteSheetBlock",Tk);class Rk extends tl{constructor(NN){super(NN),this.reference=0,this.registerInput("value",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=NN=>{switch(NN){case al.Float:return al.FloatGradient;case al.Vector2:return al.Vector2Gradient;case al.fB:return al.Vector3Gradient;case al.xc:return al.Color4Gradient}return NN},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(al.Float|al.Vector2|al.fB|al.xc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=NN=>null}serialize(){const NN=super.serialize();return NN.reference=this.reference,NN}_deserialize(NN){super._deserialize(NN),this.reference=NN.reference}}(0,xN.c)([ol("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Rk.prototype,"reference",void 0),(0,vN.f)("BABYLON.ParticleGradientValueBlock",Rk);(0,vN.f)("BABYLON.ParticleGradientBlock",class extends tl{constructor(NN){super(NN),this._entryCount=1,this.registerInput("gradient",al.Float,!0,1,0,1),this.registerInput("value0",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=NN=>{switch(NN){case al.FloatGradient:return al.Float;case al.Vector2Gradient:return al.Vector2;case al.Vector3Gradient:return al.fB;case al.Color4Gradient:return al.xc}return NN},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(al.FloatGradient|al.Vector2Gradient|al.Vector3Gradient|al.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(NN){this._inputs[NN].onConnectionObservable.add((()=>{this._entryCount>NN||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),al.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const NN=[];for(let lN=1;lN<this._inputs.length;lN++){var BN;if(this._inputs[lN].isConnected)NN.push(null===(BN=this._inputs[lN].connectedPoint)||void 0===BN?void 0:BN.ownerBlock)}NN.sort(((NN,BN)=>NN.reference-BN.reference)),this.output._storedFunction=BN=>{const lN=this.gradient.getConnectedValue(BN);if(1===NN.length)return NN[0].value.getConnectedValue(BN);let qN=null;for(let cN=NN.length-1;cN>=0;cN--){const vN=NN[cN];if(vN.reference<=lN){const NN=vN.value.getConnectedValue(BN);if(qN){const cN=qN.value.getConnectedValue(BN),HN=qN.reference,RN=vN.reference,sN=Math.max(0,Math.min(1,(lN-RN)/(HN-RN)));switch(this.output.type){case al.Float:return(0,TN.Lerp)(NN,cN,sN);case al.Vector2:return kB.Vector2.Lerp(NN,cN,sN);case al.fB:return kB.fB.Lerp(NN,cN,sN);case al.xc:return eN.xc.Lerp(NN,cN,sN)}}return NN}qN=vN}return 0}}});(0,vN.f)("BABYLON.ParticleConverterBlock",class extends tl{constructor(NN){super(NN),this.registerInput("color ",al.xc,!0),this.registerInput("xyz ",al.fB,!0),this.registerInput("xy ",al.Vector2,!0),this.registerInput("zw ",al.Vector2,!0),this.registerInput("x ",al.Float,!0),this.registerInput("y ",al.Float,!0),this.registerInput("z ",al.Float,!0),this.registerInput("w ",al.Float,!0),this.registerOutput("color",al.xc),this.registerOutput("xyz",al.fB),this.registerOutput("xy",al.Vector2),this.registerOutput("zw",al.Vector2),this.registerOutput("x",al.Float),this.registerOutput("y",al.Float),this.registerOutput("z",al.Float),this.registerOutput("w",al.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(NN){return"color "===NN?"colorIn":"xyz "===NN?"xyzIn":"xy "===NN?"xyIn":"zw "===NN?"zwIn":"x "===NN?"xIn":"y "===NN?"yIn":"z "===NN?"zIn":"w "===NN?"wIn":NN}_outputRename(NN){switch(NN){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return NN}}_build(NN){super._build(NN);const BN=this.xIn,lN=this.yIn,qN=this.zIn,cN=this.wIn,vN=this.xyIn,HN=this.zwIn,TN=this.xyzIn,RN=this.colorIn,sN=this.colorOut,VN=this.xyzOut,fN=this.xyOut,ZN=this.zwOut,PN=this.xOut,CN=this.yOut,FN=this.zOut,IN=this.wOut,AN=NN=>{if(RN.isConnected)return RN.getConnectedValue(NN);let kB=0,sN=0,VN=0,fN=0;if(BN.isConnected&&(kB=BN.getConnectedValue(NN)),lN.isConnected&&(sN=lN.getConnectedValue(NN)),qN.isConnected&&(VN=qN.getConnectedValue(NN)),cN.isConnected&&(fN=cN.getConnectedValue(NN)),vN.isConnected){const BN=vN.getConnectedValue(NN);BN&&(kB=BN.x,sN=BN.y)}if(HN.isConnected){const BN=HN.getConnectedValue(NN);BN&&(VN=BN.x,fN=BN.y)}if(TN.isConnected){const BN=TN.getConnectedValue(NN);BN&&(kB=BN.x,sN=BN.y,VN=BN.z)}return new eN.xc(kB,sN,VN,fN)};sN._storedFunction=NN=>AN(NN),VN._storedFunction=NN=>{const BN=AN(NN);return new kB.fB(BN.r,BN.g,BN.b)},fN._storedFunction=NN=>{const BN=AN(NN);return new kB.Vector2(BN.r,BN.g)},ZN._storedFunction=NN=>{const BN=AN(NN);return new kB.Vector2(BN.b,BN.a)},PN._storedFunction=NN=>AN(NN).r,CN._storedFunction=NN=>AN(NN).g,FN._storedFunction=NN=>AN(NN).b,IN._storedFunction=NN=>AN(NN).a}}),function(NN){NN[NN.Cos=0]="Cos",NN[NN.Sin=1]="Sin",NN[NN.Abs=2]="Abs",NN[NN.Exp=3]="Exp",NN[NN.Exp2=4]="Exp2",NN[NN.Round=5]="Round",NN[NN.Floor=6]="Floor",NN[NN.Ceiling=7]="Ceiling",NN[NN.Sqrt=8]="Sqrt",NN[NN.Log=9]="Log",NN[NN.Tan=10]="Tan",NN[NN.ArcTan=11]="ArcTan",NN[NN.ArcCos=12]="ArcCos",NN[NN.ArcSin=13]="ArcSin",NN[NN.Sign=14]="Sign",NN[NN.Negate=15]="Negate",NN[NN.OneMinus=16]="OneMinus",NN[NN.Reciprocal=17]="Reciprocal",NN[NN.ToDegrees=18]="ToDegrees",NN[NN.ToRadians=19]="ToRadians",NN[NN.Fract=20]="Fract"}(Sl||(Sl={}));class sk extends tl{constructor(NN){super(NN),this.operation=Sl.Cos,this.registerInput("input",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(al.Float|al.Int|al.Vector2|al.fB|al.xc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(NN){super._build(NN);let BN=null;switch(this.operation){case Sl.Cos:BN=NN=>Math.cos(NN);break;case Sl.Sin:BN=NN=>Math.sin(NN);break;case Sl.Abs:BN=NN=>Math.abs(NN);break;case Sl.Exp:BN=NN=>Math.exp(NN);break;case Sl.Exp2:BN=NN=>Math.pow(2,NN);break;case Sl.Round:BN=NN=>Math.round(NN);break;case Sl.Floor:BN=NN=>Math.floor(NN);break;case Sl.Ceiling:BN=NN=>Math.ceil(NN);break;case Sl.Sqrt:BN=NN=>Math.sqrt(NN);break;case Sl.Log:BN=NN=>Math.log(NN);break;case Sl.Tan:BN=NN=>Math.tan(NN);break;case Sl.ArcTan:BN=NN=>Math.atan(NN);break;case Sl.ArcCos:BN=NN=>Math.acos(NN);break;case Sl.ArcSin:BN=NN=>Math.asin(NN);break;case Sl.Sign:BN=NN=>Math.sign(NN);break;case Sl.Negate:BN=NN=>-NN;break;case Sl.OneMinus:BN=NN=>1-NN;break;case Sl.Reciprocal:BN=NN=>1/NN;break;case Sl.ToRadians:BN=NN=>NN*Math.PI/180;break;case Sl.ToDegrees:BN=NN=>180*NN/Math.PI;break;case Sl.Fract:BN=NN=>NN>=0?NN-Math.floor(NN):NN-Math.ceil(NN)}if(!BN)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case al.Int:case al.Float:this.output._storedFunction=NN=>{const lN=this.input.getConnectedValue(NN);return BN(lN)};break;case al.Vector2:this.output._storedFunction=NN=>{const lN=this.input.getConnectedValue(NN);return new kB.Vector2(BN(lN.x),BN(lN.y))};break;case al.fB:this.output._storedFunction=NN=>{const lN=this.input.getConnectedValue(NN);return new kB.fB(BN(lN.x),BN(lN.y),BN(lN.z))};break;case al.xc:this.output._storedFunction=NN=>{const lN=this.input.getConnectedValue(NN);return new eN.xc(BN(lN.r),BN(lN.g),BN(lN.b),BN(lN.a))}}return this}serialize(){const NN=super.serialize();return NN.operation=this.operation,NN}_deserialize(NN){super._deserialize(NN),this.operation=NN.operation}}(0,xN.c)([ol("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Sl.Cos},{label:"Sin",value:Sl.Sin},{label:"Abs",value:Sl.Abs},{label:"Exp",value:Sl.Exp},{label:"Exp2",value:Sl.Exp2},{label:"Round",value:Sl.Round},{label:"Floor",value:Sl.Floor},{label:"Ceiling",value:Sl.Ceiling},{label:"Sqrt",value:Sl.Sqrt},{label:"Log",value:Sl.Log},{label:"Tan",value:Sl.Tan},{label:"ArcTan",value:Sl.ArcTan},{label:"ArcCos",value:Sl.ArcCos},{label:"ArcSin",value:Sl.ArcSin},{label:"Sign",value:Sl.Sign},{label:"Negate",value:Sl.Negate},{label:"OneMinus",value:Sl.OneMinus},{label:"Reciprocal",value:Sl.Reciprocal},{label:"ToDegrees",value:Sl.ToDegrees},{label:"ToRadians",value:Sl.ToRadians},{label:"Fract",value:Sl.Fract}]})],sk.prototype,"operation",void 0),(0,vN.f)("BABYLON.ParticleTrigonometryBlock",sk);var Vk,fk=lN(16056);class Zk extends tl{constructor(NN){super(NN),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(al.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(al.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(al.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(al.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(al.System),this._inputs[0].excludedConnectionPointTypes.push(al.Particle),this._inputs[0].excludedConnectionPointTypes.push(al.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(NN){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const BN=NN=>{const BN=this.input.getConnectedValue(NN);if(this.log.length>=this.stackSize)return BN;if(null===BN||void 0===BN)return this.log.push(["null",""]),BN;switch(this.input.type){case al.Vector2:this.log.push([(0,fk.k)(BN,4),BN.toString()]);break;case al.fB:this.log.push([(0,fk.m)(BN,4),BN.toString()]);break;case al.xc:this.log.push(["{R: ".concat(BN.r.toFixed(4)," G: ").concat(BN.g.toFixed(4)," B: ").concat(BN.b.toFixed(4)," A: ").concat(BN.a.toFixed(4),"}"),BN.toString()]);break;default:this.log.push([BN.toString(),BN.toString()])}return BN};this.output.isConnected?this.output._storedFunction=BN:this.output._storedValue=BN(NN)}serialize(){const NN=super.serialize();return NN.stackSize=this.stackSize,NN}_deserialize(NN){super._deserialize(NN),this.stackSize=NN.stackSize}}(0,xN.c)([ol("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Zk.prototype,"stackSize",void 0),(0,vN.f)("BABYLON.ParticleDebugBlock",Zk);(0,vN.f)("BABYLON.ParticleElbowBlock",class extends tl{constructor(NN){super(NN),this.registerInput("input",al.AutoDetect),this.registerOutput("output",al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(NN){super._build(NN);const BN=this._outputs[0],lN=this._inputs[0];BN._storedFunction=NN=>lN.getConnectedValue(NN)}});(0,vN.f)("BABYLON.ParticleTeleportInBlock",class extends tl{get endpoints(){return this._endpoints}constructor(NN){super(NN),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",al.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(NN){if(this.getClassName()===NN)return!0;for(const BN of this.endpoints)if(BN.isAnAncestorOfType(NN))return!0;return!1}isAnAncestorOf(NN){for(const BN of this.endpoints){if(BN===NN)return!0;if(BN.isAnAncestorOf(NN))return!0}return!1}attachToEndpoint(NN){NN.detach(),this._endpoints.push(NN),NN._entryPoint=this,NN._outputs[0]._typeConnectionSource=this._inputs[0],NN._tempEntryPointUniqueId=null,NN.name="> "+this.name}detachFromEndpoint(NN){const BN=this._endpoints.indexOf(NN);-1!==BN&&(this._endpoints.splice(BN,1),NN._outputs[0]._typeConnectionSource=null,NN._entryPoint=null)}_build(){for(const NN of this._endpoints)NN.output._storedFunction=NN=>this.input.getConnectedValue(NN)}});(0,vN.f)("BABYLON.ParticleTeleportOutBlock",class extends tl{constructor(NN){super(NN),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",al.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(NN){this.entryPoint&&this.entryPoint.build(NN)}clone(){const NN=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(NN),NN}serialize(){var NN,BN;const lN=super.serialize();return lN.entryPoint=null!==(NN=null===(BN=this.entryPoint)||void 0===BN?void 0:BN.uniqueId)&&void 0!==NN?NN:"",lN}_deserialize(NN){super._deserialize(NN),this._tempEntryPointUniqueId=NN.entryPoint}}),function(NN){NN[NN.Equal=0]="Equal",NN[NN.NotEqual=1]="NotEqual",NN[NN.LessThan=2]="LessThan",NN[NN.GreaterThan=3]="GreaterThan",NN[NN.LessOrEqual=4]="LessOrEqual",NN[NN.GreaterOrEqual=5]="GreaterOrEqual",NN[NN.Xor=6]="Xor",NN[NN.Or=7]="Or",NN[NN.And=8]="And"}(Vk||(Vk={}));class Pk extends tl{constructor(NN){super(NN),this.test=Vk.Equal,this.epsilon=0,this.registerInput("left",al.Float),this.registerInput("right",al.Float,!0,0),this.registerInput("ifTrue",al.AutoDetect,!0,1),this.registerInput("ifFalse",al.AutoDetect,!0,0),this.registerOutput("output",al.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=al.Float,this._inputs[0].acceptedConnectionPointTypes.push(al.Int),this._inputs[1].acceptedConnectionPointTypes.push(al.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const NN=NN=>{const BN=this.left.getConnectedValue(NN),lN=this.right.getConnectedValue(NN);let kB=!1;switch(this.test){case Vk.Equal:kB=(0,TN.WithinEpsilon)(BN,lN,this.epsilon);break;case Vk.NotEqual:kB=!(0,TN.WithinEpsilon)(BN,lN,this.epsilon);break;case Vk.LessThan:kB=BN<lN+this.epsilon;break;case Vk.GreaterThan:kB=BN>lN-this.epsilon;break;case Vk.LessOrEqual:kB=BN<=lN+this.epsilon;break;case Vk.GreaterOrEqual:kB=BN>=lN-this.epsilon;break;case Vk.Xor:kB=!!BN&&!lN||!BN&&!!lN;break;case Vk.Or:kB=!!BN||!!lN;break;case Vk.And:kB=!!BN&&!!lN}return kB};this.output._storedFunction=BN=>NN(BN)?this.ifTrue.getConnectedValue(BN):this.ifFalse.getConnectedValue(BN)}serialize(){const NN=super.serialize();return NN.test=this.test,NN.epsilon=this.epsilon,NN}_deserialize(NN){super._deserialize(NN),this.test=NN.test,void 0!==NN.epsilon&&(this.epsilon=NN.epsilon)}}(0,xN.c)([ol("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Vk.Equal},{label:"NotEqual",value:Vk.NotEqual},{label:"LessThan",value:Vk.LessThan},{label:"GreaterThan",value:Vk.GreaterThan},{label:"LessOrEqual",value:Vk.LessOrEqual},{label:"GreaterOrEqual",value:Vk.GreaterOrEqual},{label:"Xor",value:Vk.Xor},{label:"Or",value:Vk.Or},{label:"And",value:Vk.And}]})],Pk.prototype,"test",void 0),(0,xN.c)([ol("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Pk.prototype,"epsilon",void 0),(0,vN.f)("BABYLON.ParticleConditionBlock",Pk);class Ck extends tl{constructor(NN){super(NN),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",al.Particle),this.registerInput("condition",al.Float,!0,0),this.registerInput("system",al.System),this.registerOutput("output",al.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(NN){this._triggerCount=0;const BN=this.input.getConnectedValue(NN),lN={process:lN=>{if(NN.particleContext=lN,NN.systemContext=BN,0!==this.condition.getConnectedValue(NN)&&(0===this.limit||this._triggerCount<this.limit)){const kB=(new Date).getTime();if(this._previousOne&&kB-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=kB;const qN=this.system.getConnectedValue(NN);if(qN){const kB=Yl(qN,NN.PB,lN.position);kB.qc.addOnce((()=>{this._triggerCount--})),BN.qc.addOnce((()=>{kB.dispose()}))}}},previousItem:null,nextItem:null};BN._updateQueueStart?UB(lN,BN._updateQueueStart):BN._updateQueueStart=lN,this.output._storedValue=BN}serialize(){const NN=super.serialize();return NN.limit=this.limit,NN.delay=this.delay,NN}_deserialize(NN){super._deserialize(NN),void 0!==NN.limit&&(this.limit=NN.limit),void 0!==NN.delay&&(this.delay=NN.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,xN.c)([ol("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ck.prototype,"limit",void 0),(0,xN.c)([ol("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ck.prototype,"delay",void 0),(0,vN.f)("BABYLON.ParticleTriggerBlock",Ck);lN(16062),lN(16074),lN(16081),lN(16138)},16123:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneFragment",cN="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16088:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneFragmentDeclaration",cN="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16150:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneVertex",cN="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16146:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneVertexDeclaration",cN="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16133:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogFragment",cN="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16115:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogFragmentDeclaration",cN="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16156:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogVertex",cN="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16148:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogVertexDeclaration",cN="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16104:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="helperFunctions",cN="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16097:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="imageProcessingDeclaration",cN="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16107:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="imageProcessingFunctions",cN="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16100:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthDeclaration",cN="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16128:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthFragment",cN="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16163:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthVertex",cN="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";kB.c.IncludesShadersStoreWGSL[qN]||(kB.c.IncludesShadersStoreWGSL[qN]=cN)},16081:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{particlesPixelShaderWGSL:()=>eN});var kB=lN(14833);lN(16088),lN(16097),lN(16100),lN(16104),lN(16107),lN(16115),lN(16123),lN(16128),lN(16133);const qN="particlesPixelShader",cN="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";kB.c.ShadersStoreWGSL[qN]||(kB.c.ShadersStoreWGSL[qN]=cN);const eN={name:qN,shader:cN}},16138:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{particlesVertexShaderWGSL:()=>eN});var kB=lN(14833);lN(16146),lN(16148),lN(16100),lN(16150),lN(16156),lN(16163);const qN="particlesVertexShader",cN="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";kB.c.ShadersStoreWGSL[qN]||(kB.c.ShadersStoreWGSL[qN]=cN);const eN={name:qN,shader:cN}},16001:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneFragment",cN="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16070:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneFragmentDeclaration",cN="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16021:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneVertex",cN="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16076:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="clipPlaneVertexDeclaration",cN="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16015:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogFragment",cN="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},15992:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogFragmentDeclaration",cN="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16023:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogVertex",cN="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16018:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="fogVertexDeclaration",cN="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},15985:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="helperFunctions",cN="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},15978:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="imageProcessingDeclaration",cN="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},15990:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="imageProcessingFunctions",cN="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},15983:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthDeclaration",cN="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16006:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthFragment",cN="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16032:(NN,BN,lN)=>{"use strict";var kB=lN(14833);const qN="logDepthVertex",cN="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";kB.c.IncludesShadersStore[qN]||(kB.c.IncludesShadersStore[qN]=cN)},16062:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{particlesPixelShader:()=>eN});var kB=lN(14833);lN(16070),lN(15978),lN(15983),lN(15985),lN(15990),lN(15992),lN(16001),lN(16006),lN(16015);const qN="particlesPixelShader",cN="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";kB.c.ShadersStore[qN]||(kB.c.ShadersStore[qN]=cN);const eN={name:qN,shader:cN}},16074:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{particlesVertexShader:()=>eN});var kB=lN(14833);lN(16076),lN(16018),lN(15983),lN(16021),lN(16023),lN(16032);const qN="particlesVertexShader",cN="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";kB.c.ShadersStore[qN]||(kB.c.ShadersStore[qN]=cN);const eN={name:qN,shader:cN}},15944:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{FlowGraphGLTFDataProvider:()=>cN});var kB=lN(15908),qN=lN(15886);class cN extends kB.e{constructor(NN){var BN,lN;super();const kB=NN.glTF,cN=(null===(BN=kB.animations)||void 0===BN?void 0:BN.map((NN=>NN._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",qN.c,cN);const eN=(null===(lN=kB.nodes)||void 0===lN?void 0:lN.map((NN=>NN._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",qN.c,eN)}getClassName(){return"FlowGraphGLTFDataProvider"}}},15825:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>CN,g:()=>ZN,i:()=>fN,l:()=>PN});var kB=lN(14925),qN=lN(15429),cN=lN(14972),eN=lN(15827);const vN=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class HN{constructor(NN,BN){this._gltf=NN,this._infoTree=BN}convert(NN){let BN,lN=this._gltf,kB=this._infoTree;if(!NN.startsWith("/"))throw new Error("Path must start with a /");const qN=NN.split("/");if(qN.shift(),qN[qN.length-1].includes(".length")){const NN=qN[qN.length-1].split(".");qN.pop(),qN.push(...NN)}let cN=!1;for(const HN of qN){const qN="length"===HN;if(qN&&!kB.__array__)throw new Error("Path ".concat(NN," is invalid"));if(kB.__ignoreObjectTree__&&(cN=!0),kB.__array__&&!qN)kB=kB.__array__;else if(kB=kB[HN],!kB)throw new Error("Path ".concat(NN," is invalid"));if(!cN)if(void 0===lN){if(!vN.find((BN=>BN.regex.test(NN))))throw new Error("Path ".concat(NN," is invalid"))}else if(!qN){var eN;lN=null===(eN=lN)||void 0===eN?void 0:eN[HN]}(kB.__target__||qN)&&(BN=lN)}return{object:BN,info:kB}}}function TN(NN,BN,lN,kB){const qN=RN(NN,BN);return kB?qN[lN][kB]:qN[lN]}function RN(NN,BN,lN){var kB,cN,eN;return null===(kB=NN._data)||void 0===kB||null===(cN=kB[null!==(eN=null===lN||void 0===lN?void 0:lN.fillMode)&&void 0!==eN?eN:qN.c.MATERIAL_TriangleFillMode])||void 0===cN?void 0:cN.babylonMaterial}function sN(NN,BN){return{offset:{componentsCount:2,type:"Vector2",get:(lN,qN,cN)=>{const eN=TN(lN,cN,NN,BN);return new kB.Vector2(null===eN||void 0===eN?void 0:eN.uOffset,null===eN||void 0===eN?void 0:eN.vOffset)},getTarget:RN,set:(lN,kB,qN,cN)=>{const eN=TN(kB,cN,NN,BN);eN.uOffset=lN.x,eN.vOffset=lN.y},getPropertyName:[()=>"".concat(NN).concat(BN?"."+BN:"",".uOffset"),()=>"".concat(NN).concat(BN?"."+BN:"",".vOffset")]},rotation:{type:"number",get:(lN,kB,qN)=>{var cN;return null===(cN=TN(lN,qN,NN,BN))||void 0===cN?void 0:cN.wAng},getTarget:RN,set:(lN,kB,qN,cN)=>TN(kB,cN,NN,BN).wAng=lN,getPropertyName:[()=>"".concat(NN).concat(BN?"."+BN:"",".wAng")]},scale:{componentsCount:2,type:"Vector2",get:(lN,qN,cN)=>{const eN=TN(lN,cN,NN,BN);return new kB.Vector2(null===eN||void 0===eN?void 0:eN.uScale,null===eN||void 0===eN?void 0:eN.vScale)},getTarget:RN,set:(lN,kB,qN,cN)=>{const eN=TN(kB,cN,NN,BN);eN.uScale=lN.x,eN.vScale=lN.y},getPropertyName:[()=>"".concat(NN).concat(BN?"."+BN:"",".uScale"),()=>"".concat(NN).concat(BN?"."+BN:"",".vScale")]}}}const VN={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:NN=>{var BN,lN,qN,cN;return new kB.Vector2(null!==(BN=null===(lN=NN._babylonCamera)||void 0===lN?void 0:lN.orthoLeft)&&void 0!==BN?BN:0,null!==(qN=null===(cN=NN._babylonCamera)||void 0===cN?void 0:cN.orthoRight)&&void 0!==qN?qN:0)},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.orthoLeft=NN.x,BN._babylonCamera.orthoRight=NN.y)},getTarget:NN=>NN,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:NN=>{var BN,lN,qN,cN;return new kB.Vector2(null!==(BN=null===(lN=NN._babylonCamera)||void 0===lN?void 0:lN.orthoBottom)&&void 0!==BN?BN:0,null!==(qN=null===(cN=NN._babylonCamera)||void 0===cN?void 0:cN.orthoTop)&&void 0!==qN?qN:0)},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.orthoBottom=NN.x,BN._babylonCamera.orthoTop=NN.y)},getTarget:NN=>NN,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.Gc},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.Gc=NN)},getTarget:NN=>NN,getPropertyName:[()=>"Gc"]},znear:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.Mc},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.Mc=NN)},getTarget:NN=>NN,getPropertyName:[()=>"Mc"]}},perspective:{aspectRatio:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.getEngine().getAspectRatio(NN._babylonCamera)},getTarget:NN=>NN,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.fov},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.fov=NN)},getTarget:NN=>NN,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.Gc},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.Gc=NN)},getTarget:NN=>NN,getPropertyName:[()=>"Gc"]},znear:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonCamera)||void 0===BN?void 0:BN.Mc},set:(NN,BN)=>{BN._babylonCamera&&(BN._babylonCamera.Mc=NN)},getTarget:NN=>NN,getPropertyName:[()=>"Mc"]}}}},nodes:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>NN._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"fB",get:NN=>{var BN;return null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.position},set:(NN,BN)=>{var lN;return null===(lN=BN._babylonTransformNode)||void 0===lN?void 0:lN.position.kB(NN)},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:NN=>{var BN;return null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.rotationQuaternion},set:(NN,BN)=>{var lN,kB;return null===(lN=BN._babylonTransformNode)||void 0===lN||null===(kB=lN.rotationQuaternion)||void 0===kB?void 0:kB.kB(NN)},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"fB",get:NN=>{var BN;return null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.gc},set:(NN,BN)=>{var lN;return null===(lN=BN._babylonTransformNode)||void 0===lN?void 0:lN.gc.kB(NN)},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"gc"]},weights:{length:{type:"number",get:NN=>NN._numMorphTargets,getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(NN,BN)=>{var lN,kB;return void 0!==BN?null===(lN=NN._primitiveBabylonMeshes)||void 0===lN||null===(kB=lN[0].morphTargetManager)||void 0===kB?void 0:kB.getTarget(BN).influence:void 0},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(NN,BN)=>[0],getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:NN=>{var BN,lN,qN;return kB.Matrix.Compose(null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.gc,null===(lN=NN._babylonTransformNode)||void 0===lN?void 0:lN.rotationQuaternion,null===(qN=NN._babylonTransformNode)||void 0===qN?void 0:qN.position)},getTarget:NN=>NN._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:NN=>{var BN,lN,qN,cN;const eN=kB.Matrix.Identity();let vN=NN.parent;for(;vN&&vN.parent;)vN=vN.parent;const HN=(null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.position._isDirty)||(null===(lN=NN._babylonTransformNode)||void 0===lN||null===(qN=lN.rotationQuaternion)||void 0===qN?void 0:qN._isDirty)||(null===(cN=NN._babylonTransformNode)||void 0===cN?void 0:cN.gc._isDirty);if(vN){var TN;const BN=null===(TN=vN._babylonTransformNode)||void 0===TN?void 0:TN.uc(!0).invert();var RN,sN;if(BN)null===(RN=NN._babylonTransformNode)||void 0===RN||null===(sN=RN.uc(HN))||void 0===sN||sN.multiplyToRef(BN,eN)}else NN._babylonTransformNode&&eN.kB(NN._babylonTransformNode.uc(HN));return eN},getTarget:NN=>NN._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:NN=>{var BN,lN;return null===(BN=NN._babylonTransformNode)||void 0===BN||null===(lN=BN.getChildren((NN=>NN instanceof eN.d),!0)[0])||void 0===lN?void 0:lN.bc},getTarget:NN=>{var BN;return null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.getChildren((NN=>NN instanceof eN.d),!0)[0]},set:(NN,BN)=>{if(BN._babylonTransformNode){const lN=BN._babylonTransformNode.getChildren((NN=>NN instanceof eN.d),!0)[0];lN&&(lN.bc=NN)}}},color:{type:"FB",get:NN=>{var BN,lN;return null===(BN=NN._babylonTransformNode)||void 0===BN||null===(lN=BN.getChildren((NN=>NN instanceof eN.d),!0)[0])||void 0===lN?void 0:lN.me},getTarget:NN=>{var BN;return null===(BN=NN._babylonTransformNode)||void 0===BN?void 0:BN.getChildren((NN=>NN instanceof eN.d),!0)[0]},set:(NN,BN)=>{if(BN._babylonTransformNode){const lN=BN._babylonTransformNode.getChildren((NN=>NN instanceof eN.d),!0)[0];lN&&(lN.me=NN)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"FB",get:(NN,BN,lN)=>RN(NN,BN,lN).emissiveColor,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).emissiveColor.kB(NN),getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:sN("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(NN,BN,lN)=>{var kB;return null===(kB=TN(NN,lN,"bumpTexture"))||void 0===kB?void 0:kB.level},set:(NN,BN,lN,kB)=>{const qN=TN(BN,kB,"bumpTexture");qN&&(qN.level=NN)},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:sN("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).ambientTextureStrength,set:(NN,BN,lN,kB)=>{const qN=RN(BN,lN,kB);qN&&(qN.ambientTextureStrength=NN)},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:sN("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"xc",get:(NN,BN,lN)=>{const kB=RN(NN,BN,lN);return cN.xc.FromColor3(kB.albedoColor,kB.alpha)},set:(NN,BN,lN,kB)=>{const qN=RN(BN,lN,kB);qN.albedoColor.set(NN.r,NN.g,NN.b),qN.alpha=NN.a},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:sN("albedoTexture")}},metallicFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).metallic,set:(NN,BN,lN,kB)=>{const qN=RN(BN,lN,kB);qN&&(qN.metallic=NN)},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).roughness,set:(NN,BN,lN,kB)=>{const qN=RN(BN,lN,kB);qN&&(qN.roughness=NN)},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:sN("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).anisotropy.bc,set:(NN,BN,lN,kB)=>{RN(BN,lN,kB).anisotropy.bc=NN},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).anisotropy.angle,set:(NN,BN,lN,kB)=>{RN(BN,lN,kB).anisotropy.angle=NN},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:sN("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).clearCoat.bc,set:(NN,BN,lN,kB)=>{RN(BN,lN,kB).clearCoat.bc=NN},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).clearCoat.roughness,set:(NN,BN,lN,kB)=>{RN(BN,lN,kB).clearCoat.roughness=NN},getTarget:(NN,BN,lN)=>RN(NN,BN,lN),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:sN("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(NN,BN,lN)=>{var kB;return null===(kB=RN(NN,BN,lN).clearCoat.bumpTexture)||void 0===kB?void 0:kB.level},getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).clearCoat.bumpTexture.level=NN},extensions:{KHR_texture_transform:sN("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:sN("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.dispersion,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.dispersion=NN}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).emissiveIntensity,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).emissiveIntensity=NN}},KHR_materials_ior:{ior:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).indexOfRefraction,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).indexOfRefraction=NN}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).iridescence.bc,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).iridescence.bc=NN},iridescenceIor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).iridescence.indexOfRefraction,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).iridescence.indexOfRefraction=NN},iridescenceTexture:{extensions:{KHR_texture_transform:sN("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).iridescence.maximumThickness,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).iridescence.maximumThickness=NN},iridescenceThicknessMinimum:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).iridescence.minimumThickness,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).iridescence.minimumThickness=NN},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:sN("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"FB",get:(NN,BN,lN)=>RN(NN,BN,lN).sheen.color,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).sheen.color.kB(NN)},sheenColorTexture:{extensions:{KHR_texture_transform:sN("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).sheen.bc,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).sheen.bc=NN},sheenRoughnessTexture:{extensions:{KHR_texture_transform:sN("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).metallicF0Factor,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).metallicF0Factor=NN,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"FB",get:(NN,BN,lN)=>RN(NN,BN,lN).metallicReflectanceColor,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).metallicReflectanceColor.kB(NN),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:sN("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:sN("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.refractionIntensity,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.refractionIntensity=NN,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:sN("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.translucencyIntensity,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.translucencyIntensity=NN},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:sN("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"FB",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.translucencyColor,getTarget:RN,set:(NN,BN,lN,kB)=>{var qN;return NN&&(null===(qN=RN(BN,lN,kB).subSurface.translucencyColor)||void 0===qN?void 0:qN.kB(NN))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:sN("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"FB",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.tintColor,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.tintColor.kB(NN)},attenuationDistance:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.tintColorAtDistance,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.tintColorAtDistance=NN},thicknessFactor:{type:"number",get:(NN,BN,lN)=>RN(NN,BN,lN).subSurface.maximumThickness,getTarget:RN,set:(NN,BN,lN,kB)=>RN(BN,lN,kB).subSurface.maximumThickness=NN},thicknessTexture:{extensions:{KHR_texture_transform:sN("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>NN._babylonLight)),getPropertyName:[NN=>"length"]},__array__:{__target__:!0,color:{type:"FB",get:NN=>{var BN;return null===(BN=NN._babylonLight)||void 0===BN?void 0:BN.me},set:(NN,BN)=>{var lN;return null===(lN=BN._babylonLight)||void 0===lN?void 0:lN.me.kB(NN)},getTarget:NN=>NN._babylonLight,getPropertyName:[NN=>"diffuse"]},bc:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonLight)||void 0===BN?void 0:BN.bc},set:(NN,BN)=>BN._babylonLight?BN._babylonLight.bc=NN:void 0,getTarget:NN=>NN._babylonLight,getPropertyName:[NN=>"intensity"]},range:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonLight)||void 0===BN?void 0:BN.range},set:(NN,BN)=>BN._babylonLight?BN._babylonLight.range=NN:void 0,getTarget:NN=>NN._babylonLight,getPropertyName:[NN=>"range"]},spot:{innerConeAngle:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonLight)||void 0===BN?void 0:BN.innerAngle},set:(NN,BN)=>BN._babylonLight?BN._babylonLight.innerAngle=NN:void 0,getTarget:NN=>NN._babylonLight,getPropertyName:[NN=>"innerConeAngle"]},outerConeAngle:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonLight)||void 0===BN?void 0:BN.angle},set:(NN,BN)=>BN._babylonLight?BN._babylonLight.angle=NN:void 0,getTarget:NN=>NN._babylonLight,getPropertyName:[NN=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>NN._babylonLight)),getPropertyName:[NN=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>NN._babylonTexture)),getPropertyName:[NN=>"length"]},__array__:{__target__:!0,bc:{type:"number",get:NN=>{var BN;return null===(BN=NN._babylonTexture)||void 0===BN?void 0:BN.level},set:(NN,BN)=>{BN._babylonTexture&&(BN._babylonTexture.level=NN)},getTarget:NN=>NN._babylonTexture},rotation:{type:"Quaternion",get:NN=>{var BN;return NN._babylonTexture&&kB.Quaternion.FromRotationMatrix(null===(BN=NN._babylonTexture)||void 0===BN?void 0:BN.getReflectionTextureMatrix())},set:(NN,BN)=>{var lN;BN._babylonTexture&&(null!==(lN=BN._babylonTexture.VB())&&void 0!==lN&&lN.useRightHandedSystem||(NN=kB.Quaternion.Inverse(NN)),kB.Matrix.FromQuaternionToRef(NN,BN._babylonTexture.getReflectionTextureMatrix()))},getTarget:NN=>NN._babylonTexture}}}}},animations:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>NN._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:NN=>NN.length,getTarget:NN=>NN.map((NN=>{var BN;return null===(BN=NN.primitives[0]._instanceData)||void 0===BN?void 0:BN.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function fN(NN){return new HN(NN,VN)}function ZN(NN){const BN=NN.split("/").map((NN=>NN.replace(/{}/g,"__array__")));let lN=VN;for(const kB of BN)kB&&(lN=lN[kB]);if(lN&&lN.type&&lN.get)return lN}function PN(NN,BN){const lN=NN.split("/").map((NN=>NN.replace(/{}/g,"__array__")));let kB=VN;for(const qN of lN)qN&&(kB=kB[qN]);kB&&kB.type&&kB.get&&(kB.interpolation=BN)}function CN(NN,BN){const lN=NN.split("/").map((NN=>NN.replace(/{}/g,"__array__")));let kB=VN;for(const qN of lN)if(qN){if(!kB[qN]){if("?"===qN){kB.__ignoreObjectTree__=!0;continue}kB[qN]={},"__array__"===qN&&(kB[qN].__target__=!0)}kB=kB[qN]}Object.assign(kB,BN)}},15835:(NN,BN,lN)=>{"use strict";lN.r(BN),lN.d(BN,{AnimationPropertyInfo:()=>TN,TransformNodeAnimationPropertyInfo:()=>RN,WeightAnimationPropertyInfo:()=>sN,getQuaternion:()=>vN,getVector3:()=>eN,getWeights:()=>HN});var kB=lN(15471),qN=lN(14925),cN=lN(15825);function eN(NN,BN,lN,kB){return qN.fB.IB(BN,lN).scaleInPlace(kB)}function vN(NN,BN,lN,kB){return qN.Quaternion.IB(BN,lN).scaleInPlace(kB)}function HN(NN,BN,lN,kB){const qN=new Array(NN._numMorphTargets);for(let cN=0;cN<qN.length;cN++)qN[cN]=BN[lN++]*kB;return qN}class TN{constructor(NN,BN,lN,kB){this.type=NN,this.name=BN,this.getValue=lN,this.getStride=kB}_buildAnimation(NN,BN,lN){const qN=new kB.c(NN,this.name,BN,this.type);return qN.setKeys(lN),qN}}class RN extends TN{buildAnimations(NN,BN,lN,kB){const qN=[];return qN.push({babylonAnimatable:NN._babylonTransformNode,babylonAnimation:this._buildAnimation(BN,lN,kB)}),qN}}class sN extends TN{buildAnimations(NN,BN,lN,qN){const cN=[];if(NN._numMorphTargets)for(let eN=0;eN<NN._numMorphTargets;eN++){const vN=new kB.c("".concat(BN,"_").concat(eN),this.name,lN,this.type);if(vN.setKeys(qN.map((NN=>({frame:NN.frame,inTangent:NN.inTangent?NN.inTangent[eN]:void 0,value:NN.value[eN],outTangent:NN.outTangent?NN.outTangent[eN]:void 0,interpolation:NN.interpolation})))),NN._primitiveBabylonMeshes)for(const BN of NN._primitiveBabylonMeshes)if(BN.morphTargetManager){const NN=BN.morphTargetManager.getTarget(eN),lN=vN.clone();NN.animations.push(lN),cN.push({babylonAnimatable:NN,babylonAnimation:lN})}}return cN}}(0,cN.l)("/nodes/{}/translation",[new RN(kB.c.ANIMATIONTYPE_VECTOR3,"position",eN,(()=>3))]),(0,cN.l)("/nodes/{}/rotation",[new RN(kB.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",vN,(()=>4))]),(0,cN.l)("/nodes/{}/scale",[new RN(kB.c.ANIMATIONTYPE_VECTOR3,"gc",eN,(()=>3))]),(0,cN.l)("/nodes/{}/weights",[new sN(kB.c.ANIMATIONTYPE_FLOAT,"influence",HN,(NN=>NN._numMorphTargets))])},15781:(NN,BN,lN)=>{"use strict";class kB{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((NN,BN)=>{this._resolve=NN,this._reject=BN}))}}var qN=lN(14925),cN=lN(14972),eN=lN(14727),vN=lN(15400),HN=lN(15783),TN=lN(15794),RN=lN(14731),sN=lN(15424),VN=lN(15471),fN=lN(15473),ZN=lN(14773),PN=lN(14746),CN=lN(14754);class FN{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(NN){this._useTextureToStoreBoneMatrices=NN,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(NN){this._animationPropertiesOverride=NN}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(NN,BN,lN){this.name=NN,this.id=BN,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=qN.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new RN.b,this.bones=[],this._scene=lN||ZN.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const kB=this._scene.getEngine().getCaps();this._canUseTextureForBones=kB.textureFloat&&kB.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((NN=>!NN.getParent()))}getTransformMatrices(NN){if(this.needInitialSkinMatrix){if(!NN)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return NN._bonesTransformMatrices||this.prepare(!0),NN._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(NN){return this.needInitialSkinMatrix&&NN._transformMatrixTexture?NN._transformMatrixTexture:this._transformMatrixTexture}VB(){return this._scene}toString(NN){let BN="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(BN+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),NN){BN+=", Ranges: {";let NN=!0;for(const lN in this._ranges)NN&&(BN+=", ",NN=!1),BN+=lN;BN+="}"}return BN}getBoneIndexByName(NN){for(let BN=0,lN=this.bones.length;BN<lN;BN++)if(this.bones[BN].name===NN)return BN;return-1}createAnimationRange(NN,BN,lN){if(!this._ranges[NN]){this._ranges[NN]=new fN.b(NN,BN,lN);for(let kB=0,qN=this.bones.length;kB<qN;kB++)this.bones[kB].animations[0]&&this.bones[kB].animations[0].createRange(NN,BN,lN)}}deleteAnimationRange(NN){let BN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let lN=0,kB=this.bones.length;lN<kB;lN++)this.bones[lN].animations[0]&&this.bones[lN].animations[0].deleteRange(NN,BN);this._ranges[NN]=null}getAnimationRange(NN){return this._ranges[NN]||null}getAnimationRanges(){const NN=[];let BN;for(BN in this._ranges)NN.push(this._ranges[BN]);return NN}copyAnimationRange(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[BN]||!NN.getAnimationRange(BN))return!1;let kB=!0;const qN=this._getHighestAnimationFrame()+1,cN={},eN=NN.bones;let vN,HN;for(HN=0,vN=eN.length;HN<vN;HN++)cN[eN[HN].name]=eN[HN];this.bones.length!==eN.length&&(PN.d.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(eN.length)),kB=!1);const TN=lN&&this.dimensionsAtRest&&NN.dimensionsAtRest?this.dimensionsAtRest.divide(NN.dimensionsAtRest):null;for(HN=0,vN=this.bones.length;HN<vN;HN++){const NN=this.bones[HN].name,eN=cN[NN];eN?kB=kB&&this.bones[HN].copyAnimationRange(eN,BN,qN,lN,TN):(PN.d.Warn("copyAnimationRange: not same rig, missing source bone "+NN),kB=!1)}const RN=NN.getAnimationRange(BN);return RN&&(this._ranges[BN]=new fN.b(BN,RN.from+qN,RN.to+qN)),kB}returnToRest(){for(const NN of this.bones)-1!==NN._index&&NN.returnToRest()}_getHighestAnimationFrame(){let NN=0;for(let BN=0,lN=this.bones.length;BN<lN;BN++)if(this.bones[BN].animations[0]){const lN=this.bones[BN].animations[0].getHighestFrame();NN<lN&&(NN=lN)}return NN}beginAnimation(NN,BN,lN,kB){const qN=this.getAnimationRange(NN);return qN?this._scene.beginAnimation(this,qN.from,qN.to,BN,lN,kB):null}static MakeAnimationAdditive(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lN=arguments.length>2?arguments[2]:void 0;const kB=NN.getAnimationRange(lN);if(!kB)return null;const qN=NN._scene.getAllAnimatablesByTarget(NN);let cN=null;for(let vN=0;vN<qN.length;vN++){const NN=qN[vN];if(NN.fromFrame===(null===kB||void 0===kB?void 0:kB.from)&&NN.toFrame===(null===kB||void 0===kB?void 0:kB.to)){cN=NN;break}}const eN=NN.getAnimatables();for(let vN=0;vN<eN.length;vN++){const NN=eN[vN].animations;if(NN)for(let kB=0;kB<NN.length;kB++)VN.c.MakeAnimationAdditive(NN[kB],BN,lN)}return cN&&(cN.isAdditive=!0),NN}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(NN){this._meshesWithPoseMatrix.push(NN)}_unregisterMeshWithPoseMatrix(NN){const BN=this._meshesWithPoseMatrix.indexOf(NN);BN>-1&&this._meshesWithPoseMatrix.splice(BN,1)}_computeTransformMatrices(NN,BN){this.onBeforeComputeObservable.notifyObservers(this);for(let lN=0;lN<this.bones.length;lN++){const kB=this.bones[lN];kB._childUpdateId++;const qN=kB.getParent();if(qN?kB.getLocalMatrix().multiplyToRef(qN.getFinalMatrix(),kB.getFinalMatrix()):BN?kB.getLocalMatrix().multiplyToRef(BN,kB.getFinalMatrix()):kB.getFinalMatrix().kB(kB.getLocalMatrix()),-1!==kB._index){const BN=null===kB._index?lN:kB._index;kB.getAbsoluteInverseBindMatrix().multiplyToArray(kB.getFinalMatrix(),NN,16*BN)}}this._identity.copyToArray(NN,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const NN=this.VB().getRenderId();if(this._currentRenderId===NN)return;this._currentRenderId=NN}if(this._numBonesWithLinkedTransformNode>0)for(const NN of this.bones)if(NN._linkedTransformNode){const BN=NN._linkedTransformNode;NN.position=BN.position,BN.rotationQuaternion?NN.rotationQuaternion=BN.rotationQuaternion:NN.rotation=BN.rotation,NN.gc=BN.gc}if(this.needInitialSkinMatrix)for(const NN of this._meshesWithPoseMatrix){const BN=NN.getPoseMatrix();let lN=this._isDirty;if(NN._bonesTransformMatrices&&NN._bonesTransformMatrices.length===16*(this.bones.length+1)||(NN._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),lN=!0),lN){if(this._synchronizedWithMesh!==NN){this._synchronizedWithMesh=NN;for(const NN of this.bones)if(!NN.getParent()){NN.getBindMatrix().multiplyToRef(BN,qN.TmpVectors.Matrix[1]),NN._updateAbsoluteBindMatrices(qN.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const BN=4*(this.bones.length+1);NN._transformMatrixTexture&&NN._transformMatrixTexture.getSize().width===BN||(NN._transformMatrixTexture&&NN._transformMatrixTexture.dispose(),NN._transformMatrixTexture=sN.d.CreateRGBATexture(NN._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(NN._bonesTransformMatrices,BN),this.isUsingTextureForMatrices&&NN._transformMatrixTexture&&NN._transformMatrixTexture.update(NN._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=sN.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let NN=0;NN<this.bones.length;NN++)this._animatables.push(this.bones[NN])}return this._animatables}clone(NN,BN){const lN=new FN(NN,BN||NN,this._scene);lN.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let kB=0;kB<this.bones.length;kB++){const NN=this.bones[kB];let BN=null;const qN=NN.getParent();if(qN){const NN=this.bones.indexOf(qN);BN=lN.bones[NN]}const cN=new TN.d(NN.name,lN,BN,NN.getBindMatrix().clone(),NN.getRestMatrix().clone());cN._index=NN._index,NN._linkedTransformNode&&cN.linkTransformNode(NN._linkedTransformNode),CN.b.DeepCopy(NN.animations,cN.animations)}if(this._ranges){lN._ranges={};for(const NN in this._ranges){const BN=this._ranges[NN];BN&&(lN._ranges[NN]=BN.clone())}}return this._isDirty=!0,lN.prepare(!0),lN}enableBlending(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const BN of this.bones)for(const lN of BN.animations)lN.enableBlending=!0,lN.blendingSpeed=NN}dispose(){if(this._meshesWithPoseMatrix.length=0,this.VB().stopAnimation(this),this.VB().removeSkeleton(this),this._parentContainer){const NN=this._parentContainer.skeletons.indexOf(this);NN>-1&&this._parentContainer.skeletons.splice(NN,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const NN={};NN.name=this.name,NN.id=this.id,this.dimensionsAtRest&&(NN.dimensionsAtRest=this.dimensionsAtRest.Fc()),NN.bones=[],NN.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let lN=0;lN<this.bones.length;lN++){var BN;const kB=this.bones[lN],qN=kB.getParent(),cN={parentBoneIndex:qN?this.bones.indexOf(qN):-1,index:kB.getIndex(),name:kB.name,id:kB.id,matrix:kB.getBindMatrix().Fc(),rest:kB.getRestMatrix().Fc(),linkedTransformNodeId:null===(BN=kB.getTransformNode())||void 0===BN?void 0:BN.id};NN.bones.push(cN),kB.length&&(cN.length=kB.length),kB.metadata&&(cN.metadata=kB.metadata),kB.animations&&kB.animations.length>0&&(cN.animation=kB.animations[0].serialize()),NN.ranges=[];for(const BN in this._ranges){const lN=this._ranges[BN];if(!lN)continue;const kB={};kB.name=BN,kB.from=lN.from,kB.to=lN.to,NN.ranges.push(kB)}}return NN}static Parse(NN,BN){const lN=new FN(NN.name,NN.id,BN);let kB;for(NN.dimensionsAtRest&&(lN.dimensionsAtRest=qN.fB.IB(NN.dimensionsAtRest)),lN.needInitialSkinMatrix=NN.needInitialSkinMatrix,kB=0;kB<NN.bones.length;kB++){const BN=NN.bones[kB],cN=NN.bones[kB].index;let eN=null;BN.parentBoneIndex>-1&&(eN=lN.bones[BN.parentBoneIndex]);const vN=BN.rest?qN.Matrix.IB(BN.rest):null,HN=new TN.d(BN.name,lN,eN,qN.Matrix.IB(BN.matrix),vN,null,cN);void 0!==BN.id&&null!==BN.id&&(HN.id=BN.id),BN.length&&(HN.length=BN.length),BN.metadata&&(HN.metadata=BN.metadata),BN.animation&&HN.animations.push(VN.c.Parse(BN.animation)),void 0!==BN.linkedTransformNodeId&&null!==BN.linkedTransformNodeId&&(lN._hasWaitingData=!0,HN._waitingTransformNodeId=BN.linkedTransformNodeId)}if(NN.ranges)for(kB=0;kB<NN.ranges.length;kB++){const BN=NN.ranges[kB];lN.createAnimationRange(BN.name,BN.from,BN.to)}return lN}computeAbsoluteMatrices(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||NN)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(NN)}getPoseMatrix(){let NN=null;return this._meshesWithPoseMatrix.length>0&&(NN=this._meshesWithPoseMatrix[0].getPoseMatrix()),NN}sortBones(){const NN=[],BN=new Array(this.bones.length);for(let lN=0;lN<this.bones.length;lN++)this._sortBones(lN,NN,BN);this.bones=NN}_sortBones(NN,BN,lN){if(lN[NN])return;lN[NN]=!0;const kB=this.bones[NN];if(!kB)return;void 0===kB._index&&(kB._index=NN);const qN=kB.getParent();qN&&this._sortBones(this.bones.indexOf(qN),BN,lN),BN.push(kB)}setCurrentPoseAsRest(){for(const NN of this.bones)NN.setCurrentPoseAsRest()}}var IN=lN(15259),AN=lN(15447),MN=lN(14898),GN=lN(15363),XN=lN(14998),uN=lN(15408),dN=lN(15375),EN=lN(15391),KN=lN(15478),gN=lN(15021),nN=lN(15801);class rN{set areUpdatesFrozen(NN){NN?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new gN.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,NN||(NN=ZN.b.LastCreatedScene),this._scene=NN,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const NN=this._scene.getEngine().getCaps();this._canUseTextureForTargets=NN.canUseGLVertexID&&NN.textureFloat&&NN.maxVertexTextureImageUnits>0&&NN.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return rN.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?rN.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(NN){this._numMaxInfluencers!==NN&&(this._numMaxInfluencers=NN,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(NN){this._useTextureToStoreTargets!==NN&&(this._useTextureToStoreTargets=NN,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var NN;return rN.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(NN=this._scene)&&void 0!==NN&&NN.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(NN){return this._activeTargets.data[NN]}getTarget(NN){return this._targets[NN]}getTargetByName(NN){for(const BN of this._targets)if(BN.name===NN)return BN;return null}addTarget(NN){this._targets.push(NN),this._targetInfluenceChangedObservers.push(NN.onInfluenceChanged.add((NN=>{this.areUpdatesFrozen&&NN&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(NN)}))),this._targetDataLayoutChangedObservers.push(NN._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(NN){const BN=this._targets.indexOf(NN);BN>=0&&(this._targets.splice(BN,1),NN.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(BN,1)[0]),NN._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(BN,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(NN)}_bind(NN){NN.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),NN.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),NN.setTexture("morphTargets",this._targetStoreTexture),NN.setInt("morphTargetCount",this.numInfluencers)}clone(){const NN=new rN(this._scene);for(const BN of this._targets)NN.addTarget(BN.clone());return NN.enablePositionMorphing=this.enablePositionMorphing,NN.enableNormalMorphing=this.enableNormalMorphing,NN.enableTangentMorphing=this.enableTangentMorphing,NN.enableUVMorphing=this.enableUVMorphing,NN.enableUV2Morphing=this.enableUV2Morphing,NN.enableColorMorphing=this.enableColorMorphing,NN}serialize(){const NN={};NN.id=this.uniqueId,NN.targets=[];for(const BN of this._targets)NN.targets.push(BN.serialize());return NN}_syncActiveTargets(){let NN=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const BN=!!this._targetStoreTexture,lN=this.isUsingTextureForTargets;(this._mustSynchronize||BN!==lN)&&(this._mustSynchronize=!1,this.synchronize());let kB=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let qN=-1;for(const cN of this._targets)if(qN++,0!==cN.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=rN.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(cN),this._morphTargetTextureIndices[kB]=qN,this._tempInfluences[kB++]=cN.influence}this._morphTargetTextureIndices.length!==kB&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,kB)),this._influences&&this._influences.length===kB||(this._influences=new Float32Array(kB));for(let cN=0;cN<kB;cN++)this._influences[cN]=this._tempInfluences[cN];if(NN&&this._scene)for(const cN of this._scene.meshes)cN.morphTargetManager===this&&(lN?cN._markSubMeshesAsAttributesDirty():cN._syncGeometryWithMorphTargetManager())}synchronize(){var NN;if(!this._scene||this.areUpdatesFrozen)return;const BN=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(NN=this._targetStoreTexture)||void 0===NN||NN.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>BN.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const lN of this._targets){this._supportsPositions=this._supportsPositions&&lN.hasPositions,this._supportsNormals=this._supportsNormals&&lN.hasNormals,this._supportsTangents=this._supportsTangents&&lN.hasTangents,this._supportsUVs=this._supportsUVs&&lN.hasUVs,this._supportsUV2s=this._supportsUV2s&&lN.hasUV2s,this._supportsColors=this._supportsColors&&lN.hasColors;const NN=lN.vertexCount;if(0===this._vertexCount)this._vertexCount=NN;else if(this._vertexCount!==NN)return void PN.d.Error("Incompatible target. Targets must all have the same vertices count. Current vertex count: ".concat(this._vertexCount,', vertex count for target "').concat(lN.name,'": ').concat(NN))}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const NN=BN.getCaps().maxTextureSize;this._textureWidth>NN&&(this._textureHeight=Math.ceil(this._textureWidth/NN),this._textureWidth=NN);const lN=this._targets.length,kB=new Float32Array(lN*this._textureWidth*this._textureHeight*4);let qN=0;for(let BN=0;BN<lN;BN++){const NN=this._targets[BN],lN=NN.getPositions(),cN=NN.getNormals(),eN=NN.getUVs(),vN=NN.getTangents(),HN=NN.getUV2s(),TN=NN.getColors();qN=BN*this._textureWidth*this._textureHeight*4;for(let BN=0;BN<this._vertexCount;BN++)this._supportsPositions&&lN&&(kB[qN]=lN[3*BN],kB[qN+1]=lN[3*BN+1],kB[qN+2]=lN[3*BN+2],qN+=4),this._supportsNormals&&cN&&(kB[qN]=cN[3*BN],kB[qN+1]=cN[3*BN+1],kB[qN+2]=cN[3*BN+2],qN+=4),this._supportsUVs&&eN&&(kB[qN]=eN[2*BN],kB[qN+1]=eN[2*BN+1],qN+=4),this._supportsTangents&&vN&&(kB[qN]=vN[3*BN],kB[qN+1]=vN[3*BN+1],kB[qN+2]=vN[3*BN+2],qN+=4),this._supportsUV2s&&HN&&(kB[qN]=HN[2*BN],kB[qN+1]=HN[2*BN+1],qN+=4),this._supportsColors&&TN&&(kB[qN]=TN[4*BN],kB[qN+1]=TN[4*BN+1],kB[qN+2]=TN[4*BN+2],kB[qN+3]=TN[4*BN+3],qN+=4)}this._targetStoreTexture=nN.b.CreateRGBATexture(kB,this._textureWidth,this._textureHeight,lN,this._scene,!1,!1,1,1),this._targetStoreTexture.name="Morph texture_".concat(this.uniqueId)}for(const lN of this._scene.meshes)lN.morphTargetManager===this&&lN._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const NN=this._parentContainer.morphTargetManagers.indexOf(this);NN>-1&&this._parentContainer.morphTargetManagers.splice(NN,1),this._parentContainer=null}for(const NN of this._targets)this._scene.stopAnimation(NN)}}static Parse(NN,BN){const lN=new rN(BN);for(const kB of NN.targets)lN.addTarget(KN.e.Parse(kB,BN));return lN}}rN.EnableTextureStorage=!0,rN.MaxActiveMorphTargetsInVertexAttributeMode=8,rN.ConstantTargetCountForTextureMode=0;var pN=lN(15805),xN=lN(14781),ON=lN(15280);const wN=new Map,bN=wN;function mB(NN,BN,lN){aN(NN)&&PN.d.Warn("Extension with the name '".concat(NN,"' already exists")),wN.set(NN,{isGLTFExtension:BN,factory:lN})}function aN(NN){return wN.delete(NN)}var DN=lN(15825),yN=lN(15529),LN=lN(15002);class hN{static Get(NN,BN,lN){if(!BN||void 0==lN||!BN[lN])throw new Error("".concat(NN,": Failed to find index (").concat(lN,")"));return BN[lN]}static TryGet(NN,BN){return NN&&void 0!=BN&&NN[BN]?NN[BN]:null}static Assign(NN){if(NN)for(let BN=0;BN<NN.length;BN++)NN[BN].index=BN}}function UN(NN){if(NN.min&&NN.max){const BN=NN.min,lN=NN.max,kB=qN.TmpVectors.fB[0].Kc(BN[0],BN[1],BN[2]),cN=qN.TmpVectors.fB[1].Kc(lN[0],lN[1],lN[2]);if(NN.normalized&&5126!==NN.componentType){let BN=1;switch(NN.componentType){case 5120:BN=127;break;case 5121:BN=255;break;case 5122:BN=32767;break;case 5123:BN=65535}const lN=1/BN;kB.scaleInPlace(lN),cN.scaleInPlace(lN)}return new ON.c(kB,cN)}return null}class WN{static RegisterExtension(NN,BN){mB(NN,!1,BN)}static UnregisterExtension(NN){return aN(NN)}get sc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(NN){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=NN}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((NN=>NN.dispose&&NN.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(NN,BN,lN,kB,qN,cN){let eN=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=BN,this._assetContainer=lN,this._loadData(kB);let cN=null;if(NN){const BN={};if(this._gltf.nodes)for(const NN of this._gltf.nodes)NN.name&&(BN[NN.name]=NN.index);cN=(NN instanceof Array?NN:[NN]).map((NN=>{const lN=BN[NN];if(void 0===lN)throw new Error("Failed to find node '".concat(NN,"'"));return lN}))}return await this._loadAsync(qN,eN,cN,(()=>({meshes:this._getMeshes(),kP:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=NN,this._loadData(BN),await this._loadAsync(lN,qN,null,(()=>{}))}async _loadAsync(NN,BN,lN,kB){return await Promise.resolve().then((async()=>{this._rootUrl=NN,this._uniqueRootUrl=!NN.startsWith("file:")&&BN?NN:"".concat(NN).concat(Date.now(),"/"),this._fileName=BN,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const qN="".concat(pN.j[pN.j.LOADING]," => ").concat(pN.j[pN.j.READY]),cN="".concat(pN.j[pN.j.LOADING]," => ").concat(pN.j[pN.j.COMPLETE]);this._parent._startPerformanceCounter(qN),this._parent._startPerformanceCounter(cN),this._parent._setState(pN.j.LOADING),this._extensionsOnLoading();const vN=new Array;if(!this.parent.loadOnlyMaterials)if(lN)vN.push(this.loadSceneAsync("/nodes",{nodes:lN,index:-1}));else if(void 0!=this._gltf.PB||this._gltf.scenes&&this._gltf.scenes[0]){const NN=hN.Get("/scene",this._gltf.scenes,this._gltf.PB||0);vN.push(this.loadSceneAsync("/scenes/".concat(NN.index),NN))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let NN=0;NN<this._gltf.materials.length;++NN){const BN=this._gltf.materials[NN],lN="/materials/"+NN,kB=IN.b.TriangleFillMode;vN.push(this._loadMaterialAsync(lN,BN,null,kB,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&vN.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&vN.push(this._compileShadowGeneratorsAsync());const HN=Promise.all(vN).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.DT(!0);for(const NN of this._babylonScene.materials){const BN=NN;void 0!==BN.maxSimultaneousLights&&(BN.maxSimultaneousLights=Math.max(BN.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(pN.j.READY),this._skipStartAnimationStep||this._startAnimations(),kB()}));return await HN.then((NN=>(this._parent._endPerformanceCounter(qN),eN.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(cN),this._parent._setState(pN.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(NN=>{this._parent.onErrorObservable.notifyObservers(NN),this._parent.onErrorObservable.clear(),this.dispose()}))})),NN)))})).catch((NN=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(NN),this._parent.onErrorObservable.clear(),this.dispose()),NN}))}_loadData(NN){if(this._gltf=NN.json,this._setupData(),NN.bin){const BN=this._gltf.buffers;if(BN&&BN[0]&&!BN[0].uri){const lN=BN[0];(lN.byteLength<NN.bin.byteLength-3||lN.byteLength>NN.bin.byteLength)&&PN.d.Warn("Binary buffer length (".concat(lN.byteLength,") from JSON does not match chunk length (").concat(NN.bin.byteLength,")")),this._bin=NN.bin}else PN.d.Warn("Unexpected BIN chunk")}}_setupData(){if(hN.Assign(this._gltf.accessors),hN.Assign(this._gltf.animations),hN.Assign(this._gltf.buffers),hN.Assign(this._gltf.bufferViews),hN.Assign(this._gltf.cameras),hN.Assign(this._gltf.images),hN.Assign(this._gltf.materials),hN.Assign(this._gltf.meshes),hN.Assign(this._gltf.nodes),hN.Assign(this._gltf.samplers),hN.Assign(this._gltf.scenes),hN.Assign(this._gltf.skins),hN.Assign(this._gltf.textures),this._gltf.nodes){const NN={};for(const lN of this._gltf.nodes)if(lN.children)for(const BN of lN.children)NN[BN]=lN.index;const BN=this._createRootNode();for(const lN of this._gltf.nodes){const kB=NN[lN.index];lN.parent=void 0===kB?BN:this._gltf.nodes[kB]}}}async _loadExtensionsAsync(){const NN=[];if(bN.forEach(((BN,lN)=>{var kB;!1===(null===(kB=this.parent.extensionOptions[lN])||void 0===kB?void 0:kB.enabled)?BN.isGLTFExtension&&this.isExtensionUsed(lN)&&PN.d.Warn("Extension ".concat(lN," is used but has been explicitly disabled.")):BN.isGLTFExtension&&!this.isExtensionUsed(lN)||NN.push((async()=>{const NN=await BN.factory(this);return NN.name!==lN&&PN.d.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(NN.name," !== ").concat(lN)),this._parent.onExtensionLoadedObservable.notifyObservers(NN),NN})())})),this._extensions.push(...await Promise.all(NN)),this._extensions.sort(((NN,BN)=>(NN.order||Number.MAX_VALUE)-(BN.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const lN of this._gltf.extensionsRequired){if(!this._extensions.some((NN=>NN.name===lN&&NN.enabled))){var BN;if(!1===(null===(BN=this.parent.extensionOptions[lN])||void 0===BN?void 0:BN.enabled))throw new Error("Required extension ".concat(lN," is disabled"));throw new Error("Required extension ".concat(lN," is not available"))}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const NN=new EN.e("__root__",this._babylonScene);this._rootBabylonMesh=NN,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.DT(!1);const BN={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case pN.i.AUTO:this._babylonScene.useRightHandedSystem||(BN.rotation=[0,1,0,0],BN.scale=[1,1,-1],WN._LoadTransform(BN,this._rootBabylonMesh));break;case pN.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(NN),BN}loadSceneAsync(NN,BN){const lN=this._extensionsLoadSceneAsync(NN,BN);if(lN)return lN;const kB=new Array;if(this.logOpen("".concat(NN," ").concat(BN.name||"")),BN.nodes)for(const qN of BN.nodes){const BN=hN.Get("".concat(NN,"/nodes/").concat(qN),this._gltf.nodes,qN);kB.push(this.loadNodeAsync("/nodes/".concat(BN.index),BN,(NN=>{NN.parent=this._rootBabylonMesh})))}for(const qN of this._postSceneLoadActions)qN();return kB.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(kB).then((()=>{}))}_forEachPrimitive(NN,BN){if(NN._primitiveBabylonMeshes)for(const lN of NN._primitiveBabylonMeshes)BN(lN)}_getGeometries(){const NN=[],BN=this._gltf.nodes;if(BN)for(const lN of BN)this._forEachPrimitive(lN,(BN=>{const lN=BN.dc;lN&&-1===NN.indexOf(lN)&&NN.push(lN)}));return NN}_getMeshes(){const NN=[];this._rootBabylonMesh instanceof dN.e&&NN.push(this._rootBabylonMesh);const BN=this._gltf.nodes;if(BN)for(const lN of BN)this._forEachPrimitive(lN,(BN=>{NN.push(BN)}));return NN}_getTransformNodes(){const NN=[],BN=this._gltf.nodes;if(BN)for(const lN of BN)lN._babylonTransformNode&&"Mf"===lN._babylonTransformNode.getClassName()&&NN.push(lN._babylonTransformNode),lN._babylonTransformNodeForSkin&&NN.push(lN._babylonTransformNodeForSkin);return NN}_getSkeletons(){const NN=[],BN=this._gltf.skins;if(BN)for(const lN of BN)lN._data&&NN.push(lN._data.babylonSkeleton);return NN}_getAnimationGroups(){const NN=[],BN=this._gltf.animations;if(BN)for(const lN of BN)lN._babylonAnimationGroup&&NN.push(lN._babylonAnimationGroup);return NN}_startAnimations(){switch(this._parent.animationStartMode){case pN.g.NONE:break;case pN.g.FIRST:{const NN=this._getAnimationGroups();0!==NN.length&&NN[0].start(!0);break}case pN.g.ALL:{const NN=this._getAnimationGroups();for(const BN of NN)BN.start(!0);break}default:return void PN.d.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}}loadNodeAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const kB=this._extensionsLoadNodeAsync(NN,BN,lN);if(kB)return kB;if(BN._babylonTransformNode)throw new Error("".concat(NN,": Invalid recursive node hierarchy"));const qN=new Array;this.logOpen("".concat(NN," ").concat(BN.name||""));const cN=kB=>{if(WN.AddPointerMetadata(kB,NN),WN._LoadTransform(BN,kB),void 0!=BN.camera){const lN=hN.Get("".concat(NN,"/camera"),this._gltf.cameras,BN.camera);qN.push(this.loadCameraAsync("/cameras/".concat(lN.index),lN,(NN=>{NN.parent=kB,this._babylonScene.useRightHandedSystem||(kB.gc.x=-1)})))}if(BN.children)for(const lN of BN.children){const BN=hN.Get("".concat(NN,"/children/").concat(lN),this._gltf.nodes,lN);qN.push(this.loadNodeAsync("/nodes/".concat(BN.index),BN,(NN=>{NN.parent=kB})))}lN(kB)},eN=void 0!=BN.mesh,vN=this._parent.loadSkins&&void 0!=BN.skin;if(!eN||vN){const NN=BN.name||"node".concat(BN.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const lN=new GN.e(NN,this._babylonScene);lN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==BN.mesh?BN._babylonTransformNode=lN:BN._babylonTransformNodeForSkin=lN,cN(lN)}if(eN)if(vN){const lN=hN.Get("".concat(NN,"/mesh"),this._gltf.meshes,BN.mesh);qN.push(this._loadMeshAsync("/meshes/".concat(lN.index),BN,lN,(lN=>{const kB=BN._babylonTransformNodeForSkin;lN.metadata=(0,yN.e)(kB.metadata,lN.metadata||{});const cN=hN.Get("".concat(NN,"/skin"),this._gltf.skins,BN.skin);qN.push(this._loadSkinAsync("/skins/".concat(cN.index),BN,cN,(NN=>{this._forEachPrimitive(BN,(BN=>{BN.skeleton=NN})),this._postSceneLoadActions.push((()=>{if(void 0!=cN.skeleton){const NN=hN.Get("/skins/".concat(cN.index,"/skeleton"),this._gltf.nodes,cN.skeleton).parent;BN.index===NN.index?lN.parent=kB.parent:lN.parent=NN._babylonTransformNode}else lN.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:kB,skinnedNode:lN})}))})))})))}else{const lN=hN.Get("".concat(NN,"/mesh"),this._gltf.meshes,BN.mesh);qN.push(this._loadMeshAsync("/meshes/".concat(lN.index),BN,lN,cN))}return this.logClose(),Promise.all(qN).then((()=>(this._forEachPrimitive(BN,(NN=>{const BN=NN;!BN.isAnInstance&&BN.dc&&BN.dc.useBoundingInfoFromGeometry?NN._updateBoundingInfo():NN.refreshBoundingInfo(!0,!0)})),BN._babylonTransformNode)))}_loadMeshAsync(NN,BN,lN,kB){const qN=lN.primitives;if(!qN||!qN.length)throw new Error("".concat(NN,": Primitives are missing"));void 0==qN[0].index&&hN.Assign(qN);const cN=new Array;this.logOpen("".concat(NN," ").concat(lN.name||""));const eN=BN.name||"node".concat(BN.index);if(1===qN.length){const kB=lN.primitives[0];cN.push(this._loadMeshPrimitiveAsync("".concat(NN,"/primitives/").concat(kB.index),eN,BN,lN,kB,(NN=>{BN._babylonTransformNode=NN,BN._primitiveBabylonMeshes=[NN]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,BN._babylonTransformNode=new GN.e(eN,this._babylonScene),BN._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,BN._primitiveBabylonMeshes=[];for(const kB of qN)cN.push(this._loadMeshPrimitiveAsync("".concat(NN,"/primitives/").concat(kB.index),"".concat(eN,"_primitive").concat(kB.index),BN,lN,kB,(NN=>{NN.parent=BN._babylonTransformNode,BN._primitiveBabylonMeshes.push(NN)})))}return kB(BN._babylonTransformNode),this.logClose(),Promise.all(cN).then((()=>BN._babylonTransformNode))}_loadMeshPrimitiveAsync(NN,BN,lN,kB,qN,cN){const eN=this._extensionsLoadMeshPrimitiveAsync(NN,BN,lN,kB,qN,cN);if(eN)return eN;this.logOpen("".concat(NN));const vN=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==lN.skin&&!kB.primitives[0].targets;let HN,TN;if(vN&&qN._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,HN=qN._instanceData.babylonSourceMesh.createInstance(BN),HN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,TN=qN._instanceData.promise;else{const cN=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const eN=new EN.e(BN,this._babylonScene);eN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,eN.sideOrientation=this._babylonScene.useRightHandedSystem?IN.b.CounterClockWiseSideOrientation:IN.b.ClockWiseSideOrientation,this._createMorphTargets(NN,lN,kB,qN,eN),cN.push(this._loadVertexDataAsync(NN,qN,eN).then((async BN=>await this._loadMorphTargetsAsync(NN,qN,eN,BN).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,BN.applyToMesh(eN),BN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const RN=WN._GetDrawMode(NN,qN.mode);if(void 0==qN.material){let NN=this._defaultBabylonMaterialData[RN];NN||(NN=this._createDefaultMaterial("__GLTFLoader._default",RN),this._parent.onMaterialLoadedObservable.notifyObservers(NN),this._defaultBabylonMaterialData[RN]=NN),eN.material=NN}else if(!this.parent.skipMaterials){const BN=hN.Get("".concat(NN,"/material"),this._gltf.materials,qN.material);cN.push(this._loadMaterialAsync("/materials/".concat(BN.index),BN,eN,RN,(NN=>{eN.material=NN})))}TN=Promise.all(cN),vN&&(qN._instanceData={babylonSourceMesh:eN,promise:TN}),HN=eN}return WN.AddPointerMetadata(HN,NN),this._parent.onMeshLoadedObservable.notifyObservers(HN),cN(HN),this.logClose(),TN.then((()=>HN))}_loadVertexDataAsync(NN,BN,lN){const kB=this._extensionsLoadVertexDataAsync(NN,BN,lN);if(kB)return kB;const qN=BN.attributes;if(!qN)throw new Error("".concat(NN,": Attributes are missing"));const cN=new Array,eN=new uN.c(lN.name,this._babylonScene);if(void 0==BN.indices)lN.isUnIndexed=!0;else{const lN=hN.Get("".concat(NN,"/indices"),this._gltf.accessors,BN.indices);cN.push(this._loadIndicesAccessorAsync("/accessors/".concat(lN.index),lN).then((NN=>{eN.setIndices(NN)})))}const vN=(BN,kB,vN)=>{if(void 0==qN[BN])return;lN._delayInfo=lN._delayInfo||[],-1===lN._delayInfo.indexOf(kB)&&lN._delayInfo.push(kB);const HN=hN.Get("".concat(NN,"/attributes/").concat(BN),this._gltf.accessors,qN[BN]);cN.push(this._loadVertexAccessorAsync("/accessors/".concat(HN.index),HN,kB).then((NN=>{if(NN.getKind()===XN.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!lN.skeleton){const NN=UN(HN);NN&&(eN._boundingInfo=NN,eN.useBoundingInfoFromGeometry=!0)}eN.setVerticesBuffer(NN,HN.count)}))),kB==XN.f.MatricesIndicesExtraKind&&(lN.numBoneInfluencers=8),vN&&vN(HN)};return vN("POSITION",XN.f.PositionKind),vN("NORMAL",XN.f.NormalKind),vN("TANGENT",XN.f.TangentKind),vN("TEXCOORD_0",XN.f.UVKind),vN("TEXCOORD_1",XN.f.UV2Kind),vN("TEXCOORD_2",XN.f.UV3Kind),vN("TEXCOORD_3",XN.f.UV4Kind),vN("TEXCOORD_4",XN.f.UV5Kind),vN("TEXCOORD_5",XN.f.UV6Kind),vN("JOINTS_0",XN.f.MatricesIndicesKind),vN("WEIGHTS_0",XN.f.MatricesWeightsKind),vN("JOINTS_1",XN.f.MatricesIndicesExtraKind),vN("WEIGHTS_1",XN.f.MatricesWeightsExtraKind),vN("COLOR_0",XN.f.ColorKind,(NN=>{"VEC4"===NN.type&&(lN.hasVertexAlpha=!0)})),Promise.all(cN).then((()=>eN))}_createMorphTargets(NN,BN,lN,kB,qN){if(!kB.targets||!this._parent.loadMorphTargets)return;if(void 0==BN._numMorphTargets)BN._numMorphTargets=kB.targets.length;else if(kB.targets.length!==BN._numMorphTargets)throw new Error("".concat(NN,": Primitives do not have the same number of targets"));const cN=lN.extras?lN.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,qN.morphTargetManager=new rN(this._babylonScene),qN.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,qN.morphTargetManager.areUpdatesFrozen=!0;for(let eN=0;eN<kB.targets.length;eN++){const NN=BN.weights?BN.weights[eN]:lN.weights?lN.weights[eN]:0,kB=cN?cN[eN]:"morphTarget".concat(eN);qN.morphTargetManager.addTarget(new KN.e(kB,NN,qN.VB()))}}_loadMorphTargetsAsync(NN,BN,lN,kB){if(!BN.targets||!this._parent.loadMorphTargets)return Promise.resolve();const qN=new Array,cN=lN.morphTargetManager;for(let eN=0;eN<cN.numTargets;eN++){const lN=cN.getTarget(eN);qN.push(this._loadMorphTargetVertexDataAsync("".concat(NN,"/targets/").concat(eN),kB,BN.targets[eN],lN))}return Promise.all(qN).then((()=>{cN.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(NN,BN,lN,kB){const qN=new Array,cN=(kB,cN,eN)=>{if(void 0==lN[kB])return;const vN=BN.getVertexBuffer(cN);if(!vN)return;const HN=hN.Get("".concat(NN,"/").concat(kB),this._gltf.accessors,lN[kB]);qN.push(this._loadFloatAccessorAsync("/accessors/".concat(HN.index),HN).then((NN=>{eN(vN,NN)})))};return cN("POSITION",XN.f.PositionKind,((NN,BN)=>{const lN=new Float32Array(BN.length);NN.forEach(BN.length,((NN,kB)=>{lN[kB]=BN[kB]+NN})),kB.setPositions(lN)})),cN("NORMAL",XN.f.NormalKind,((NN,BN)=>{const lN=new Float32Array(BN.length);NN.forEach(lN.length,((NN,kB)=>{lN[kB]=BN[kB]+NN})),kB.setNormals(lN)})),cN("TANGENT",XN.f.TangentKind,((NN,BN)=>{const lN=new Float32Array(BN.length/3*4);let qN=0;NN.forEach(BN.length/3*4,((NN,kB)=>{(kB+1)%4!==0&&(lN[qN]=BN[qN]+NN,qN++)})),kB.setTangents(lN)})),cN("TEXCOORD_0",XN.f.UVKind,((NN,BN)=>{const lN=new Float32Array(BN.length);NN.forEach(BN.length,((NN,kB)=>{lN[kB]=BN[kB]+NN})),kB.setUVs(lN)})),cN("TEXCOORD_1",XN.f.UV2Kind,((NN,BN)=>{const lN=new Float32Array(BN.length);NN.forEach(BN.length,((NN,kB)=>{lN[kB]=BN[kB]+NN})),kB.setUV2s(lN)})),cN("COLOR_0",XN.f.ColorKind,((BN,lN)=>{let qN=null;const cN=BN.getSize();if(3===cN){qN=new Float32Array(lN.length/3*4),BN.forEach(lN.length,((NN,BN)=>{const kB=Math.floor(BN/3),cN=BN%3;qN[4*kB+cN]=lN[3*kB+cN]+NN}));for(let NN=0;NN<lN.length/3;++NN)qN[4*NN+3]=1}else{if(4!==cN)throw new Error("".concat(NN,": Invalid number of components (").concat(cN,") for COLOR_0 attribute"));qN=new Float32Array(lN.length),BN.forEach(lN.length,((NN,BN)=>{qN[BN]=lN[BN]+NN}))}kB.setColors(qN)})),await Promise.all(qN).then((()=>{}))}static _LoadTransform(NN,BN){if(void 0!=NN.skin)return;let lN=qN.fB.Zero(),kB=qN.Quaternion.Identity(),cN=qN.fB.One();if(NN.matrix){qN.Matrix.IB(NN.matrix).decompose(cN,kB,lN)}else NN.translation&&(lN=qN.fB.IB(NN.translation)),NN.rotation&&(kB=qN.Quaternion.IB(NN.rotation)),NN.scale&&(cN=qN.fB.IB(NN.scale));BN.position=lN,BN.rotationQuaternion=kB,BN.gc=cN}_loadSkinAsync(NN,BN,lN,kB){if(!this._parent.loadSkins)return Promise.resolve();const qN=this._extensionsLoadSkinAsync(NN,BN,lN);if(qN)return qN;if(lN._data)return kB(lN._data.babylonSkeleton),lN._data.promise;const cN="skeleton".concat(lN.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const eN=new FN(lN.name||cN,cN,this._babylonScene);eN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(NN,lN,eN);const vN=this._loadSkinInverseBindMatricesDataAsync(NN,lN).then((NN=>{this._updateBoneMatrices(eN,NN)}));return lN._data={babylonSkeleton:eN,promise:vN},kB(eN),vN}_loadBones(NN,BN,lN){if(void 0==BN.skeleton||this._parent.alwaysComputeSkeletonRootNode){const lN=this._findSkeletonRootNode("".concat(NN,"/joints"),BN.joints);if(lN)if(void 0===BN.skeleton)BN.skeleton=lN.index;else{const kB=(NN,BN)=>{for(;BN.parent;BN=BN.parent)if(BN.parent===NN)return!0;return!1},qN=hN.Get("".concat(NN,"/skeleton"),this._gltf.nodes,BN.skeleton);qN===lN||kB(qN,lN)||(PN.d.Warn("".concat(NN,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),BN.skeleton=lN.index)}else PN.d.Warn("".concat(NN,": Failed to find common root"))}const kB={};for(const qN of BN.joints){const cN=hN.Get("".concat(NN,"/joints/").concat(qN),this._gltf.nodes,qN);this._loadBone(cN,BN,lN,kB)}}_findSkeletonRootNode(NN,BN){if(0===BN.length)return null;const lN={};for(const qN of BN){const BN=[];let kB=hN.Get("".concat(NN,"/").concat(qN),this._gltf.nodes,qN);for(;-1!==kB.index;)BN.unshift(kB),kB=kB.parent;lN[qN]=BN}let kB=null;for(let qN=0;;++qN){let NN=lN[BN[0]];if(qN>=NN.length)return kB;const cN=NN[qN];for(let eN=1;eN<BN.length;++eN)if(NN=lN[BN[eN]],qN>=NN.length||cN!==NN[qN])return kB;kB=cN}}_loadBone(NN,BN,lN,kB){NN._isJoint=!0;let qN=kB[NN.index];if(qN)return qN;let cN=null;NN.index!==BN.skeleton&&(NN.parent&&-1!==NN.parent.index?cN=this._loadBone(NN.parent,BN,lN,kB):void 0!==BN.skeleton&&PN.d.Warn("/skins/".concat(BN.index,"/skeleton: Skeleton node is not a common root")));const eN=BN.joints.indexOf(NN.index);return qN=new TN.d(NN.name||"joint".concat(NN.index),lN,cN,this._getNodeMatrix(NN),null,null,eN),kB[NN.index]=qN,this._postSceneLoadActions.push((()=>{qN.linkTransformNode(NN._babylonTransformNode)})),qN}_loadSkinInverseBindMatricesDataAsync(NN,BN){if(void 0==BN.inverseBindMatrices)return Promise.resolve(null);const lN=hN.Get("".concat(NN,"/inverseBindMatrices"),this._gltf.accessors,BN.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(lN.index),lN)}_updateBoneMatrices(NN,BN){for(const lN of NN.bones){const NN=qN.Matrix.Identity(),kB=lN._index;BN&&-1!==kB&&(qN.Matrix.FromArrayToRef(BN,16*kB,NN),NN.invertToRef(NN));const cN=lN.getParent();cN&&NN.multiplyToRef(cN.getAbsoluteInverseBindMatrix(),NN),lN.Xc(NN,!1,!1),lN._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(NN){return NN.matrix?qN.Matrix.IB(NN.matrix):qN.Matrix.Compose(NN.scale?qN.fB.IB(NN.scale):qN.fB.One(),NN.rotation?qN.Quaternion.IB(NN.rotation):qN.Quaternion.Identity(),NN.translation?qN.fB.IB(NN.translation):qN.fB.Zero())}loadCameraAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const kB=this._extensionsLoadCameraAsync(NN,BN,lN);if(kB)return kB;const cN=new Array;this.logOpen("".concat(NN," ").concat(BN.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;const eN=new HN.e(BN.name||"camera".concat(BN.index),qN.fB.Zero(),this._babylonScene,!1);switch(eN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,BN._babylonCamera=eN,eN.setTarget(new qN.fB(0,0,-1)),BN.type){case"perspective":{const lN=BN.perspective;if(!lN)throw new Error("".concat(NN,": Camera perspective properties are missing"));eN.fov=lN.yfov,eN.Mc=lN.znear,eN.Gc=lN.zfar||0;break}case"orthographic":if(!BN.orthographic)throw new Error("".concat(NN,": Camera orthographic properties are missing"));eN.mode=vN.c.ORTHOGRAPHIC_CAMERA,eN.orthoLeft=-BN.orthographic.xmag,eN.orthoRight=BN.orthographic.xmag,eN.orthoBottom=-BN.orthographic.ymag,eN.orthoTop=BN.orthographic.ymag,eN.Mc=BN.orthographic.znear,eN.Gc=BN.orthographic.zfar;break;default:throw new Error("".concat(NN,": Invalid camera type (").concat(BN.type,")"))}return WN.AddPointerMetadata(eN,NN),this._parent.onCameraLoadedObservable.notifyObservers(eN),lN(eN),this.logClose(),Promise.all(cN).then((()=>eN))}_loadAnimationsAsync(){const NN=this._gltf.animations;if(!NN)return Promise.resolve();const BN=new Array;for(let lN=0;lN<NN.length;lN++){const kB=NN[lN];BN.push(this.loadAnimationAsync("/animations/".concat(kB.index),kB).then((NN=>{0===NN.targetedAnimations.length&&NN.dispose()})))}return Promise.all(BN).then((()=>{}))}loadAnimationAsync(NN,BN){const kB=this._extensionsLoadAnimationAsync(NN,BN);return kB||lN.e(78).then(lN.bind(lN,17795)).then((lN=>{let{AnimationGroup:kB}=lN;this._babylonScene._blockEntityCollection=!!this._assetContainer;const qN=new kB(BN.name||"animation".concat(BN.index),this._babylonScene);qN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,BN._babylonAnimationGroup=qN;const cN=new Array;hN.Assign(BN.channels),hN.Assign(BN.samplers);for(const eN of BN.channels)cN.push(this._loadAnimationChannelAsync("".concat(NN,"/channels/").concat(eN.index),NN,BN,eN,((NN,BN)=>{NN.animations=NN.animations||[],NN.animations.push(BN),qN.addTargetedAnimation(BN,NN)})));return Promise.all(cN).then((()=>(qN.normalize(0),qN)))}))}async _loadAnimationChannelAsync(NN,BN,kB,qN,cN){const eN=this._extensionsLoadAnimationChannelAsync(NN,BN,kB,qN,cN);if(eN)return await eN;if(void 0==qN.target.node)return await Promise.resolve();const vN=hN.Get("".concat(NN,"/target/node"),this._gltf.nodes,qN.target.node),HN=qN.target.path,TN="weights"===HN;if(TN&&!vN._numMorphTargets||!TN&&!vN._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!TN&&!vN._isJoint)return await Promise.resolve();let RN;switch(await Promise.resolve().then(lN.bind(lN,15835)),HN){case"translation":var sN;RN=null===(sN=(0,DN.g)("/nodes/{}/translation"))||void 0===sN?void 0:sN.interpolation;break;case"rotation":var VN;RN=null===(VN=(0,DN.g)("/nodes/{}/rotation"))||void 0===VN?void 0:VN.interpolation;break;case"scale":var fN;RN=null===(fN=(0,DN.g)("/nodes/{}/scale"))||void 0===fN?void 0:fN.interpolation;break;case"weights":var ZN;RN=null===(ZN=(0,DN.g)("/nodes/{}/weights"))||void 0===ZN?void 0:ZN.interpolation;break;default:throw new Error("".concat(NN,"/target/path: Invalid value (").concat(qN.target.path,")"))}if(!RN)throw new Error("".concat(NN,"/target/path: Could not find interpolation properties for target path (").concat(qN.target.path,")"));const PN={object:vN,info:RN};return await this._loadAnimationChannelFromTargetInfoAsync(NN,BN,kB,qN,PN,cN)}_loadAnimationChannelFromTargetInfoAsync(NN,BN,lN,kB,qN,cN){const eN=this.parent.targetFps,vN=1/eN,HN=hN.Get("".concat(NN,"/sampler"),lN.samplers,kB.sampler);return this._loadAnimationSamplerAsync("".concat(BN,"/samplers/").concat(kB.sampler),HN).then((NN=>{let BN=0;const HN=qN.object,TN=qN.info;for(const qN of TN){const TN=qN.getStride(HN),RN=NN.input,sN=NN.output,VN=new Array(RN.length);let fN=0;switch(NN.interpolation){case"STEP":for(let NN=0;NN<RN.length;NN++){const BN=qN.getValue(HN,sN,fN,1);fN+=TN,VN[NN]={frame:RN[NN]*eN,value:BN,interpolation:1}}break;case"CUBICSPLINE":for(let NN=0;NN<RN.length;NN++){const BN=qN.getValue(HN,sN,fN,vN);fN+=TN;const lN=qN.getValue(HN,sN,fN,1);fN+=TN;const kB=qN.getValue(HN,sN,fN,vN);fN+=TN,VN[NN]={frame:RN[NN]*eN,inTangent:BN,value:lN,outTangent:kB}}break;case"LINEAR":for(let NN=0;NN<RN.length;NN++){const BN=qN.getValue(HN,sN,fN,1);fN+=TN,VN[NN]={frame:RN[NN]*eN,value:BN}}}if(fN>0){const NN="".concat(lN.name||"animation".concat(lN.index),"_channel").concat(kB.index,"_").concat(BN),vN=qN.buildAnimations(HN,NN,eN,VN);for(const lN of vN)BN++,cN(lN.babylonAnimatable,lN.babylonAnimation)}}}))}_loadAnimationSamplerAsync(NN,BN){if(BN._data)return BN._data;const lN=BN.interpolation||"LINEAR";switch(lN){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(NN,"/interpolation: Invalid value (").concat(BN.interpolation,")"))}const kB=hN.Get("".concat(NN,"/input"),this._gltf.accessors,BN.input),qN=hN.Get("".concat(NN,"/output"),this._gltf.accessors,BN.output);return BN._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(kB.index),kB),this._loadFloatAccessorAsync("/accessors/".concat(qN.index),qN)]).then((NN=>{let[BN,kB]=NN;return{input:BN,interpolation:lN,output:kB}})),BN._data}loadBufferAsync(NN,BN,lN,kB){const qN=this._extensionsLoadBufferAsync(NN,BN,lN,kB);if(qN)return qN;if(!BN._data)if(BN.uri)BN._data=this.loadUriAsync("".concat(NN,"/uri"),BN,BN.uri);else{if(!this._bin)throw new Error("".concat(NN,": Uri is missing or the binary glTF is missing its binary chunk"));BN._data=this._bin.readAsync(0,BN.byteLength)}return BN._data.then((BN=>{try{return new Uint8Array(BN.buffer,BN.byteOffset+lN,kB)}catch(qN){throw new Error("".concat(NN,": ").concat(qN.message))}}))}loadBufferViewAsync(NN,BN){const lN=this._extensionsLoadBufferViewAsync(NN,BN);if(lN)return lN;if(BN._data)return BN._data;const kB=hN.Get("".concat(NN,"/buffer"),this._gltf.buffers,BN.buffer);return BN._data=this.loadBufferAsync("/buffers/".concat(kB.index),kB,BN.byteOffset||0,BN.byteLength),BN._data}_loadAccessorAsync(NN,BN,lN){if(BN._data)return BN._data;const kB=WN._GetNumComponents(NN,BN.type),qN=kB*XN.f.GetTypeByteLength(BN.componentType),cN=kB*BN.count;if(void 0==BN.bufferView)BN._data=Promise.resolve(new lN(cN));else{const eN=hN.Get("".concat(NN,"/bufferView"),this._gltf.bufferViews,BN.bufferView);BN._data=this.loadBufferViewAsync("/bufferViews/".concat(eN.index),eN).then((vN=>{if(5126!==BN.componentType||BN.normalized||eN.byteStride&&eN.byteStride!==qN){const NN=new lN(cN);return XN.f.ForEach(vN,BN.byteOffset||0,eN.byteStride||qN,kB,BN.componentType,NN.length,BN.normalized||!1,((BN,lN)=>{NN[lN]=BN})),NN}return WN._GetTypedArray(NN,BN.componentType,vN,BN.byteOffset,cN)}))}if(BN.sparse){const cN=BN.sparse;BN._data=BN._data.then((eN=>{const vN=eN,HN=hN.Get("".concat(NN,"/sparse/indices/bufferView"),this._gltf.bufferViews,cN.indices.bufferView),TN=hN.Get("".concat(NN,"/sparse/values/bufferView"),this._gltf.bufferViews,cN.values.bufferView);return Promise.all([this.loadBufferViewAsync("/bufferViews/".concat(HN.index),HN),this.loadBufferViewAsync("/bufferViews/".concat(TN.index),TN)]).then((eN=>{let[HN,TN]=eN;const RN=WN._GetTypedArray("".concat(NN,"/sparse/indices"),cN.indices.componentType,HN,cN.indices.byteOffset,cN.count),sN=kB*cN.count;let VN;if(5126!==BN.componentType||BN.normalized){const eN=WN._GetTypedArray("".concat(NN,"/sparse/values"),BN.componentType,TN,cN.values.byteOffset,sN);VN=new lN(sN),XN.f.ForEach(eN,0,qN,kB,BN.componentType,VN.length,BN.normalized||!1,((NN,BN)=>{VN[BN]=NN}))}else VN=WN._GetTypedArray("".concat(NN,"/sparse/values"),BN.componentType,TN,cN.values.byteOffset,sN);let fN=0;for(let NN=0;NN<RN.length;NN++){let BN=RN[NN]*kB;for(let NN=0;NN<kB;NN++)vN[BN++]=VN[fN++]}return vN}))}))}return BN._data}_loadFloatAccessorAsync(NN,BN){return this._loadAccessorAsync(NN,BN,Float32Array)}_loadIndicesAccessorAsync(NN,BN){if("SCALAR"!==BN.type)throw new Error("".concat(NN,"/type: Invalid value ").concat(BN.type));if(5121!==BN.componentType&&5123!==BN.componentType&&5125!==BN.componentType)throw new Error("".concat(NN,"/componentType: Invalid value ").concat(BN.componentType));if(BN._data)return BN._data;if(BN.sparse){const lN=WN._GetTypedArrayConstructor("".concat(NN,"/componentType"),BN.componentType);BN._data=this._loadAccessorAsync(NN,BN,lN)}else{const lN=hN.Get("".concat(NN,"/bufferView"),this._gltf.bufferViews,BN.bufferView);BN._data=this.loadBufferViewAsync("/bufferViews/".concat(lN.index),lN).then((lN=>WN._GetTypedArray(NN,BN.componentType,lN,BN.byteOffset,BN.count)))}return BN._data}_loadVertexBufferViewAsync(NN){if(NN._babylonBuffer)return NN._babylonBuffer;const BN=this._babylonScene.getEngine();return NN._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(NN.index),NN).then((NN=>new XN.e(BN,NN,!1))),NN._babylonBuffer}_loadVertexAccessorAsync(NN,BN,lN){var kB;if(null!==(kB=BN._babylonVertexBuffer)&&void 0!==kB&&kB[lN])return BN._babylonVertexBuffer[lN];BN._babylonVertexBuffer||(BN._babylonVertexBuffer={});const qN=this._babylonScene.getEngine();if(BN.sparse||void 0==BN.bufferView)BN._babylonVertexBuffer[lN]=this._loadFloatAccessorAsync(NN,BN).then((NN=>new XN.f(qN,NN,lN,!1)));else{const kB=hN.Get("".concat(NN,"/bufferView"),this._gltf.bufferViews,BN.bufferView);BN._babylonVertexBuffer[lN]=this._loadVertexBufferViewAsync(kB).then((cN=>{const eN=WN._GetNumComponents(NN,BN.type);return new XN.f(qN,cN,lN,!1,void 0,kB.byteStride,void 0,BN.byteOffset,eN,BN.componentType,BN.normalized,!0,void 0,!0)}))}return BN._babylonVertexBuffer[lN]}_loadMaterialMetallicRoughnessPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return BN&&(BN.baseColorFactor?(lN.albedoColor=cN.FB.IB(BN.baseColorFactor),lN.alpha=BN.baseColorFactor[3]):lN.albedoColor=cN.FB.White(),lN.metallic=void 0==BN.metallicFactor?1:BN.metallicFactor,lN.roughness=void 0==BN.roughnessFactor?1:BN.roughnessFactor,BN.baseColorTexture&&kB.push(this.loadTextureInfoAsync("".concat(NN,"/baseColorTexture"),BN.baseColorTexture,(NN=>{NN.name="".concat(lN.name," (Base Color)"),lN.albedoTexture=NN}))),BN.metallicRoughnessTexture&&(BN.metallicRoughnessTexture.nonColorData=!0,kB.push(this.loadTextureInfoAsync("".concat(NN,"/metallicRoughnessTexture"),BN.metallicRoughnessTexture,(NN=>{NN.name="".concat(lN.name," (Metallic Roughness)"),lN.metallicTexture=NN}))),lN.useMetallnessFromMetallicTextureBlue=!0,lN.useRoughnessFromMetallicTextureGreen=!0,lN.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(kB).then((()=>{}))}_loadMaterialAsync(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const cN=this._extensionsLoadMaterialAsync(NN,BN,lN,kB,qN);if(cN)return cN;BN._data=BN._data||{};let eN=BN._data[kB];if(!eN){this.logOpen("".concat(NN," ").concat(BN.name||""));const lN=this.createMaterial(NN,BN,kB);eN={babylonMaterial:lN,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(NN,BN,lN)},BN._data[kB]=eN,WN.AddPointerMetadata(lN,NN),this._parent.onMaterialLoadedObservable.notifyObservers(lN),this.logClose()}return lN&&(eN.babylonMeshes.push(lN),lN.qc.addOnce((()=>{const NN=eN.babylonMeshes.indexOf(lN);-1!==NN&&eN.babylonMeshes.splice(NN,1)}))),qN(eN.babylonMaterial),eN.promise.then((()=>eN.babylonMaterial))}_createDefaultMaterial(NN,BN){this._babylonScene._blockEntityCollection=!!this._assetContainer;const lN=new AN.e(NN,this._babylonScene);return lN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,lN.fillMode=BN,lN.enableSpecularAntiAliasing=!0,lN.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,lN.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,lN.Ac=AN.e.PBRMATERIAL_OPAQUE,lN.metallic=1,lN.roughness=1,lN}createMaterial(NN,BN,lN){const kB=this._extensionsCreateMaterial(NN,BN,lN);if(kB)return kB;const qN=BN.name||"material".concat(BN.index);return this._createDefaultMaterial(qN,lN)}loadMaterialPropertiesAsync(NN,BN,lN){const kB=this._extensionsLoadMaterialPropertiesAsync(NN,BN,lN);if(kB)return kB;const qN=new Array;return qN.push(this.loadMaterialBasePropertiesAsync(NN,BN,lN)),BN.pbrMetallicRoughness&&qN.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(NN,"/pbrMetallicRoughness"),BN.pbrMetallicRoughness,lN)),this.loadMaterialAlphaProperties(NN,BN,lN),Promise.all(qN).then((()=>{}))}loadMaterialBasePropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return lN.emissiveColor=BN.emissiveFactor?cN.FB.IB(BN.emissiveFactor):new cN.FB(0,0,0),BN.doubleSided&&(lN.backFaceCulling=!1,lN.twoSidedLighting=!0),BN.normalTexture&&(BN.normalTexture.nonColorData=!0,kB.push(this.loadTextureInfoAsync("".concat(NN,"/normalTexture"),BN.normalTexture,(NN=>{NN.name="".concat(lN.name," (Normal)"),lN.bumpTexture=NN}))),lN.invertNormalMapX=!this._babylonScene.useRightHandedSystem,lN.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=BN.normalTexture.scale&&lN.bumpTexture&&(lN.bumpTexture.level=BN.normalTexture.scale),lN.forceIrradianceInFragment=!0),BN.occlusionTexture&&(BN.occlusionTexture.nonColorData=!0,kB.push(this.loadTextureInfoAsync("".concat(NN,"/occlusionTexture"),BN.occlusionTexture,(NN=>{NN.name="".concat(lN.name," (Occlusion)"),lN.ambientTexture=NN}))),lN.useAmbientInGrayScale=!0,void 0!=BN.occlusionTexture.strength&&(lN.ambientTextureStrength=BN.occlusionTexture.strength)),BN.emissiveTexture&&kB.push(this.loadTextureInfoAsync("".concat(NN,"/emissiveTexture"),BN.emissiveTexture,(NN=>{NN.name="".concat(lN.name," (Emissive)"),lN.emissiveTexture=NN}))),Promise.all(kB).then((()=>{}))}loadMaterialAlphaProperties(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));switch(BN.alphaMode||"OPAQUE"){case"OPAQUE":lN.Ac=AN.e.PBRMATERIAL_OPAQUE,lN.alpha=1;break;case"MASK":lN.Ac=AN.e.PBRMATERIAL_ALPHATEST,lN.alphaCutOff=void 0==BN.alphaCutoff?.5:BN.alphaCutoff,lN.albedoTexture&&(lN.albedoTexture.Ic=!0);break;case"BLEND":lN.Ac=AN.e.PBRMATERIAL_ALPHABLEND,lN.albedoTexture&&(lN.albedoTexture.Ic=!0,lN.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(NN,"/alphaMode: Invalid value (").concat(BN.alphaMode,")"))}}loadTextureInfoAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const kB=this._extensionsLoadTextureInfoAsync(NN,BN,lN);if(kB)return kB;if(this.logOpen("".concat(NN)),BN.texCoord>=6)throw new Error("".concat(NN,"/texCoord: Invalid value (").concat(BN.texCoord,")"));const qN=hN.Get("".concat(NN,"/index"),this._gltf.textures,BN.index);qN._textureInfo=BN;const cN=this._loadTextureAsync("/textures/".concat(BN.index),qN,(kB=>{kB.coordinatesIndex=BN.texCoord||0,WN.AddPointerMetadata(kB,NN),this._parent.onTextureLoadedObservable.notifyObservers(kB),lN(kB)}));return this.logClose(),cN}_loadTextureAsync(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const kB=this._extensionsLoadTextureAsync(NN,BN,lN);if(kB)return kB;this.logOpen("".concat(NN," ").concat(BN.name||""));const qN=void 0==BN.sampler?WN.DefaultSampler:hN.Get("".concat(NN,"/sampler"),this._gltf.samplers,BN.sampler),cN=hN.Get("".concat(NN,"/source"),this._gltf.images,BN.source),eN=this._createTextureAsync(NN,qN,cN,lN,void 0,!BN._textureInfo.nonColorData);return this.logClose(),eN}_createTextureAsync(NN,BN,lN){var qN,cN;let eN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},vN=arguments.length>4?arguments[4]:void 0,HN=arguments.length>5?arguments[5]:void 0;const TN=this._loadSampler("/samplers/".concat(BN.index),BN),RN=new Array,sN=new kB;this._babylonScene._blockEntityCollection=!!this._assetContainer;const VN={noMipmap:TN.noMipMaps,invertY:!1,samplingMode:TN.samplingMode,rN:()=>{this._disposed||sN.resolve()},onError:(BN,lN)=>{this._disposed||sN.reject(new Error("".concat(NN,": ").concat(lN&&lN.message?lN.message:BN||"Failed to load texture")))},mimeType:null!==(qN=lN.mimeType)&&void 0!==qN?qN:(0,xN.k)(null!==(cN=lN.uri)&&void 0!==cN?cN:""),loaderOptions:vN,useSRGBBuffer:!!HN&&this._parent.useSRGBBuffers},fN=new MN.c(null,this._babylonScene,VN);return fN._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,RN.push(sN.promise),RN.push(this.loadImageAsync("/images/".concat(lN.index),lN).then((NN=>{const BN=lN.uri||"".concat(this._fileName,"#image").concat(lN.index),kB="data:".concat(this._uniqueRootUrl).concat(BN);fN.updateURL(kB,NN);const qN=fN.getInternalTexture();qN&&(qN.label=lN.name)}))),fN.wrapU=TN.wrapU,fN.wrapV=TN.wrapV,eN(fN),this._parent.useGltfTextureNames&&(fN.name=lN.name||lN.uri||"image".concat(lN.index)),Promise.all(RN).then((()=>fN))}_loadSampler(NN,BN){return BN._data||(BN._data={noMipMaps:9728===BN.minFilter||9729===BN.minFilter,samplingMode:WN._GetTextureSamplingMode(NN,BN),wrapU:WN._GetTextureWrapMode("".concat(NN,"/wrapS"),BN.wrapS),wrapV:WN._GetTextureWrapMode("".concat(NN,"/wrapT"),BN.wrapT)}),BN._data}loadImageAsync(NN,BN){if(!BN._data){if(this.logOpen("".concat(NN," ").concat(BN.name||"")),BN.uri)BN._data=this.loadUriAsync("".concat(NN,"/uri"),BN,BN.uri);else{const lN=hN.Get("".concat(NN,"/bufferView"),this._gltf.bufferViews,BN.bufferView);BN._data=this.loadBufferViewAsync("/bufferViews/".concat(lN.index),lN)}this.logClose()}return BN._data}loadUriAsync(NN,BN,lN){const kB=this._extensionsLoadUriAsync(NN,BN,lN);if(kB)return kB;if(!WN._ValidateUri(lN))throw new Error("".concat(NN,": '").concat(lN,"' is invalid"));if((0,xN.l)(lN)){const BN=new Uint8Array((0,xN.e)(lN));return this.log("".concat(NN,": Decoded ").concat(lN.substring(0,64),"... (").concat(BN.length," bytes)")),Promise.resolve(BN)}return this.log("".concat(NN,": Loading ").concat(lN)),this._parent.preprocessUrlAsync(this._rootUrl+lN).then((BN=>new Promise(((kB,qN)=>{this._parent._loadFile(this._babylonScene,BN,(BN=>{this._disposed||(this.log("".concat(NN,": Loaded ").concat(lN," (").concat(BN.byteLength," bytes)")),kB(new Uint8Array(BN)))}),!0,(BN=>{qN(new xN.o("".concat(NN,": Failed to load '").concat(lN,"'").concat(BN?": "+BN.status+" "+BN.statusText:""),BN))}))}))))}static AddPointerMetadata(NN,BN){NN.metadata=NN.metadata||{};const lN=NN._internalMetadata=NN._internalMetadata||{},kB=lN.sc=lN.sc||{};(kB.pointers=kB.pointers||[]).push(BN)}static _GetTextureWrapMode(NN,BN){switch(BN=void 0==BN?10497:BN){case 33071:return MN.c.CLAMP_ADDRESSMODE;case 33648:return MN.c.MIRROR_ADDRESSMODE;case 10497:return MN.c.WRAP_ADDRESSMODE;default:return PN.d.Warn("".concat(NN,": Invalid value (").concat(BN,")")),MN.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(NN,BN){const lN=void 0==BN.magFilter?9729:BN.magFilter,kB=void 0==BN.minFilter?9987:BN.minFilter;if(9729===lN)switch(kB){case 9728:return MN.c.LINEAR_NEAREST;case 9729:return MN.c.LINEAR_LINEAR;case 9984:return MN.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return MN.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return MN.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return MN.c.LINEAR_LINEAR_MIPLINEAR;default:return PN.d.Warn("".concat(NN,"/minFilter: Invalid value (").concat(kB,")")),MN.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==lN&&PN.d.Warn("".concat(NN,"/magFilter: Invalid value (").concat(lN,")")),kB){case 9728:return MN.c.NEAREST_NEAREST;case 9729:return MN.c.NEAREST_LINEAR;case 9984:return MN.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return MN.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return MN.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return MN.c.NEAREST_LINEAR_MIPLINEAR;default:return PN.d.Warn("".concat(NN,"/minFilter: Invalid value (").concat(kB,")")),MN.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(NN,BN){try{return(0,LN.s)(BN)}catch(lN){throw new Error("".concat(NN,": ").concat(lN.message))}}static _GetTypedArray(NN,BN,lN,kB,qN){const cN=lN.buffer;kB=lN.byteOffset+(kB||0);const eN=WN._GetTypedArrayConstructor("".concat(NN,"/componentType"),BN),vN=XN.f.GetTypeByteLength(BN);return kB%vN!==0?(PN.d.Warn("".concat(NN,": Copying buffer as byte offset (").concat(kB,") is not a multiple of component type byte length (").concat(vN,")")),new eN(cN.slice(kB,kB+qN*vN),0)):new eN(cN,kB,qN)}static _GetNumComponents(NN,BN){switch(BN){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(NN,": Invalid type (").concat(BN,")"))}static _ValidateUri(NN){return eN.Tools.IsBase64(NN)||-1===NN.indexOf("..")}static _GetDrawMode(NN,BN){switch(void 0==BN&&(BN=4),BN){case 0:return IN.b.PointListDrawMode;case 1:return IN.b.LineListDrawMode;case 2:return IN.b.LineLoopDrawMode;case 3:return IN.b.LineStripDrawMode;case 4:return IN.b.TriangleFillMode;case 5:return IN.b.TriangleStripDrawMode;case 6:return IN.b.TriangleFanDrawMode}throw new Error("".concat(NN,": Invalid mesh primitive mode (").concat(BN,")"))}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const NN=new Array;if(this._gltf.materials)for(const BN of this._gltf.materials)if(BN._data)for(const lN in BN._data){const kB=BN._data[lN];for(const BN of kB.babylonMeshes){BN.uc(!0);const lN=kB.babylonMaterial;NN.push(lN.forceCompilationAsync(BN)),NN.push(lN.forceCompilationAsync(BN,{useInstances:!0})),this._parent.useClipPlane&&(NN.push(lN.forceCompilationAsync(BN,{clipPlane:!0})),NN.push(lN.forceCompilationAsync(BN,{clipPlane:!0,useInstances:!0})))}}return Promise.all(NN).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const NN=new Array,BN=this._babylonScene.lights;for(const lN of BN){const BN=lN.getShadowGenerator();BN&&NN.push(BN.forceCompilationAsync())}return Promise.all(NN).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(NN){for(const BN of this._extensions)BN.enabled&&NN(BN)}_applyExtensions(NN,BN,lN){for(const kB of this._extensions)if(kB.enabled){const qN="".concat(kB.name,".").concat(BN),cN=NN;cN._activeLoaderExtensionFunctions=cN._activeLoaderExtensionFunctions||{};const eN=cN._activeLoaderExtensionFunctions;if(!eN[qN]){eN[qN]=!0;try{const NN=lN(kB);if(NN)return NN}finally{delete eN[qN]}}}return null}_extensionsOnLoading(){this._forEachExtensions((NN=>NN.onLoading&&NN.onLoading()))}_extensionsOnReady(){this._forEachExtensions((NN=>NN.onReady&&NN.onReady()))}_extensionsLoadSceneAsync(NN,BN){return this._applyExtensions(BN,"loadScene",(lN=>lN.loadSceneAsync&&lN.loadSceneAsync(NN,BN)))}_extensionsLoadNodeAsync(NN,BN,lN){return this._applyExtensions(BN,"loadNode",(kB=>kB.loadNodeAsync&&kB.loadNodeAsync(NN,BN,lN)))}_extensionsLoadCameraAsync(NN,BN,lN){return this._applyExtensions(BN,"loadCamera",(kB=>kB.loadCameraAsync&&kB.loadCameraAsync(NN,BN,lN)))}_extensionsLoadVertexDataAsync(NN,BN,lN){return this._applyExtensions(BN,"loadVertexData",(kB=>kB._loadVertexDataAsync&&kB._loadVertexDataAsync(NN,BN,lN)))}_extensionsLoadMeshPrimitiveAsync(NN,BN,lN,kB,qN,cN){return this._applyExtensions(qN,"loadMeshPrimitive",(eN=>eN._loadMeshPrimitiveAsync&&eN._loadMeshPrimitiveAsync(NN,BN,lN,kB,qN,cN)))}_extensionsLoadMaterialAsync(NN,BN,lN,kB,qN){return this._applyExtensions(BN,"loadMaterial",(cN=>cN._loadMaterialAsync&&cN._loadMaterialAsync(NN,BN,lN,kB,qN)))}_extensionsCreateMaterial(NN,BN,lN){return this._applyExtensions(BN,"createMaterial",(kB=>kB.createMaterial&&kB.createMaterial(NN,BN,lN)))}_extensionsLoadMaterialPropertiesAsync(NN,BN,lN){return this._applyExtensions(BN,"loadMaterialProperties",(kB=>kB.loadMaterialPropertiesAsync&&kB.loadMaterialPropertiesAsync(NN,BN,lN)))}_extensionsLoadTextureInfoAsync(NN,BN,lN){return this._applyExtensions(BN,"loadTextureInfo",(kB=>kB.loadTextureInfoAsync&&kB.loadTextureInfoAsync(NN,BN,lN)))}_extensionsLoadTextureAsync(NN,BN,lN){return this._applyExtensions(BN,"loadTexture",(kB=>kB._loadTextureAsync&&kB._loadTextureAsync(NN,BN,lN)))}_extensionsLoadAnimationAsync(NN,BN){return this._applyExtensions(BN,"loadAnimation",(lN=>lN.loadAnimationAsync&&lN.loadAnimationAsync(NN,BN)))}_extensionsLoadAnimationChannelAsync(NN,BN,lN,kB,qN){return this._applyExtensions(lN,"loadAnimationChannel",(cN=>cN._loadAnimationChannelAsync&&cN._loadAnimationChannelAsync(NN,BN,lN,kB,qN)))}_extensionsLoadSkinAsync(NN,BN,lN){return this._applyExtensions(lN,"loadSkin",(kB=>kB._loadSkinAsync&&kB._loadSkinAsync(NN,BN,lN)))}_extensionsLoadUriAsync(NN,BN,lN){return this._applyExtensions(BN,"loadUri",(kB=>kB._loadUriAsync&&kB._loadUriAsync(NN,BN,lN)))}_extensionsLoadBufferViewAsync(NN,BN){return this._applyExtensions(BN,"loadBufferView",(lN=>lN.loadBufferViewAsync&&lN.loadBufferViewAsync(NN,BN)))}_extensionsLoadBufferAsync(NN,BN,lN,kB){return this._applyExtensions(BN,"loadBuffer",(qN=>qN.loadBufferAsync&&qN.loadBufferAsync(NN,BN,lN,kB)))}static LoadExtensionAsync(NN,BN,lN,kB){if(!BN.extensions)return null;const qN=BN.extensions[lN];return qN?kB("".concat(NN,"/extensions/").concat(lN),qN):null}static LoadExtraAsync(NN,BN,lN,kB){if(!BN.extras)return null;const qN=BN.extras[lN];return qN?kB("".concat(NN,"/extras/").concat(lN),qN):null}isExtensionUsed(NN){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(NN)}logOpen(NN){this._parent._logOpen(NN)}logClose(){this._parent._logClose()}log(NN){this._parent._log(NN)}startPerformanceCounter(NN){this._parent._startPerformanceCounter(NN)}endPerformanceCounter(NN){this._parent._endPerformanceCounter(NN)}}WN.DefaultSampler={index:-1},pN.e._CreateGLTF2Loader=NN=>new WN(NN);var QN=lN(15835),SN=lN(15111),iB=lN(14959),tN=lN(15838),oN=lN(15841);class JN extends oN.e{constructor(NN,BN,lN){let kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,cN=arguments.length>5&&void 0!==arguments[5]&&arguments[5],eN=arguments.length>6&&void 0!==arguments[6]&&arguments[6],vN=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,HN=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",NN),this._texture=NN.getEngine().createRawCubeTexture(BN,lN,kB,qN,cN,eN,vN,HN)}update(NN,BN,lN,kB){let qN=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,NN,BN,lN,kB,qN)}updateRGBDAsync(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,tN.l)(this._texture,NN,BN,lN,kB).then((()=>{}))}clone(){return iB.b.Clone((()=>{const NN=this.VB(),BN=this._texture,lN=new JN(NN,BN._bufferViewArray,BN.width,BN.format,BN.type,BN.generateMipMaps,BN.invertY,BN.samplingMode,BN._compression);return 13===BN.source&&lN.updateRGBDAsync(BN._bufferViewArrayArray,BN._sphericalPolynomial,BN._lodGenerationScale,BN._lodGenerationOffset),lN}),this)}}const YN="EXT_lights_image_based";class jB{constructor(NN){this.name=YN,this._loader=NN,this.enabled=this._loader.isExtensionUsed(YN)}dispose(){this._loader=null,delete this._lights}onLoading(){const NN=this._loader.sc.extensions;if(NN&&NN[this.name]){const BN=NN[this.name];this._lights=BN.lights}}loadSceneAsync(NN,BN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(lN,kB)=>{this._loader._allMaterialsDirtyRequired=!0;const qN=new Array;qN.push(this._loader.loadSceneAsync(NN,BN)),this._loader.logOpen("".concat(lN));const cN=hN.Get("".concat(lN,"/light"),this._lights,kB.eq);return qN.push(this._loadLightAsync("/extensions/".concat(this.name,"/lights/").concat(kB.eq),cN).then((NN=>{this._loader.babylonScene.environmentTexture=NN}))),this._loader.logClose(),await Promise.all(qN).then((()=>{}))}))}_loadLightAsync(NN,BN){if(!BN._loaded){const lN=new Array;this._loader.logOpen("".concat(NN));const kB=new Array(BN.specularImages.length);for(let qN=0;qN<BN.specularImages.length;qN++){const cN=BN.specularImages[qN];kB[qN]=new Array(cN.length);for(let BN=0;BN<cN.length;BN++){const eN="".concat(NN,"/specularImages/").concat(qN,"/").concat(BN);this._loader.logOpen("".concat(eN));const vN=cN[BN],HN=hN.Get(eN,this._loader.sc.images,vN);lN.push(this._loader.loadImageAsync("/images/".concat(vN),HN).then((NN=>{kB[qN][BN]=NN}))),this._loader.logClose()}}this._loader.logClose(),BN._loaded=Promise.all(lN).then((async()=>{const lN=new JN(this._loader.babylonScene,null,BN.specularImageSize);if(lN.name=BN.name||"environment",BN._babylonTexture=lN,void 0!=BN.bc&&(lN.level=BN.bc),BN.rotation){let NN=qN.Quaternion.IB(BN.rotation);this._loader.babylonScene.useRightHandedSystem||(NN=qN.Quaternion.Inverse(NN)),qN.Matrix.FromQuaternionToRef(NN,lN.getReflectionTextureMatrix())}if(!BN.irradianceCoefficients)throw new Error("".concat(NN,": Irradiance coefficients are missing"));const cN=SN.b.IB(BN.irradianceCoefficients);cN.scaleInPlace(BN.bc),cN.convertIrradianceToLambertianRadiance();const eN=SN.e.FromHarmonics(cN),vN=(kB.length-1)/Math.log2(BN.specularImageSize);return await lN.updateRGBDAsync(kB,eN,vN)}))}return BN._loaded.then((()=>BN._babylonTexture))}}aN(YN),mB(YN,!0,(NN=>new jB(NN)));lN(15504);const zN="EXT_mesh_gpu_instancing";class NB{constructor(NN){this.name=zN,this._loader=NN,this.enabled=this._loader.isExtensionUsed(zN)}dispose(){this._loader=null}loadNodeAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(NN,kB)=>{this._loader._disableInstancedMesh++;const cN=this._loader.loadNodeAsync("/nodes/".concat(BN.index),BN,lN);if(this._loader._disableInstancedMesh--,!BN._primitiveBabylonMeshes)return await cN;const eN=new Array;let vN=0;const HN=BN=>{if(void 0==kB.attributes[BN])return void eN.push(Promise.resolve(null));const lN=hN.Get("".concat(NN,"/attributes/").concat(BN),this._loader.sc.accessors,kB.attributes[BN]);if(eN.push(this._loader._loadFloatAccessorAsync("/accessors/".concat(lN.bufferView),lN)),0===vN)vN=lN.count;else if(vN!==lN.count)throw new Error("".concat(NN,"/attributes: Instance buffer accessors do not have the same count."))};return HN("TRANSLATION"),HN("ROTATION"),HN("SCALE"),await cN.then((async NN=>{const[lN,kB,cN]=await Promise.all(eN),HN=new Float32Array(16*vN);qN.TmpVectors.fB[0].Kc(0,0,0),qN.TmpVectors.Quaternion[0].Kc(0,0,0,1),qN.TmpVectors.fB[1].Kc(1,1,1);for(let BN=0;BN<vN;++BN)lN&&qN.fB.FromArrayToRef(lN,3*BN,qN.TmpVectors.fB[0]),kB&&qN.Quaternion.FromArrayToRef(kB,4*BN,qN.TmpVectors.Quaternion[0]),cN&&qN.fB.FromArrayToRef(cN,3*BN,qN.TmpVectors.fB[1]),qN.Matrix.ComposeToRef(qN.TmpVectors.fB[1],qN.TmpVectors.Quaternion[0],qN.TmpVectors.fB[0],qN.TmpVectors.Matrix[0]),qN.TmpVectors.Matrix[0].copyToArray(HN,16*BN);for(const qN of BN._primitiveBabylonMeshes)qN.Zf("matrix",HN,16,!0);return NN}))}))}}aN(zN),mB(zN,!0,(NN=>new NB(NN)));let BB=0,lB=null;class kl{static get Default(){return kl._Default||(kl._Default=new kl),kl._Default}constructor(){const NN=kl.Configuration.decoder;this._decoderModulePromise=eN.Tools.LoadBabylonScriptAsync(NN.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(NN,BN,lN,kB,qN){await this._decoderModulePromise,0===BB&&(MeshoptDecoder.useWorkers(1),BB=1);const cN=await MeshoptDecoder.decodeGltfBufferAsync(BN,lN,NN,kB,qN);return null!==lB&&clearTimeout(lB),lB=setTimeout((()=>{MeshoptDecoder.useWorkers(0),BB=0,lB=null}),1e3),cN}}kl.Configuration={decoder:{url:"".concat(eN.Tools._DefaultCdnUrl,"/meshopt_decoder.js")}},kl._Default=null;const qB="EXT_meshopt_compression";class cB{constructor(NN){this.name=qB,this.enabled=NN.isExtensionUsed(qB),this._loader=NN}dispose(){this._loader=null}loadBufferViewAsync(NN,BN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(lN,kB)=>{const qN=BN;if(qN._meshOptData)return await qN._meshOptData;const cN=hN.Get("".concat(NN,"/buffer"),this._loader.sc.buffers,kB.buffer);return qN._meshOptData=this._loader.loadBufferAsync("/buffers/".concat(cN.index),cN,kB.byteOffset||0,kB.byteLength).then((async NN=>await kl.Default.decodeGltfBufferAsync(NN,kB.count,kB.byteStride,kB.mode,kB.filter))),await qN._meshOptData}))}}aN(qB),mB(qB,!0,(NN=>new cB(NN)));const eB="EXT_texture_webp";class vB{constructor(NN){this.name=eB,this._loader=NN,this.enabled=NN.isExtensionUsed(eB)}dispose(){this._loader=null}_loadTextureAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=void 0==BN.sampler?WN.DefaultSampler:hN.Get("".concat(NN,"/sampler"),this._loader.sc.samplers,BN.sampler),eN=hN.Get("".concat(kB,"/source"),this._loader.sc.images,qN.source);return await this._loader._createTextureAsync(NN,cN,eN,(NN=>{lN(NN)}),void 0,!BN._textureInfo.nonColorData)}))}}aN(eB),mB(eB,!0,(NN=>new vB(NN)));const HB="EXT_texture_avif";class TB{constructor(NN){this.name=HB,this._loader=NN,this.enabled=NN.isExtensionUsed(HB)}dispose(){this._loader=null}_loadTextureAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=void 0==BN.sampler?WN.DefaultSampler:hN.Get("".concat(NN,"/sampler"),this._loader.sc.samplers,BN.sampler),eN=hN.Get("".concat(kB,"/source"),this._loader.sc.images,qN.source);return await this._loader._createTextureAsync(NN,cN,eN,(NN=>{lN(NN)}),void 0,!BN._textureInfo.nonColorData)}))}}aN(HB),mB(HB,!0,(NN=>new TB(NN)));var RB=lN(15827),sB=lN(15485);const VB="EXT_lights_ies";class fB{constructor(NN){this.name=VB,this._loader=NN,this.enabled=this._loader.isExtensionUsed(VB)}dispose(){this._loader=null,delete this._lights}onLoading(){const NN=this._loader.sc.extensions;if(NN&&NN[this.name]){const BN=NN[this.name];this._lights=BN.lights,hN.Assign(this._lights)}}loadNodeAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,eN)=>{let vN,HN;this._loader._allMaterialsDirtyRequired=!0;const TN=await this._loader.loadNodeAsync(NN,BN,(NN=>{HN=hN.Get(kB,this._lights,eN.eq);const BN=HN.name||NN.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,vN=new RB.d(BN,qN.fB.Zero(),qN.fB.Backward(),0,1,this._loader.babylonScene),vN.angle=Math.PI/2,vN.innerAngle=0,vN._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,HN._babylonLight=vN,vN.falloffType=sB.b.FALLOFF_GLTF,vN.me=eN.color?cN.FB.IB(eN.color):cN.FB.White(),vN.bc=eN.multiplier||1,vN.range=Number.MAX_VALUE,vN.parent=NN,this._loader._babylonLights.push(vN),WN.AddPointerMetadata(vN,kB),lN(NN)}));let RN;if(HN.uri)RN=await this._loader.loadUriAsync(NN,HN,HN.uri);else{const BN=hN.Get("".concat(NN,"/bufferView"),this._loader.sc.bufferViews,HN.bufferView);RN=await this._loader.loadBufferViewAsync("/bufferViews/".concat(BN.index),BN)}return vN.iesProfileTexture=new MN.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,RN,!0,void 0,void 0,void 0,void 0,".ies"),TN}))}}aN(VB),mB(VB,!0,(NN=>new fB(NN)));var ZB=lN(15856);const PB="KHR_draco_mesh_compression";class CB{constructor(NN){this.name=PB,this.useNormalizedFlagFromAccessor=!0,this._loader=NN,this.enabled=ZB.d.DefaultAvailable&&this._loader.isExtensionUsed(PB)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{if(void 0!=BN.mode&&4!==BN.mode&&5!==BN.mode)throw new Error("".concat(NN,": Unsupported mode ").concat(BN.mode));const cN={},eN={},vN=(NN,kB)=>{const vN=qN.attributes[NN];if(void 0!=vN&&(lN._delayInfo=lN._delayInfo||[],-1===lN._delayInfo.indexOf(kB)&&lN._delayInfo.push(kB),cN[kB]=vN,this.useNormalizedFlagFromAccessor)){const lN=hN.TryGet(this._loader.sc.accessors,BN.attributes[NN]);lN&&(eN[kB]=lN.normalized||!1)}};vN("POSITION",XN.f.PositionKind),vN("NORMAL",XN.f.NormalKind),vN("TANGENT",XN.f.TangentKind),vN("TEXCOORD_0",XN.f.UVKind),vN("TEXCOORD_1",XN.f.UV2Kind),vN("TEXCOORD_2",XN.f.UV3Kind),vN("TEXCOORD_3",XN.f.UV4Kind),vN("TEXCOORD_4",XN.f.UV5Kind),vN("TEXCOORD_5",XN.f.UV6Kind),vN("JOINTS_0",XN.f.MatricesIndicesKind),vN("WEIGHTS_0",XN.f.MatricesWeightsKind),vN("COLOR_0",XN.f.ColorKind);const HN=hN.Get(kB,this._loader.sc.bufferViews,qN.bufferView);return HN._dracoBabylonGeometry||(HN._dracoBabylonGeometry=this._loader.loadBufferViewAsync("/bufferViews/".concat(HN.index),HN).then((async kB=>{const qN=this.dracoDecoder||ZB.d.Default,vN=hN.TryGet(this._loader.sc.accessors,BN.attributes.POSITION),HN=this._loader.parent.alwaysComputeBoundingBox||lN.skeleton||!vN?null:UN(vN);return await qN._decodeMeshToGeometryForGltfAsync(lN.name,this._loader.babylonScene,kB,cN,eN,HN).catch((BN=>{throw new Error("".concat(NN,": ").concat(BN.message))}))}))),await HN._dracoBabylonGeometry}))}}aN(PB),mB(PB,!0,(NN=>new CB(NN)));var FB=lN(15861),IB=lN(14905),AB=lN(14910),MB=lN(15370),GB=lN(15534),XB=lN(14881);MB.c.AddNodeConstructor("Light_Type_0",((NN,BN)=>()=>new uB(NN,qN.fB.Zero(),BN)));class uB extends GB.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(NN){this._shadowAngle=NN,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(NN){const BN=this.needCube();if(this._direction=NN,this.needCube()!==BN&&this._shadowGenerators){const NN=this._shadowGenerators.values();for(let BN=NN.next();!0!==BN.done;BN=NN.next()){BN.value.recreateShadowMap()}}}constructor(NN,BN,lN){super(NN,lN),this._shadowAngle=Math.PI/2,this.position=BN}getClassName(){return"PointLight"}getTypeID(){return sB.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(NN){if(this.direction)return super.getShadowDirection(NN);switch(NN){case 0:return new qN.fB(1,0,0);case 1:return new qN.fB(-1,0,0);case 2:return new qN.fB(0,-1,0);case 3:return new qN.fB(0,1,0);case 4:return new qN.fB(0,0,1);case 5:return new qN.fB(0,0,-1)}return qN.fB.Zero()}_setDefaultShadowProjectionMatrix(NN,BN,lN){const kB=this.VB().activeCamera;if(!kB)return;const cN=void 0!==this.shadowMinZ?this.shadowMinZ:kB.Mc,eN=void 0!==this.shadowMaxZ?this.shadowMaxZ:kB.Gc,vN=this.VB().getEngine().Nc;qN.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,vN?eN:cN,vN?cN:eN,NN,!0,this._scene.getEngine().isNDCHalfZRange,void 0,vN)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(NN,BN){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,BN):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,BN),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,BN),this}transferToNodeMaterialEffect(NN,BN){return this.computeTransformedInformation()?NN.setFloat3(BN,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):NN.setFloat3(BN,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(NN,BN){NN["POINTLIGHT"+BN]=!0}}(0,IB.c)([(0,AB.G)()],uB.prototype,"shadowAngle",null),(0,XB.f)("BABYLON.PointLight",uB);const dB="KHR_lights_punctual";class EB{constructor(NN){this.name=dB,this._loader=NN,this.enabled=this._loader.isExtensionUsed(dB)}dispose(){this._loader=null,delete this._lights}onLoading(){const NN=this._loader.sc.extensions;if(NN&&NN[this.name]){const BN=NN[this.name];this._lights=BN.lights,hN.Assign(this._lights)}}loadNodeAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,eN)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(NN,BN,(NN=>{let BN;const vN=hN.Get(kB,this._lights,eN.eq),HN=vN.name||NN.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,vN.type){case"directional":{const NN=new FB.c(HN,qN.fB.Backward(),this._loader.babylonScene);NN.position.nc(0),BN=NN;break}case"point":BN=new uB(HN,qN.fB.Zero(),this._loader.babylonScene);break;case"spot":{const NN=new RB.d(HN,qN.fB.Zero(),qN.fB.Backward(),0,1,this._loader.babylonScene);NN.angle=2*(vN.spot&&vN.spot.outerConeAngle||Math.PI/4),NN.innerAngle=2*(vN.spot&&vN.spot.innerConeAngle||0),BN=NN;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(kB,": Invalid light type (").concat(vN.type,")"))}BN._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,vN._babylonLight=BN,BN.falloffType=sB.b.FALLOFF_GLTF,BN.me=vN.color?cN.FB.IB(vN.color):cN.FB.White(),BN.bc=void 0==vN.bc?1:vN.bc,BN.range=void 0==vN.range?Number.MAX_VALUE:vN.range,BN.parent=NN,this._loader._babylonLights.push(BN),WN.AddPointerMetadata(BN,kB),lN(NN)})))))}}aN(dB),mB(dB,!0,(NN=>new EB(NN)));const KB="KHR_materials_pbrSpecularGlossiness";class gB{constructor(NN){this.name=KB,this.order=200,this._loader=NN,this.enabled=this._loader.isExtensionUsed(KB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialBasePropertiesAsync(NN,BN,lN)),cN.push(this._loadSpecularGlossinessPropertiesAsync(kB,qN,lN)),this._loader.loadMaterialAlphaProperties(NN,BN,lN),await Promise.all(cN).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return lN.metallic=null,lN.roughness=null,BN.diffuseFactor?(lN.albedoColor=cN.FB.IB(BN.diffuseFactor),lN.alpha=BN.diffuseFactor[3]):lN.albedoColor=cN.FB.White(),lN.reflectivityColor=BN.specularFactor?cN.FB.IB(BN.specularFactor):cN.FB.White(),lN.microSurface=void 0==BN.glossinessFactor?1:BN.glossinessFactor,BN.diffuseTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/diffuseTexture"),BN.diffuseTexture,(NN=>{NN.name="".concat(lN.name," (Diffuse)"),lN.albedoTexture=NN}))),BN.specularGlossinessTexture&&(kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/specularGlossinessTexture"),BN.specularGlossinessTexture,(NN=>{NN.name="".concat(lN.name," (Specular Glossiness)"),lN.reflectivityTexture=NN,lN.reflectivityTexture.Ic=!0}))),lN.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(kB).then((()=>{}))}}aN(KB),mB(KB,!0,(NN=>new gB(NN)));const nB="KHR_materials_unlit";class rB{constructor(NN){this.name=nB,this.order=210,this._loader=NN,this.enabled=this._loader.isExtensionUsed(nB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async()=>await this._loadUnlitPropertiesAsync(NN,BN,lN)))}_loadUnlitPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;lN.unlit=!0;const qN=BN.pbrMetallicRoughness;return qN&&(qN.baseColorFactor?(lN.albedoColor=cN.FB.IB(qN.baseColorFactor),lN.alpha=qN.baseColorFactor[3]):lN.albedoColor=cN.FB.White(),qN.baseColorTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/baseColorTexture"),qN.baseColorTexture,(NN=>{NN.name="".concat(lN.name," (Base Color)"),lN.albedoTexture=NN})))),BN.doubleSided&&(lN.backFaceCulling=!1,lN.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(NN,BN,lN),Promise.all(kB).then((()=>{}))}}aN(nB),mB(nB,!0,(NN=>new rB(NN)));const pB="KHR_materials_clearcoat";class xB{constructor(NN){this.name=pB,this.order=190,this._loader=NN,this.enabled=this._loader.isExtensionUsed(pB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadClearCoatPropertiesAsync(kB,qN,lN)),await Promise.all(cN)}))}_loadClearCoatPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return lN.clearCoat.isEnabled=!0,lN.clearCoat.useRoughnessFromMainTexture=!1,lN.clearCoat.remapF0OnInterfaceChange=!1,void 0!=BN.clearcoatFactor?lN.clearCoat.bc=BN.clearcoatFactor:lN.clearCoat.bc=0,BN.clearcoatTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/clearcoatTexture"),BN.clearcoatTexture,(NN=>{NN.name="".concat(lN.name," (ClearCoat)"),lN.clearCoat.texture=NN}))),void 0!=BN.clearcoatRoughnessFactor?lN.clearCoat.roughness=BN.clearcoatRoughnessFactor:lN.clearCoat.roughness=0,BN.clearcoatRoughnessTexture&&(BN.clearcoatRoughnessTexture.nonColorData=!0,kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/clearcoatRoughnessTexture"),BN.clearcoatRoughnessTexture,(NN=>{NN.name="".concat(lN.name," (ClearCoat Roughness)"),lN.clearCoat.textureRoughness=NN})))),BN.clearcoatNormalTexture&&(BN.clearcoatNormalTexture.nonColorData=!0,kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/clearcoatNormalTexture"),BN.clearcoatNormalTexture,(NN=>{NN.name="".concat(lN.name," (ClearCoat Normal)"),lN.clearCoat.bumpTexture=NN}))),lN.invertNormalMapX=!lN.VB().useRightHandedSystem,lN.invertNormalMapY=lN.VB().useRightHandedSystem,void 0!=BN.clearcoatNormalTexture.scale&&(lN.clearCoat.bumpTexture.level=BN.clearcoatNormalTexture.scale)),Promise.all(kB).then((()=>{}))}}aN(pB),mB(pB,!0,(NN=>new xB(NN)));const OB="KHR_materials_iridescence";class wB{constructor(NN){this.name=OB,this.order=195,this._loader=NN,this.enabled=this._loader.isExtensionUsed(OB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadIridescencePropertiesAsync(kB,qN,lN)),await Promise.all(cN).then((()=>{}))}))}_loadIridescencePropertiesAsync(NN,BN,lN){var kB,qN,cN,eN,vN;if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const HN=new Array;return lN.iridescence.isEnabled=!0,lN.iridescence.bc=null!==(kB=BN.iridescenceFactor)&&void 0!==kB?kB:0,lN.iridescence.indexOfRefraction=null!==(qN=null!==(cN=BN.iridescenceIor)&&void 0!==cN?cN:BN.iridescenceIOR)&&void 0!==qN?qN:1.3,lN.iridescence.minimumThickness=null!==(eN=BN.iridescenceThicknessMinimum)&&void 0!==eN?eN:100,lN.iridescence.maximumThickness=null!==(vN=BN.iridescenceThicknessMaximum)&&void 0!==vN?vN:400,BN.iridescenceTexture&&HN.push(this._loader.loadTextureInfoAsync("".concat(NN,"/iridescenceTexture"),BN.iridescenceTexture,(NN=>{NN.name="".concat(lN.name," (Iridescence)"),lN.iridescence.texture=NN}))),BN.iridescenceThicknessTexture&&HN.push(this._loader.loadTextureInfoAsync("".concat(NN,"/iridescenceThicknessTexture"),BN.iridescenceThicknessTexture,(NN=>{NN.name="".concat(lN.name," (Iridescence Thickness)"),lN.iridescence.thicknessTexture=NN}))),Promise.all(HN).then((()=>{}))}}aN(OB),mB(OB,!0,(NN=>new wB(NN)));const bB="KHR_materials_anisotropy";class ml{constructor(NN){this.name=bB,this.order=195,this._loader=NN,this.enabled=this._loader.isExtensionUsed(bB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadIridescencePropertiesAsync(kB,qN,lN)),await Promise.all(cN)}))}async _loadIridescencePropertiesAsync(NN,BN,lN){var kB,qN;if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const cN=new Array;lN.anisotropy.isEnabled=!0,lN.anisotropy.bc=null!==(kB=BN.anisotropyStrength)&&void 0!==kB?kB:0,lN.anisotropy.angle=null!==(qN=BN.anisotropyRotation)&&void 0!==qN?qN:0,BN.anisotropyTexture&&(BN.anisotropyTexture.nonColorData=!0,cN.push(this._loader.loadTextureInfoAsync("".concat(NN,"/anisotropyTexture"),BN.anisotropyTexture,(NN=>{NN.name="".concat(lN.name," (Anisotropy Intensity)"),lN.anisotropy.texture=NN})))),await Promise.all(cN)}}aN(bB),mB(bB,!0,(NN=>new ml(NN)));const aB="KHR_materials_emissive_strength";class DB{constructor(NN){this.name=aB,this.order=170,this._loader=NN,this.enabled=this._loader.isExtensionUsed(aB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>await this._loader.loadMaterialPropertiesAsync(NN,BN,lN).then((()=>{this._loadEmissiveProperties(kB,qN,lN)}))))}_loadEmissiveProperties(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));void 0!==BN.emissiveStrength&&(lN.emissiveIntensity=BN.emissiveStrength)}}aN(aB),mB(aB,!0,(NN=>new DB(NN)));const yB="KHR_materials_sheen";class LB{constructor(NN){this.name=yB,this.order=190,this._loader=NN,this.enabled=this._loader.isExtensionUsed(yB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadSheenPropertiesAsync(kB,qN,lN)),await Promise.all(cN).then((()=>{}))}))}_loadSheenPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return lN.sheen.isEnabled=!0,lN.sheen.bc=1,void 0!=BN.sheenColorFactor?lN.sheen.color=cN.FB.IB(BN.sheenColorFactor):lN.sheen.color=cN.FB.Black(),BN.sheenColorTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/sheenColorTexture"),BN.sheenColorTexture,(NN=>{NN.name="".concat(lN.name," (Sheen Color)"),lN.sheen.texture=NN}))),void 0!==BN.sheenRoughnessFactor?lN.sheen.roughness=BN.sheenRoughnessFactor:lN.sheen.roughness=0,BN.sheenRoughnessTexture&&(BN.sheenRoughnessTexture.nonColorData=!0,kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/sheenRoughnessTexture"),BN.sheenRoughnessTexture,(NN=>{NN.name="".concat(lN.name," (Sheen Roughness)"),lN.sheen.textureRoughness=NN})))),lN.sheen.albedoScaling=!0,lN.sheen.useRoughnessFromMainTexture=!1,Promise.all(kB).then((()=>{}))}}aN(yB),mB(yB,!0,(NN=>new LB(NN)));var hB=lN(15429);const UB="KHR_materials_specular";class WB{constructor(NN){this.name=UB,this.order=190,this._loader=NN,this.enabled=this._loader.isExtensionUsed(UB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;if(cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadSpecularPropertiesAsync(kB,qN,lN)),qN.extensions&&qN.extensions.EXT_materials_specular_edge_color&&lN instanceof AN.e){qN.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(lN.brdf.dielectricSpecularModel=hB.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,lN.brdf.conductorSpecularModel=hB.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(cN).then((()=>{}))}))}_loadSpecularPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return void 0!==BN.specularFactor&&(lN.metallicF0Factor=BN.specularFactor),void 0!==BN.specularColorFactor&&(lN.metallicReflectanceColor=cN.FB.IB(BN.specularColorFactor)),BN.specularTexture&&(BN.specularTexture.nonColorData=!0,kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/specularTexture"),BN.specularTexture,(NN=>{NN.name="".concat(lN.name," (Specular)"),lN.metallicReflectanceTexture=NN,lN.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),BN.specularColorTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/specularColorTexture"),BN.specularColorTexture,(NN=>{NN.name="".concat(lN.name," (Specular Color)"),lN.reflectanceTexture=NN}))),Promise.all(kB).then((()=>{}))}}aN(UB),mB(UB,!0,(NN=>new WB(NN)));const QB="KHR_materials_ior";class SB{constructor(NN){this.name=QB,this.order=180,this._loader=NN,this.enabled=this._loader.isExtensionUsed(QB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadIorPropertiesAsync(kB,qN,lN)),await Promise.all(cN).then((()=>{}))}))}_loadIorPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));return void 0!==BN.ior?lN.indexOfRefraction=BN.ior:lN.indexOfRefraction=SB._DEFAULT_IOR,Promise.resolve()}}SB._DEFAULT_IOR=1.5,aN(QB),mB(QB,!0,(NN=>new SB(NN)));const il="KHR_materials_variants";class tB{constructor(NN){this.name=il,this._loader=NN,this.enabled=this._loader.isExtensionUsed(il)}dispose(){this._loader=null}static GetAvailableVariants(NN){const BN=this._GetExtensionMetadata(NN);return BN?Object.keys(BN.variants):[]}getAvailableVariants(NN){return tB.GetAvailableVariants(NN)}static SelectVariant(NN,BN){const lN=this._GetExtensionMetadata(NN);if(!lN)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(il," extension"));const kB=NN=>{const BN=lN.variants[NN];if(BN)for(const lN of BN)lN.mesh.material=lN.material};if(BN instanceof Array)for(const qN of BN)kB(qN);else kB(BN);lN.lastSelected=BN}selectVariant(NN,BN){tB.SelectVariant(NN,BN)}static Reset(NN){const BN=this._GetExtensionMetadata(NN);if(!BN)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(il," extension"));for(const lN of BN.original)lN.mesh.material=lN.material;BN.lastSelected=null}reset(NN){tB.Reset(NN)}static GetLastSelectedVariant(NN){const BN=this._GetExtensionMetadata(NN);if(!BN)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(il," extension"));return BN.lastSelected}getLastSelectedVariant(NN){return tB.GetLastSelectedVariant(NN)}static _GetExtensionMetadata(NN){var BN,lN;return(null===NN||void 0===NN||null===(BN=NN._internalMetadata)||void 0===BN||null===(lN=BN.sc)||void 0===lN?void 0:lN[il])||null}onLoading(){const NN=this._loader.sc.extensions;if(NN&&NN[this.name]){const BN=NN[this.name];this._variants=BN.variants}}onReady(){const NN=this._loader.rootBabylonMesh;if(NN){var BN;const lN=this._loader.parent.extensionOptions[il];null!==lN&&void 0!==lN&&lN.defaultVariant&&tB.SelectVariant(NN,lN.defaultVariant),null===lN||void 0===lN||null===(BN=lN.onLoaded)||void 0===BN||BN.call(lN,{get variants(){return tB.GetAvailableVariants(NN)},get selectedVariant(){const BN=tB.GetLastSelectedVariant(NN);return BN?Array.isArray(BN)?BN[0]:BN:tB.GetAvailableVariants(NN)[0]},set selectedVariant(BN){tB.SelectVariant(NN,BN)}})}}_loadMeshPrimitiveAsync(NN,BN,lN,kB,qN,cN){return WN.LoadExtensionAsync(NN,qN,this.name,(async(eN,vN)=>{const HN=new Array;return HN.push(this._loader._loadMeshPrimitiveAsync(NN,BN,lN,kB,qN,(BN=>{if(cN(BN),BN instanceof EN.e){const lN=WN._GetDrawMode(NN,qN.mode),kB=this._loader.rootBabylonMesh,cN=kB?kB._internalMetadata=kB._internalMetadata||{}:{},TN=cN.sc=cN.sc||{},RN=TN[il]=TN[il]||{lastSelected:null,original:[],variants:{}};RN.original.push({mesh:BN,material:BN.material});for(let NN=0;NN<vN.mappings.length;++NN){const qN=vN.mappings[NN],cN=hN.Get("".concat(eN,"/mappings/").concat(NN,"/material"),this._loader.sc.materials,qN.material);HN.push(this._loader._loadMaterialAsync("#/materials/".concat(qN.material),cN,BN,lN,(NN=>{for(let lN=0;lN<qN.variants.length;++lN){const cN=qN.variants[lN],eN=hN.Get("/extensions/".concat(il,"/variants/").concat(cN),this._variants,cN);RN.variants[eN.name]=RN.variants[eN.name]||[],RN.variants[eN.name].push({mesh:BN,material:NN}),BN.onClonedObservable.add((NN=>{const lN=NN;let qN=null,cN=lN;do{if(cN=cN.parent,!cN)return;qN=tB._GetExtensionMetadata(cN)}while(null===qN);if(kB&&qN===tB._GetExtensionMetadata(kB)){cN._internalMetadata={};for(const NN in kB._internalMetadata)cN._internalMetadata[NN]=kB._internalMetadata[NN];cN._internalMetadata.sc=[];for(const NN in kB._internalMetadata.sc)cN._internalMetadata.sc[NN]=kB._internalMetadata.sc[NN];cN._internalMetadata.sc[il]={lastSelected:null,original:[],variants:{}};for(const NN of qN.original)cN._internalMetadata.sc[il].original.push({mesh:NN.mesh,material:NN.material});for(const NN in qN.variants)if(Object.prototype.hasOwnProperty.call(qN.variants,NN)){cN._internalMetadata.sc[il].variants[NN]=[];for(const BN of qN.variants[NN])cN._internalMetadata.sc[il].variants[NN].push({mesh:BN.mesh,material:BN.material})}qN=cN._internalMetadata.sc[il]}for(const kB of qN.original)kB.mesh===BN&&(kB.mesh=lN);for(const kB of qN.variants[eN.name])kB.mesh===BN&&(kB.mesh=lN)}))}})))}}}))),await Promise.all(HN).then((NN=>{let[BN]=NN;return BN}))}))}}aN(il),mB(il,!0,(NN=>new tB(NN)));var oB=lN(19),JB=lN(14986);class YB{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:hB.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(NN,BN){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,oB.d)((0,oB.d)({},YB._GetDefaultOptions()),NN),this._scene=BN,this._scene._transmissionHelper=this,this.onErrorObservable=new RN.b,this._scene.qc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(NN){if(!Object.keys(NN).filter((BN=>this._options[BN]!==NN[BN])).length)return;const BN=(0,oB.d)((0,oB.d)({},this._options),NN),lN=this._options;this._options=BN,BN.renderSize===lN.renderSize&&BN.renderTargetTextureType===lN.renderTargetTextureType&&BN.generateMipmaps===lN.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=BN.samples,this._opaqueRenderTarget.lodGenerationScale=BN.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=BN.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(NN){return!!NN&&!!(NN instanceof AN.e&&NN.subSurface.isRefractionEnabled)}_addMesh(NN){this._materialObservers[NN.uniqueId]=NN.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),eN.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(NN.material)?(NN.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(NN)&&this._transparentMeshesCache.push(NN)):-1===this._opaqueMeshesCache.indexOf(NN)&&this._opaqueMeshesCache.push(NN)}))}_removeMesh(NN){NN.onMaterialChangedObservable.remove(this._materialObservers[NN.uniqueId]),delete this._materialObservers[NN.uniqueId];let BN=this._transparentMeshesCache.indexOf(NN);-1!==BN&&this._transparentMeshesCache.splice(BN,1),BN=this._opaqueMeshesCache.indexOf(NN),-1!==BN&&this._opaqueMeshesCache.splice(BN,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(NN){const BN=this._transparentMeshesCache.indexOf(NN),lN=this._opaqueMeshesCache.indexOf(NN);this._shouldRenderAsTransmission(NN.material)?(NN.material instanceof AN.e&&(NN.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==lN?(this._opaqueMeshesCache.splice(lN,1),this._transparentMeshesCache.push(NN)):-1===BN&&this._transparentMeshesCache.push(NN)):-1!==BN?(this._transparentMeshesCache.splice(BN,1),this._opaqueMeshesCache.push(NN)):-1===lN&&this._opaqueMeshesCache.push(NN)}_isRenderTargetValid(){var NN;return null!==(null===(NN=this._opaqueRenderTarget)||void 0===NN?void 0:NN.getInternalTexture())}_setupRenderTargets(){var NN,BN;let lN;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new JB.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(NN=null===(BN=this._options.clearColor)||void 0===BN?void 0:BN.clone())&&void 0!==NN?NN:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((NN=>{lN=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?NN.clearColor.kB(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(NN.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=lN}));for(const kB of this._transparentMeshesCache)this._shouldRenderAsTransmission(kB.material)&&(kB.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const jl="KHR_materials_transmission";class zB{constructor(NN){this.name=jl,this.order=175,this._loader=NN,this.enabled=this._loader.isExtensionUsed(jl),this.enabled&&(NN.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadTransparentPropertiesAsync(kB,BN,lN,qN)),await Promise.all(cN).then((()=>{}))}))}_loadTransparentPropertiesAsync(NN,BN,lN,kB){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const qN=lN;if(qN.subSurface.isRefractionEnabled=!0,qN.subSurface.volumeIndexOfRefraction=1,qN.subSurface.useAlbedoToTintRefraction=!0,void 0===kB.transmissionFactor)return qN.subSurface.refractionIntensity=0,qN.subSurface.isRefractionEnabled=!1,Promise.resolve();{var cN;qN.subSurface.refractionIntensity=kB.transmissionFactor;const NN=qN.VB();if(qN.subSurface.refractionIntensity&&!NN._transmissionHelper)new YB({},qN.VB());else if(qN.subSurface.refractionIntensity&&(null===(cN=NN._transmissionHelper)||void 0===cN||!cN._isRenderTargetValid())){var eN;null===(eN=NN._transmissionHelper)||void 0===eN||eN._setupRenderTargets()}}return qN.subSurface.minimumThickness=0,qN.subSurface.maximumThickness=0,kB.transmissionTexture?(kB.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(NN,"/transmissionTexture"),kB.transmissionTexture,void 0).then((NN=>{NN.name="".concat(lN.name," (Transmission)"),qN.subSurface.refractionIntensityTexture=NN,qN.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}aN(jl),mB(jl,!0,(NN=>new zB(NN)));const Nl="KHR_materials_diffuse_transmission";class Bl{constructor(NN){this.name=Nl,this.order=174,this._loader=NN,this.enabled=this._loader.isExtensionUsed(Nl),this.enabled&&(NN.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadTranslucentPropertiesAsync(kB,BN,lN,qN)),await Promise.all(cN).then((()=>{}))}))}_loadTranslucentPropertiesAsync(NN,BN,lN,kB){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const qN=lN;if(qN.subSurface.isTranslucencyEnabled=!0,qN.subSurface.volumeIndexOfRefraction=1,qN.subSurface.minimumThickness=0,qN.subSurface.maximumThickness=0,qN.subSurface.useAlbedoToTintTranslucency=!1,void 0===kB.diffuseTransmissionFactor)return qN.subSurface.translucencyIntensity=0,qN.subSurface.isTranslucencyEnabled=!1,Promise.resolve();qN.subSurface.translucencyIntensity=kB.diffuseTransmissionFactor;const eN=new Array;return qN.subSurface.useGltfStyleTextures=!0,kB.diffuseTransmissionTexture&&(kB.diffuseTransmissionTexture.nonColorData=!0,eN.push(this._loader.loadTextureInfoAsync("".concat(NN,"/diffuseTransmissionTexture"),kB.diffuseTransmissionTexture).then((NN=>{NN.name="".concat(lN.name," (Diffuse Transmission)"),qN.subSurface.translucencyIntensityTexture=NN})))),void 0!==kB.diffuseTransmissionColorFactor?qN.subSurface.translucencyColor=cN.FB.IB(kB.diffuseTransmissionColorFactor):qN.subSurface.translucencyColor=cN.FB.White(),kB.diffuseTransmissionColorTexture&&eN.push(this._loader.loadTextureInfoAsync("".concat(NN,"/diffuseTransmissionColorTexture"),kB.diffuseTransmissionColorTexture).then((NN=>{NN.name="".concat(lN.name," (Diffuse Transmission Color)"),qN.subSurface.translucencyColorTexture=NN}))),Promise.all(eN).then((()=>{}))}}aN(Nl),mB(Nl,!0,(NN=>new Bl(NN)));const ll="KHR_materials_volume";class kk{constructor(NN){this.name=ll,this.order=173,this._loader=NN,this.enabled=this._loader.isExtensionUsed(ll),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadVolumePropertiesAsync(kB,BN,lN,qN)),await Promise.all(cN).then((()=>{}))}))}_loadVolumePropertiesAsync(NN,BN,lN,kB){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));if(!lN.subSurface.isRefractionEnabled&&!lN.subSurface.isTranslucencyEnabled||!kB.thicknessFactor)return Promise.resolve();lN.subSurface.volumeIndexOfRefraction=lN.indexOfRefraction;const qN=void 0!==kB.attenuationDistance?kB.attenuationDistance:Number.MAX_VALUE;return lN.subSurface.tintColorAtDistance=qN,void 0!==kB.attenuationColor&&3==kB.attenuationColor.length&&lN.subSurface.tintColor.Kc(kB.attenuationColor[0],kB.attenuationColor[1],kB.attenuationColor[2]),lN.subSurface.minimumThickness=0,lN.subSurface.maximumThickness=kB.thicknessFactor,lN.subSurface.useThicknessAsDepth=!0,kB.thicknessTexture?(kB.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(NN,"/thicknessTexture"),kB.thicknessTexture).then((NN=>{NN.name="".concat(lN.name," (Thickness)"),lN.subSurface.thicknessTexture=NN,lN.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}aN(ll),mB(ll,!0,(NN=>new kk(NN)));const ql="KHR_materials_dispersion";class cl{constructor(NN){this.name=ql,this.order=174,this._loader=NN,this.enabled=this._loader.isExtensionUsed(ql)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadDispersionPropertiesAsync(kB,BN,lN,qN)),await Promise.all(cN).then((()=>{}))}))}_loadDispersionPropertiesAsync(NN,BN,lN,kB){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));return lN.subSurface.isRefractionEnabled&&kB.dispersion?(lN.subSurface.isDispersionEnabled=!0,lN.subSurface.dispersion=kB.dispersion,Promise.resolve()):Promise.resolve()}}aN(ql),mB(ql,!0,(NN=>new cl(NN)));const el="EXT_materials_diffuse_roughness";class vl{constructor(NN){this.name=el,this.order=190,this._loader=NN,this.enabled=this._loader.isExtensionUsed(el)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=new Array;return cN.push(this._loader.loadMaterialPropertiesAsync(NN,BN,lN)),cN.push(this._loadDiffuseRoughnessPropertiesAsync(kB,qN,lN)),await Promise.all(cN).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(NN,BN,lN){if(!(lN instanceof AN.e))throw new Error("".concat(NN,": Material type not supported"));const kB=new Array;return lN.brdf.baseDiffuseModel=hB.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=BN.diffuseRoughnessFactor?lN.baseDiffuseRoughness=BN.diffuseRoughnessFactor:lN.baseDiffuseRoughness=0,BN.diffuseRoughnessTexture&&kB.push(this._loader.loadTextureInfoAsync("".concat(NN,"/diffuseRoughnessTexture"),BN.diffuseRoughnessTexture,(NN=>{NN.name="".concat(lN.name," (Diffuse Roughness)"),lN.baseDiffuseRoughnessTexture=NN}))),Promise.all(kB).then((()=>{}))}}aN(el),mB(el,!0,(NN=>new vl(NN)));const Hl="KHR_mesh_quantization";class Tl{constructor(NN){this.name=Hl,this.enabled=NN.isExtensionUsed(Hl)}dispose(){}}aN(Hl),mB(Hl,!0,(NN=>new Tl(NN)));const Rl="KHR_texture_basisu";class sl{constructor(NN){this.name=Rl,this._loader=NN,this.enabled=NN.isExtensionUsed(Rl)}dispose(){this._loader=null}_loadTextureAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>{const cN=void 0==BN.sampler?WN.DefaultSampler:hN.Get("".concat(NN,"/sampler"),this._loader.sc.samplers,BN.sampler),eN=hN.Get("".concat(kB,"/source"),this._loader.sc.images,qN.source);return await this._loader._createTextureAsync(NN,cN,eN,(NN=>{lN(NN)}),BN._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!BN._textureInfo.nonColorData)}))}}aN(Rl),mB(Rl,!0,(NN=>new sl(NN)));const Vl="KHR_texture_transform";class fl{constructor(NN){this.name=Vl,this._loader=NN,this.enabled=this._loader.isExtensionUsed(Vl)}dispose(){this._loader=null}loadTextureInfoAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(kB,qN)=>await this._loader.loadTextureInfoAsync(NN,BN,(NN=>{if(!(NN instanceof MN.c))throw new Error("".concat(kB,": Texture type not supported"));qN.offset&&(NN.uOffset=qN.offset[0],NN.vOffset=qN.offset[1]),NN.uRotationCenter=0,NN.vRotationCenter=0,qN.rotation&&(NN.wAng=-qN.rotation),qN.scale&&(NN.uScale=qN.scale[0],NN.vScale=qN.scale[1]),void 0!=qN.texCoord&&(NN.coordinatesIndex=qN.texCoord),lN(NN)}))))}}aN(Vl),mB(Vl,!0,(NN=>new fl(NN)));const Zl="KHR_xmp_json_ld";class Pl{constructor(NN){this.name=Zl,this.order=100,this._loader=NN,this.enabled=this._loader.isExtensionUsed(Zl)}dispose(){this._loader=null}onLoading(){var NN,BN,lN;if(null===this._loader.rootBabylonMesh)return;const kB=null===(NN=this._loader.sc.extensions)||void 0===NN?void 0:NN.KHR_xmp_json_ld,qN=null===(BN=this._loader.sc.asset)||void 0===BN||null===(lN=BN.extensions)||void 0===lN?void 0:lN.KHR_xmp_json_ld;if(kB&&qN){const NN=+qN.packet;kB.packets&&NN<kB.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=kB.packets[NN])}}}function Cl(NN,BN,lN,kB){return cN.FB.IB(BN,lN).scale(kB)}function Fl(NN,BN,lN,kB){return BN[lN]*kB}function Il(NN,BN,lN,kB){return-BN[lN]*kB}function Al(NN,BN,lN,kB){return BN[lN+1]*kB}function Ml(NN,BN,lN,kB){return BN[lN]*kB*2}function Gl(NN){return{scale:[new ul(VN.c.ANIMATIONTYPE_FLOAT,"".concat(NN,".uScale"),Fl,(()=>2)),new ul(VN.c.ANIMATIONTYPE_FLOAT,"".concat(NN,".vScale"),Al,(()=>2))],offset:[new ul(VN.c.ANIMATIONTYPE_FLOAT,"".concat(NN,".uOffset"),Fl,(()=>2)),new ul(VN.c.ANIMATIONTYPE_FLOAT,"".concat(NN,".vOffset"),Al,(()=>2))],rotation:[new ul(VN.c.ANIMATIONTYPE_FLOAT,"".concat(NN,".wAng"),Il,(()=>1))]}}aN(Zl),mB(Zl,!0,(NN=>new Pl(NN)));class Xl extends QN.AnimationPropertyInfo{buildAnimations(NN,BN,lN,kB){return[{babylonAnimatable:NN._babylonCamera,babylonAnimation:this._buildAnimation(BN,lN,kB)}]}}class ul extends QN.AnimationPropertyInfo{buildAnimations(NN,BN,lN,kB){const qN=[];for(const cN in NN._data)qN.push({babylonAnimatable:NN._data[cN].babylonMaterial,babylonAnimation:this._buildAnimation(BN,lN,kB)});return qN}}class dl extends QN.AnimationPropertyInfo{buildAnimations(NN,BN,lN,kB){return[{babylonAnimatable:NN._babylonLight,babylonAnimation:this._buildAnimation(BN,lN,kB)}]}}(0,DN.l)("/cameras/{}/orthographic/xmag",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Il,(()=>1)),new Xl(VN.c.ANIMATIONTYPE_FLOAT,"orthoRight",Al,(()=>1))]),(0,DN.l)("/cameras/{}/orthographic/ymag",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Il,(()=>1)),new Xl(VN.c.ANIMATIONTYPE_FLOAT,"orthoTop",Al,(()=>1))]),(0,DN.l)("/cameras/{}/orthographic/zfar",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"Gc",Fl,(()=>1))]),(0,DN.l)("/cameras/{}/orthographic/znear",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"Mc",Fl,(()=>1))]),(0,DN.l)("/cameras/{}/perspective/yfov",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"fov",Fl,(()=>1))]),(0,DN.l)("/cameras/{}/perspective/zfar",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"Gc",Fl,(()=>1))]),(0,DN.l)("/cameras/{}/perspective/znear",[new Xl(VN.c.ANIMATIONTYPE_FLOAT,"Mc",Fl,(()=>1))]),(0,DN.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"albedoColor",Cl,(()=>4)),new ul(VN.c.ANIMATIONTYPE_FLOAT,"alpha",(function(NN,BN,lN,kB){return BN[lN+3]*kB}),(()=>4))]),(0,DN.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"metallic",Fl,(()=>1))]),(0,DN.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"roughness",Fl,(()=>1))]);const El=Gl("albedoTexture");(0,DN.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",El.scale),(0,DN.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",El.offset),(0,DN.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",El.rotation);const Kl=Gl("metallicTexture");(0,DN.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Kl.scale),(0,DN.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Kl.offset),(0,DN.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Kl.rotation),(0,DN.l)("/materials/{}/emissiveFactor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Cl,(()=>3))]);const gl=Gl("bumpTexture");(0,DN.l)("/materials/{}/normalTexture/scale",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Fl,(()=>1))]),(0,DN.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",gl.scale),(0,DN.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",gl.offset),(0,DN.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",gl.rotation),(0,DN.l)("/materials/{}/occlusionTexture/strength",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Fl,(()=>1))]);const nl=Gl("ambientTexture");(0,DN.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",nl.scale),(0,DN.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",nl.offset),(0,DN.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",nl.rotation);const rl=Gl("emissiveTexture");(0,DN.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",rl.scale),(0,DN.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",rl.offset),(0,DN.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",rl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Fl,(()=>1))]);const pl=Gl("anisotropy.texture");(0,DN.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",pl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",pl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",pl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Fl,(()=>1))]);const xl=Gl("clearCoat.texture");(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",xl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",xl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",xl.rotation);const Ol=Gl("clearCoat.bumpTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ol.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ol.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ol.rotation);const wl=Gl("clearCoat.textureRoughness");(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",wl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",wl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",wl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Fl,(()=>1))]);const bl=Gl("iridescence.texture");(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",bl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",bl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",bl.rotation);const mk=Gl("iridescence.thicknessTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",mk.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",mk.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",mk.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"sheen.color",Cl,(()=>3))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Fl,(()=>1))]);const al=Gl("sheen.texture");(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",al.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",al.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",al.rotation);const Dl=Gl("sheen.textureRoughness");(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Dl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Dl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Dl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Cl,(()=>3))]);const yl=Gl("metallicReflectanceTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",yl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",yl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",yl.rotation);const Ll=Gl("reflectanceTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ll.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ll.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ll.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Fl,(()=>1))]);const hl=Gl("subSurface.refractionIntensityTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",hl.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",hl.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",hl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Cl,(()=>3))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Fl,(()=>1))]),(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Fl,(()=>1))]);const Ul=Gl("subSurface.thicknessTexture");(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ul.scale),(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ul.offset),(0,DN.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ul.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new ul(VN.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Fl,(()=>1))]);const Wl=Gl("subSurface.translucencyIntensityTexture");(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Wl.scale),(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Wl.offset),(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Wl.rotation),(0,DN.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new ul(VN.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Cl,(()=>3))]);const Ql=Gl("subSurface.translucencyColorTexture");(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Ql.scale),(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Ql.offset),(0,DN.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Ql.rotation),(0,DN.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new dl(VN.c.ANIMATIONTYPE_COLOR3,"diffuse",Cl,(()=>3))]),(0,DN.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new dl(VN.c.ANIMATIONTYPE_FLOAT,"intensity",Fl,(()=>1))]),(0,DN.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new dl(VN.c.ANIMATIONTYPE_FLOAT,"range",Fl,(()=>1))]),(0,DN.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new dl(VN.c.ANIMATIONTYPE_FLOAT,"innerAngle",Ml,(()=>1))]),(0,DN.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new dl(VN.c.ANIMATIONTYPE_FLOAT,"angle",Ml,(()=>1))]),(0,DN.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new dl(VN.c.ANIMATIONTYPE_COLOR3,"diffuse",Cl,(()=>3))]),(0,DN.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new dl(VN.c.ANIMATIONTYPE_FLOAT,"intensity",Fl,(()=>1))]);const Sl="KHR_animation_pointer";class ik{constructor(NN){this.name=Sl,this._loader=NN,this._pathToObjectConverter=(0,DN.i)(this._loader.sc)}get enabled(){return this._loader.isExtensionUsed(Sl)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(NN,BN,lN,kB,qN){var cN;const eN=null===(cN=kB.target.extensions)||void 0===cN?void 0:cN.KHR_animation_pointer;if(!eN||!this._pathToObjectConverter)return null;"pointer"!==kB.target.path&&PN.d.Warn("".concat(NN,"/target/path: Value (").concat(kB.target.path,") must be (","pointer",") when using the ").concat(this.name," extension")),void 0!=kB.target.node&&PN.d.Warn("".concat(NN,"/target/node: Value (").concat(kB.target.node,") must not be present when using the ").concat(this.name," extension"));const vN="".concat(NN,"/extensions/").concat(this.name),HN=eN.pointer;if(!HN)throw new Error("".concat(vN,": Pointer is missing"));try{const cN=this._pathToObjectConverter.convert(HN);if(!cN.info.interpolation)throw new Error("".concat(vN,"/pointer: Interpolation is missing"));return this._loader._loadAnimationChannelFromTargetInfoAsync(NN,BN,lN,kB,{object:cN.object,info:cN.info.interpolation},qN)}catch(TN){return PN.d.Warn("".concat(vN,"/pointer: Invalid pointer (").concat(HN,") skipped")),null}}}aN(Sl),mB(Sl,!0,(NN=>new ik(NN)));class tl{constructor(NN,BN,lN){this.frame=NN,this.action=BN,this.onlyOnce=lN,this.isDone=!1}_clone(){return new tl(this.frame,this.action,this.onlyOnce)}}var ol=lN(14760),Jl=lN(14818),Yl=lN(14813);class jk{get loop(){return this._loop}set loop(NN){NN!==this._loop&&(this._loop=NN,this.updateOptions({loop:NN}))}get currentTime(){var NN;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.audioContext&&(this.isPlaying||this.isPaused)){const NN=this.isPaused?0:Jl.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+NN}return 0}get spatialSound(){return this._spatialSound}set spatialSound(NN){if(NN==this._spatialSound)return;const BN=this.isPlaying;this.pause(),NN?(this._spatialSound=NN,this._updateSpatialParameters()):this._disableSpatialSound(),BN&&this.play()}constructor(NN,BN,lN){var kB;let cN=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,vN=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new RN.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=qN.fB.Zero(),this._localDirection=new qN.fB(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=NN,lN=lN||ZN.b.LastCreatedScene){var HN,TN,sN,VN;if(this._scene=lN,jk._SceneComponentInitialization(lN),this._readyToPlayCallback=cN,this._customAttenuationFunction=(NN,BN,lN,kB,qN)=>BN<lN?NN*(1-BN/lN):0,vN)this.autoplay=vN.autoplay||!1,this._loop=vN.loop||!1,void 0!==vN.volume&&(this._volume=vN.volume),this._spatialSound=null!==(HN=vN.spatialSound)&&void 0!==HN&&HN,this.maxDistance=null!==(TN=vN.maxDistance)&&void 0!==TN?TN:100,this.useCustomAttenuation=null!==(sN=vN.useCustomAttenuation)&&void 0!==sN&&sN,this.rolloffFactor=vN.rolloffFactor||1,this.refDistance=vN.refDistance||1,this.distanceModel=vN.distanceModel||"linear",this._playbackRate=vN.playbackRate||1,this._streaming=null!==(VN=vN.streaming)&&void 0!==VN&&VN,this._length=vN.length,this._offset=vN.offset;if(null!==(kB=Jl.c.audioEngine)&&void 0!==kB&&kB.canUseWebAudio&&Jl.c.audioEngine.audioContext){this._soundGain=Jl.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let NN=!0;if(BN)try{"string"===typeof BN?(this._urlType="String",this._url=BN):BN instanceof ArrayBuffer?this._urlType="ArrayBuffer":BN instanceof HTMLMediaElement?this._urlType="MediaElement":BN instanceof MediaStream?this._urlType="MediaStream":BN instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(BN)&&(this._urlType="Array");let lN=[],kB=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Jl.c.audioEngine.audioContext.createMediaElementSource(BN),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Jl.c.audioEngine.audioContext.createMediaStreamSource(BN),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":BN.byteLength>0&&(kB=!0,this._soundLoaded(BN));break;case"AudioBuffer":this._audioBufferLoaded(BN);break;case"String":lN.push(BN);case"Array":0===lN.length&&(lN=BN);for(let NN=0;NN<lN.length;NN++){const BN=lN[NN];if(kB=vN&&vN.skipCodecCheck||-1!==BN.indexOf(".mp3",BN.length-4)&&Jl.c.audioEngine.isMP3supported||-1!==BN.indexOf(".ogg",BN.length-4)&&Jl.c.audioEngine.isOGGsupported||-1!==BN.indexOf(".wav",BN.length-4)||-1!==BN.indexOf(".m4a",BN.length-4)||-1!==BN.indexOf(".mp4",BN.length-4)||-1!==BN.indexOf("blob:"),kB){this._streaming?(this._htmlAudioElement=new Audio(BN),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,eN.Tools.SetCorsBehavior(BN,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(BN,(NN=>{this._soundLoaded(NN)}),void 0,!0,!0,(NN=>{NN&&PN.d.Error("XHR "+NN.status+" error on: "+BN+"."),PN.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:NN=!1}NN?kB||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):PN.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(fN){PN.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Jl.c.audioEngine&&!Jl.c.audioEngine.WarnedWebAudioUnsupported&&(PN.d.Error("Web Audio is not supported by your browser."),Jl.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}}dispose(){var NN;null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(NN){var BN;null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.audioContext&&(this._audioBuffer=NN,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(NN){var BN;null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.audioContext&&Jl.c.audioEngine.audioContext.decodeAudioData(NN,(NN=>{this._audioBufferLoaded(NN)}),(NN=>{PN.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+NN)}))}setAudioBuffer(NN){var BN;null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&(this._audioBuffer=NN,this._isReadyToPlay=!0)}updateOptions(NN){var BN,lN,kB,qN,cN,eN,vN,HN,TN,RN,sN;NN&&(this.loop=null!==(BN=NN.loop)&&void 0!==BN?BN:this.loop,this.maxDistance=null!==(lN=NN.maxDistance)&&void 0!==lN?lN:this.maxDistance,this.useCustomAttenuation=null!==(kB=NN.useCustomAttenuation)&&void 0!==kB?kB:this.useCustomAttenuation,this.rolloffFactor=null!==(qN=NN.rolloffFactor)&&void 0!==qN?qN:this.rolloffFactor,this.refDistance=null!==(cN=NN.refDistance)&&void 0!==cN?cN:this.refDistance,this.distanceModel=null!==(eN=NN.distanceModel)&&void 0!==eN?eN:this.distanceModel,this._playbackRate=null!==(vN=NN.playbackRate)&&void 0!==vN?vN:this._playbackRate,this._length=null!==(HN=NN.length)&&void 0!==HN?HN:void 0,this.spatialSound=null!==(TN=NN.spatialSound)&&void 0!==TN?TN:this._spatialSound,this._setOffset(null!==(RN=NN.offset)&&void 0!==RN?RN:void 0),this.setVolume(null!==(sN=NN.volume)&&void 0!==sN?sN:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var NN,BN;null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio&&Jl.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(BN=this._soundPanner)&&void 0!==BN?BN:Jl.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var NN;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(NN=this._soundPanner)||void 0===NN||NN.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var NN;null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(NN){var BN;null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(NN),this._isOutputConnected=!0)}setDirectionalCone(NN,BN,lN){BN<NN?PN.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=NN,this._coneOuterAngle=BN,this._coneOuterGain=lN,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(NN){if(NN!=this._coneInnerAngle){var BN;if(this._coneOuterAngle<NN)return void PN.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=NN,null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(NN){if(NN!=this._coneOuterAngle){var BN;if(NN<this._coneInnerAngle)return void PN.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=NN,null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(NN){var BN;NN.equals(this._position)||(this._position.kB(NN),null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(NN){var BN;this._localDirection=NN,null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const NN=this._connectedTransformNode.getWorldMatrix(),BN=qN.fB.TransformNormal(this._localDirection,NN);BN.normalize(),this._soundPanner.orientationX.value=BN.x,this._soundPanner.orientationY.value=BN.y,this._soundPanner.orientationZ.value=BN.z}updateDistanceFromListener(){var NN;if(null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const NN=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ZB(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,NN,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(NN){this._customAttenuationFunction=NN}play(NN,BN,lN){var kB;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(kB=Jl.c.audioEngine)&&void 0!==kB&&kB.audioContext)try{var qN,cN;this._clearTimeoutsAndObservers();let kB=NN?(null===(qN=Jl.c.audioEngine)||void 0===qN?void 0:qN.audioContext.currentTime)+NN:null===(cN=Jl.c.audioEngine)||void 0===cN?void 0:cN.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Jl.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const NN=()=>{var lN;if(null!==(lN=Jl.c.audioEngine)&&void 0!==lN&&lN.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=null!==BN&&void 0!==BN?BN:0;const lN=this._htmlAudioElement.play();void 0!==lN&&lN.catch((()=>{var BN,lN;(null===(BN=Jl.c.audioEngine)||void 0===BN||BN.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(lN=Jl.c.audioEngine)||void 0===lN?void 0:lN.onAudioUnlockedObservable.addOnce((()=>{NN()})))}))}else{var kB;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(kB=Jl.c.audioEngine)||void 0===kB?void 0:kB.onAudioUnlockedObservable.addOnce((()=>{NN()}))}};NN()}}else{var eN;const qN=()=>{var qN;if(null!==(qN=Jl.c.audioEngine)&&void 0!==qN&&qN.audioContext){var cN;if(lN=lN||this._length,void 0!==BN&&this._setOffset(BN),this._soundSource){const NN=this._soundSource;NN.onended=()=>{NN.disconnect()}}if(this._soundSource=null===(cN=Jl.c.audioEngine)||void 0===cN?void 0:cN.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var eN,vN;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==BN&&(this._soundSource.loopStart=BN),void 0!==lN&&(this._soundSource.loopEnd=(0|BN)+lN),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},kB=NN?(null===(eN=Jl.c.audioEngine)||void 0===eN?void 0:eN.audioContext.currentTime)+NN:Jl.c.audioEngine.audioContext.currentTime;const qN=((this.isPaused?this.currentTime:0)+(null!==(vN=this._offset)&&void 0!==vN?vN:0))%this._soundSource.buffer.duration;this._soundSource.start(kB,qN,this.loop?void 0:lN)}}};"suspended"===(null===(eN=Jl.c.audioEngine)||void 0===eN?void 0:eN.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var NN;"suspended"===(null===(NN=Jl.c.audioEngine)||void 0===NN?void 0:NN.audioContext.state)?(Jl.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Jl.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{qN()})))):qN()}),500):qN()}this._startTime=kB,this.isPlaying=!0,this.isPaused=!1}catch(vN){PN.d.Error("Error while trying to play audio: "+this.name+", "+vN.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(NN){var BN;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var lN;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(lN=this._streamingSource)||void 0===lN||lN.disconnect();this.isPlaying=!1}else if(null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.audioContext&&this._soundSource){const BN=NN?Jl.c.audioEngine.audioContext.currentTime+NN:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(BN)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var NN;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var BN;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(BN=this._streamingSource)||void 0===BN||BN.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Jl.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(NN,BN){var lN;null!==(lN=Jl.c.audioEngine)&&void 0!==lN&&lN.canUseWebAudio&&this._soundGain&&(BN&&Jl.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Jl.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Jl.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(NN,Jl.c.audioEngine.audioContext.currentTime+BN)):this._soundGain.gain.value=NN),this._volume=NN}setPlaybackRate(NN){this._playbackRate=NN,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(NN){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=NN,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=NN=>this._onRegisterAfterWorldMatrixUpdate(NN),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(NN){var BN;if(NN.getBoundingInfo){const BN=NN.getBoundingInfo();this.setPosition(BN.boundingSphere.centerWorld)}else this.setPosition(NN.absolutePosition);null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const NN=()=>{(0,Yl.g)((()=>this._isReadyToPlay),(()=>{lN._audioBuffer=this.getAudioBuffer(),lN._isReadyToPlay=!0,lN.autoplay&&lN.play(0,this._offset,this._length)}),void 0,300)},BN={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},lN=new jk(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,BN);return this.useCustomAttenuation&&lN.setAttenuationFunction(this._customAttenuationFunction),lN.setPosition(this._position),lN.setPlaybackRate(this._playbackRate),NN(),lN}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const NN={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(NN.connectedMeshId=this._connectedTransformNode.id),NN.position=this._position.Fc(),NN.refDistance=this.refDistance,NN.distanceModel=this.distanceModel,NN.isDirectional=this._isDirectional,NN.localDirectionToMesh=this._localDirection.Fc(),NN.coneInnerAngle=this._coneInnerAngle,NN.coneOuterAngle=this._coneOuterAngle,NN.coneOuterGain=this._coneOuterGain),NN}static Parse(NN,BN,lN,kB){const cN=NN.name;let eN;eN=NN.url?lN+NN.url:lN+cN;const vN={autoplay:NN.autoplay,loop:NN.loop,volume:NN.volume,spatialSound:NN.spatialSound,maxDistance:NN.maxDistance,rolloffFactor:NN.rolloffFactor,refDistance:NN.refDistance,distanceModel:NN.distanceModel,playbackRate:NN.playbackRate};let HN;if(kB){const NN=()=>{(0,Yl.g)((()=>kB._isReadyToPlay),(()=>{HN._audioBuffer=kB.getAudioBuffer(),HN._isReadyToPlay=!0,HN.autoplay&&HN.play(0,HN._offset,HN._length)}),void 0,300)};HN=new jk(cN,new ArrayBuffer(0),BN,null,vN),NN()}else HN=new jk(cN,eN,BN,(()=>{BN.removePendingData(HN)}),vN),BN.addPendingData(HN);if(NN.position){const BN=qN.fB.IB(NN.position);HN.setPosition(BN)}if(NN.isDirectional&&(HN.setDirectionalCone(NN.coneInnerAngle||360,NN.coneOuterAngle||360,NN.coneOuterGain||0),NN.localDirectionToMesh)){const BN=qN.fB.IB(NN.localDirectionToMesh);HN.setLocalDirectionToMesh(BN)}if(NN.connectedMeshId){const lN=BN.getMeshById(NN.connectedMeshId);lN&&HN.attachToMesh(lN)}return NN.metadata&&(HN.metadata=NN.metadata),HN}_setOffset(NN){this._offset!==NN&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=NN)}_clearTimeoutsAndObservers(){var NN;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(NN=Jl.c.audioEngine)||void 0===NN||NN.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}jk._SceneComponentInitialization=NN=>{throw(0,ol.b)("AudioSceneComponent")},(0,XB.f)("BABYLON.Sound",jk);class zl{constructor(NN,BN,lN){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],BN.length!==lN.length)throw new Error("Sounds length does not equal weights length");this.loop=NN,this._weights=lN;let kB=0;for(const cN of lN)kB+=cN;const qN=kB>0?1/kB:0;for(let cN=0;cN<this._weights.length;cN++)this._weights[cN]*=qN;this._sounds=BN;for(const cN of this._sounds)cN.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(NN){if(NN!==this._coneInnerAngle){if(this._coneOuterAngle<NN)return void PN.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=NN;for(const BN of this._sounds)BN.directionalConeInnerAngle=NN}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(NN){if(NN!==this._coneOuterAngle){if(NN<this._coneInnerAngle)return void PN.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=NN;for(const BN of this._sounds)BN.directionalConeOuterAngle=NN}}get volume(){return this._volume}set volume(NN){if(NN!==this._volume)for(const BN of this._sounds)BN.setVolume(NN)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(NN){var BN;if(!this.isPaused){this.stop();const NN=Math.random();let BN=0;for(let lN=0;lN<this._weights.length;lN++)if(BN+=this._weights[lN],NN<=BN){this._currentIndex=lN;break}}const lN=this._sounds[null!==(BN=this._currentIndex)&&void 0!==BN?BN:0];lN.isReady()?lN.play(0,this.isPaused?void 0:NN):lN.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Nk{constructor(NN){let BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(NN=NN||ZN.b.LastCreatedScene)&&(this._scene=NN,this.soundCollection=[],this._options=BN,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var NN;null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio&&Jl.c.audioEngine.audioContext&&(this._outputAudioNode=Jl.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Jl.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Jl.c.audioEngine&&Jl.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(NN){var BN;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._outputAudioNode&&NN.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==NN.soundTrackId&&(-1===NN.soundTrackId?this._scene.mainSoundTrack.removeSound(NN):this._scene.soundTracks&&this._scene.soundTracks[NN.soundTrackId].removeSound(NN)),this.soundCollection.push(NN),NN.soundTrackId=this.id}removeSound(NN){const BN=this.soundCollection.indexOf(NN);-1!==BN&&this.soundCollection.splice(BN,1)}setVolume(NN){var BN;null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=NN)}switchPanningModelToHRTF(){var NN;if(null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio)for(let BN=0;BN<this.soundCollection.length;BN++)this.soundCollection[BN].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var NN;if(null!==(NN=Jl.c.audioEngine)&&void 0!==NN&&NN.canUseWebAudio)for(let BN=0;BN<this.soundCollection.length;BN++)this.soundCollection[BN].switchPanningModelToEqualPower()}connectToAnalyser(NN){var BN;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=NN,null!==(BN=Jl.c.audioEngine)&&void 0!==BN&&BN.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Jl.c.audioEngine.masterGain))}}var Bk=lN(15200),lk=lN(15162),kq=lN(14738);Jl.c.AudioEngineFactory=(NN,BN,lN)=>new qk(NN,BN,lN);class qk{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,BN=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new RN.b,this.onAudioLockedObservable=new RN.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,kq.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const kB=document.createElement("audio");this._hostElement=NN,this._audioContext=BN,this._audioDestination=lN;try{kB&&kB.canPlayType&&(kB.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||kB.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(qN){}try{kB&&kB.canPlayType&&kB.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(qN){}}lock(){this._triggerSuspendedState()}unlock(){var NN,BN;if("running"===(null===(NN=this._audioContext)||void 0===NN?void 0:NN.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(BN=this._audioContext)||void 0===BN||BN.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{PN.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var NN;null===(NN=this._audioContext)||void 0===NN||NN.addEventListener("statechange",(()=>{var NN;this.unlocked&&"running"!==(null===(NN=this._audioContext)||void 0===NN?void 0:NN.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var NN;return null!==(NN=this._audioContext)&&void 0!==NN&&NN.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(NN){this.canUseWebAudio=!1,PN.d.Error("Web Audio: "+NN.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(NN){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const NN=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",BN=document.createElement("style");BN.appendChild(document.createTextNode(NN)),document.getElementsByTagName("head")[0].appendChild(BN),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var NN;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(NN=this._audioContext)||void 0===NN||NN.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(NN){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=NN)}connectToAnalyser(NN){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=NN,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ck=lN(14756);(0,lN(15866).h)(Bk.c.NAME_AUDIO,((NN,BN,lN,kB)=>{let qN,cN=[];if(lN.vP=lN.vP||[],void 0!==NN.vP&&null!==NN.vP)for(let vN=0,HN=NN.vP.length;vN<HN;vN++){var eN;const HN=NN.vP[vN];null!==(eN=Jl.c.audioEngine)&&void 0!==eN&&eN.canUseWebAudio?(HN.url||(HN.url=HN.name),cN[HN.url]?lN.vP.push(jk.Parse(HN,BN,kB,cN[HN.url])):(qN=jk.Parse(HN,BN,kB),cN[HN.url]=qN,lN.vP.push(qN))):lN.vP.push(new jk(HN.name,null,BN))}cN=[]})),Object.defineProperty(lk.d.prototype,"mainSoundTrack",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),this._mainSoundTrack||(this._mainSoundTrack=new Nk(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),lk.d.prototype.getSoundByName=function(NN){let BN;for(BN=0;BN<this.mainSoundTrack.soundCollection.length;BN++)if(this.mainSoundTrack.soundCollection[BN].name===NN)return this.mainSoundTrack.soundCollection[BN];if(this.soundTracks)for(let lN=0;lN<this.soundTracks.length;lN++)for(BN=0;BN<this.soundTracks[lN].soundCollection.length;BN++)if(this.soundTracks[lN].soundCollection[BN].name===NN)return this.soundTracks[lN].soundCollection[BN];return null},Object.defineProperty(lk.d.prototype,"audioEnabled",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),NN.audioEnabled},set:function(NN){let BN=this._getComponent(Bk.c.NAME_AUDIO);BN||(BN=new ek(this),this.mc(BN)),NN?BN.enableAudio():BN.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(lk.d.prototype,"headphone",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),NN.headphone},set:function(NN){let BN=this._getComponent(Bk.c.NAME_AUDIO);BN||(BN=new ek(this),this.mc(BN)),NN?BN.switchAudioModeForHeadphones():BN.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(lk.d.prototype,"audioListenerPositionProvider",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),NN.audioListenerPositionProvider},set:function(NN){let BN=this._getComponent(Bk.c.NAME_AUDIO);if(BN||(BN=new ek(this),this.mc(BN)),NN&&"function"!==typeof NN)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");BN.audioListenerPositionProvider=NN},enumerable:!0,configurable:!0}),Object.defineProperty(lk.d.prototype,"audioListenerRotationProvider",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),NN.audioListenerRotationProvider},set:function(NN){let BN=this._getComponent(Bk.c.NAME_AUDIO);if(BN||(BN=new ek(this),this.mc(BN)),NN&&"function"!==typeof NN)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");BN.audioListenerRotationProvider=NN},enumerable:!0,configurable:!0}),Object.defineProperty(lk.d.prototype,"audioPositioningRefreshRate",{get:function(){let NN=this._getComponent(Bk.c.NAME_AUDIO);return NN||(NN=new ek(this),this.mc(NN)),NN.audioPositioningRefreshRate},set:function(NN){let BN=this._getComponent(Bk.c.NAME_AUDIO);BN||(BN=new ek(this),this.mc(BN)),BN.audioPositioningRefreshRate=NN},enumerable:!0,configurable:!0});class ek{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(NN){this.name=Bk.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new qN.fB,this._cachedCameraPosition=new qN.fB,this._lastCheck=0,this._invertMatrixTemp=new qN.Matrix,this._cameraDirectionTemp=new qN.fB,(NN=NN||ZN.b.LastCreatedScene)&&(this.PB=NN,NN.soundTracks=[],NN.vP=[])}register(){this.PB._afterRenderStage.registerStep(Bk.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(NN){if(NN.vP=[],this.PB.soundTracks)for(let BN=0;BN<this.PB.soundTracks.length;BN++){const lN=this.PB.soundTracks[BN];for(let BN=0;BN<lN.soundCollection.length;BN++)NN.vP.push(lN.soundCollection[BN].serialize())}}addFromContainer(NN){if(NN.vP)for(const BN of NN.vP)BN.play(),BN.autoplay=!0,this.PB.mainSoundTrack.addSound(BN)}removeFromContainer(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(NN.vP)for(const lN of NN.vP)lN.stop(),lN.autoplay=!1,this.PB.mainSoundTrack.removeSound(lN),BN&&lN.dispose()}dispose(){const NN=this.PB;if(NN._mainSoundTrack&&NN.mainSoundTrack.dispose(),NN.soundTracks)for(let BN=0;BN<NN.soundTracks.length;BN++)NN.soundTracks[BN].dispose()}disableAudio(){const NN=this.PB;let BN;for(this._audioEnabled=!1,Jl.c.audioEngine&&Jl.c.audioEngine.audioContext&&Jl.c.audioEngine.audioContext.suspend(),BN=0;BN<NN.mainSoundTrack.soundCollection.length;BN++)NN.mainSoundTrack.soundCollection[BN].pause();if(NN.soundTracks)for(BN=0;BN<NN.soundTracks.length;BN++)for(let lN=0;lN<NN.soundTracks[BN].soundCollection.length;lN++)NN.soundTracks[BN].soundCollection[lN].pause()}enableAudio(){const NN=this.PB;let BN;for(this._audioEnabled=!0,Jl.c.audioEngine&&Jl.c.audioEngine.audioContext&&Jl.c.audioEngine.audioContext.resume(),BN=0;BN<NN.mainSoundTrack.soundCollection.length;BN++)NN.mainSoundTrack.soundCollection[BN].isPaused&&NN.mainSoundTrack.soundCollection[BN].play();if(NN.soundTracks)for(BN=0;BN<NN.soundTracks.length;BN++)for(let lN=0;lN<NN.soundTracks[BN].soundCollection.length;lN++)NN.soundTracks[BN].soundCollection[lN].isPaused&&NN.soundTracks[BN].soundCollection[lN].play()}switchAudioModeForHeadphones(){const NN=this.PB;if(this._headphone=!0,NN.mainSoundTrack.switchPanningModelToHRTF(),NN.soundTracks)for(let BN=0;BN<NN.soundTracks.length;BN++)NN.soundTracks[BN].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const NN=this.PB;if(this._headphone=!1,NN.mainSoundTrack.switchPanningModelToEqualPower(),NN.soundTracks)for(let BN=0;BN<NN.soundTracks.length;BN++)NN.soundTracks[BN].switchPanningModelToEqualPower()}_afterRender(){const NN=ck.b.Now;if(this._lastCheck&&NN-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=NN;const BN=this.PB;if(!this._audioEnabled||!BN._mainSoundTrack||!BN.soundTracks||0===BN._mainSoundTrack.soundCollection.length&&1===BN.soundTracks.length)return;const lN=Jl.c.audioEngine;if(lN&&lN.audioContext){let NN,kB=BN.activeCamera;if(BN.activeCameras&&BN.activeCameras.length>0&&(kB=BN.activeCameras[0]),this.audioListenerPositionProvider){const NN=this.audioListenerPositionProvider();lN.audioContext.listener.setPosition(NN.x||0,NN.y||0,NN.z||0)}else kB?this._cachedCameraPosition.equals(kB.globalPosition)||(this._cachedCameraPosition.kB(kB.globalPosition),lN.audioContext.listener.setPosition(kB.globalPosition.x,kB.globalPosition.y,kB.globalPosition.z)):lN.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const NN=this.audioListenerRotationProvider();lN.audioContext.listener.setOrientation(NN.x||0,NN.y||0,NN.z||0,0,1,0)}else kB?(kB.rigCameras&&kB.rigCameras.length>0&&(kB=kB.rigCameras[0]),kB.getViewMatrix().invertToRef(this._invertMatrixTemp),qN.fB.TransformNormalToRef(ek._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.kB(this._cameraDirectionTemp),lN.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):lN.audioContext.listener.setOrientation(0,0,0,0,1,0);for(NN=0;NN<BN.mainSoundTrack.soundCollection.length;NN++){const lN=BN.mainSoundTrack.soundCollection[NN];lN.useCustomAttenuation&&lN.updateDistanceFromListener()}if(BN.soundTracks)for(NN=0;NN<BN.soundTracks.length;NN++)for(let lN=0;lN<BN.soundTracks[NN].soundCollection.length;lN++){const kB=BN.soundTracks[NN].soundCollection[lN];kB.useCustomAttenuation&&kB.updateDistanceFromListener()}}}}ek._CameraDirection=new qN.fB(0,0,-1),jk._SceneComponentInitialization=NN=>{let BN=NN._getComponent(Bk.c.NAME_AUDIO);BN||(BN=new ek(NN),NN.mc(BN))};const vk="MSFT_audio_emitter";class Hk{constructor(NN){this.name=vk,this._loader=NN,this.enabled=this._loader.isExtensionUsed(vk)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const NN=this._loader.sc.extensions;if(NN&&NN[this.name]){const BN=NN[this.name];this._clips=BN.clips,this._emitters=BN.emitters,hN.Assign(this._clips),hN.Assign(this._emitters)}}loadSceneAsync(NN,BN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(lN,kB)=>{const qN=new Array;qN.push(this._loader.loadSceneAsync(NN,BN));for(const NN of kB.emitters){const BN=hN.Get("".concat(lN,"/emitters"),this._emitters,NN);if(void 0!=BN.refDistance||void 0!=BN.maxDistance||void 0!=BN.rolloffFactor||void 0!=BN.distanceModel||void 0!=BN.innerAngle||void 0!=BN.outerAngle)throw new Error("".concat(lN,": Direction or Distance properties are not allowed on emitters attached to a scene"));qN.push(this._loadEmitterAsync("".concat(lN,"/emitters/").concat(BN.index),BN))}await Promise.all(qN)}))}loadNodeAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(NN,kB)=>{const cN=new Array,vN=await this._loader.loadNodeAsync(NN,BN,(BN=>{for(const lN of kB.emitters){const kB=hN.Get("".concat(NN,"/emitters"),this._emitters,lN);cN.push(this._loadEmitterAsync("".concat(NN,"/emitters/").concat(kB.index),kB).then((()=>{for(const NN of kB._babylonSounds)NN.attachToMesh(BN),void 0==kB.innerAngle&&void 0==kB.outerAngle||(NN.setLocalDirectionToMesh(qN.fB.Forward()),NN.setDirectionalCone(2*eN.Tools.ToDegrees(void 0==kB.innerAngle?Math.PI:kB.innerAngle),2*eN.Tools.ToDegrees(void 0==kB.outerAngle?Math.PI:kB.outerAngle),0))})))}lN(BN)}));return await Promise.all(cN),vN}))}loadAnimationAsync(NN,BN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(lN,kB)=>{const qN=await this._loader.loadAnimationAsync(NN,BN),cN=new Array;hN.Assign(kB.events);for(const eN of kB.events)cN.push(this._loadAnimationEventAsync("".concat(lN,"/events/").concat(eN.index),NN,BN,eN,qN));return await Promise.all(cN),qN}))}_loadClipAsync(NN,BN){if(BN._objectURL)return BN._objectURL;let lN;if(BN.uri)lN=this._loader.loadUriAsync(NN,BN,BN.uri);else{const kB=hN.Get("".concat(NN,"/bufferView"),this._loader.sc.bufferViews,BN.bufferView);lN=this._loader.loadBufferViewAsync("/bufferViews/".concat(kB.index),kB)}return BN._objectURL=lN.then((NN=>URL.createObjectURL(new Blob([NN],{type:BN.mimeType})))),BN._objectURL}_loadEmitterAsync(NN,BN){if(BN._babylonSounds=BN._babylonSounds||[],!BN._babylonData){const NN=new Array,lN=BN.name||"NB".concat(BN.index),kB={loop:!1,autoplay:!1,volume:void 0==BN.volume?1:BN.volume};for(let cN=0;cN<BN.clips.length;cN++){const qN="/extensions/".concat(this.name,"/clips"),eN=hN.Get(qN,this._clips,BN.clips[cN].clip);NN.push(this._loadClipAsync("".concat(qN,"/").concat(BN.clips[cN].clip),eN).then((NN=>{const qN=BN._babylonSounds[cN]=new jk(lN,NN,this._loader.babylonScene,null,kB);qN.refDistance=BN.refDistance||1,qN.maxDistance=BN.maxDistance||256,qN.rolloffFactor=BN.rolloffFactor||1,qN.distanceModel=BN.distanceModel||"exponential"})))}const qN=Promise.all(NN).then((()=>{const NN=BN.clips.map((NN=>NN.weight||1)),lN=new zl(BN.loop||!1,BN._babylonSounds,NN);BN.innerAngle&&(lN.directionalConeInnerAngle=2*eN.Tools.ToDegrees(BN.innerAngle)),BN.outerAngle&&(lN.directionalConeOuterAngle=2*eN.Tools.ToDegrees(BN.outerAngle)),BN.volume&&(lN.volume=BN.volume),BN._babylonData.sound=lN}));BN._babylonData={loaded:qN}}return BN._babylonData.loaded}_getEventAction(NN,BN,lN,kB,qN){switch(lN){case"play":return NN=>{const lN=(qN||0)+(NN-kB);BN.play(lN)};case"stop":return()=>{BN.stop()};case"pause":return()=>{BN.pause()};default:throw new Error("".concat(NN,": Unsupported action ").concat(lN))}}_loadAnimationEventAsync(NN,BN,lN,kB,qN){if(0==qN.targetedAnimations.length)return Promise.resolve();const cN=qN.targetedAnimations[0],eN=kB.NB,vN=hN.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,eN);return this._loadEmitterAsync(NN,vN).then((()=>{const BN=vN._babylonData.sound;if(BN){const lN=new tl(kB.time,this._getEventAction(NN,BN,kB.action,kB.time,kB.startOffset));cN.animation.addEvent(lN),qN.onAnimationGroupEndObservable.add((()=>{BN.stop()})),qN.onAnimationGroupPauseObservable.add((()=>{BN.pause()}))}}))}}aN(vk),mB(vk,!0,(NN=>new Hk(NN)));const Tk="MSFT_lod";class Rk{constructor(NN){var BN,lN;this.name=Tk,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new RN.b,this.onMaterialLODsLoadedObservable=new RN.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=NN,this.maxLODsToLoad=null!==(BN=null===(lN=this._loader.parent.extensionOptions[Tk])||void 0===lN?void 0:lN.maxLODsToLoad)&&void 0!==BN?BN:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Tk)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let NN=0;NN<this._nodePromiseLODs.length;NN++){const BN=Promise.all(this._nodePromiseLODs[NN]).then((()=>{0!==NN&&(this._loader.endPerformanceCounter("Node LOD ".concat(NN)),this._loader.log("Loaded node LOD ".concat(NN))),this.onNodeLODsLoadedObservable.notifyObservers(NN),NN!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter("Node LOD ".concat(NN+1)),this._loadBufferLOD(this._nodeBufferLODs,NN+1),this._nodeSignalLODs[NN]&&this._nodeSignalLODs[NN].resolve())}));this._loader._completePromises.push(BN)}for(let NN=0;NN<this._materialPromiseLODs.length;NN++){const BN=Promise.all(this._materialPromiseLODs[NN]).then((()=>{0!==NN&&(this._loader.endPerformanceCounter("Material LOD ".concat(NN)),this._loader.log("Loaded material LOD ".concat(NN))),this.onMaterialLODsLoadedObservable.notifyObservers(NN),NN!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter("Material LOD ".concat(NN+1)),this._loadBufferLOD(this._materialBufferLODs,NN+1),this._materialSignalLODs[NN]&&this._materialSignalLODs[NN].resolve())}));this._loader._completePromises.push(BN)}}loadSceneAsync(NN,BN){const lN=this._loader.loadSceneAsync(NN,BN);return this._loadBufferLOD(this._bufferLODs,0),lN}loadNodeAsync(NN,BN,lN){return WN.LoadExtensionAsync(NN,BN,this.name,(async(NN,qN)=>{let cN;const eN=this._getLODs(NN,BN,this._loader.sc.nodes,qN.ids);this._loader.logOpen("".concat(NN));for(let BN=0;BN<eN.length;BN++){const NN=eN[BN];0!==BN&&(this._nodeIndexLOD=BN,this._nodeSignalLODs[BN]=this._nodeSignalLODs[BN]||new kB);const qN=NN=>{lN(NN),NN.DT(!1)},vN=this._loader.loadNodeAsync("/nodes/".concat(NN.index),NN,qN).then((NN=>{if(0!==BN){const NN=eN[BN-1];NN._babylonTransformNode&&(this._disposeTransformNode(NN._babylonTransformNode),delete NN._babylonTransformNode)}return NN.DT(!0),NN}));this._nodePromiseLODs[BN]=this._nodePromiseLODs[BN]||[],0===BN?cN=vN:(this._nodeIndexLOD=null,this._nodePromiseLODs[BN].push(vN))}return this._loader.logClose(),await cN}))}_loadMaterialAsync(NN,BN,lN,kB,qN){return this._nodeIndexLOD?null:WN.LoadExtensionAsync(NN,BN,this.name,(async(NN,cN)=>{let eN;const vN=this._getLODs(NN,BN,this._loader.sc.materials,cN.ids);this._loader.logOpen("".concat(NN));for(let BN=0;BN<vN.length;BN++){const NN=vN[BN];0!==BN&&(this._materialIndexLOD=BN);const cN=this._loader._loadMaterialAsync("/materials/".concat(NN.index),NN,lN,kB,(NN=>{0===BN&&qN(NN)})).then((NN=>{if(0!==BN){qN(NN);const lN=vN[BN-1]._data;lN[kB]&&(this._disposeMaterials([lN[kB].babylonMaterial]),delete lN[kB])}return NN}));this._materialPromiseLODs[BN]=this._materialPromiseLODs[BN]||[],0===BN?eN=cN:(this._materialIndexLOD=null,this._materialPromiseLODs[BN].push(cN))}return this._loader.logClose(),await eN}))}_loadUriAsync(NN,BN,lN){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const qN=this._nodeIndexLOD-1;return this._nodeSignalLODs[qN]=this._nodeSignalLODs[qN]||new kB,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(NN,BN,lN)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const qN=this._materialIndexLOD-1;return this._materialSignalLODs[qN]=this._materialSignalLODs[qN]||new kB,this._materialSignalLODs[qN].promise.then((async()=>await this._loader.loadUriAsync(NN,BN,lN)))}return null}loadBufferAsync(NN,BN,lN,qN){if(this._loader.parent.useRangeRequests&&!BN.uri){if(!this._loader.bin)throw new Error("".concat(NN,": Uri is missing or the binary glTF is missing its binary chunk"));const BN=async(NN,BN)=>{const cN=lN,eN=cN+qN-1;let vN=NN[BN];return vN?(vN.start=Math.min(vN.start,cN),vN.end=Math.max(vN.end,eN)):(vN={start:cN,end:eN,loaded:new kB},NN[BN]=vN),await vN.loaded.promise.then((NN=>new Uint8Array(NN.buffer,NN.byteOffset+lN-vN.start,qN)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?BN(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?BN(this._materialBufferLODs,this._materialIndexLOD):BN(this._bufferLODs,0)}return null}_loadBufferLOD(NN,BN){const lN=NN[BN];lN&&(this._loader.log("Loading buffer range [".concat(lN.start,"-").concat(lN.end,"]")),this._loader.bin.readAsync(lN.start,lN.end-lN.start+1).then((NN=>{lN.loaded.resolve(NN)}),(NN=>{lN.loaded.reject(NN)})))}_getLODs(NN,BN,lN,kB){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const qN=[];for(let cN=kB.length-1;cN>=0;cN--)if(qN.push(hN.Get("".concat(NN,"/ids/").concat(kB[cN]),lN,kB[cN])),qN.length===this.maxLODsToLoad)return qN;return qN.push(BN),qN}_disposeTransformNode(NN){const BN=[],lN=NN.material;lN&&BN.push(lN);for(const qN of NN.getChildMeshes())qN.material&&BN.push(qN.material);NN.dispose();const kB=BN.filter((NN=>this._loader.babylonScene.meshes.every((BN=>BN.material!=NN))));this._disposeMaterials(kB)}_disposeMaterials(NN){const BN={};for(const lN of NN){for(const NN of lN.getActiveTextures())BN[NN.uniqueId]=NN;lN.dispose()}for(const lN in BN)for(const NN of this._loader.babylonScene.materials)NN.hasTexture(BN[lN])&&delete BN[lN];for(const lN in BN)BN[lN].dispose()}}aN(Tk),mB(Tk,!0,(NN=>new Rk(NN)));const sk="MSFT_minecraftMesh";class Vk{constructor(NN){this.name=sk,this._loader=NN,this.enabled=this._loader.isExtensionUsed(sk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtraAsync(NN,BN,this.name,(async(kB,qN)=>{if(qN){if(!(lN instanceof AN.e))throw new Error("".concat(kB,": Material type not supported"));const qN=this._loader.loadMaterialPropertiesAsync(NN,BN,lN);return lN.needAlphaBlending()&&(lN.forceDepthWrite=!0,lN.separateCullingPass=!0),lN.backFaceCulling=lN.forceDepthWrite,lN.twoSidedLighting=!0,await qN}}))}}aN(sk),mB(sk,!0,(NN=>new Vk(NN)));const fk="MSFT_sRGBFactors";class Zk{constructor(NN){this.name=fk,this._loader=NN,this.enabled=this._loader.isExtensionUsed(fk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(NN,BN,lN){return WN.LoadExtraAsync(NN,BN,this.name,(async(kB,qN)=>{if(qN){if(!(lN instanceof AN.e))throw new Error("".concat(kB,": Material type not supported"));const qN=this._loader.loadMaterialPropertiesAsync(NN,BN,lN),cN=lN.VB().getEngine().useExactSrgbConversions;return lN.albedoTexture||lN.albedoColor.toLinearSpaceToRef(lN.albedoColor,cN),lN.reflectivityTexture||lN.reflectivityColor.toLinearSpaceToRef(lN.reflectivityColor,cN),await qN}}))}}aN(fk),mB(fk,!0,(NN=>new Zk(NN)));var Pk=lN(15872);const Ck={};var Fk=lN(15926),Ik=lN(15901),Ak=lN(15878),Mk=lN(15886);function Gk(NN,BN){for(const lN of NN)for(const NN of lN.dataOutputs)if(NN.uniqueId===BN)return NN;throw new Error("Could not find data out connection with unique id "+BN)}function Xk(NN,BN){for(const lN of NN)if(lN instanceof Ik.b)for(const NN of lN.signalInputs)if(NN.uniqueId===BN)return NN;throw new Error("Could not find signal in connection with unique id "+BN)}async function uk(NN,BN){const kB=await Promise.all(NN.allBlocks.map((async NN=>{const BN=function(NN){switch(NN){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([lN.e(78),lN.e(79)]).then(lN.bind(lN,17802))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await lN.e(80).then(lN.bind(lN,17805))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await lN.e(81).then(lN.bind(lN,17814))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await lN.e(82).then(lN.bind(lN,17823))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await lN.e(83).then(lN.bind(lN,17825))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await lN.e(84).then(lN.bind(lN,17828))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await lN.e(85).then(lN.bind(lN,17835))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await lN.e(86).then(lN.bind(lN,17841))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await lN.e(87).then(lN.bind(lN,17843))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await lN.e(95).then(lN.bind(lN,17874))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await lN.e(96).then(lN.bind(lN,17879))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await lN.e(97).then(lN.bind(lN,17885))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await lN.e(98).then(lN.bind(lN,17891))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await lN.e(99).then(lN.bind(lN,17900))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await lN.e(100).then(lN.bind(lN,17905))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await lN.e(101).then(lN.bind(lN,17909))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await lN.e(102).then(lN.bind(lN,17911))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await lN.e(103).then(lN.bind(lN,17918))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await lN.e(104).then(lN.bind(lN,17923))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await lN.e(105).then(lN.bind(lN,17931))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await lN.e(106).then(lN.bind(lN,17933))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await lN.e(107).then(lN.bind(lN,17937))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await lN.e(108).then(lN.bind(lN,17941))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await lN.e(109).then(lN.bind(lN,17947))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await lN.e(110).then(lN.bind(lN,17956))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await lN.e(111).then(lN.bind(lN,17959))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await lN.e(112).then(lN.bind(lN,17966))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await lN.e(113).then(lN.bind(lN,17971))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await lN.e(92).then(lN.bind(lN,17978))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await lN.e(114).then(lN.bind(lN,17983))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await lN.e(115).then(lN.bind(lN,17990))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await lN.e(116).then(lN.bind(lN,17997))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await lN.e(93).then(lN.bind(lN,18001))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await lN.e(88).then(lN.bind(lN,17845))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await lN.e(94).then(lN.bind(lN,18009))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await lN.e(89).then(lN.bind(lN,17868))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await lN.e(90).then(lN.bind(lN,17870))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await lN.e(91).then(lN.bind(lN,18013))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await lN.e(117).then(lN.bind(lN,18019))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await lN.e(118).then(lN.bind(lN,18025))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await lN.e(119).then(lN.bind(lN,18027))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await lN.e(120).then(lN.bind(lN,18033))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await lN.e(121).then(lN.bind(lN,18040))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await lN.e(122).then(lN.bind(lN,18046))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await lN.e(123).then(lN.bind(lN,18053))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await lN.e(124).then(lN.bind(lN,18057))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await lN.e(125).then(lN.bind(lN,18064))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await lN.e(126).then(lN.bind(lN,18070))).FlowGraphDataSwitchBlock;default:if(Ck[NN])return Ck[NN];throw new Error("Unknown block name ".concat(NN))}}(NN.className);return await BN()})));return function(NN,BN,lN){var kB;const qN=BN.coordinator.createGraph(),cN=[],eN=null!==(kB=BN.valueParseFunction)&&void 0!==kB?kB:Ak.c;for(let vN=0;vN<NN.allBlocks.length;vN++){const kB=Ek(NN.allBlocks[vN],{PB:BN.coordinator.config.PB,pathConverter:BN.pathConverter,assetsContainer:BN.coordinator.config.PB,valueParseFunction:eN},lN[vN]);cN.push(kB),kB instanceof Fk.d&&qN.addEventBlock(kB)}for(const vN of cN){for(const NN of vN.dataInputs)for(const BN of NN.connectedPointIds){const lN=Gk(cN,BN);NN.connectTo(lN)}if(vN instanceof Ik.b)for(const NN of vN.signalOutputs)for(const BN of NN.connectedPointIds){const lN=Xk(cN,BN);NN.connectTo(lN)}}for(const vN of NN.executionContexts)dk(vN,{graph:qN,valueParseFunction:eN},NN.rightHanded);return qN}(NN,BN,kB)}function dk(NN,BN,lN){var kB;const qN=BN.graph.createContext();NN.enableLogging&&(qN.enableLogging=!0),qN.treatDataAsRightHanded=lN||!1;const cN=null!==(kB=BN.valueParseFunction)&&void 0!==kB?kB:Ak.c;qN.uniqueId=NN.uniqueId;const eN=qN.VB();if(NN._assetsContext){var vN,HN,TN,RN,sN,VN,fN,ZN,PN,CN;const BN=NN._assetsContext,lN={meshes:null===(vN=BN.meshes)||void 0===vN?void 0:vN.map((NN=>eN.getMeshById(NN))),lights:null===(HN=BN.lights)||void 0===HN?void 0:HN.map((NN=>eN.getLightByName(NN))),cameras:null===(TN=BN.cameras)||void 0===TN?void 0:TN.map((NN=>eN.getCameraByName(NN))),materials:null===(RN=BN.materials)||void 0===RN?void 0:RN.map((NN=>eN.getMaterialById(NN))),textures:null===(sN=BN.textures)||void 0===sN?void 0:sN.map((NN=>eN.getTextureByName(NN))),animations:null===(VN=BN.animations)||void 0===VN?void 0:VN.map((NN=>eN.animations.find((BN=>BN.name===NN)))),skeletons:null===(fN=BN.skeletons)||void 0===fN?void 0:fN.map((NN=>eN.getSkeletonByName(NN))),kP:null===(ZN=BN.kP)||void 0===ZN?void 0:ZN.map((NN=>eN.getParticleSystemById(NN))),animationGroups:null===(PN=BN.animationGroups)||void 0===PN?void 0:PN.map((NN=>eN.getAnimationGroupByName(NN))),transformNodes:null===(CN=BN.transformNodes)||void 0===CN?void 0:CN.map((NN=>eN.getTransformNodeById(NN))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vP:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};qN.assetsContext=lN}for(const FN in NN._userVariables){const BN=cN(FN,NN._userVariables,qN.assetsContext,eN);qN.userVariables[FN]=BN}for(const FN in NN._connectionValues){const BN=cN(FN,NN._connectionValues,qN.assetsContext,eN);qN._setConnectionValueByKey(FN,BN)}return qN}function Ek(NN,BN,lN){var kB;const qN={},cN=null!==(kB=BN.valueParseFunction)&&void 0!==kB?kB:Ak.c;if(NN.config)for(const vN in NN.config)qN[vN]=cN(vN,NN.config,BN.assetsContainer||BN.PB,BN.PB);if((0,Ak.g)(NN.className)){if(!BN.pathConverter)throw new Error("Path converter is required for this block");qN.pathConverter=BN.pathConverter}const eN=new lN(qN);eN.uniqueId=NN.uniqueId;for(let vN=0;vN<NN.dataInputs.length;vN++){const BN=eN.getDataInput(NN.dataInputs[vN].name);if(!BN)throw new Error("Could not find data input with name "+NN.dataInputs[vN].name+" in block "+NN.className);BN.deserialize(NN.dataInputs[vN])}for(let vN=0;vN<NN.dataOutputs.length;vN++){const BN=eN.getDataOutput(NN.dataOutputs[vN].name);if(!BN)throw new Error("Could not find data output with name "+NN.dataOutputs[vN].name+" in block "+NN.className);BN.deserialize(NN.dataOutputs[vN])}return eN.metadata=NN.metadata,eN.deserialize&&eN.deserialize(NN),eN}function Kk(NN){const[BN,lN]=NN.split(":");return gk({op:BN,extension:lN})}function gk(NN){var BN;let lN=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const kB=NN.extension?null===(BN=rk[NN.extension])||void 0===BN?void 0:BN[NN.op]:pk[NN.op];if(!kB&&(PN.d.Warn("No mapping found for operation ".concat(NN.op," and extension ").concat(NN.extension||"KHR_interactivity")),lN)){const BN={},lN={flows:{}};if(NN.inputValueSockets){BN.values={};for(const lN in NN.inputValueSockets)BN.values[lN]={name:lN}}return NN.outputValueSockets&&(lN.values={},Object.keys(NN.outputValueSockets).forEach((NN=>{lN.values[NN]={name:NN}}))),{RV:[],inputs:BN,outputs:lN}}return kB}function nk(NN,BN,lN){rk[BN]||(rk[BN]={}),rk[BN][NN]=lN}const rk={BABYLON:{"flow/log":{RV:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},pk={"event/onStart":{RV:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{RV:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{RV:["FlowGraphSendCustomEventBlock"],extraProcessor(NN,BN,lN,kB,qN){if("event/send"!==BN.op||!NN.configuration||1!==Object.keys(NN.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const cN=NN.configuration.event.value[0];if("number"!==typeof cN)throw new Error("Event id should be a number");const eN=kB.arrays.events[cN],vN=qN[0];return vN.config||(vN.config={}),vN.config.eventId=eN.eventId,vN.config.eventData=eN.eventData,qN}},"event/receive":{RV:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(NN,BN){var lN;if(!NN.configuration)return PN.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const kB=NN.configuration.event;if(!kB)return PN.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const qN=kB.value[0];if("number"!==typeof qN)return PN.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(lN=BN.events)||void 0===lN?void 0:lN[qN])?{valid:!0}:(PN.d.Error("Event with id ".concat(qN," not found")),{valid:!1,error:"Event with id ".concat(qN," not found")})},extraProcessor(NN,BN,lN,kB,qN){if("event/receive"!==BN.op||!NN.configuration||1!==Object.keys(NN.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const cN=NN.configuration.event.value[0];if("number"!==typeof cN)throw new Error("Event id should be a number");const eN=kB.arrays.events[cN],vN=qN[0];return vN.config||(vN.config={}),vN.config.eventId=eN.eventId,vN.config.eventData=eN.eventData,qN}},"math/e":xk("FlowGraphEBlock"),"math/pi":xk("FlowGraphPIBlock"),"math/inf":xk("FlowGraphInfBlock"),"math/nan":xk("FlowGraphNaNBlock"),"math/abs":xk("FlowGraphAbsBlock"),"math/sign":xk("FlowGraphSignBlock"),"math/trunc":xk("FlowGraphTruncBlock"),"math/floor":xk("FlowGraphFloorBlock"),"math/ceil":xk("FlowGraphCeilBlock"),"math/round":{RV:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN){var cN;return(cN=qN[0]).config||(cN.config={}),qN[0].config.roundHalfAwayFromZero=!0,qN}},"math/fract":xk("FlowGraphFractBlock"),"math/neg":xk("FlowGraphNegationBlock"),"math/add":xk("FlowGraphAddBlock",["a","b"],!0),"math/sub":xk("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{RV:["FlowGraphMultiplyBlock"],extraProcessor(NN,BN,lN,kB,qN){var cN;(cN=qN[0]).config||(cN.config={}),qN[0].config.useMatrixPerComponent=!0,qN[0].config.preventIntegerFloatArithmetic=!0;let eN=-1;return Object.keys(NN.values||{}).find((BN=>{var lN;return void 0!==(null===(lN=NN.values)||void 0===lN?void 0:lN[BN].type)&&(eN=NN.values[BN].type,!0)})),-1!==eN&&(qN[0].config.type=kB.arrays.types[eN].flowGraphType),qN},validation:NN=>NN.values?Ok(NN):{valid:!0}},"math/div":xk("FlowGraphDivideBlock",["a","b"],!0),"math/rem":xk("FlowGraphModuloBlock",["a","b"]),"math/min":xk("FlowGraphMinBlock",["a","b"]),"math/max":xk("FlowGraphMaxBlock",["a","b"]),"math/clamp":xk("FlowGraphClampBlock",["a","b","c"]),"math/saturate":xk("FlowGraphSaturateBlock"),"math/mix":xk("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":xk("FlowGraphEqualityBlock",["a","b"]),"math/lt":xk("FlowGraphLessThanBlock",["a","b"]),"math/le":xk("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":xk("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":xk("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":xk("FlowGraphIsNaNBlock"),"math/isinf":xk("FlowGraphIsInfBlock"),"math/select":{RV:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{RV:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":xk("FlowGraphSinBlock"),"math/cos":xk("FlowGraphCosBlock"),"math/tan":xk("FlowGraphTanBlock"),"math/asin":xk("FlowGraphASinBlock"),"math/acos":xk("FlowGraphACosBlock"),"math/atan":xk("FlowGraphATanBlock"),"math/atan2":xk("FlowGraphATan2Block",["a","b"]),"math/sinh":xk("FlowGraphSinhBlock"),"math/cosh":xk("FlowGraphCoshBlock"),"math/tanh":xk("FlowGraphTanhBlock"),"math/asinh":xk("FlowGraphASinhBlock"),"math/acosh":xk("FlowGraphACoshBlock"),"math/atanh":xk("FlowGraphATanhBlock"),"math/exp":xk("FlowGraphExponentialBlock"),"math/log":xk("FlowGraphLogBlock"),"math/log2":xk("FlowGraphLog2Block"),"math/log10":xk("FlowGraphLog10Block"),"math/sqrt":xk("FlowGraphSquareRootBlock"),"math/cbrt":xk("FlowGraphCubeRootBlock"),"math/pow":xk("FlowGraphPowerBlock",["a","b"]),"math/length":xk("FlowGraphLengthBlock"),"math/normalize":xk("FlowGraphNormalizeBlock"),"math/dot":xk("FlowGraphDotBlock",["a","b"]),"math/cross":xk("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":xk("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":xk("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{RV:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{RV:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{RV:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{RV:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{RV:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{RV:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{RV:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":xk("FlowGraphTransposeBlock"),"math/determinant":xk("FlowGraphDeterminantBlock"),"math/inverse":xk("FlowGraphInvertMatrixBlock"),"math/matmul":xk("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{RV:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"gc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN,cN){const eN=qN[0].dataInputs.find((NN=>"rotationQuaternion"===NN.name));if(!eN)throw new Error("Rotation quaternion input not found");return cN._connectionValues[eN.uniqueId]&&(cN._connectionValues[eN.uniqueId].type="Quaternion"),qN}},"math/matDecompose":{RV:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"gc"}}}},"math/quatConjugate":xk("FlowGraphConjugateBlock",["a"]),"math/quatMul":{RV:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN){var cN;return(cN=qN[0]).config||(cN.config={}),qN[0].config.type="Quaternion",qN}},"math/quatAngleBetween":xk("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{RV:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":xk("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":xk("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{RV:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN){var cN;return(cN=qN[0]).config||(cN.config={}),qN[0].config.inputIsColumnMajor=!0,qN}},"math/extract2x2":{RV:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{RV:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN){var cN;return(cN=qN[0]).config||(cN.config={}),qN[0].config.inputIsColumnMajor=!0,qN}},"math/extract3x3":{RV:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{RV:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN){var cN;return(cN=qN[0]).config||(cN.config={}),qN[0].config.inputIsColumnMajor=!0,qN}},"math/extract4x4":{RV:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{RV:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN,cN){var eN,vN,HN;(HN=qN[0]).config||(HN.config={});const TN=qN[0].dataInputs[0];return qN[0].config.valueType=null!==(eN=null===(vN=cN._connectionValues[TN.uniqueId])||void 0===vN?void 0:vN.type)&&void 0!==eN?eN:"FlowGraphInteger",qN}},"math/and":{RV:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN,cN){var eN,vN,HN,TN,RN;(RN=qN[0]).config||(RN.config={});const sN=qN[0].dataInputs[0],VN=qN[0].dataInputs[1];return qN[0].config.valueType=null!==(eN=null!==(vN=null===(HN=cN._connectionValues[sN.uniqueId])||void 0===HN?void 0:HN.type)&&void 0!==vN?vN:null===(TN=cN._connectionValues[VN.uniqueId])||void 0===TN?void 0:TN.type)&&void 0!==eN?eN:"FlowGraphInteger",qN}},"math/or":{RV:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN,cN){var eN,vN,HN,TN,RN;(RN=qN[0]).config||(RN.config={});const sN=qN[0].dataInputs[0],VN=qN[0].dataInputs[1];return qN[0].config.valueType=null!==(eN=null!==(vN=null===(HN=cN._connectionValues[sN.uniqueId])||void 0===HN?void 0:HN.type)&&void 0!==vN?vN:null===(TN=cN._connectionValues[VN.uniqueId])||void 0===TN?void 0:TN.type)&&void 0!==eN?eN:"FlowGraphInteger",qN}},"math/xor":{RV:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,BN,lN,kB,qN,cN){var eN,vN,HN,TN,RN;(RN=qN[0]).config||(RN.config={});const sN=qN[0].dataInputs[0],VN=qN[0].dataInputs[1];return qN[0].config.valueType=null!==(eN=null!==(vN=null===(HN=cN._connectionValues[sN.uniqueId])||void 0===HN?void 0:HN.type)&&void 0!==vN?vN:null===(TN=cN._connectionValues[VN.uniqueId])||void 0===TN?void 0:TN.type)&&void 0!==eN?eN:"FlowGraphInteger",qN}},"math/asr":xk("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":xk("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":xk("FlowGraphLeadingZerosBlock"),"math/ctz":xk("FlowGraphTrailingZerosBlock"),"math/popcnt":xk("FlowGraphOneBitsCounterBlock"),"math/rad":xk("FlowGraphDegToRadBlock"),"math/deg":xk("FlowGraphRadToDegBlock"),"type/boolToInt":xk("FlowGraphBooleanToInt"),"type/boolToFloat":xk("FlowGraphBooleanToFloat"),"type/intToBool":xk("FlowGraphIntToBoolean"),"type/intToFloat":xk("FlowGraphIntToFloat"),"type/floatToInt":xk("FlowGraphFloatToInt"),"type/floatToBool":xk("FlowGraphFloatToBoolean"),"flow/sequence":{RV:["FlowGraphSequenceBlock"],extraProcessor(NN,BN,lN,kB,qN){const cN=qN[0];return cN.config||(cN.config={}),cN.config.outputSignalCount=Object.keys(NN.flows||[]).length,cN.signalOutputs.forEach(((NN,BN)=>{NN.name="out_"+BN})),qN}},"flow/branch":{RV:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{RV:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(NN){if(NN.configuration&&NN.configuration.cases){const BN=NN.configuration.cases.value;if(!BN.every((NN=>"number"===typeof NN&&/^-?\d+$/.test(NN.toString()))))return PN.d.Warn("Switch cases should be integers. Using empty array instead."),NN.configuration.cases.value=[],{valid:!0};const lN=new Set(BN);NN.configuration.cases.value=Array.from(lN)}return{valid:!0}},extraProcessor(NN,BN,lN,kB,qN){if("flow/switch"!==BN.op||!NN.flows||0===Object.keys(NN.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return qN[0].signalOutputs.forEach((NN=>{"default"!==NN.name&&(NN.name="out_"+NN.name)})),qN}},"flow/while":{RV:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{RV:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(NN,BN,lN,kB,qN){const cN=qN[0];return cN.config||(cN.config={}),cN.config.incrementIndexWhenLoopDone=!0,qN}},"flow/doN":{RV:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{RV:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(NN,BN,lN,kB,qN){if("flow/multiGate"!==BN.op||!NN.flows||0===Object.keys(NN.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const cN=qN[0];return cN.config||(cN.config={}),cN.config.outputSignalCount=Object.keys(NN.flows).length,cN.signalOutputs.forEach(((NN,BN)=>{NN.name="out_"+BN})),qN}},"flow/waitAll":{RV:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(NN){var BN,lN;return"number"!==typeof(null===(BN=NN.configuration)||void 0===BN||null===(lN=BN.inputFlows)||void 0===lN?void 0:lN.value[0])&&(NN.configuration=NN.configuration||{inputFlows:{value:[0]}},NN.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{RV:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{RV:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{RV:["FlowGraphCancelDelayBlock"]},"variable/get":{RV:["FlowGraphGetVariableBlock"],validation(NN){var BN,lN;return null!==(BN=NN.configuration)&&void 0!==BN&&null!==(lN=BN.variable)&&void 0!==lN&&lN.value?{valid:!0}:(PN.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(NN,BN)=>[BN.getVariableName(NN[0])]}}},"variable/set":{RV:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(NN,BN)=>[BN.getVariableName(NN[0])]}}},"variable/setMultiple":{RV:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(NN,BN)=>[NN[0].map((NN=>BN.getVariableName(NN)))]}},extraProcessor:(NN,BN,lN,kB,qN)=>(qN[0].dataInputs.forEach((NN=>{NN.name=kB.getVariableName(+NN.name)})),qN)},"variable/interpolate":{RV:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(NN,BN)=>[BN.getVariableName(NN[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:NN=>!0===NN[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Kl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Kl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Kl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Kl:"FlowGraphPlayAnimationBlock"},out:{name:"out",Kl:"FlowGraphPlayAnimationBlock"},done:{name:"done",Kl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN){var cN,eN,vN;const HN=qN[0],TN=null===(cN=NN.configuration)||void 0===cN?void 0:cN.variable.value[0];if("number"!==typeof TN)throw PN.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const RN=kB.arrays.staticVariables[TN];"undefined"===typeof HN.config.animationType.value&&(kB.arrays.staticVariables,HN.config.animationType.value=(0,Mk.K)(RN.type));const sN=qN[4];return sN.config||(sN.config={}),(eN=sN.config).variable||(eN.variable={}),sN.config.variable.value=kB.getVariableName(TN),(vN=qN[3]).config||(vN.config={}),qN}},"pointer/get":{RV:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Kl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Kl:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(NN,BN,lN,kB,qN)=>(qN.forEach((NN=>{"FlowGraphJsonPointerParserBlock"===NN.className&&(NN.config||(NN.config={}),NN.config.outputValue=!0)})),qN)},"pointer/set":{RV:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Kl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Kl:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(NN,BN,lN,kB,qN)=>(qN.forEach((NN=>{"FlowGraphJsonPointerParserBlock"===NN.className&&(NN.config||(NN.config={}),NN.config.outputValue=!0)})),qN)},"pointer/interpolate":{RV:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Kl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Kl:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Kl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Kl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Kl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Kl:"FlowGraphPlayAnimationBlock"},out:{name:"out",Kl:"FlowGraphPlayAnimationBlock"},done:{name:"done",Kl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(NN,BN,lN,kB,qN)=>(qN.forEach((BN=>{"FlowGraphJsonPointerParserBlock"===BN.className?(BN.config||(BN.config={}),BN.config.outputValue=!0):"FlowGraphInterpolationBlock"===BN.className&&(BN.config||(BN.config={}),Object.keys(NN.values||[]).forEach((lN=>{var qN;const cN=null===(qN=NN.values)||void 0===qN?void 0:qN[lN];if("value"===lN&&cN){const NN=cN.type;void 0!==NN&&(BN.config.animationType=kB.arrays.types[NN].flowGraphType)}})))})),qN)},"animation/start":{RV:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Kl:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(NN,BN)=>[NN[0]*BN._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(NN,BN)=>[NN[0]*BN._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){const vN=qN[qN.length-1];return vN.config||(vN.config={}),vN.config.glTF=eN,qN}},"animation/stop":{RV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Kl:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){const vN=qN[qN.length-1];return vN.config||(vN.config={}),vN.config.glTF=eN,qN}},"animation/stopAt":{RV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Kl:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(NN,BN)=>[NN[0]*BN._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){const vN=qN[qN.length-1];return vN.config||(vN.config={}),vN.config.glTF=eN,qN}},"math/switch":{RV:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(NN){if(NN.configuration&&NN.configuration.cases){const BN=NN.configuration.cases.value;if(!BN.every((NN=>"number"===typeof NN&&/^-?\d+$/.test(NN.toString()))))return PN.d.Warn("Switch cases should be integers. Using empty array instead."),NN.configuration.cases.value=[],{valid:!0};const lN=new Set(BN);NN.configuration.cases.value=Array.from(lN)}return{valid:!0}},extraProcessor(NN,BN,lN,kB,qN){const cN=qN[0];return cN.dataInputs.forEach((NN=>{"default"!==NN.name&&"case"!==NN.name&&(NN.name="in_"+NN.name)})),cN.config||(cN.config={}),cN.config.treatCasesAsIntegers=!0,qN}},"debug/log":{RV:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function xk(NN){let BN=arguments.length>2?arguments[2]:void 0;return{RV:[NN],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((NN,BN)=>(NN[BN]={name:BN},NN)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(NN,lN,kB,qN,cN){var eN;if(BN){(eN=cN[0]).config||(eN.config={}),cN[0].config.preventIntegerFloatArithmetic=!0;let BN=-1;Object.keys(NN.values||{}).find((lN=>{var kB;return void 0!==(null===(kB=NN.values)||void 0===kB?void 0:kB[lN].type)&&(BN=NN.values[lN].type,!0)})),-1!==BN&&(cN[0].config.type=qN.arrays.types[BN].flowGraphType)}return cN},validation:NN=>BN?Ok(NN):{valid:!0}}}function Ok(NN){if(NN.values){const BN=Object.keys(NN.values).map((BN=>NN.values[BN].type)).filter((NN=>void 0!==NN));if(!BN.every((NN=>NN===BN[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}pk["math/compose"]=pk["math/matCompose"],pk["math/decompose"]=pk["math/matDecompose"];var wk=lN(14885);const bk={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"fB",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class mq{constructor(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=NN,this._gltf=BN,this._animationTargetFps=lN,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const NN of this._interactivityGraph.types)this._types.push(bk[NN.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const NN of this._interactivityGraph.declarations){const BN=gk(NN);if(!BN)throw PN.d.Error(["No mapping found for declaration",NN]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:BN,fullOperationName:NN.extension?NN.op+":"+NN.extension:NN.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const NN of this._interactivityGraph.variables){const BN=this._parseVariable(NN);this._staticVariables.push(BN)}}_parseVariable(NN,BN){const lN=this._types[NN.type];if(!lN)throw PN.d.Error(["No type found for variable",NN]),new Error("Error parsing variables");if(NN.value&&NN.value.length!==lN.length)throw PN.d.Error(["Invalid value length for variable",NN,lN]),new Error("Error parsing variables");const kB=NN.value||[];if(!kB.length)switch(lN.flowGraphType){case"boolean":kB.push(!1);break;case"FlowGraphInteger":kB.push(0);break;case"number":kB.push(NaN);break;case"Vector2":kB.push(NaN,NaN);break;case"fB":kB.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":kB.fill(NaN,0,4);break;case"Matrix":kB.fill(NaN,0,16);break;case"Matrix3D":kB.fill(NaN,0,9)}return"number"===lN.elementType&&"string"===typeof kB[0]&&(kB[0]=parseFloat(kB[0])),{type:lN.flowGraphType,value:BN?BN(kB,this):kB}}_parseEvents(){if(this._interactivityGraph.events)for(const NN of this._interactivityGraph.events){const BN={eventId:NN.id||"internalEvent_"+this._internalEventsCounter++};NN.values&&(BN.eventData=Object.keys(NN.values).map((BN=>{var lN;const kB=null===(lN=NN.values)||void 0===lN?void 0:lN[BN];if(!kB)throw PN.d.Error(["No value found for event key",BN]),new Error("Error parsing events");const qN=this._types[kB.type];if(!qN)throw PN.d.Error(["No type found for event value",kB]),new Error("Error parsing events");const cN="undefined"!==typeof kB.value?this._parseVariable(kB):void 0;return{id:BN,type:qN.flowGraphType,eventData:!0,value:cN}}))),this._events.push(BN)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const BN of this._interactivityGraph.nodes){if("number"!==typeof BN.declaration)throw PN.d.Error(["No declaration found for node",BN]),new Error("Error parsing nodes");const lN=this._mappings[BN.declaration];if(!lN)throw PN.d.Error(["No mapping found for node",BN]),new Error("Error parsing nodes");if(lN.flowGraphMapping.validation){const kB=lN.flowGraphMapping.validation(BN,this._interactivityGraph,this._gltf);var NN;if(!kB.valid)throw new Error("Error validating interactivity node ".concat(null===(NN=this._interactivityGraph.declarations)||void 0===NN?void 0:NN[BN.declaration].op," - ").concat(kB.error))}const kB=[];for(const NN of lN.flowGraphMapping.RV){const qN=this._getEmptyBlock(NN,lN.fullOperationName);this._parseNodeConfiguration(BN,qN,lN.flowGraphMapping,NN),kB.push(qN)}this._nodes.push({RV:kB,fullOperationName:lN.fullOperationName})}}_getEmptyBlock(NN,BN){return{uniqueId:(0,wk.d)(),className:NN,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:BN,metadata:{}}}_parseNodeConfiguration(NN,BN,lN,kB){const qN=BN.config;if(NN.configuration){const BN=Object.keys(NN.configuration);for(const vN of BN){var cN,eN;const BN=null===(cN=NN.configuration)||void 0===cN?void 0:cN[vN];if(!BN)throw PN.d.Error(["No value found for node configuration",vN]),new Error("Error parsing node configuration");const HN=null===(eN=lN.configuration)||void 0===eN?void 0:eN[vN];if(HN&&HN.Kl?HN.Kl===kB:0===lN.RV.indexOf(kB)){const NN=(null===HN||void 0===HN?void 0:HN.name)||vN;BN&&"undefined"!==typeof BN.value||"undefined"===typeof(null===HN||void 0===HN?void 0:HN.defaultValue)?BN.value.length>=0?qN[NN]={value:1===BN.value.length?BN.value[0]:BN.value}:PN.d.Warn(["Invalid value for node configuration",BN]):qN[NN]={value:HN.defaultValue},HN&&HN.dataTransformer&&(qN[NN].value=HN.dataTransformer([qN[NN].value],this)[0])}}}}_parseNodeConnections(NN){for(let XN=0;XN<this._nodes.length;XN++){var BN;const uN=null===(BN=this._interactivityGraph.nodes)||void 0===BN?void 0:BN[XN];if(!uN)throw PN.d.Error(["No node found for interactivity node",this._nodes[XN]]),new Error("Error parsing node connections");const dN=this._nodes[XN],EN=this._mappings[uN.declaration];if(!EN)throw PN.d.Error(["No mapping found for node",uN]),new Error("Error parsing node connections");const KN=uN.flows||{},gN=Object.keys(KN).sort();for(const NN of gN){var lN,kB,qN,cN;const BN=KN[NN],TN=null===(lN=EN.flowGraphMapping.outputs)||void 0===lN||null===(kB=lN.flows)||void 0===kB?void 0:kB[NN],RN=(null===TN||void 0===TN?void 0:TN.name)||NN,sN=this._createNewSocketConnection(RN,!0);(TN&&TN.Kl&&dN.RV.find((NN=>NN.className===TN.Kl))||dN.RV[0]).signalOutputs.push(sN);const VN=BN.node,fN=this._nodes[VN];if(!fN)throw PN.d.Error(["No node found for input node id",VN]),new Error("Error parsing node connections");const ZN=Kk(fN.fullOperationName);if(!ZN)throw PN.d.Error(["No mapping found for input node",fN]),new Error("Error parsing node connections");let CN=null===(qN=ZN.inputs)||void 0===qN||null===(cN=qN.flows)||void 0===cN?void 0:cN[BN.socket||"in"],FN=!1;if(!CN)for(const NN in null===(eN=ZN.inputs)||void 0===eN?void 0:eN.flows){var eN,vN,HN;if(NN.startsWith("[")&&NN.endsWith("]"))FN=!0,CN=null===(vN=ZN.inputs)||void 0===vN||null===(HN=vN.flows)||void 0===HN?void 0:HN[NN]}const IN=CN?FN?CN.name.replace("$1",BN.socket||""):CN.name:BN.socket||"in",AN=CN&&CN.Kl&&fN.RV.find((NN=>NN.className===CN.Kl))||fN.RV[0];let MN=AN.signalInputs.find((NN=>NN.name===IN));MN||(MN=this._createNewSocketConnection(IN),AN.signalInputs.push(MN)),MN.connectedPointIds.push(sN.uniqueId),sN.connectedPointIds.push(MN.uniqueId)}const nN=uN.values||{},rN=Object.keys(nN);for(const BN of rN){var TN,RN;const lN=nN[BN];let kB=null===(TN=EN.flowGraphMapping.inputs)||void 0===TN||null===(RN=TN.values)||void 0===RN?void 0:RN[BN],qN=!1;if(!kB)for(const NN in null===(sN=EN.flowGraphMapping.inputs)||void 0===sN?void 0:sN.values){var sN,VN,fN;if(NN.startsWith("[")&&NN.endsWith("]"))qN=!0,kB=null===(VN=EN.flowGraphMapping.inputs)||void 0===VN||null===(fN=VN.values)||void 0===fN?void 0:fN[NN]}const cN=kB?qN?kB.name.replace("$1",BN):kB.name:BN,eN=this._createNewSocketConnection(cN);if((kB&&kB.Kl&&dN.RV.find((NN=>NN.className===kB.Kl))||dN.RV[0]).dataInputs.push(eN),void 0!==lN.value){const BN=this._parseVariable(lN,kB&&kB.dataTransformer);NN._connectionValues[eN.uniqueId]=BN}else{if("undefined"===typeof lN.node)throw PN.d.Error(["Invalid value for value connection",lN]),new Error("Error parsing node connections");{var ZN,CN,FN;const NN=lN.node,BN=lN.socket||"value",kB=this._nodes[NN];if(!kB)throw PN.d.Error(["No node found for output socket reference",lN]),new Error("Error parsing node connections");const qN=Kk(kB.fullOperationName);if(!qN)throw PN.d.Error(["No mapping found for output socket reference",lN]),new Error("Error parsing node connections");let cN=null===(ZN=qN.outputs)||void 0===ZN||null===(CN=ZN.values)||void 0===CN?void 0:CN[BN],vN=!1;if(!cN)for(const lN in null===(IN=qN.outputs)||void 0===IN?void 0:IN.values){var IN,AN,MN;if(lN.startsWith("[")&&lN.endsWith("]"))vN=!0,cN=null===(AN=qN.outputs)||void 0===AN||null===(MN=AN.values)||void 0===MN?void 0:MN[lN]}const HN=cN?vN?cN.name.replace("$1",BN):null===(FN=cN)||void 0===FN?void 0:FN.name:BN,TN=cN&&cN.Kl&&kB.RV.find((NN=>NN.className===cN.Kl))||kB.RV[0];let RN=TN.dataOutputs.find((NN=>NN.name===HN));RN||(RN=this._createNewSocketConnection(HN,!0),TN.dataOutputs.push(RN)),eN.connectedPointIds.push(RN.uniqueId),RN.connectedPointIds.push(eN.uniqueId)}}}if(EN.flowGraphMapping.interBlockConnectors)for(const NN of EN.flowGraphMapping.interBlockConnectors){const BN=NN.input,lN=NN.output,kB=NN.isVariable;this._connectFlowGraphNodes(BN,lN,dN.RV[NN.inputBlockIndex],dN.RV[NN.outputBlockIndex],kB)}if(EN.flowGraphMapping.extraProcessor){var GN;const BN=null===(GN=this._interactivityGraph.declarations)||void 0===GN?void 0:GN[uN.declaration];if(!BN)throw PN.d.Error(["No declaration found for extra processor",uN]),new Error("Error parsing node connections");dN.RV=EN.flowGraphMapping.extraProcessor(uN,BN,EN.flowGraphMapping,this,dN.RV,NN,this._gltf)}}}_createNewSocketConnection(NN,BN){return{uniqueId:(0,wk.d)(),name:NN,_connectionType:BN?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(NN,BN,lN,kB,qN){const cN=qN?lN.dataInputs:lN.signalInputs,eN=qN?kB.dataOutputs:kB.signalOutputs,vN=cN.find((BN=>BN.name===NN))||this._createNewSocketConnection(NN),HN=eN.find((NN=>NN.name===BN))||this._createNewSocketConnection(BN,!0);cN.find((BN=>BN.name===NN))||cN.push(vN),eN.find((NN=>NN.name===BN))||eN.push(HN),vN.connectedPointIds.push(HN.uniqueId),HN.connectedPointIds.push(vN.uniqueId)}getVariableName(NN){return"staticVariable_"+NN}serializeToFlowGraph(){const NN={uniqueId:(0,wk.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(NN);for(let BN=0;BN<this._staticVariables.length;BN++){const lN=this._staticVariables[BN];NN._userVariables[this.getVariableName(BN)]=lN}return{rightHanded:!0,allBlocks:this._nodes.reduce(((NN,BN)=>NN.concat(BN.RV)),[]),executionContexts:[NN]}}}const ak="KHR_interactivity";class Dk{constructor(NN){this._loader=NN,this.name=ak,this.enabled=this._loader.isExtensionUsed(ak),this._pathConverter=(0,DN.i)(this._loader.sc),NN._skipStartAnimationStep=!0;const BN=NN.babylonScene;BN&&function(NN){(0,DN.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!NN.activeCamera)return new qN.Quaternion(NaN,NaN,NaN,NaN);const BN=qN.Quaternion.FromRotationMatrix(NN.activeCamera.getWorldMatrix()).normalize();return NN.useRightHandedSystem||(BN.w*=-1,BN.x*=-1),BN},type:"Quaternion",getTarget:()=>NN.activeCamera}),(0,DN.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!NN.activeCamera)return new qN.fB(NaN,NaN,NaN);const BN=NN.activeCamera.getWorldMatrix().getTranslation();return NN.useRightHandedSystem||(BN.x*=-1),BN},type:"fB",getTarget:()=>NN.activeCamera}),(0,DN.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:NN=>{var BN,lN;return null!==(BN=null===(lN=NN._babylonAnimationGroup)||void 0===lN?void 0:lN.isPlaying)&&void 0!==BN&&BN},type:"boolean",getTarget:NN=>NN._babylonAnimationGroup}),(0,DN.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:NN=>{var BN,lN;return(null!==(BN=null===(lN=NN._babylonAnimationGroup)||void 0===lN?void 0:lN.from)&&void 0!==BN?BN:0)/60},type:"number",getTarget:NN=>NN._babylonAnimationGroup}),(0,DN.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:NN=>{var BN,lN;return(null!==(BN=null===(lN=NN._babylonAnimationGroup)||void 0===lN?void 0:lN.to)&&void 0!==BN?BN:0)/60},type:"number",getTarget:NN=>NN._babylonAnimationGroup}),(0,DN.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:NN=>{var BN,lN;return(null!==(BN=null===(lN=NN._babylonAnimationGroup)||void 0===lN?void 0:lN.getCurrentFrame())&&void 0!==BN?BN:0)/60},type:"number",getTarget:NN=>NN._babylonAnimationGroup}),(0,DN.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:NN=>{var BN,lN;return(null!==(BN=null===(lN=NN._babylonAnimationGroup)||void 0===lN?void 0:lN.getCurrentFrame())&&void 0!==BN?BN:0)/60},type:"number",getTarget:NN=>NN._babylonAnimationGroup})}(BN)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var NN;if(!this._loader.babylonScene||!this._pathConverter)return;const BN=this._loader.babylonScene,lN=null===(NN=this._loader.sc.extensions)||void 0===NN?void 0:NN.KHR_interactivity;if(!lN)return;const kB=new Pk.b({PB:BN});kB.dispatchEventsSynchronously=!1;const qN=lN.graphs.map((NN=>new mq(NN,this._loader.sc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(qN.map((async NN=>await uk(NN,{coordinator:kB,pathConverter:this._pathConverter})))),kB.start()}}var yk,Lk;yk="FlowGraphGLTFDataProvider",Lk=async()=>(await Promise.resolve().then(lN.bind(lN,15944))).FlowGraphGLTFDataProvider,Ck["".concat(ak,"/").concat(yk)]=Lk,aN(ak),mB(ak,!0,(NN=>new Dk(NN)));const hk="KHR_node_visibility";(0,DN.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:NN=>{const BN=NN._babylonTransformNode;return!BN||void 0===BN.isVisible||BN.isVisible},set:(NN,BN)=>{var lN,kB;null===(lN=BN._primitiveBabylonMeshes)||void 0===lN||lN.forEach((NN=>{NN.inheritVisibility=!0})),BN._babylonTransformNode&&(BN._babylonTransformNode.isVisible=NN),null===(kB=BN._primitiveBabylonMeshes)||void 0===kB||kB.forEach((BN=>{BN.isVisible=NN}))},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Uk{constructor(NN){this.name=hk,this._loader=NN,this.enabled=NN.isExtensionUsed(hk)}async onReady(){var NN;null===(NN=this._loader.sc.nodes)||void 0===NN||NN.forEach((NN=>{var BN,lN,kB,qN;(null===(BN=NN._primitiveBabylonMeshes)||void 0===BN||BN.forEach((NN=>{NN.inheritVisibility=!0})),null!==(lN=NN.extensions)&&void 0!==lN&&lN.KHR_node_visibility)&&(!1===(null===(kB=NN.extensions)||void 0===kB?void 0:kB.KHR_node_visibility.visible)&&(NN._babylonTransformNode&&(NN._babylonTransformNode.isVisible=!1),null===(qN=NN._primitiveBabylonMeshes)||void 0===qN||qN.forEach((NN=>{NN.isVisible=!1}))))}))}dispose(){this._loader=null}}aN(hk),mB(hk,!0,(NN=>new Uk(NN)));const Wk="KHR_node_selectability";nk("event/onSelect",Wk,{RV:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Kl:"FlowGraphGetVariableBlock",dataTransformer:NN=>["pickedMesh_"+NN[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Kl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){var vN,HN,TN,RN,sN,VN;const fN=qN[qN.length-1];fN.config=fN.config||{},fN.config.glTF=eN;const ZN=null===(vN=NN.configuration)||void 0===vN||null===(HN=vN.nodeIndex)||void 0===HN?void 0:HN.value[0];if(void 0===ZN||"number"!==typeof ZN)throw new Error("nodeIndex not found in configuration");const PN="pickedMesh_"+ZN;return qN[1].config.variable=PN,cN._userVariables[PN]={className:"Mesh",id:null===eN||void 0===eN||null===(TN=eN.nodes)||void 0===TN||null===(RN=TN[ZN]._babylonTransformNode)||void 0===RN?void 0:RN.id,uniqueId:null===eN||void 0===eN||null===(sN=eN.nodes)||void 0===sN||null===(VN=sN[ZN]._babylonTransformNode)||void 0===VN?void 0:VN.uniqueId},qN}}),(0,DN.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:NN=>{const BN=NN._babylonTransformNode;return!BN||void 0===BN.nR||BN.nR},set:(NN,BN)=>{var lN;null===(lN=BN._primitiveBabylonMeshes)||void 0===lN||lN.forEach((BN=>{BN.nR=NN}))},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"nR"],type:"boolean"});class Qk{constructor(NN){this.name=Wk,this._loader=NN,this.enabled=NN.isExtensionUsed(Wk)}async onReady(){var NN;null===(NN=this._loader.sc.nodes)||void 0===NN||NN.forEach((NN=>{var BN,lN,kB;null!==(BN=NN.extensions)&&void 0!==BN&&BN.KHR_node_selectability&&!1===(null===(lN=NN.extensions)||void 0===lN?void 0:lN.KHR_node_selectability.selectable)&&(null===(kB=NN._babylonTransformNode)||void 0===kB||kB.getChildMeshes().forEach((NN=>{NN.nR=!1})))}))}dispose(){this._loader=null}}aN(Wk),mB(Wk,!0,(NN=>new Qk(NN)));const Sk="KHR_node_hoverability",iq="targetMeshPointerOver_";nk("event/onHoverIn",Sk,{RV:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Kl:"FlowGraphGetVariableBlock",dataTransformer:NN=>[iq+NN[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Kl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){var vN,HN,TN,RN,sN,VN;const fN=qN[qN.length-1];fN.config=fN.config||{},fN.config.glTF=eN;const ZN=null===(vN=NN.configuration)||void 0===vN||null===(HN=vN.nodeIndex)||void 0===HN?void 0:HN.value[0];if(void 0===ZN||"number"!==typeof ZN)throw new Error("nodeIndex not found in configuration");const PN=iq+ZN;return qN[1].config.variable=PN,cN._userVariables[PN]={className:"Mesh",id:null===eN||void 0===eN||null===(TN=eN.nodes)||void 0===TN||null===(RN=TN[ZN]._babylonTransformNode)||void 0===RN?void 0:RN.id,uniqueId:null===eN||void 0===eN||null===(sN=eN.nodes)||void 0===sN||null===(VN=sN[ZN]._babylonTransformNode)||void 0===VN?void 0:VN.uniqueId},qN}});const tk="targetMeshPointerOut_";nk("event/onHoverOut",Sk,{RV:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Kl:"FlowGraphGetVariableBlock",dataTransformer:NN=>[tk+NN[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Kl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(NN,BN,lN,kB,qN,cN,eN){var vN,HN,TN,RN,sN,VN;const fN=qN[qN.length-1];fN.config=fN.config||{},fN.config.glTF=eN;const ZN=null===(vN=NN.configuration)||void 0===vN||null===(HN=vN.nodeIndex)||void 0===HN?void 0:HN.value[0];if(void 0===ZN||"number"!==typeof ZN)throw new Error("nodeIndex not found in configuration");const PN=tk+ZN;return qN[1].config.variable=PN,cN._userVariables[PN]={className:"Mesh",id:null===eN||void 0===eN||null===(TN=eN.nodes)||void 0===TN||null===(RN=TN[ZN]._babylonTransformNode)||void 0===RN?void 0:RN.id,uniqueId:null===eN||void 0===eN||null===(sN=eN.nodes)||void 0===sN||null===(VN=sN[ZN]._babylonTransformNode)||void 0===VN?void 0:VN.uniqueId},qN}}),(0,DN.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:NN=>{const BN=NN._babylonTransformNode;return!BN||void 0===BN.pointerOverDisableMeshTesting||BN.pointerOverDisableMeshTesting},set:(NN,BN)=>{var lN;null===(lN=BN._primitiveBabylonMeshes)||void 0===lN||lN.forEach((BN=>{BN.pointerOverDisableMeshTesting=!NN}))},getTarget:NN=>NN._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class ok{constructor(NN){this.name=Sk,this._loader=NN,this.enabled=NN.isExtensionUsed(Sk)}async onReady(){var NN;null===(NN=this._loader.sc.nodes)||void 0===NN||NN.forEach((NN=>{var BN,lN,kB;null!==(BN=NN.extensions)&&void 0!==BN&&BN.KHR_node_hoverability&&!1===(null===(lN=NN.extensions)||void 0===lN?void 0:lN.KHR_node_hoverability.hoverable)&&(null===(kB=NN._babylonTransformNode)||void 0===kB||kB.getChildMeshes().forEach((NN=>{NN.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}aN(Sk),mB(Sk,!0,(NN=>new ok(NN)));const Jk="ExtrasAsMetadata";class Yk{_assignExtras(NN,BN){if(BN.extras&&Object.keys(BN.extras).length>0){const lN=NN.metadata=NN.metadata||{};(lN.sc=lN.sc||{}).extras=BN.extras}}constructor(NN){this.name=Jk,this.enabled=!0,this._loader=NN}dispose(){this._loader=null}loadNodeAsync(NN,BN,lN){return this._loader.loadNodeAsync(NN,BN,(NN=>{this._assignExtras(NN,BN),lN(NN)}))}loadCameraAsync(NN,BN,lN){return this._loader.loadCameraAsync(NN,BN,(NN=>{this._assignExtras(NN,BN),lN(NN)}))}createMaterial(NN,BN,lN){const kB=this._loader.createMaterial(NN,BN,lN);return this._assignExtras(kB,BN),kB}}aN(Jk),mB(Jk,!1,(NN=>new Yk(NN)));lN(15944)},15805:(NN,BN,lN)=>{"use strict";lN.d(BN,{e:()=>ON,g:()=>KN,i:()=>EN,j:()=>gN});var kB=lN(14731),qN=lN(14727),cN=lN(15813),eN=lN(19),vN=lN(15391),HN=lN(15363),TN=lN(15375),RN=lN(14746),sN=lN(14773),VN=lN(15388),fN=lN(15485),ZN=lN(15400),PN=lN(14963);class CN{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.kP=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vP=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(NN){this._environmentTexture=NN}getNodes(){let NN=[];NN=NN.concat(this.meshes),NN=NN.concat(this.lights),NN=NN.concat(this.cameras),NN=NN.concat(this.transformNodes);for(const BN of this.skeletons)NN=NN.concat(BN.bones);return NN}}class FN extends CN{}class IN{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const NN=this.rootNodes;for(const kB of NN)kB.dispose();NN.length=0;const BN=this.skeletons;for(const kB of BN)kB.dispose();BN.length=0;const lN=this.animationGroups;for(const kB of lN)kB.dispose();lN.length=0}}class AN extends CN{constructor(NN){super(),this._wasAddedToScene=!1,(NN=NN||sN.b.LastCreatedScene)&&(this.PB=NN,this.proceduralTextures=[],NN.qc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=NN.getEngine().onContextRestoredObservable.add((()=>{for(const NN of this.geometries)NN._rebuild();for(const NN of this.meshes)NN._rebuild();for(const NN of this.kP)NN.rebuild();for(const NN of this.textures)NN._rebuild()})))}_topologicalSort(NN){const BN=new Map;for(const eN of NN)BN.set(eN.uniqueId,eN);const lN={dependsOn:new Map,dependedBy:new Map};for(const eN of NN){const NN=eN.uniqueId;lN.dependsOn.set(NN,new Set),lN.dependedBy.set(NN,new Set)}for(const eN of NN){const NN=eN.uniqueId,kB=lN.dependsOn.get(NN);if(eN instanceof VN.e){const qN=eN.sourceMesh;BN.has(qN.uniqueId)&&(kB.add(qN.uniqueId),lN.dependedBy.get(qN.uniqueId).add(NN))}const qN=lN.dependedBy.get(NN);for(const cN of eN.getDescendants()){const kB=cN.uniqueId;if(BN.has(kB)){qN.add(kB);lN.dependsOn.get(kB).add(NN)}}}const kB=[],qN=[];for(const eN of NN){const NN=eN.uniqueId;0===lN.dependsOn.get(NN).size&&(qN.push(eN),BN.delete(NN))}const cN=qN;for(;cN.length>0;){const NN=cN.shift();kB.push(NN);const qN=lN.dependedBy.get(NN.uniqueId);for(const kB of Array.from(qN.values())){const qN=lN.dependsOn.get(kB);qN.delete(NN.uniqueId),0===qN.size&&BN.get(kB)&&(cN.push(BN.get(kB)),BN.delete(kB))}}return BN.size>0&&(RN.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),BN.forEach((NN=>{RN.d.Error(NN.name)}))),kB}_addNodeAndDescendantsToList(NN,BN,lN,kB){if(lN&&(!kB||kB(lN))&&!BN.has(lN.uniqueId)){NN.push(lN),BN.add(lN.uniqueId);for(const qN of lN.getDescendants(!0))this._addNodeAndDescendantsToList(NN,BN,qN,kB)}}_isNodeInContainer(NN){return NN instanceof TN.e&&-1!==this.meshes.indexOf(NN)||(NN instanceof HN.e&&-1!==this.transformNodes.indexOf(NN)||(NN instanceof fN.b&&-1!==this.lights.indexOf(NN)||NN instanceof ZN.c&&-1!==this.cameras.indexOf(NN)))}_isValidHierarchy(){for(const NN of this.meshes)if(NN.parent&&!this._isNodeInContainer(NN.parent))return RN.d.Warn("Node ".concat(NN.name," has a parent that is not in the container.")),!1;for(const NN of this.transformNodes)if(NN.parent&&!this._isNodeInContainer(NN.parent))return RN.d.Warn("Node ".concat(NN.name," has a parent that is not in the container.")),!1;for(const NN of this.lights)if(NN.parent&&!this._isNodeInContainer(NN.parent))return RN.d.Warn("Node ".concat(NN.name," has a parent that is not in the container.")),!1;for(const NN of this.cameras)if(NN.parent&&!this._isNodeInContainer(NN.parent))return RN.d.Warn("Node ".concat(NN.name," has a parent that is not in the container.")),!1;return!0}instantiateModelsToScene(NN){let BN=arguments.length>1&&void 0!==arguments[1]&&arguments[1],lN=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||qN.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const kB={},cN={},HN=new IN,TN=[],RN=[],sN=(0,eN.d)({doNotInstantiate:!0},lN),VN=[],fN=new Set;for(const qN of this.transformNodes)null===qN.parent&&this._addNodeAndDescendantsToList(VN,fN,qN,sN.predicate);for(const qN of this.meshes)null===qN.parent&&this._addNodeAndDescendantsToList(VN,fN,qN,sN.predicate);const ZN=this._topologicalSort(VN),PN=(lN,qN)=>{if(((BN,lN)=>{if(kB[BN.uniqueId]=lN.uniqueId,cN[lN.uniqueId]=lN,NN&&(lN.name=NN(BN.name)),lN instanceof vN.e){const NN=lN;if(NN.morphTargetManager){const lN=BN.morphTargetManager;NN.morphTargetManager=lN.clone();for(let BN=0;BN<lN.numTargets;BN++){const qN=lN.getTarget(BN),eN=NN.morphTargetManager.getTarget(BN);kB[qN.uniqueId]=eN.uniqueId,cN[eN.uniqueId]=eN}}}})(lN,qN),lN.parent){const NN=kB[lN.parent.uniqueId],BN=cN[NN];qN.parent=BN||lN.parent}if(qN.position&&lN.position&&qN.position.kB(lN.position),qN.rotationQuaternion&&lN.rotationQuaternion&&qN.rotationQuaternion.kB(lN.rotationQuaternion),qN.rotation&&lN.rotation&&qN.rotation.kB(lN.rotation),qN.gc&&lN.gc&&qN.gc.kB(lN.gc),qN.material){const eN=qN;if(eN.material)if(BN){const BN=lN.material;if(-1===RN.indexOf(BN)){let lN=BN.clone(NN?NN(BN.name):"Clone of "+BN.name);if(RN.push(BN),kB[BN.uniqueId]=lN.uniqueId,cN[lN.uniqueId]=lN,"MultiMaterial"===BN.getClassName()){const qN=BN;for(const BN of qN.Oc)BN&&(lN=BN.clone(NN?NN(BN.name):"Clone of "+BN.name),RN.push(BN),kB[BN.uniqueId]=lN.uniqueId,cN[lN.uniqueId]=lN);qN.Oc=qN.Oc.map((NN=>NN&&cN[kB[NN.uniqueId]]))}}"InstancedMesh"!==eN.getClassName()&&(eN.material=cN[kB[BN.uniqueId]])}else"MultiMaterial"===eN.material.getClassName()?-1===this.PB.multiMaterials.indexOf(eN.material)&&this.PB.addMultiMaterial(eN.material):-1===this.PB.materials.indexOf(eN.material)&&this.PB.addMaterial(eN.material)}null===qN.parent&&HN.rootNodes.push(qN)};for(const qN of ZN)if("InstancedMesh"===qN.getClassName()){const NN=qN,BN=NN.sourceMesh,lN=kB[BN.uniqueId];PN(NN,("number"===typeof lN?cN[lN]:BN).createInstance(NN.name))}else{let NN=!0;"Mf"===qN.getClassName()||"Node"===qN.getClassName()||qN.skeleton||!qN.getTotalVertices||0===qN.getTotalVertices()?NN=!1:sN.doNotInstantiate&&(NN="function"===typeof sN.doNotInstantiate?!sN.doNotInstantiate(qN):!sN.doNotInstantiate);const BN=NN?qN.createInstance("instance of ".concat(qN.name)):qN.clone("Clone of ".concat(qN.name),null,!0);if(!BN)throw new Error("Could not clone or instantiate node on Asset Container ".concat(qN.name));PN(qN,BN)}for(const qN of this.skeletons){if(sN.predicate&&!sN.predicate(qN))continue;const BN=qN.clone(NN?NN(qN.name):"Clone of "+qN.name);for(const NN of this.meshes)if(NN.skeleton===qN&&!NN.isAnInstance){const lN=cN[kB[NN.uniqueId]];if(!lN||lN.isAnInstance)continue;if(lN.skeleton=BN,-1!==TN.indexOf(BN))continue;TN.push(BN);for(const NN of BN.bones)NN._linkedTransformNode&&(NN._linkedTransformNode=cN[kB[NN._linkedTransformNode.uniqueId]])}HN.skeletons.push(BN)}for(const qN of this.animationGroups){if(sN.predicate&&!sN.predicate(qN))continue;const BN=qN.clone(NN?NN(qN.name):"Clone of "+qN.name,(NN=>cN[kB[NN.uniqueId]]||NN));HN.animationGroups.push(BN)}return HN}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||qN.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.PB.environmentTexture=this.environmentTexture);for(const NN of this.PB._serializableComponents)NN.addFromContainer(this);this.PB.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const BN=[];for(const lN of this.cameras)NN&&!NN(lN)||(this.PB.addCamera(lN),BN.push(lN));for(const lN of this.lights)NN&&!NN(lN)||(this.PB.addLight(lN),BN.push(lN));for(const lN of this.meshes)NN&&!NN(lN)||(this.PB.BV(lN),BN.push(lN));for(const lN of this.skeletons)NN&&!NN(lN)||this.PB.addSkeleton(lN);for(const lN of this.animations)NN&&!NN(lN)||this.PB.addAnimation(lN);for(const lN of this.animationGroups)NN&&!NN(lN)||this.PB.addAnimationGroup(lN);for(const lN of this.multiMaterials)NN&&!NN(lN)||this.PB.addMultiMaterial(lN);for(const lN of this.materials)NN&&!NN(lN)||this.PB.addMaterial(lN);for(const lN of this.morphTargetManagers)NN&&!NN(lN)||this.PB.addMorphTargetManager(lN);for(const lN of this.geometries)NN&&!NN(lN)||this.PB.addGeometry(lN);for(const lN of this.transformNodes)NN&&!NN(lN)||(this.PB.addTransformNode(lN),BN.push(lN));for(const lN of this.actionManagers)NN&&!NN(lN)||this.PB.addActionManager(lN);for(const lN of this.textures)NN&&!NN(lN)||this.PB.addTexture(lN);for(const lN of this.reflectionProbes)NN&&!NN(lN)||this.PB.addReflectionProbe(lN);for(const lN of BN)lN.parent&&-1===this.PB.getNodes().indexOf(lN.parent)&&(lN.setParent?lN.setParent(null):lN.parent=null)}removeAllFromScene(){this._isValidHierarchy()||qN.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.PB.environmentTexture&&(this.PB.environmentTexture=null);for(const NN of this.PB._serializableComponents)NN.removeFromContainer(this)}removeFromScene(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const BN of this.cameras)NN&&!NN(BN)||this.PB.removeCamera(BN);for(const BN of this.lights)NN&&!NN(BN)||this.PB.removeLight(BN);for(const BN of this.meshes)NN&&!NN(BN)||this.PB.ts(BN,!0);for(const BN of this.skeletons)NN&&!NN(BN)||this.PB.removeSkeleton(BN);for(const BN of this.animations)NN&&!NN(BN)||this.PB.removeAnimation(BN);for(const BN of this.animationGroups)NN&&!NN(BN)||this.PB.removeAnimationGroup(BN);for(const BN of this.multiMaterials)NN&&!NN(BN)||this.PB.removeMultiMaterial(BN);for(const BN of this.materials)NN&&!NN(BN)||this.PB.removeMaterial(BN);for(const BN of this.morphTargetManagers)NN&&!NN(BN)||this.PB.removeMorphTargetManager(BN);for(const BN of this.geometries)NN&&!NN(BN)||this.PB.removeGeometry(BN);for(const BN of this.transformNodes)NN&&!NN(BN)||this.PB.removeTransformNode(BN);for(const BN of this.actionManagers)NN&&!NN(BN)||this.PB.removeActionManager(BN);for(const BN of this.textures)NN&&!NN(BN)||this.PB.removeTexture(BN);for(const BN of this.reflectionProbes)NN&&!NN(BN)||this.PB.removeReflectionProbe(BN)}dispose(){const NN=this.cameras.slice(0);for(const fN of NN)fN.dispose();this.cameras.length=0;const BN=this.lights.slice(0);for(const fN of BN)fN.dispose();this.lights.length=0;const lN=this.meshes.slice(0);for(const fN of lN)fN.dispose();this.meshes.length=0;const kB=this.skeletons.slice(0);for(const fN of kB)fN.dispose();this.skeletons.length=0;const qN=this.animationGroups.slice(0);for(const fN of qN)fN.dispose();this.animationGroups.length=0;const cN=this.multiMaterials.slice(0);for(const fN of cN)fN.dispose();this.multiMaterials.length=0;const eN=this.materials.slice(0);for(const fN of eN)fN.dispose();this.materials.length=0;const vN=this.geometries.slice(0);for(const fN of vN)fN.dispose();this.geometries.length=0;const HN=this.transformNodes.slice(0);for(const fN of HN)fN.dispose();this.transformNodes.length=0;const TN=this.actionManagers.slice(0);for(const fN of TN)fN.dispose();this.actionManagers.length=0;const RN=this.textures.slice(0);for(const fN of RN)fN.dispose();this.textures.length=0;const sN=this.reflectionProbes.slice(0);for(const fN of sN)fN.dispose();this.reflectionProbes.length=0;const VN=this.morphTargetManagers.slice(0);for(const fN of VN)fN.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const fN of this.PB._serializableComponents)fN.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.PB.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(NN,BN,lN){if(NN&&BN)for(const kB of NN){let NN=!0;if(lN)for(const BN of lN)if(kB===BN){NN=!1;break}NN&&(BN.push(kB),kB._parentContainer=this)}}moveAllFromScene(NN){this._wasAddedToScene=!1,void 0===NN&&(NN=new FN);for(const BN in this)Object.prototype.hasOwnProperty.call(this,BN)&&(this[BN]=this[BN]||("_environmentTexture"===BN?null:[]),this._moveAssets(this.PB[BN],this[BN],NN[BN]));this.environmentTexture=this.PB.environmentTexture,this.removeAllFromScene()}createRootMesh(){const NN=new vN.e("assetContainerRootMesh",this.PB);for(const BN of this.meshes)BN.parent||NN.addChild(BN);return this.meshes.unshift(NN),NN}mergeAnimationsTo(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sN.b.LastCreatedScene,BN=arguments.length>1?arguments[1]:void 0,lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!NN)return RN.d.Error("No scene available to merge animations to"),[];const kB=lN||(BN=>{let lN=null;const kB=BN.animations.length?BN.animations[0].targetProperty:"",qN=BN.name.split(".").join("").split("_primitive")[0];switch(kB){case"position":case"rotationQuaternion":lN=NN.getTransformNodeByName(BN.name)||NN.getTransformNodeByName(qN);break;case"influence":lN=NN.getMorphTargetByName(BN.name)||NN.getMorphTargetByName(qN);break;default:lN=NN.getNodeByName(BN.name)||NN.getNodeByName(qN)}return lN}),qN=this.getNodes();for(const vN of qN){const NN=kB(vN);if(null!==NN){for(const BN of vN.animations){const lN=NN.animations.filter((NN=>NN.targetProperty===BN.targetProperty));for(const BN of lN){const lN=NN.animations.indexOf(BN,0);lN>-1&&NN.animations.splice(lN,1)}}NN.animations=NN.animations.concat(vN.animations)}}const cN=[],eN=this.animationGroups.slice();for(const vN of eN){cN.push(vN.clone(vN.name,kB));for(const NN of vN.animatables)NN.stop()}for(const vN of BN){const BN=kB(vN.target);BN&&(NN.beginAnimation(BN,vN.fromFrame,vN.toFrame,vN.loopAnimation,vN.speedRatio,vN.onAnimationEnd?vN.onAnimationEnd:void 0,void 0,!0,void 0,vN.onAnimationLoop?vN.onAnimationLoop:void 0),NN.stopAnimation(vN.target))}return cN}populateRootNodes(){this.rootNodes.length=0;for(const NN of this.meshes)NN.parent||-1!==this.rootNodes.indexOf(NN)||this.rootNodes.push(NN);for(const NN of this.transformNodes)NN.parent||-1!==this.rootNodes.indexOf(NN)||this.rootNodes.push(NN);for(const NN of this.lights)NN.parent||-1!==this.rootNodes.indexOf(NN)||this.rootNodes.push(NN);for(const NN of this.cameras)NN.parent||-1!==this.rootNodes.indexOf(NN)||this.rootNodes.push(NN)}addAllAssetsToContainer(NN){if(!NN)return;const BN=[],lN=new Set;for(BN.push(NN);BN.length>0;){const NN=BN.pop();if(NN instanceof vN.e?(NN.dc&&-1===this.geometries.indexOf(NN.dc)&&this.geometries.push(NN.dc),this.meshes.push(NN)):NN instanceof VN.e?this.meshes.push(NN):NN instanceof HN.e?this.transformNodes.push(NN):NN instanceof fN.b?this.lights.push(NN):NN instanceof ZN.c&&this.cameras.push(NN),NN instanceof TN.e){if(NN.material&&-1===this.materials.indexOf(NN.material)){this.materials.push(NN.material);for(const BN of NN.material.getActiveTextures())-1===this.textures.indexOf(BN)&&this.textures.push(BN)}NN.skeleton&&-1===this.skeletons.indexOf(NN.skeleton)&&this.skeletons.push(NN.skeleton),NN.morphTargetManager&&-1===this.morphTargetManagers.indexOf(NN.morphTargetManager)&&this.morphTargetManagers.push(NN.morphTargetManager)}for(const kB of NN.getChildren())lN.has(kB)||BN.push(kB);lN.add(NN)}this.populateRootNodes()}_getByTags(NN,BN,lN){if(void 0===BN)return NN;const kB=[];for(const qN in NN){const cN=NN[qN];PN.b&&PN.b.MatchesQuery(cN,BN)&&(!lN||lN(cN))&&kB.push(cN)}return kB}getMeshesByTags(NN,BN){return this._getByTags(this.meshes,NN,BN)}getCamerasByTags(NN,BN){return this._getByTags(this.cameras,NN,BN)}getLightsByTags(NN,BN){return this._getByTags(this.lights,NN,BN)}getMaterialsByTags(NN,BN){return this._getByTags(this.materials,NN,BN).concat(this._getByTags(this.multiMaterials,NN,BN))}getTransformNodesByTags(NN,BN){return this._getByTags(this.transformNodes,NN,BN)}}var MN=lN(14797);class GN{constructor(NN){this.byteOffset=0,this.buffer=NN}async loadAsync(NN){const BN=await this.buffer.readAsync(this.byteOffset,NN);this._dataView=new DataView(BN.buffer,BN.byteOffset,BN.byteLength),this._dataByteOffset=0}readUint32(){const NN=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,NN}readUint8Array(NN){const BN=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,NN);return this._dataByteOffset+=NN,this.byteOffset+=NN,BN}readString(NN){return(0,MN.i)(this.readUint8Array(NN))}skipBytes(NN){this._dataByteOffset+=NN,this.byteOffset+=NN}}var XN=lN(15822);const uN="Z2xURg",dN={name:"sc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:NN=>-1!==NN.indexOf("asset")&&-1!==NN.indexOf("version")||NN.startsWith("data:base64,"+uN)||NN.startsWith("data:;base64,"+uN)||NN.startsWith("data:application/octet-stream;base64,"+uN)||NN.startsWith("data:model/gltf-binary;base64,"+uN)};var EN,KN,gN,nN=lN(14781),rN=lN(14789);function pN(NN,BN,lN){try{return Promise.resolve(new Uint8Array(NN,BN,lN))}catch(kB){return Promise.reject(kB)}}!function(NN){NN[NN.AUTO=0]="AUTO",NN[NN.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(EN||(EN={})),function(NN){NN[NN.NONE=0]="NONE",NN[NN.FIRST=1]="FIRST",NN[NN.ALL=2]="ALL"}(KN||(KN={})),function(NN){NN[NN.LOADING=0]="LOADING",NN[NN.READY=1]="READY",NN[NN.COMPLETE=2]="COMPLETE"}(gN||(gN={}));class xN{constructor(){this.coordinateSystemMode=EN.AUTO,this.animationStartMode=KN.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=NN=>Promise.resolve(NN),this.extensionOptions={}}kB(NN){var BN,lN,kB,qN,cN,eN,vN,HN,TN,RN,sN,VN,fN,ZN,PN,CN,FN,IN,AN,MN,GN;NN&&(this.onParsed=NN.onParsed,this.coordinateSystemMode=null!==(BN=NN.coordinateSystemMode)&&void 0!==BN?BN:this.coordinateSystemMode,this.animationStartMode=null!==(lN=NN.animationStartMode)&&void 0!==lN?lN:this.animationStartMode,this.loadNodeAnimations=null!==(kB=NN.loadNodeAnimations)&&void 0!==kB?kB:this.loadNodeAnimations,this.loadSkins=null!==(qN=NN.loadSkins)&&void 0!==qN?qN:this.loadSkins,this.loadMorphTargets=null!==(cN=NN.loadMorphTargets)&&void 0!==cN?cN:this.loadMorphTargets,this.compileMaterials=null!==(eN=NN.compileMaterials)&&void 0!==eN?eN:this.compileMaterials,this.useClipPlane=null!==(vN=NN.useClipPlane)&&void 0!==vN?vN:this.useClipPlane,this.compileShadowGenerators=null!==(HN=NN.compileShadowGenerators)&&void 0!==HN?HN:this.compileShadowGenerators,this.transparencyAsCoverage=null!==(TN=NN.transparencyAsCoverage)&&void 0!==TN?TN:this.transparencyAsCoverage,this.useRangeRequests=null!==(RN=NN.useRangeRequests)&&void 0!==RN?RN:this.useRangeRequests,this.createInstances=null!==(sN=NN.createInstances)&&void 0!==sN?sN:this.createInstances,this.alwaysComputeBoundingBox=null!==(VN=NN.alwaysComputeBoundingBox)&&void 0!==VN?VN:this.alwaysComputeBoundingBox,this.loadAllMaterials=null!==(fN=NN.loadAllMaterials)&&void 0!==fN?fN:this.loadAllMaterials,this.loadOnlyMaterials=null!==(ZN=NN.loadOnlyMaterials)&&void 0!==ZN?ZN:this.loadOnlyMaterials,this.skipMaterials=null!==(PN=NN.skipMaterials)&&void 0!==PN?PN:this.skipMaterials,this.useSRGBBuffers=null!==(CN=NN.useSRGBBuffers)&&void 0!==CN?CN:this.useSRGBBuffers,this.targetFps=null!==(FN=NN.targetFps)&&void 0!==FN?FN:this.targetFps,this.alwaysComputeSkeletonRootNode=null!==(IN=NN.alwaysComputeSkeletonRootNode)&&void 0!==IN?IN:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=null!==(AN=NN.useGltfTextureNames)&&void 0!==AN?AN:this.useGltfTextureNames,this.preprocessUrlAsync=null!==(MN=NN.preprocessUrlAsync)&&void 0!==MN?MN:this.preprocessUrlAsync,this.customRootNode=NN.customRootNode,this.onMeshLoaded=NN.onMeshLoaded,this.onSkinLoaded=NN.onSkinLoaded,this.onTextureLoaded=NN.onTextureLoaded,this.onMaterialLoaded=NN.onMaterialLoaded,this.onCameraLoaded=NN.onCameraLoaded,this.extensionOptions=null!==(GN=NN.extensionOptions)&&void 0!==GN?GN:this.extensionOptions)}}class ON extends xN{constructor(NN){super(),this.onParsedObservable=new kB.b,this.onMeshLoadedObservable=new kB.b,this.onSkinLoadedObservable=new kB.b,this.onTextureLoadedObservable=new kB.b,this.onMaterialLoadedObservable=new kB.b,this.onCameraLoadedObservable=new kB.b,this.onCompleteObservable=new kB.b,this.onErrorObservable=new kB.b,this.qc=new kB.b,this.onExtensionLoadedObservable=new kB.b,this.validate=!1,this.onValidatedObservable=new kB.b,this._loader=null,this._state=null,this._requests=new Array,this.name=dN.name,this.extensions=dN.extensions,this.onLoaderStateChangedObservable=new kB.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.kB(NN)}set onParsed(NN){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),NN&&(this._onParsedObserver=this.onParsedObservable.add(NN))}set onMeshLoaded(NN){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),NN&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(NN))}set onSkinLoaded(NN){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),NN&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((BN=>NN(BN.node,BN.skinnedNode))))}set onTextureLoaded(NN){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),NN&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(NN))}set onMaterialLoaded(NN){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),NN&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(NN))}set onCameraLoaded(NN){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),NN&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(NN))}set onComplete(NN){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(NN)}set onError(NN){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(NN)}set onDispose(NN){this._onDisposeObserver&&this.qc.remove(this._onDisposeObserver),this._onDisposeObserver=this.qc.add(NN)}set onExtensionLoaded(NN){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(NN)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(NN){this._loggingEnabled!==NN&&(this._loggingEnabled=NN,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(NN){this._capturePerformanceCounters!==NN&&(this._capturePerformanceCounters=NN,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(NN){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(NN)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const NN of this._requests)NN.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=NN=>Promise.resolve(NN),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.qc.notifyObservers(void 0),this.qc.clear()}loadFile(NN,BN,lN,cN,eN,vN,HN,TN){if(ArrayBuffer.isView(BN))return this._loadBinary(NN,BN,lN,cN,HN,TN),null;this._progressCallback=eN;const sN=BN.name||qN.Tools.GetFilename(BN);if(vN){if(this.useRangeRequests){this.validate&&RN.d.Warn("glTF validation is not supported when range requests are enabled");const lN={abort:()=>{},onCompleteObservable:new kB.b},qN={readAsync:(lN,kB)=>new Promise(((qN,cN)=>{this._loadFile(NN,BN,(NN=>{qN(new Uint8Array(NN))}),!0,(NN=>{cN(NN)}),(NN=>{NN.setRequestHeader("Range","bytes=".concat(lN,"-").concat(lN+kB-1))}))})),byteLength:0};return this._unpackBinaryAsync(new GN(qN)).then((NN=>{lN.onCompleteObservable.notifyObservers(lN),cN(NN)}),HN?NN=>HN(void 0,NN):void 0),lN}return this._loadFile(NN,BN,(BN=>{this._validate(NN,new Uint8Array(BN,0,BN.byteLength),lN,sN),this._unpackBinaryAsync(new GN({readAsync:(NN,lN)=>pN(BN,NN,lN),byteLength:BN.byteLength})).then((NN=>{cN(NN)}),HN?NN=>HN(void 0,NN):void 0)}),!0,HN)}return this._loadFile(NN,BN,(BN=>{try{this._validate(NN,BN,lN,sN),cN({json:this._parseJson(BN)})}catch(kB){HN&&HN()}}),!1,HN)}_loadBinary(NN,BN,lN,kB,qN,cN){this._validate(NN,new Uint8Array(BN.buffer,BN.byteOffset,BN.byteLength),lN,cN),this._unpackBinaryAsync(new GN({readAsync:(NN,lN)=>function(NN,BN,lN){try{if(BN<0||BN>=NN.byteLength)throw new RangeError("Offset is out of range.");if(BN+lN>NN.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(NN.buffer,NN.byteOffset+BN,lN))}catch(kB){return Promise.reject(kB)}}(BN,NN,lN),byteLength:BN.byteLength})).then((NN=>{kB(NN)}),qN?NN=>qN(void 0,NN):void 0)}importMeshAsync(NN,BN,lN,kB,qN,cN){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(lN),this.onParsedObservable.clear(),this._log("Loading ".concat(cN||"")),this._loader=this._getLoader(lN),this._loader.importMeshAsync(NN,BN,null,lN,kB,qN,cN))))}loadAsync(NN,BN,lN,kB,qN){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(BN),this.onParsedObservable.clear(),this._log("Loading ".concat(qN||"")),this._loader=this._getLoader(BN),this._loader.loadAsync(NN,BN,lN,kB,qN))))}loadAssetContainerAsync(NN,BN,lN,kB,qN){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(BN),this.onParsedObservable.clear(),this._log("Loading ".concat(qN||"")),this._loader=this._getLoader(BN);const cN=new AN(NN),eN=[];this.onMaterialLoadedObservable.add((NN=>{eN.push(NN)}));const vN=[];this.onTextureLoadedObservable.add((NN=>{vN.push(NN)}));const HN=[];this.onCameraLoadedObservable.add((NN=>{HN.push(NN)}));const TN=[];return this.onMeshLoadedObservable.add((NN=>{NN.morphTargetManager&&TN.push(NN.morphTargetManager)})),this._loader.importMeshAsync(null,NN,cN,BN,lN,kB,qN).then((NN=>(Array.prototype.push.apply(cN.geometries,NN.geometries),Array.prototype.push.apply(cN.meshes,NN.meshes),Array.prototype.push.apply(cN.kP,NN.kP),Array.prototype.push.apply(cN.skeletons,NN.skeletons),Array.prototype.push.apply(cN.animationGroups,NN.animationGroups),Array.prototype.push.apply(cN.materials,eN),Array.prototype.push.apply(cN.textures,vN),Array.prototype.push.apply(cN.lights,NN.lights),Array.prototype.push.apply(cN.transformNodes,NN.transformNodes),Array.prototype.push.apply(cN.cameras,HN),Array.prototype.push.apply(cN.morphTargetManagers,TN),cN)))}))}canDirectLoad(NN){return dN.canDirectLoad(NN)}directLoad(NN,BN){if(BN.startsWith("base64,"+uN)||BN.startsWith(";base64,"+uN)||BN.startsWith("application/octet-stream;base64,"+uN)||BN.startsWith("model/gltf-binary;base64,"+uN)){const lN=(0,nN.e)(BN);return this._validate(NN,new Uint8Array(lN,0,lN.byteLength)),this._unpackBinaryAsync(new GN({readAsync:(NN,BN)=>pN(lN,NN,BN),byteLength:lN.byteLength}))}return this._validate(NN,BN),Promise.resolve({json:this._parseJson(BN)})}createPlugin(NN){return new ON(NN[dN.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((NN,BN)=>{this.onCompleteObservable.addOnce((()=>{NN()})),this.onErrorObservable.addOnce((NN=>{BN(NN)}))}))}_setState(NN){this._state!==NN&&(this._state=NN,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(gN[this._state]))}_loadFile(NN,BN,lN,kB,qN,cN){const eN=NN._loadFile(BN,lN,(NN=>{this._onProgress(NN,eN)}),!0,kB,qN,cN);return eN.onCompleteObservable.add((()=>{eN._lengthComputable=!0,eN._total=eN._loaded})),this._requests.push(eN),eN}_onProgress(NN,BN){if(!this._progressCallback)return;BN._lengthComputable=NN.lengthComputable,BN._loaded=NN.loaded,BN._total=NN.total;let lN=!0,kB=0,qN=0;for(const cN of this._requests){if(void 0===cN._lengthComputable||void 0===cN._loaded||void 0===cN._total)return;lN=lN&&cN._lengthComputable,kB+=cN._loaded,qN+=cN._total}this._progressCallback({lengthComputable:lN,loaded:kB,total:lN?qN:0})}_validate(NN,BN){let lN=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",kB=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),XN.c.ValidateAsync(BN,lN,kB,(BN=>this.preprocessUrlAsync(lN+BN).then((BN=>NN._loadFileAsync(BN,void 0,!0,!0).then((NN=>new Uint8Array(NN,0,NN.byteLength))))))).then((NN=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(NN),this.onValidatedObservable.clear()}),(NN=>{this._endPerformanceCounter("Validate JSON"),qN.Tools.Warn("Failed to validate: ".concat(NN.message)),this.onValidatedObservable.clear()})))}_getLoader(NN){const BN=NN.json.asset||{};this._log("Asset version: ".concat(BN.version)),BN.minVersion&&this._log("Asset minimum version: ".concat(BN.minVersion)),BN.generator&&this._log("Asset generator: ".concat(BN.generator));const lN=ON._parseVersion(BN.version);if(!lN)throw new Error("Invalid version: "+BN.version);if(void 0!==BN.minVersion){const NN=ON._parseVersion(BN.minVersion);if(!NN)throw new Error("Invalid minimum version: "+BN.minVersion);if(ON._compareVersion(NN,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+BN.minVersion)}const kB={1:ON._CreateGLTF1Loader,2:ON._CreateGLTF2Loader}[lN.major];if(!kB)throw new Error("Unsupported version: "+BN.version);return kB(this)}_parseJson(NN){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(NN.length));const BN=JSON.parse(NN);return this._endPerformanceCounter("Parse JSON"),BN}_unpackBinaryAsync(NN){return this._startPerformanceCounter("Unpack Binary"),NN.loadAsync(20).then((()=>{const BN=NN.readUint32();if(1179937895!==BN)throw new rN.i("Unexpected magic: "+BN,rN.e.GLTFLoaderUnexpectedMagicError);const lN=NN.readUint32();this.loggingEnabled&&this._log("Binary version: ".concat(lN));const kB=NN.readUint32();let qN;switch(this.useRangeRequests||kB===NN.buffer.byteLength||RN.d.Warn("Length in header does not match actual data length: ".concat(kB," != ").concat(NN.buffer.byteLength)),lN){case 1:qN=this._unpackBinaryV1Async(NN,kB);break;case 2:qN=this._unpackBinaryV2Async(NN,kB);break;default:throw new Error("Unsupported version: "+lN)}return this._endPerformanceCounter("Unpack Binary"),qN}))}_unpackBinaryV1Async(NN,BN){const lN=NN.readUint32(),kB=NN.readUint32();if(0!==kB)throw new Error("Unexpected content format: ".concat(kB));const qN=BN-NN.byteOffset,cN={json:this._parseJson(NN.readString(lN)),bin:null};if(0!==qN){const BN=NN.byteOffset;cN.bin={readAsync:(lN,kB)=>NN.buffer.readAsync(BN+lN,kB),byteLength:qN}}return Promise.resolve(cN)}_unpackBinaryV2Async(NN,BN){const lN=1313821514,kB=5130562,qN=NN.readUint32();if(NN.readUint32()!==lN)throw new Error("First chunk format is not JSON");return NN.byteOffset+qN===BN?NN.loadAsync(qN).then((()=>({json:this._parseJson(NN.readString(qN)),bin:null}))):NN.loadAsync(qN+8).then((()=>{const cN={json:this._parseJson(NN.readString(qN)),bin:null},eN=()=>{const qN=NN.readUint32();switch(NN.readUint32()){case lN:throw new Error("Unexpected JSON chunk");case kB:{const BN=NN.byteOffset;cN.bin={readAsync:(lN,kB)=>NN.buffer.readAsync(BN+lN,kB),byteLength:qN},NN.skipBytes(qN);break}default:NN.skipBytes(qN)}return NN.byteOffset!==BN?NN.loadAsync(8).then(eN):Promise.resolve(cN)};return eN()}))}static _parseVersion(NN){if("1.0"===NN||"1.0.1"===NN)return{major:1,minor:0};const BN=(NN+"").match(/^(\d+)\.(\d+)/);return BN?{major:parseInt(BN[1]),minor:parseInt(BN[2])}:null}static _compareVersion(NN,BN){return NN.major>BN.major?1:NN.major<BN.major?-1:NN.minor>BN.minor?1:NN.minor<BN.minor?-1:0}_logOpen(NN){this._log(NN),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(NN){const BN=ON._logSpaces.substring(0,2*this._logIndentLevel);RN.d.Log("".concat(BN).concat(NN))}_logDisabled(NN){}_startPerformanceCounterEnabled(NN){qN.Tools.StartPerformanceCounter(NN)}_startPerformanceCounterDisabled(NN){}_endPerformanceCounterEnabled(NN){qN.Tools.EndPerformanceCounter(NN)}_endPerformanceCounterDisabled(NN){}}ON.IncrementalLoading=!0,ON.HomogeneousCoordinates=!1,ON._logSpaces="                                ",(0,cN.d)(new ON)},15822:(NN,BN,lN)=>{"use strict";lN.d(BN,{c:()=>eN});var kB=lN(14727);function qN(NN,BN,lN,kB){const qN={externalResourceFunction:kB};return lN&&(qN.uri="file:"===BN?lN:BN+lN),ArrayBuffer.isView(NN)?GLTFValidator.validateBytes(NN,qN):GLTFValidator.validateString(NN,qN)}function cN(){const NN=[];onmessage=BN=>{const lN=BN.data;switch(lN.id){case"init":importScripts(lN.url);break;case"validate":qN(lN.data,lN.rootUrl,lN.fileName,(BN=>new Promise(((lN,kB)=>{const qN=NN.length;NN.push({resolve:lN,reject:kB}),postMessage({id:"getExternalResource",index:qN,uri:BN})})))).then((NN=>{postMessage({id:"validate.resolve",value:NN})}),(NN=>{postMessage({id:"validate.reject",reason:NN})}));break;case"getExternalResource.resolve":NN[lN.index].resolve(lN.value);break;case"getExternalResource.reject":NN[lN.index].reject(lN.reason)}}}class eN{static ValidateAsync(NN,BN,lN,eN){return"function"===typeof Worker?new Promise(((vN,HN)=>{const TN="".concat(qN,"(").concat(cN,")()"),RN=URL.createObjectURL(new Blob([TN],{type:"application/javascript"})),sN=new Worker(RN),VN=NN=>{sN.removeEventListener("error",VN),sN.removeEventListener("message",fN),HN(NN)},fN=NN=>{const BN=NN.data;switch(BN.id){case"getExternalResource":eN(BN.uri).then((NN=>{sN.postMessage({id:"getExternalResource.resolve",index:BN.index,value:NN},[NN.buffer])}),(NN=>{sN.postMessage({id:"getExternalResource.reject",index:BN.index,reason:NN})}));break;case"validate.resolve":sN.removeEventListener("error",VN),sN.removeEventListener("message",fN),vN(BN.value),sN.terminate();break;case"validate.reject":sN.removeEventListener("error",VN),sN.removeEventListener("message",fN),HN(BN.reason),sN.terminate()}};if(sN.addEventListener("error",VN),sN.addEventListener("message",fN),sN.postMessage({id:"init",url:kB.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(NN)){const kB=NN.slice();sN.postMessage({id:"validate",data:kB,rootUrl:BN,fileName:lN},[kB.buffer])}else sN.postMessage({id:"validate",data:NN,rootUrl:BN,fileName:lN})})):(this._LoadScriptPromise||(this._LoadScriptPromise=kB.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>qN(NN,BN,lN,eN))))}}eN.Configuration={url:"".concat(kB.Tools._DefaultCdnUrl,"/gltf_validator.js")}},16767:(NN,BN,lN)=>{"use strict";lN.d(BN,{d:()=>uN});var kB=lN(14905),qN=lN(14910),cN=lN(14959),eN=lN(14925),vN=lN(15325),HN=lN(15252),TN=lN(14998),RN=lN(15162),sN=lN(14881),VN=lN(14833);lN(16070),lN(15983),lN(15992),lN(15985),lN(16001),lN(16006),lN(16015);const fN="imageProcessingCompatibility",ZN="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";VN.c.IncludesShadersStore[fN]||(VN.c.IncludesShadersStore[fN]=ZN);const PN="skyPixelShader",CN="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";VN.c.ShadersStore[PN]||(VN.c.ShadersStore[PN]=CN);lN(16076),lN(16018),lN(16021),lN(16032),lN(16023);const FN="skyVertexShader",IN="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";VN.c.ShadersStore[FN]||(VN.c.ShadersStore[FN]=IN);var AN=lN(15245),MN=lN(15306),GN=lN(15297);class XN extends vN.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class uN extends HN.c{constructor(NN,BN){super(NN,BN),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new eN.fB(0,100,0),this.useSunPosition=!1,this.cameraOffset=eN.fB.Zero(),this.up=eN.fB.Up(),this.dithering=!1,this._cameraPosition=eN.fB.Zero(),this._skyOrientation=new eN.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(NN,BN){const lN=BN._drawWrapper;if(this.isFrozen&&lN.effect&&lN._wasPreviouslyReady)return!0;BN.materialDefines||(BN.materialDefines=new XN);const kB=BN.materialDefines,qN=this.VB();if(this._isReadyForSubMesh(BN))return!0;if((0,GN.I)(NN,qN,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,kB),(0,GN.y)(NN,kB,!0,!1),kB.IMAGEPROCESSINGPOSTPROCESS!==qN.imageProcessingConfiguration.applyByPostProcess&&kB.markAsMiscDirty(),kB.DITHER!==this.dithering&&kB.markAsMiscDirty(),kB.isDirty){kB.markAsProcessed(),qN.resetCachedMaterial();const NN=new AN.e;kB.FOG&&NN.addFallback(1,"FOG"),kB.IMAGEPROCESSINGPOSTPROCESS=qN.imageProcessingConfiguration.applyByPostProcess,kB.DITHER=this.dithering;const lN=[TN.f.PositionKind];kB.VERTEXCOLOR&&lN.push(TN.f.ColorKind);const cN="sky",eN=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,MN.e)(eN);const vN=kB.toString();BN.setEffect(qN.getEngine().createEffect(cN,lN,eN,[],vN,NN,this.onCompiled,this.onError),kB,this._materialContext)}return!(!BN.effect||!BN.effect.isReady())&&(kB._renderId=qN.getRenderId(),lN._wasPreviouslyReady=!0,!0)}bindForSubMesh(NN,BN,lN){const kB=this.VB(),qN=lN.materialDefines;if(!qN)return;const cN=lN.effect;if(!cN)return;this._activeEffect=cN,this.bindOnlyWorldMatrix(NN),this._activeEffect.setMatrix("viewProjection",kB.getTransformMatrix()),this._mustRebind(kB,cN,lN)&&((0,MN.g)(cN,this,kB),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,GN.h)(qN,cN,kB)),kB.fogEnabled&&BN.applyFog&&kB.fogMode!==RN.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",kB.getViewMatrix()),(0,GN.d)(kB,BN,this._activeEffect);const vN=kB.activeCamera;if(vN){const NN=vN.getWorldMatrix();this._cameraPosition.x=NN.m[12],this._cameraPosition.y=NN.m[13],this._cameraPosition.z=NN.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const NN=Math.PI*(this.inclination-.5),BN=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(BN)*Math.cos(NN),this.sunPosition.y=this.distance*Math.sin(-NN),this.sunPosition.z=this.distance*Math.sin(BN)*Math.cos(NN),eN.Quaternion.FromUnitVectorsToRef(eN.fB.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(BN,this._activeEffect,lN)}getAnimatables(){return[]}dispose(NN){super.dispose(NN)}clone(NN){return cN.b.Clone((()=>new uN(NN,this.VB())),this)}serialize(){const NN=super.serialize();return NN.customType="BABYLON.SkyMaterial",NN}getClassName(){return"SkyMaterial"}static Parse(NN,BN,lN){return cN.b.Parse((()=>new uN(NN.name,BN)),NN,BN,lN)}}(0,kB.c)([(0,qN.G)()],uN.prototype,"luminance",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"turbidity",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"rayleigh",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"mieCoefficient",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"mieDirectionalG",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"distance",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"inclination",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"azimuth",void 0),(0,kB.c)([(0,qN.F)()],uN.prototype,"sunPosition",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"useSunPosition",void 0),(0,kB.c)([(0,qN.F)()],uN.prototype,"cameraOffset",void 0),(0,kB.c)([(0,qN.F)()],uN.prototype,"up",void 0),(0,kB.c)([(0,qN.G)()],uN.prototype,"dithering",void 0),(0,sN.f)("BABYLON.SkyMaterial",uN)},15636:(NN,BN,lN)=>{"use strict";function kB(NN,BN){BN.headers=NN.headers||{},BN.statusMessage=NN.statusText,BN.statusCode=NN.status,BN.data=NN.response}function qN(NN,BN,lN){return new Promise((function(qN,cN){lN=lN||{};var eN,vN,HN,TN=new XMLHttpRequest,RN=lN.body,sN=lN.headers||{};for(eN in lN.timeout&&(TN.timeout=lN.timeout),TN.ontimeout=TN.onerror=function(NN){NN.timeout="timeout"==NN.type,cN(NN)},TN.open(NN,BN.href||BN),TN.onload=function(){for(HN=TN.getAllResponseHeaders().trim().split(/[\r\n]+/),kB(TN,TN);vN=HN.shift();)vN=vN.split(": "),TN.headers[vN.shift().toLowerCase()]=vN.join(": ");if((vN=TN.headers["content-type"])&&~vN.indexOf("application/json"))try{TN.data=JSON.parse(TN.data,lN.reviver)}catch(NN){return kB(TN,NN),cN(NN)}(TN.status>=400?cN:qN)(TN)},typeof FormData<"u"&&RN instanceof FormData||RN&&"object"==typeof RN&&(sN["content-type"]="application/json",RN=JSON.stringify(RN)),TN.withCredentials=!!lN.withCredentials,sN)TN.setRequestHeader(eN,sN[eN]);TN.send(RN)}))}lN.r(BN),lN.d(BN,{del:()=>HN,get:()=>cN,patch:()=>vN,post:()=>eN,put:()=>TN,send:()=>qN});var cN=qN.bind(qN,"GET"),eN=qN.bind(qN,"POST"),vN=qN.bind(qN,"PATCH"),HN=qN.bind(qN,"DELETE"),TN=qN.bind(qN,"PUT")},16904:(NN,BN,lN)=>{"use strict";lN.d(BN,{b:()=>sN});const kB=.5*(Math.sqrt(3)-1),qN=(3-Math.sqrt(3))/6,cN=1/3,eN=1/6,vN=(Math.sqrt(5)-1)/4,HN=(5-Math.sqrt(5))/20,TN=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),RN=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const sN=class{constructor(){let NN=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const BN="function"==typeof NN?NN:function(NN){let BN=0,lN=0,kB=0,qN=1;const cN=function(){let NN=4022871197;return function(BN){BN=BN.toString();for(let lN=0;lN<BN.length;lN++){NN+=BN.charCodeAt(lN);let kB=.02519603282416938*NN;NN=kB>>>0,kB-=NN,kB*=NN,NN=kB>>>0,kB-=NN,NN+=4294967296*kB}return 2.3283064365386963e-10*(NN>>>0)}}();BN=cN(" "),lN=cN(" "),kB=cN(" "),BN-=cN(NN),BN<0&&(BN+=1);lN-=cN(NN),lN<0&&(lN+=1);kB-=cN(NN),kB<0&&(kB+=1);return function(){const NN=2091639*BN+2.3283064365386963e-10*qN;return BN=lN,lN=kB,kB=NN-(qN=0|NN)}}(NN);this.p=function(NN){const BN=new Uint8Array(256);for(let lN=0;lN<256;lN++)BN[lN]=lN;for(let lN=0;lN<255;lN++){const kB=lN+~~(NN()*(256-lN)),qN=BN[lN];BN[lN]=BN[kB],BN[kB]=qN}return BN}(BN),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let lN=0;lN<512;lN++)this.perm[lN]=this.p[255&lN],this.permMod12[lN]=this.perm[lN]%12}noise2D(NN,BN){const lN=this.permMod12,cN=this.perm;let eN=0,vN=0,HN=0;const RN=(NN+BN)*kB,sN=Math.floor(NN+RN),VN=Math.floor(BN+RN),fN=(sN+VN)*qN,ZN=NN-(sN-fN),PN=BN-(VN-fN);let CN,FN;ZN>PN?(CN=1,FN=0):(CN=0,FN=1);const IN=ZN-CN+qN,AN=PN-FN+qN,MN=ZN-1+2*qN,GN=PN-1+2*qN,XN=255&sN,uN=255&VN;let dN=.5-ZN*ZN-PN*PN;if(dN>=0){const NN=3*lN[XN+cN[uN]];dN*=dN,eN=dN*dN*(TN[NN]*ZN+TN[NN+1]*PN)}let EN=.5-IN*IN-AN*AN;if(EN>=0){const NN=3*lN[XN+CN+cN[uN+FN]];EN*=EN,vN=EN*EN*(TN[NN]*IN+TN[NN+1]*AN)}let KN=.5-MN*MN-GN*GN;if(KN>=0){const NN=3*lN[XN+1+cN[uN+1]];KN*=KN,HN=KN*KN*(TN[NN]*MN+TN[NN+1]*GN)}return 70*(eN+vN+HN)}noise3D(NN,BN,lN){const kB=this.permMod12,qN=this.perm;let vN,HN,RN,sN;const VN=(NN+BN+lN)*cN,fN=Math.floor(NN+VN),ZN=Math.floor(BN+VN),PN=Math.floor(lN+VN),CN=(fN+ZN+PN)*eN,FN=NN-(fN-CN),IN=BN-(ZN-CN),AN=lN-(PN-CN);let MN,GN,XN,uN,dN,EN;FN>=IN?IN>=AN?(MN=1,GN=0,XN=0,uN=1,dN=1,EN=0):FN>=AN?(MN=1,GN=0,XN=0,uN=1,dN=0,EN=1):(MN=0,GN=0,XN=1,uN=1,dN=0,EN=1):IN<AN?(MN=0,GN=0,XN=1,uN=0,dN=1,EN=1):FN<AN?(MN=0,GN=1,XN=0,uN=0,dN=1,EN=1):(MN=0,GN=1,XN=0,uN=1,dN=1,EN=0);const KN=FN-MN+eN,gN=IN-GN+eN,nN=AN-XN+eN,rN=FN-uN+2*eN,pN=IN-dN+2*eN,xN=AN-EN+2*eN,ON=FN-1+.5,wN=IN-1+.5,bN=AN-1+.5,mB=255&fN,aN=255&ZN,DN=255&PN;let yN=.6-FN*FN-IN*IN-AN*AN;if(yN<0)vN=0;else{const NN=3*kB[mB+qN[aN+qN[DN]]];yN*=yN,vN=yN*yN*(TN[NN]*FN+TN[NN+1]*IN+TN[NN+2]*AN)}let LN=.6-KN*KN-gN*gN-nN*nN;if(LN<0)HN=0;else{const NN=3*kB[mB+MN+qN[aN+GN+qN[DN+XN]]];LN*=LN,HN=LN*LN*(TN[NN]*KN+TN[NN+1]*gN+TN[NN+2]*nN)}let hN=.6-rN*rN-pN*pN-xN*xN;if(hN<0)RN=0;else{const NN=3*kB[mB+uN+qN[aN+dN+qN[DN+EN]]];hN*=hN,RN=hN*hN*(TN[NN]*rN+TN[NN+1]*pN+TN[NN+2]*xN)}let UN=.6-ON*ON-wN*wN-bN*bN;if(UN<0)sN=0;else{const NN=3*kB[mB+1+qN[aN+1+qN[DN+1]]];UN*=UN,sN=UN*UN*(TN[NN]*ON+TN[NN+1]*wN+TN[NN+2]*bN)}return 32*(vN+HN+RN+sN)}noise4D(NN,BN,lN,kB){const qN=this.perm;let cN,eN,TN,sN,VN;const fN=(NN+BN+lN+kB)*vN,ZN=Math.floor(NN+fN),PN=Math.floor(BN+fN),CN=Math.floor(lN+fN),FN=Math.floor(kB+fN),IN=(ZN+PN+CN+FN)*HN,AN=NN-(ZN-IN),MN=BN-(PN-IN),GN=lN-(CN-IN),XN=kB-(FN-IN);let uN=0,dN=0,EN=0,KN=0;AN>MN?uN++:dN++,AN>GN?uN++:EN++,AN>XN?uN++:KN++,MN>GN?dN++:EN++,MN>XN?dN++:KN++,GN>XN?EN++:KN++;const gN=uN>=3?1:0,nN=dN>=3?1:0,rN=EN>=3?1:0,pN=KN>=3?1:0,xN=uN>=2?1:0,ON=dN>=2?1:0,wN=EN>=2?1:0,bN=KN>=2?1:0,mB=uN>=1?1:0,aN=dN>=1?1:0,DN=EN>=1?1:0,yN=KN>=1?1:0,LN=AN-gN+HN,hN=MN-nN+HN,UN=GN-rN+HN,WN=XN-pN+HN,QN=AN-xN+2*HN,SN=MN-ON+2*HN,iB=GN-wN+2*HN,tN=XN-bN+2*HN,oN=AN-mB+3*HN,JN=MN-aN+3*HN,YN=GN-DN+3*HN,jB=XN-yN+3*HN,zN=AN-1+4*HN,NB=MN-1+4*HN,BB=GN-1+4*HN,lB=XN-1+4*HN,kl=255&ZN,qB=255&PN,cB=255&CN,eB=255&FN;let vB=.6-AN*AN-MN*MN-GN*GN-XN*XN;if(vB<0)cN=0;else{const NN=qN[kl+qN[qB+qN[cB+qN[eB]]]]%32*4;vB*=vB,cN=vB*vB*(RN[NN]*AN+RN[NN+1]*MN+RN[NN+2]*GN+RN[NN+3]*XN)}let HB=.6-LN*LN-hN*hN-UN*UN-WN*WN;if(HB<0)eN=0;else{const NN=qN[kl+gN+qN[qB+nN+qN[cB+rN+qN[eB+pN]]]]%32*4;HB*=HB,eN=HB*HB*(RN[NN]*LN+RN[NN+1]*hN+RN[NN+2]*UN+RN[NN+3]*WN)}let TB=.6-QN*QN-SN*SN-iB*iB-tN*tN;if(TB<0)TN=0;else{const NN=qN[kl+xN+qN[qB+ON+qN[cB+wN+qN[eB+bN]]]]%32*4;TB*=TB,TN=TB*TB*(RN[NN]*QN+RN[NN+1]*SN+RN[NN+2]*iB+RN[NN+3]*tN)}let RB=.6-oN*oN-JN*JN-YN*YN-jB*jB;if(RB<0)sN=0;else{const NN=qN[kl+mB+qN[qB+aN+qN[cB+DN+qN[eB+yN]]]]%32*4;RB*=RB,sN=RB*RB*(RN[NN]*oN+RN[NN+1]*JN+RN[NN+2]*YN+RN[NN+3]*jB)}let sB=.6-zN*zN-NB*NB-BB*BB-lB*lB;if(sB<0)VN=0;else{const NN=qN[kl+1+qN[qB+1+qN[cB+1+qN[eB+1]]]]%32*4;sB*=sB,VN=sB*sB*(RN[NN]*zN+RN[NN+1]*NB+RN[NN+2]*BB+RN[NN+3]*lB)}return 27*(cN+eN+TN+sN+VN)}}}}]);
//# sourceMappingURL=zc38s.33.ab366040.chunk.js.map
//# debugId=49ffa5cd-876e-5ae9-8c4a-06d441e3851a
