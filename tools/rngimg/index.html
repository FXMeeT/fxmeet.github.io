<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Random Image Generator</title>
<style>
  body { margin: 0; background: black; display: flex; align-items: center; justify-content: center; height: 100vh; }
  canvas { display: none; } /* canvas only used for generating blob */
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
// ===== Helpers =====
function getParams() {
    const params = new URLSearchParams(location.search);
    return {
        seed: params.get("seed") || null,
        type: (params.get("t") || "c").toLowerCase()
    };
}

// Crypto RNG
function cryptoRandom() {
    const arr = new Uint8Array(1);
    crypto.getRandomValues(arr);
    return arr[0] / 255;
}

// Seeded RNG (Parkâ€“Miller LCG)
function seededRandom(seed) {
    let s = seed % 2147483647;
    return function() {
        s = (s * 16807) % 2147483647;
        return (s % 256) / 255;
    }
}

// Generate random pixel
function randomPixel(rngFunc, type) {
    let isColor = false;
    if (type === "c") isColor = true;
    else if (type === "b") isColor = false;
    else if (type === "cb" || type === "bc") isColor = Math.random() < 0.5;

    if (isColor) {
        return [
            Math.floor(rngFunc() * 256), 
            Math.floor(rngFunc() * 256), 
            Math.floor(rngFunc() * 256), 
            255
        ];
    } else {
        const gray = Math.floor(rngFunc() * 256);
        return [gray, gray, gray, 255];
    }
}

// ===== Main =====
async function generateAndRedirect() {
    const { seed, type } = getParams();
    const width = 1920;
    const height = 1080;

    const canvas = document.getElementById("canvas");
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");
    const imgData = ctx.createImageData(width, height);

    const rng = seed ? seededRandom(Number(seed)) : cryptoRandom;

    for (let i = 0; i < imgData.data.length; i += 4) {
        const [r,g,b,a] = randomPixel(rng, type);
        imgData.data[i] = r;
        imgData.data[i+1] = g;
        imgData.data[i+2] = b;
        imgData.data[i+3] = a;
    }

    ctx.putImageData(imgData, 0, 0);

    // Convert canvas to Blob and redirect
    canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        // Redirect to blob URL
        window.location.href = url;

        // Optionally revoke after some delay to allow display
        setTimeout(() => URL.revokeObjectURL(url), 60000);
    }, "image/png");
}

generateAndRedirect();
</script>
</body>
</html>
