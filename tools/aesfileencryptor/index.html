<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AES File Encryptor/Decryptor</title>
</head>
<body>
  <h2>AES File Encryptor/Decryptor</h2>

  <input type="file" id="fileInput"><br><br>
  <input type="password" id="password" placeholder="Enter password"><br><br>

  <button id="encryptBtn" onclick="encryptFile()">Encrypt</button>
  <button id="decryptBtn" onclick="decryptFile()">Decrypt</button>

  <p id="status"></p>
  <a id="downloadLink" style="display:none;">Download</a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script>
    async function encryptFile() {
      const fileInput = document.getElementById('fileInput');
      const password = document.getElementById('password').value;
      const encryptBtn = document.getElementById('encryptBtn');
      const status = document.getElementById('status');
      const downloadLink = document.getElementById('downloadLink');

      if (!fileInput.files.length || !password) {
        alert("Select a file and enter a password!");
        return;
      }

      const file = fileInput.files[0];
      encryptBtn.disabled = true;
      status.textContent = "Encrypting... please wait";
      downloadLink.style.display = "none";

      const reader = new FileReader();
      reader.onload = function(e) {
        const wordArray = CryptoJS.lib.WordArray.create(e.target.result);
        const encrypted = CryptoJS.AES.encrypt(wordArray, password).toString();

        const blob = new Blob([encrypted], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.download = file.name + ".fxmencrypted";
        downloadLink.textContent = "Download Encrypted File";
        downloadLink.style.display = "block";

        status.textContent = "Encryption complete!";
        encryptBtn.disabled = false;
      };
      reader.readAsArrayBuffer(file);
    }

    async function decryptFile() {
      const fileInput = document.getElementById('fileInput');
      const password = document.getElementById('password').value;
      const decryptBtn = document.getElementById('decryptBtn');
      const status = document.getElementById('status');
      const downloadLink = document.getElementById('downloadLink');

      if (!fileInput.files.length || !password) {
        alert("Select a file and enter a password!");
        return;
      }

      const file = fileInput.files[0];
      decryptBtn.disabled = true;
      status.textContent = "Decrypting... please wait";
      downloadLink.style.display = "none";

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const encryptedText = e.target.result;
          const decrypted = CryptoJS.AES.decrypt(encryptedText, password);
          const typedArray = new Uint8Array(decrypted.sigBytes);
          for (let i = 0; i < decrypted.sigBytes; i++) {
            typedArray[i] = (decrypted.words[i >>> 2] >> (24 - (i % 4) * 8)) & 0xff;
          }

          let originalName = file.name.replace(/\.fxmencrypted$/, "");
          const blob = new Blob([typedArray]);
          const url = URL.createObjectURL(blob);

          downloadLink.href = url;
          downloadLink.download = originalName;
          downloadLink.textContent = "Download Decrypted File";
          downloadLink.style.display = "block";

          status.textContent = "Decryption complete!";
        } catch (err) {
          status.textContent = "Decryption failed. Wrong password or corrupted file.";
        }
        decryptBtn.disabled = false;
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
