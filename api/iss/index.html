<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ISS API proxy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body style="font-family:system-ui,Segoe UI,Roboto,-apple-system,Arial,sans-serif;padding:20px;">
  <pre id="out">Loadingâ€¦</pre>

<script>
(function(){
  const params = new URLSearchParams(location.search);
  const d = (params.get('d') || 'la').toLowerCase(); // ts, la, lo

  if (!['ts','la','lo'].includes(d)) {
    document.getElementById('out').textContent = 'Invalid param. Use ?d=ts | ?d=la | ?d=lo';
    return;
  }

  const xhr = new XMLHttpRequest();
  xhr.open('GET', 'http://api.open-notify.org/iss-now.json', true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status >= 200 && xhr.status < 300) {
        try {
          const data = JSON.parse(xhr.responseText);
          let result = '';
          if (d === 'ts') result = String(data.timestamp ?? '');
          if (d === 'la') result = String((data.iss_position && data.iss_position.latitude) ?? '');
          if (d === 'lo') result = String((data.iss_position && data.iss_position.longitude) ?? '');

          document.body.innerHTML = ''; // clear everything
          const pre = document.createElement('pre');
          pre.style.fontSize = '16px';
          pre.style.whiteSpace = 'pre-wrap';
          pre.textContent = result;
          document.body.appendChild(pre);
          document.title = result;
        } catch (err) {
          document.getElementById('out').textContent = 'Error parsing JSON: ' + err;
        }
      } else {
        document.getElementById('out').textContent = 'HTTP error: ' + xhr.status;
      }
    }
  };
  xhr.send();
})();
</script>
</body>
</html>
